Mediasite.namespace("Player"),Mediasite.Player.BookmarkStore=function(n,t,r,u,f){function compareSavedAt(n,t){return n.savedAt<t.savedAt?-1:n.savedAt>t.savedAt?1:0}var s=this,l=0,c=0,h=864e6,a=10,e="bookmarks",o=null;t=isNaN(t)?0:t,this.start=function(n){o=n},this.save=function(s,l){var b=0,k,v,w;if(Mediasite.Player.Support.localstorage&&!r&&o!==null&&(k=Math.floor((s-o)/1e3),k!==0)){for(v=JSON.parse(localStorage.getItem(e)),w=JSON.stringify(v),v===null&&(v=[]),i=0;i<v.length;i++)v[i].presentationId===n&&v.splice(i,1);if(s>c&&s<h&&Math.abs(t-s)>2100){var y=new Date,p=Date.UTC(y.getFullYear(),y.getMonth(),y.getDate(),y.getHours(),y.getMinutes(),y.getSeconds(),y.getMilliseconds()),p=p-u;v.push({presentationId:n,position:s,savedAt:p/1e3}),b=s}for(v.sort(compareSavedAt);v.length>a;)v.shift();return JSON.stringify(v)!==w&&(v.length===0?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(v))),f.SaveBookmark(JSON.stringify({playbackTicket:l,position:b})),o=null,v.length}},this.retrieve=function(){if(!Mediasite.Player.Support.localstorage)return l;var t=JSON.parse(localStorage.getItem(e)),r={position:0,savedAt:0};if(t!==null)for(i=0;i<t.length;i++)if(t[i].presentationId===n)return r.position=Math.min(Math.max(t[i].position,c),h),r.savedAt=t[i].savedAt,r;return r},this.watchViewTracking=function(n,t){n.addHandler({start:function(n){s.start(n*1e3)},end:function(n,i){s.save(i*1e3,t)}})}}
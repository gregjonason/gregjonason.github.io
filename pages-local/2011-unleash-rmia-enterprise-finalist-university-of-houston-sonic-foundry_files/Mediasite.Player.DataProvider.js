Mediasite.namespace("Mediasite.Player.DataProvider"),Mediasite.Player.DataProviderType={None:0,Server:1,PublishToGo:2,Recorder:3},Mediasite.Player.DataProvider.GetProvider=function(n,t,i,r,u,f){switch(n){case Mediasite.Player.DataProviderType.Server:return new Mediasite.Player.DataProvider.Server(t,i,r,u,f);case Mediasite.Player.DataProviderType.PublishToGo:return new Mediasite.Player.DataProvider.PublishToGo;case Mediasite.Player.DataProviderType.Recorder:return new Mediasite.Player.DataProvider.Recorder(t,i,r);default:return new Mediasite.Player.DataProvider.Server(t,i,r,u)}},Mediasite.Player.DataProvider.Server=function(n,t,i,r,u){function hackInDashVideoUrls(n){for(var i,t,u,r=0;r<n.length;r++)for(t=n[r],i=0;i<t.VideoUrls.length;i++)if(u=t.VideoUrls[i],u.MimeType==Mediasite.Player.MimeTypes.SS){t.VideoUrls.push(makeDashUrlItem(u));break}}function makeDashUrlItem(n){return $.extend({},n,{Location:n.Location.replace(/manifest/i,"manifest(format=mpd-time-csf)"),MimeType:Mediasite.Player.MimeTypes.Dash})}function setAbsoluteSlideBaseUrl(n){var i,u,t,r;if(n.Streams)for(i=0,u=n.Streams.length;i<u;i++)t=n.Streams[i],t.SlideBaseUrl!==null&&t.SlideBaseUrl.indexOf("://")===-1&&(r=r||Mediasite.BrowserDetect.GetBaseUri(),t.SlideBaseUrl=r+"/"+t.SlideBaseUrl)}function ajaxSetup(){$(document).ajaxComplete(function(n,t){var r;try{r=JSON.parse(t.responseText)}catch(n){if(t.statusCode().status==404)r={Message:"An error occurred.  Please check the server logs.",Success:!1};else return}if(r.FaultType==2&&r.LoginUrl){window.location=r.LoginUrl+"?ReturnUrl="+encodeURIComponent(window.location);return}if(r.Message!=null){Mediasite.Player.DisplayMessage({message:r.Message,width:"500"});return}})}function getServiceLocation(n){return t+"/"+n}function getUserPreferences(){return{UserFromName:o.UserPreferences.GetValue(Mediasite.Player.Options.UserFromName,""),UserFromEmail:o.UserPreferences.GetValue(Mediasite.Player.Options.UserFromEmail,""),Volume:o.UserPreferences.GetValue(Mediasite.Player.Options.Volume,"100"),SlideDisplay:o.UserPreferences.GetValue(Mediasite.Player.Options.SlideDisplay,Mediasite.Player.SlideDisplayPref.LargeThumbs),ShowSlideDescriptions:o.UserPreferences.GetValue(Mediasite.Player.Options.ShowSlideDescriptions,!1)}}function unescapePresentation(n){return n.Title!=undefined&&(unescapeProperty("Title",null,n),unescapeProperty("Description",null,n),$.each(n.Presenters,unescapeProperty.bind(this,"Name")),$.each(n.Transcript,unescapeProperty.bind(this,"Text")),$.each(n.Chapters,unescapeProperty.bind(this,"Text")),$.each(n.TimedEvents,unescapeProperty.bind(this,"Text")),$.each(n.TimedEvents,unescapeProperty.bind(this,"Type")),$.each(n.SupportingLinks,unescapeProperty.bind(this,"Url")),$.each(n.SupportingLinks,unescapeProperty.bind(this,"Description")),$.each(n.Streams,function(n,t){$.each(t.Slides,unescapeProperty.bind(this,"Description")),$.each(t.Slides,unescapeProperty.bind(this,"Text"))})),n}function unescapeProperty(n,t,i){i[n]!=undefined&&(i[n]=i[n].unescapeJavascriptSerialized())}var f,e="application/json; charset=utf-8",o=this,s;this.UserPreferences=new Mediasite.Player.UserPreferences,this.LoadPlayerData=function(){f={};var t={getPlayerOptionsRequest:{ResourceId:n,QueryString:window.location.search,UseScreenReader:this.UserPreferences.GetValue(Mediasite.Player.Options.UseScreenReader,!1),UrlReferrer:r}};return $.ajax({async:!1,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:getServiceLocation("GetPlayerOptions"),data:JSON.stringify(t),beforeSend:function(n){u&&n.setRequestHeader(u,!0)},error:function(n){var i="Unknown Error",t;try{i=JSON.parse(n.responseText).Message}catch(r){}f.Success=!1,t={errorCode:600,details:i},f.error=t},success:function(n){var t,i;n.d.PlayerPresentationStatus==Mediasite.Player.PlayerPresentationStatus.Viewable?(n.d.Presentation.ServerClockSkew=+new Date-n.d.Presentation.ServerTimeForClockSkew,f.Success=!0,f.PlayerLayoutOptions=$.extend({},n.d.PlayerLayoutOptions),f.GlobalOptions=$.extend({AllowPlayerStreamPopout:!0},n.d.GlobalOptions),f.UserData={},f.UserData.PresentationBookmark=$.extend({},n.d.PresentationBookmark),f.UserData.UserPreferences=getUserPreferences(),t=unescapePresentation(n.d.Presentation),setAbsoluteSlideBaseUrl(t),f.CurrentPresentation=new Mediasite.Presentation(t),f.PlaybackOptions=new Mediasite.Player.PlaybackOptions(f.CurrentPresentation,f.UserData.PresentationBookmark),f.GlobalOptions.UseScreenReader=o.UserPreferences.GetBoolValue(Mediasite.Player.Options.UseScreenReader,!1),Mediasite.Player.IosAppDetectionOptions=$.extend({},n.d.IosAppDetectionOptions),f.GlobalOptions.EnableExperimentalDashPlayback&&f.CurrentPresentation.PlayStatus==Mediasite.Player.PresentationStatus.OnDemand&&hackInDashVideoUrls(f.CurrentPresentation.Streams)):n.d.LoginUrl?window.location=n.d.LoginUrl+"?ReturnUrl="+encodeURIComponent(window.location):(f.Success=!1,i={errorCode:600+n.d.PlayerPresentationStatus,details:n.d.PlayerPresentationStatusMessage},f.error=i,Mediasite.Player.DisplayMessage({message:n.d.PlayerPresentationStatusMessage,isError:!0,width:"500",buttons:[]}))}}),f},this.LoadMarkup=function(n,t){$.ajax({type:"GET",dataType:"text",contentType:"application/x-www-form-urlencoded",url:n+"?version="+t,async:!1,success:function(n){$("#"+i).empty().append(n)}})},this.GetLiveStatus=function(n,t,i){$.ajax({type:"POST",dataType:"json",contentType:e,url:getServiceLocation("GetLiveStatus"),data:n,success:t,error:i})},this.GetLiveEvents=function(n,t,i){$.ajax({type:"POST",dataType:"json",contentType:e,url:getServiceLocation("GetLiveEvents"),data:n,success:t,error:i})},this.GetInvite=function(n,t,i){$.ajax({type:"POST",dataType:"json",contentType:e,url:getServiceLocation("GetInvite"),data:n,success:t,error:i})},this.SendInvite=function(n,t,i){$.ajax({type:"POST",dataType:"json",contentType:e,url:getServiceLocation("SendInvite"),data:n,success:t,error:i})},this.SendQuestion=function(n,t,i){$.ajax({type:"POST",dataType:"json",contentType:e,url:getServiceLocation("SendQuestion"),data:n,success:t,error:i})},this.Search=function(n,t,i){s&&s.abort();var r=JSON.stringify({playbackTicketId:f.CurrentPresentation.PlaybackTicketId,searchTerm:n});s=$.ajax({type:"POST",dataType:"json",contentType:e,url:getServiceLocation("SearchPresentationText"),data:r,success:function(r){r&&r.d&&r.d.SearchResults?t&&t(r.d.SearchResults,n):i&&i()},error:i})},this.SaveBookmark=function(n){$.ajax({type:"POST",dataType:"json",contentType:e,url:getServiceLocation("SaveBookmark"),data:n})},this.ReportMediaOpen=function(n){$.ajax({type:"POST",dataType:"json",contentType:e,url:getServiceLocation("ReportMediaOpen"),data:n})},this.ReportMediaView=function(n,t){$.ajax({type:"POST",dataType:"json",contentType:e,url:getServiceLocation("ReportMediaView"),async:t,data:n})},function(){ajaxSetup()}()},Mediasite.Player.DataProvider.PublishToGo=function(){function setAbsoluteSlideBaseUrl(n){for(var t,r,i=0,u=n.Streams.length;i<u;i++)t=n.Streams[i],t.SlideBaseUrl!==null&&t.SlideBaseUrl.indexOf("://")===-1&&(r=r||Mediasite.BrowserDetect.GetBaseUri(),t.SlideBaseUrl=r+"/"+t.SlideBaseUrl)}function getUserPreferences(){return{UserFromName:t.UserPreferences.GetValue(Mediasite.Player.Options.UserFromName,""),UserFromEmail:t.UserPreferences.GetValue(Mediasite.Player.Options.UserFromEmail,""),Volume:t.UserPreferences.GetValue(Mediasite.Player.Options.Volume,"100"),SlideDisplay:t.UserPreferences.GetValue(Mediasite.Player.Options.SlideDisplay,Mediasite.Player.SlideDisplayPref.LargeThumbs),ShowSlideDescriptions:t.UserPreferences.GetValue(Mediasite.Player.Options.ShowSlideDescriptions,!1)}}var n,t=this;this.UserPreferences=new Mediasite.Player.UserPreferences,this.LoadPlayerData=function(){n={},n.Success=!0,n.PlayerLayoutOptions=$.extend({},JSON.parse(Mediasite.PlayerLayoutOptions.JSON));var t=Mediasite.CurrentPresentation.JSON;return setAbsoluteSlideBaseUrl(t),n.CurrentPresentation=new Mediasite.Presentation(t),n.GlobalOptions={AppRoot:"",EnableContextMenuForPlayer:!0,ErrorPage:"",ServiceEndpoint:"",SessionTimeout:12e5,SlideGroupMaxInGroup:10,SlideGroupMinToTrigger:25,SlideGroupThreshold:2e3,UseLiveEventPolling:!1,CompatiblePlugins:undefined,DesiredPlugins:Mediasite.Player.MediaPlugins.None,UseExtensions:!1,AllowPlayerVideoStreamPopout:!1,AllowPlayerStreamPopout:!1},n.PlayerLayoutOptions.PlayerType=globalPlayerType,n.PlaybackOptions=new Mediasite.Player.PlaybackOptions(n.CurrentPresentation,null),n.UserData={},n.UserData.UserPreferences=getUserPreferences(),n},this.LoadMarkup=function(){},this.GetLiveStatus=function(){},this.GetLiveEvents=function(){},this.GetInvite=function(){},this.SendInvite=function(){},this.SendQuestion=function(){},this.Search=function(t,i){var c=n.CurrentPresentation,o=c.Transcript,e=e=c.GetStream(Mediasite.ContentStreamType.Slide),f=e?e.Slides:[],u=[],l=[],s=[],h=new RegExp("("+t+")","gi");jQuery.isArray(o)&&o.length>0&&(u=jQuery.grep(o,function(n){return n&&n.Text.match(h)}),u=jQuery.map(u,function(n){return jQuery.extend({},n,{Type:Mediasite.TimingEventType.Caption})})),jQuery.isArray(f)&&f.length>0&&(l=jQuery.grep(f,function(n){var i=n.Text+" "+n.Description;return n&&i.match(h)}),$.each(l,function(n,t){s.push({Type:Mediasite.TimingEventType.SlideText,Text:t.Text+" "+t.Description,Time:t.Time,Number:t.Number})})),$.merge(u,s),u=u.sort(function(n,t){return n.Time-t.Time}),i(u,t)},this.SaveBookmark=function(){},this.ReportMediaOpen=function(){},this.ReportMediaView=function(){}},Mediasite.Player.DataProvider.Recorder=function(n,t){function ajaxSetup(){$(document).ajaxComplete(function(n,t){var r;try{r=JSON.parse(t.responseText)}catch(n){if(t.statusCode().status==404)r={Message:"An error occurred.  Please check the recorder logs.",Success:!1};else return}if(r.Message!=null){Mediasite.Player.DisplayMessage({message:r.Message,width:"500"});return}})}function getUserPreferences(){return{UserFromName:r.UserPreferences.GetValue(Mediasite.Player.Options.UserFromName,""),UserFromEmail:r.UserPreferences.GetValue(Mediasite.Player.Options.UserFromEmail,""),Volume:r.UserPreferences.GetValue(Mediasite.Player.Options.Volume,"100"),SlideDisplay:r.UserPreferences.GetValue(Mediasite.Player.Options.SlideDisplay,Mediasite.Player.SlideDisplayPref.LargeThumbs),ShowSlideDescriptions:r.UserPreferences.GetValue(Mediasite.Player.Options.ShowSlideDescriptions,!1)}}var r=this;r.serviceLocation=t,this.UserPreferences=new Mediasite.Player.UserPreferences,this.LoadPlayerData=function(){var t={PresentationId:Mediasite.GetQueryParam("presentationId")},n={};return n.Success=!1,$.ajax({async:!1,type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",url:r.serviceLocation,data:JSON.stringify(t),success:function(t){t.Presentation.ServerClockSkew=+new Date-t.Presentation.ServerTimeForClockSkew,t.PlayerLayoutOptions.PlayerType=Mediasite.Player.PlayerType.ContentOnlyPlayer,n.PlayerLayoutOptions=$.extend({},t.PlayerLayoutOptions),n.PlayerLayoutOptions.PlayerLoader="Javascript/Players/ContentOnlyPlayer/Mediasite.Player.ContentOnlyPlayerView.js",n.GlobalOptions={AppRoot:"",EnableContextMenuForPlayer:!0,ErrorPage:"",ServiceEndpoint:"",SessionTimeout:12e5,SlideGroupMaxInGroup:10,SlideGroupMinToTrigger:25,SlideGroupThreshold:2e3,UseLiveEventPolling:!1,CompatiblePlugins:undefined,DesiredPlugins:Mediasite.Player.MediaPlugins.None,UseExtensions:!1},n.UserData=Mediasite.UserData?Mediasite.UserData:{},n.UserData.PresentationBookmark=n.UserData.PresentationBookmark?$.extend(n.UserData,t.PresentationBookmark):$.extend({},t.PresentationBookmark),n.UserData.UserPreferences=getUserPreferences(),n.CurrentPresentation=new Mediasite.Presentation(t.Presentation),n.CurrentPresentation.SharingEnabled=!1,n.PlaybackOptions=new Mediasite.Player.PlaybackOptions(n.CurrentPresentation,null),n.PlaybackOptions.AutoStart=!0,n.Success=!0}}),n},this.LoadMarkup=function(n){$.ajax({url:n,type:"get",dataType:"html",async:!1,success:function(n){$("#PlayerContent").empty(),$("#PlayerContent").append(n)}})},this.GetLiveStatus=function(){},this.GetLiveEvents=function(){},this.GetInvite=function(){},this.SendInvite=function(){},this.SendQuestion=function(){},this.Search=function(){return undefined},this.SaveBookmark=function(){},this.ReportState=function(){},this.ReportMediaOpen=function(){},this.ReportMediaView=function(){},$(function(){ajaxSetup()})}
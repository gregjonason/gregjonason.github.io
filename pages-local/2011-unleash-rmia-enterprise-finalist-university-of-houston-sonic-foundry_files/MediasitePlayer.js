Mediasite.Player.MediasitePlayer=function(n){function startPlayerLoad(){if(t.GlobalOptions.PlayerContentPlugin=Mediasite.Player.DetectPlayerContentPlugin(t),t.GlobalOptions.PlayerContentPlugin.MediaPlayerType===Mediasite.Player.MediaPlayerType.Unknown){setLoadingError({errorCode:610,details:Mediasite.Player.Localization.ClientDetection.ErrorPageClientLoadError});return}var n=Mediasite.Player.AppPaths.PlayerView.format(t.PlayerLayoutOptions.PlayerType);$LAB.script(n).wait(executeViewLoader)}function setLoadingError(n){a.Hide(),Mediasite.Player.APIBroker.playerNotInitialized(n),Mediasite.Player.API.error=n}function executeViewLoader(){function onLoadStyleSheets(){$("#"+k).show(),f.LoadFunction(loadPlayer)}f=Mediasite.Player.Register.Players[t.PlayerLayoutOptions.PlayerType],f&&(isPlayerCompatible()?loadStyleSheets(onLoadStyleSheets):showIncompatiblePlayerError())}function loadStyleSheets(n){function errorCallback(n){a.Hide(),o.Error("Failed to load CSS files",n),Mediasite.Player.DisplayMessage({message:"Player CSS files failed to load.",isError:!0,width:"500",buttons:[]})}var t=getStyleSheetPaths();Mediasite.Css.LoadStyleSheets(t,n,errorCallback)}function getStyleSheetPaths(){var u=f.StyleSheetFiles,i=t.PlayerLayoutOptions.PlayerType,n=t.PlayerLayoutOptions.ThemeId;return $.map(u,function(t){var e=Mediasite.Player.AppPaths.StyleSheet.format(i,t),u=n&&Mediasite.Player.AppPaths.ThemedStyleSheet.format(i,n,t),f=[e];return u&&f.push(u),f})}function loadPlayer(){a.Hide(),$.each(t.CurrentPresentation.Streams,function(n,t){var i=[];i.push("StreamType="+t.StreamType),i.push("Priority="+t.Priority),i.push("AspectRatio="+t.AspectRatio),t.HasSlides()?i.push(t.Slides.length+" slides"):i.push("No slides"),t.HasVideo()&&$.each(t.VideoUrls,function(n,r){var u=t.VideoUrls.length>1?"Video "+(n+1)+"/"+t.VideoUrls.length:"Video";i.push(u+"="+r.Location)}),i=i.join("\n"),o.Info(i)}),i=new f.View(t),e.LoadMarkup(f.MarkupUrl,t.GlobalOptions.SiteBuildNumber),v=$.extend({},Mediasite.MediaPlayer.ViewOptions,f.MediaElementOptions,{mediaPlayerType:t.GlobalOptions.PlayerContentPlugin.MediaPlayerType,pluginMimeType:t.GlobalOptions.PlayerContentPlugin.MimeType,height:t.PlayerLayoutOptions.VideoHeight,width:t.PlayerLayoutOptions.VideoWidth,isStandAlone:t.CurrentPresentation.IsStandAlone,isMobile:Mediasite.BrowserDetect.Mobile(),playButtonText:Mediasite.Player.Localization.Buttons.Play,liveSmoothStreamingOffset:t.GlobalOptions.LiveSmoothStreamingOffset}),u=new Mediasite.Player.Model(e),u.Initialize(t.CurrentPresentation),p=new Mediasite.Player.PresentationContentSearch(e,t.CurrentPresentation.PlaybackTicketId),t.GlobalOptions.IsLayoutPreview||(initializeEvents(),s.MediaStateChange(Mediasite.Player.MediaState.Undefined)),i.LoadLayout();var n={getStreamViewHandler:i.GetStreamViewHandler.bind(i),contentCapability:f.ContentCapability};r=new Mediasite.Player.StreamViewerManager(t.CurrentPresentation.Streams,v,w,b,n,u,t),t.GlobalOptions.IsLayoutPreview?i.LoadLayout():(i.UpdatePresentationData(t.CurrentPresentation),updateUserPreferences(),u.SetInactivityTimeout(t.GlobalOptions.SessionTimeout),connectAPI(),loadExtensions(),u.LoadMedia(),o.Debug("Player Loaded..."))}function isPlayerCompatible(){var i=!0,n;return f&&t&&t.CurrentPresentation&&!t.GlobalOptions.IsLayoutPreview&&f.ContentCapability==Mediasite.Player.ContentCapability.VideoAndSlides&&(t.CurrentPresentation.Streams.length>2?i=!1:(n=0,$.each(t.CurrentPresentation.Streams,function(t,i){i.StreamType!=Mediasite.ContentStreamType.Slide&&n++}),n>1&&(i=!1))),i}function showIncompatiblePlayerError(){var n=Mediasite.Player.Localization.ClientDetection.NeedMultiView;a.Hide(),Mediasite.Player.DisplayMessage({message:n,isError:!0,width:"500",buttons:[]})}function initializeEvents(){function executeSlideTrackerMethod(n,t){var i=r.ExecuteSlideTrackerMethod(n,t);i&&(u.UpdatePosition(i.Time),u.FireEvent(Mediasite.Player.ModelEvent.PositionChange,i.Time))}i=$.extend(new Mediasite.Player.BaseView,i),u=$.extend(new Mediasite.Player.BaseModel,u),l=new Mediasite.Player.CurrentViewTracking,y=new Mediasite.Player.ViewReporting,h=new Mediasite.Player.StateReporting,s.AddEventHandler({PlayerStateChanged:function(n){u.UpdatePlayerState(n)}}),w={CommonHandlers:{MediaError:function(n){s.MediaError(n),u.HandleMediaError(n)},MediaLoaded:function(n){o.Debug("Stream media metadata loaded",n);var f=r.IsMediaLoaded(n);f!=undefined&&(connectBookmarks(f.duration),u.UpdateMediaInfo(f.videoInfo),i.UpdateMediaInfo(f.videoInfo),t.PlaybackOptions.StartPosition>0&&r.ExecuteMediaPlayerModelMethod("SetPosition",t.PlaybackOptions.StartPosition),t.PlaybackOptions.AutoStart&&!t.GlobalOptions.UseScreenReader?r.ExecuteMediaPlayerModelMethod("Play"):(Mediasite.BrowserDetect.Mobile()||r.ExecuteMediaPlayerModelMethod("Pause"),t.PlaybackOptions.AutoStart=!0))},MediaUpdated:function(n){var t=r.IsMediaLoaded(n);o.Debug("Stream media metadata updated",n||"no media info",t||"no collated media data"),t!=undefined&&(o.Debug("update model/view!"),u.UpdateMediaInfo(t.videoInfo),i.UpdateMediaInfo(t.videoInfo))},MediaFidelityChanged:function(n){i.UpdateMediaFidelity(n)}},MainHandlers:{MediaLoadStart:function(){i.MediaLoadStart()},MediaEvent:function(n){u.HandleMediaEvent(n)},StateChanged:function(n){s.MediaStateChange(n),g.mediaState=n,u.UpdateMediaState(n),i.UpdateMediaState(n),executeSlideTrackerMethod("UpdateMediaState",{State:n})},VolumeChanged:function(n){u.UpdateMediaVolume(n),i.UpdateMediaVolume(n)},PlaybackRateChanged:function(n){i.UpdatePlaybackRate(n),r.UpdatePlaybackRate(n.Current)},PositionChanged:function(n){u.UpdatePosition(n),i.UpdatePosition(n),r.UpdateStreamViewerPosition(n,t.CurrentPresentation.IsLivePresentation()),t.PlaybackOptions.PauseAt>0&&t.PlaybackOptions.PauseAt<=n&&(r.ExecuteMediaPlayerModelMethod("Pause"),t.PlaybackOptions.PauseAt=-1)},EnableLiveJumpBackDetection:function(){u.EnableLiveJumpBackDetection()},EnableLiveStartDelay:function(n){u.EnableLiveStartDelay(n)}}},b={SlideChange:function(n){r.UpdateCurrentSlide(n),u.FireEvent(Mediasite.Player.StreamViewerEvent.SlideChange,n)},AddNewSlide:function(n){r.AddNewSlide(n),u.FireEvent(Mediasite.Player.StreamViewerEvent.AddNewSlide,n)}},u.AddEventHandler({InactivityExceeded:function(){i.InactivityExceeded(),r.ExecuteMediaPlayerModelMethod("InactivityExceeded")},EmailInviteLoaded:function(n){i.UpdateEmailInvite(n)},StartMedia:function(n){r.ExecuteMediaPlayerModelMethod("SetupMediaElement",n)},CaptionChange:function(n){i.UpdateCurrentCaption(n)},SendQuestionComplete:function(n,t){i.SendQuestionComplete(n,t)},SendEmailComplete:function(n,t){i.SendEmailComplete(n,t)},PlayerStateChanged:function(n){i.UpdatePlayerState(n)},VisibleStreamsChanged:function(n){i.UpdateVisibleStreams(n)},LiveStatusChanged:function(n){s.LiveStatusChange(n),i.LiveStatusChange(n),r.ExecuteMediaPlayerModelMethod("LiveStatusChange",n)},SetLiveStartTime:function(n){r.ExecuteMediaPlayerModelMethod("SetLiveStartTime",n)},MediaError:function(n){i.ShowErrorMessage(Mediasite.Player.Localization.MediaPlayer.ErrorTitle,n)},ChapterChange:function(n){i.ChapterChanged(n)}}),p.AddEventHandler({SearchComplete:function(n,t){i.DisplaySearchResults(n,t)},SearchError:function(){i.DisplaySearchError()}}),i.AddEventHandler({AudioLanguageChanged:function(n){r.ExecuteMediaPlayerModelMethod("SetAudioLanguage",n)},SendQuestion:function(n){u.SendQuestion(n)},SendEmail:function(n){u.SendEmail(n)},Search:function(n){p.search(n)},VolumeChanged:function(n){r.ExecuteMediaPlayerModelMethod("SetVolume",n)},PlaybackRateChanged:function(n){r.ExecuteMediaPlayerModelMethod("SetPlaybackRate",n)},PlaybackRateFaster:function(n){r.ExecuteMediaPlayerModelMethod("PlayFaster",n)},PlaybackRateSlower:function(n){r.ExecuteMediaPlayerModelMethod("PlaySlower",n)},PositionChanged:function(n){r.ExecuteMediaPlayerModelMethod("SetPosition",n)},PreferenceChanged:function(n,t){u.SetPreference(n,t)},VisibleStreamsChanged:function(n){u.SetVisibleStreamTypes(n)},TogglePlayPause:function(){r.ExecuteMediaPlayerModelMethod("TogglePlayPause")},ToggleSlideShow:function(){i.ToggleSlideBrowser()},SkipBack:function(){r.ExecuteMediaPlayerModelMethod("SkipBack")},SkipForward:function(){r.ExecuteMediaPlayerModelMethod("SkipForward")},ToggleCaptions:function(){i.ToggleCaptionDisplay()},ToggleSearch:function(){i.ToggleSearch()},FullScreen:function(){r.ExecuteMediaPlayerModelMethod("FullScreen")},Mute:function(){r.ExecuteMediaPlayerModelMethod("ToggleMute")},VolumeUp:function(){r.ExecuteMediaPlayerModelMethod("StepVolumeUp")},VolumeDown:function(){r.ExecuteMediaPlayerModelMethod("StepVolumeDown")},AskQuestion:function(){i.ShowAskQuestionForm()},OpenEmail:function(){u.GetEmailInvite()},ShowPolls:function(){i.ShowPolls()},ShowLinks:function(){i.ShowLinks()},ShowHelp:function(){i.ShowHelp()},ShowChapters:function(){i.ShowChapters()},ShowSlideList:function(){i.UpdateSlideBrowserView(Mediasite.Player.SlideDisplayPref.List),u.SetPreference(Mediasite.Player.Options.SlideDisplay,Mediasite.Player.SlideDisplayPref.List)},ShowSlideSmallThumbs:function(){i.UpdateSlideBrowserView(Mediasite.Player.SlideDisplayPref.SmallThumbs),u.SetPreference(Mediasite.Player.Options.SlideDisplay,Mediasite.Player.SlideDisplayPref.SmallThumbs)},ShowSlideLargeThumbs:function(){i.UpdateSlideBrowserView(Mediasite.Player.SlideDisplayPref.LargeThumbs),u.SetPreference(Mediasite.Player.Options.SlideDisplay,Mediasite.Player.SlideDisplayPref.LargeThumbs)},ShowSlideText:function(){i.ToggleSlideText()},ShowInfo:function(){i.ShowInfo()},PopOut:function(){var n=g.mediaState;typeof n!="undefined"&&r.ExecuteMediaPlayerModelMethod("Pause"),i.LaunchPopOut(n)},PlayAsVideo:function(n){r.PlayAsVideo(n)},DismissPanels:function(){i.DismissPanels()},ToggleLogViewer:function(){Mediasite.LogViewer.Loaded()?Mediasite.LogViewer.Destroy():Mediasite.LogViewer.Load()},ToggleScreenReader:function(){typeof window.toggleScreenReaderMode=="function"?window.toggleScreenReaderMode():(u.TogglePreference(Mediasite.Player.Options.UseScreenReader),window.location.reload())}})}function connectAPI(){Mediasite.Player.API._registerModels(r.MainStreamViewer.MediaPlayerModel,u,i),Mediasite.Player.APIBroker.initialize(Mediasite.Player.API,t.GlobalOptions.AllowedPlayerIFrameAPISites),l.trackPresentation(Mediasite.Player.API),y.reportToDataProvider(t.CurrentPresentation.PlaybackTicketId,e),y.watchViewTracking(l),h.reportToDataProvider(t.CurrentPresentation.PlaybackTicketId,e),h.watchPlayer(Mediasite.Player.API),h.setMediaPlayerType(v.mediaPlayerType)}function connectBookmarks(n){t.CurrentPresentation.PlayStatus==Mediasite.Player.PresentationStatus.OnDemand&&(d=new Mediasite.Player.BookmarkStore(t.CurrentPresentation.PresentationId,n,!1,t.CurrentPresentation.ServerClockSkew,e),d.watchViewTracking(l,t.CurrentPresentation.PlaybackTicketId))}function updateUserPreferences(){i.UpdateOptions(t.UserData.UserPreferences),r.ExecuteMediaPlayerModelMethod("UpdateOptions",t.UserData.UserPreferences)}function loadExtensions(){if(t.GlobalOptions.UseExtensions){var i=$.grep(t.CurrentPresentation.PlayerExtensions,function(n){return!n.PlayerTypes.length||$.inArray(t.PlayerLayoutOptions.PlayerType,n.PlayerTypes)!=-1}),n=$.map(i,function(n){return n.ExtensionBasePath+"Extension.js"});n.length>0&&$LAB.script(n).wait(function(){$.each(Mediasite.Player.Register.Extensions,function(n,i){var r=t.CurrentPresentation.GetPlayerExtension(n);r&&new i.Constructor(Mediasite.Player.API,r)})})}}var nt=n.ResourceId,tt=n.ServicePath,k=n.PlayerContentId,ut=n.UrlReferrer,rt=n.DataProviderType,it=n.CustomHeader,a=new Mediasite.Player.Overlay,i,u,l,y,h,d,p,v,o=Mediasite.Logging.LoggerFactory("Controller",{separator:"\n"}),g={mediaState:undefined},r,w,b,f,s=new Mediasite.Player.PlayerStateManager,e,t,c;if(Mediasite.GetQueryParam("loadLog",Mediasite.GetQueryParam.AsBool)==!0&&Mediasite.LogViewer.Load(),e=Mediasite.Player.DataProvider.GetProvider(rt,nt,tt,k,ut,it),t=e.LoadPlayerData(),t.Success)if(Mediasite.Player.IosAppDetectionOptions){c=new IosAppDetection(Mediasite.Player.IosAppDetectionOptions);$(c).on("NotIosAppCandidate",startPlayerLoad);$(c).on("IosAppMessageClosed",startPlayerLoad);c.Run()}else startPlayerLoad();else setLoadingError(t.error)}
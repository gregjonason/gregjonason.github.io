Mediasite.Player.PipPlayerView=function(n){function setupDisabledFeatures(){r.disableCommonViewEvents(n.PlayerLayoutOptions,n.CurrentPresentation),r.disable(Mediasite.Player.ViewEvent.PopOut,n.PlayerLayoutOptions.ShowMainControls===!1||w==Mediasite.Player.PopOutPlayer.Disabled),f.disable(f.item.TitleArea,n.PlayerLayoutOptions.ShowTitleArea===!1),f.disable(f.item.TitleImage,n.PlayerLayoutOptions.ShowTitleImage===!1),f.disable(f.item.MainControls,n.PlayerLayoutOptions.ShowMainControls===!1),f.disable(f.item.SlideZoom,n.PlayerLayoutOptions.AllowSlideZoom===!1),f.disable(f.item.FidelityIndicator,n.PlayerLayoutOptions.AllowFidelityIndicator===!1),f.disable(f.item.SlideNavigation,n.PlayerLayoutOptions.AllowScrubbing===!1||n.PlayerLayoutOptions.ShowMainControls===!1||n.PlayerLayoutOptions.ShowSlideNavigation===!1)}function setOptionDefault(t,i){var r=n.PlayerLayoutOptions[t];(typeof r=="undefined"||typeof r=="null")&&(n.PlayerLayoutOptions[t]=i)}function getAspectRatio(n){var t=n.split(":");return t.length===2?parseInt(t[0],10)/parseInt(t[1],10):0}function updateSlideNavigation(){!r.isDisabled(Mediasite.Player.ViewEvent.NextSlide)&&hasSlides()&&(c&&isOnDemand()?(c.Number<2?($(t.firstSlideButton).imageButton("disable"),$(t.previousSlideButton).imageButton("disable")):($(t.firstSlideButton).imageButton("enable"),$(t.previousSlideButton).imageButton("enable")),c.Number<s.Slides.length?($(t.lastSlideButton).imageButton("enable"),$(t.nextSlideButton).imageButton("enable")):($(t.lastSlideButton).imageButton("disable"),$(t.nextSlideButton).imageButton("disable"))):($(t.firstSlideButton).imageButton("disable"),$(t.previousSlideButton).imageButton("disable"),$(t.lastSlideButton).imageButton("disable"),$(t.nextSlideButton).imageButton("disable")))}function isVideoPip(){return d===l.Video}function isPipHidden(){return rt||tt||n.PlayerLayoutOptions.PipPosition===y.Hidden}function isLivePresentation(){return u.PlayStatus===Mediasite.Player.PresentationStatus.ScheduledForLive||u.PlayStatus===Mediasite.Player.PresentationStatus.OpenForLive||u.PlayStatus===Mediasite.Player.PresentationStatus.Live||u.PlayStatus===Mediasite.Player.PresentationStatus.LivePaused||u.PlayStatus===Mediasite.Player.PresentationStatus.LiveEnded}function updatePipPosition(i,r){var h,e,u,o,s;if(n.PlayerLayoutOptions.PipPosition===y.BottomLeft||n.PlayerLayoutOptions.PipPosition===y.BottomRight){if(f.isDisabled(f.item.MainControls))return}else if(f.isDisabled(f.item.TitleArea))return;h=$(window),i===undefined&&(i=!0);var c=r||g,v=a?70:10,l=a?74:10;isPipHidden()?(o=$(t.mediaStateStandalone),s=h.height()-o.height()-l,s&&(i?o.stop(!0,!0).animate({top:s,useTranslate3d:!0},c):o.css("top",s))):(e=$(t.pipArea),u=n.PlayerLayoutOptions.PipPosition===y.BottomLeft||n.PlayerLayoutOptions.PipPosition===y.BottomRight?h.height()-e.height()-l:v,u&&(i?e.stop(!0,!0).animate({top:u,useTranslate3d:!0},c):e.css("top",u)))}function updateCCPosition(n,i){var u;if(!et&&!f.isDisabled(f.item.MainControls)){var s=$(window),r=$(t.ccArea),o=$(t.ccPanel),c=$(t.controlsArea);n===undefined&&(n=!0);var l=a?c.height():0,h=s.height()-o.height()-l-20,e=i||(a?g:pt);n&&(u=r.clone(),u.css("top",r.css("top")),u.attr("id",t.ccArea.substr(1,t.ccArea.length)+"Temp"),r.hide(),r.parent().append(u),u.stop(!0,!0).fadeOut(e),r.stop(!0,!0).fadeIn(e),setTimeout("$('"+t.ccArea+"Temp').remove();",e)),r.css("top",h),r.css("height",o.height())}}function touchShowHideControls(){if(a){var n=!1;$(t.volume).is(":data(playervolume)")&&(n=$(t.volume).playervolume("isVisible")),o!=i.None||n||hideControls(k.touchControlsToggleSpeed)}else showControls(k.touchControlsToggleSpeed)}function hideControls(n){a&&(it=document.activeElement,n=isNaN(n)?pt:n,a=!1,$(t.controlsOverlay).stop(!0,!0).fadeOut(n),updatePipPosition(),updateCCPosition(),o!==i.None&&($(t.overlayPanels).stop(!0,!0).fadeOut(n),$(t.closePanel).stop(!0,!0).fadeOut(n)),e.setZoomHudVisibilityAnimationDuration(n),e.setCanHideZoomHud(!0),r.fire(h.LayoutChanged))}function showControls(n){if(!a){n=n||g,a=!0,$(t.controlsOverlay).stop(!0,!0).fadeIn(n),updatePipPosition(),updateCCPosition(),adjustVariableSizeContainers();var u=null;switch(o){case i.Info:u=$(t.infoPanel);break;case i.Search:u=$(t.searchPanel);break;case i.Chapters:u=$(t.chaptersPanel);break;case i.Links:u=$(t.linksPanel);break;case i.Ask:u=$(t.askPanel);break;case i.Email:u=$(t.emailPanel)}u&&(u.stop(!0,!0).fadeIn(n),$(t.closePanel).stop(!0,!0).fadeIn(n)),e.setZoomHudVisibilityAnimationDuration(n),e.setCanHideZoomHud(!1),r.fire(h.LayoutChanged),it!==null&&($(it).focus(),it=null)}}function hidePanel(n,r,u,f){var s,h,e;u=u||g,nt&&clearInteractivityPopupWindow(),s=null;switch(n){case i.Info:s=$(t.infoPanel);break;case i.Search:s=$(t.searchPanel);break;case i.Chapters:s=$(t.chaptersPanel);break;case i.Links:s=$(t.linksPanel);break;case i.Ask:s=$(t.askPanel);break;case i.Email:s=$(t.emailPanel)}if(s){s.stop(!0,!0).fadeOut(u,function(){r&&r()}),e=null,h=Mediasite.Player.PanelFocusResetter.PanelClosingType.OneClosedNoneStillOpen;switch(n){case i.Info:e=b.GetElementToResetFocusTo(h,$(t.infoButton),f),e.focus();break;case i.Ask:e=b.GetElementToResetFocusTo(h,$(t.askButton),f),e.focus();break;case i.Email:e=b.GetElementToResetFocusTo(h,$(t.emailButton),f),e.focus();break;case i.Search:e=b.GetElementToResetFocusTo(h,$(t.searchButton),f),e.focus();break;case i.Chapters:e=b.GetElementToResetFocusTo(h,$(t.chaptersButton),f),e.focus();break;case i.Links:e=b.GetElementToResetFocusTo(h,$(t.linksButton),f),e.focus()}}else r&&r();o=i.None,$(t.searchButton).imageButton("setIsChecked",o===i.Search)}function clearInteractivityPopupWindow(){nt&&p&&p.close&&p.close(),p=null}function showPanel(n,r,u,f){var s,e;if(u=u||g,hidePanel(o,null,null,f),nt&&(n===i.Ask||n===i.Email)){if(n!==i.None){if(p=window.open("","interactivity","width=500,height=500",!0),!p){alert(Mediasite.Player.Localization.Common.PopupsBlocked),nt=!1,showPanel(n,r,u);return}s=$("body",p.document),s.addClass(si.popup),$(t.panelStylesheet).clone().appendTo(s);switch(n){case i.Ask:t.askPanel=s;break;case i.Email:t.emailPanel=s}}_currentInteractivityPanel=n.None;return}a||n===i.None||showControls(),e=null;switch(n){case i.Info:e=$(t.infoPanel);break;case i.Search:e=$(t.searchPanel);break;case i.Chapters:e=$(t.chaptersPanel);break;case i.Links:e=$(t.linksPanel);break;case i.Ask:e=$(t.askPanel);break;case i.Email:e=$(t.emailPanel)}e?($(t.closePanel).stop(!0,!0).fadeIn(u),e.stop(!0,!0).fadeIn(u,function(){fi||$("input, textarea",e).first().focus(),r&&r()})):$(t.closePanel).stop(!0,!0).fadeOut(u,function(){r&&r()}),o=n,$(t.searchButton).imageButton("setIsChecked",o===i.Search),updateBodyClasses()}function dismissInvite(){showPanel(i.None)}function completedResize(){var i=Mediasite.Slide.getCacheFriendlyImageSize($(t.slideArea).height(),getAspectRatio(n.PlayerLayoutOptions.SlideAspect));oi=i.width(),ei=i.height(),r.fire(h.LayoutChanged)}function updatePipLayout(){var o=$(window),r,i,u;isVideoPip()?(r=$(t.videoArea),i=$(t.slideArea),u=getAspectRatio(n.PlayerLayoutOptions.VideoAspect)):(r=$(t.slideArea),i=$(t.videoArea),u=getAspectRatio(n.PlayerLayoutOptions.SlideAspect)),r.removeClass("primaryArea").addClass("pipArea"),i.removeClass("pipArea").addClass("primaryArea");var e=getPipFraction(),f=Math.min(o.width()*e,u*o.height()*e),s=f/u;r.width(f).height(s),i.css({width:"",height:"",top:"",left:""}),$(t.slideViewer).trigger("containerresize")}function getPipFraction(){return n.PlayerLayoutOptions.PipSize===ti.Small?1/4:1/3}function updateCCLayout(){var e=$(window),f=$(t.ccPanel),u=$(t.ccArea),o=isVideoPip()?$(t.videoArea):$(t.slideArea),r=o.width()+10,i=e.width()-20;isPipHidden()?u.css("z-index",3):(u.css("z-index",1),n.PlayerLayoutOptions.PipPosition===y.BottomLeft?(f.css("margin-left",r),i=i-r):n.PlayerLayoutOptions.PipPosition===y.BottomRight?i=i-r:f.css("margin-right",r)),f.css("width",i),u.css("width",e.width())}function sizePlayer(){updatePipLayout(),updateCCLayout(),updatePipPosition(!1),updateCCPosition(!1);var i=Mediasite.Slide.getCacheFriendlyImageSize($(t.slideArea).height(),getAspectRatio(n.PlayerLayoutOptions.SlideAspect));oi=i.width(),ei=i.height()}function updatePositionText(n){$(t.position).text(Mediasite.Player.TimeHelper.getDisplayFromDuration(n,!0))}function togglePlayButton(n){if(!r.isDisabled(Mediasite.Player.ViewEvent.TogglePlayPause)){var e=$(document.activeElement).is($(t.pauseButton)),u=$(document.activeElement).is($(t.stopButton)),f=$(document.activeElement).is($(t.playButton)),i=e||u||f;n?($(t.pauseButton).hide(),$(t.stopButton).hide(),$(t.playButton).show(),i&&$(t.playButton).focus()):($(t.playButton).hide(),isLivePresentation()?($(t.stopButton).show(),i&&$(t.stopButton).focus()):($(t.pauseButton).show(),i&&$(t.pauseButton).focus()))}}function maySearch(){return!r.isDisabled(Mediasite.Player.ViewEvent.Search)&&n.CurrentPresentation.HasSearchableText}function setupControls(){var g,u,k,nt,it,tt,c,a,e,s,b,y,p,w;!f.isDisabled(f.item.TitleImage)&&n.PlayerLayoutOptions.Images&&n.PlayerLayoutOptions.Images.TitleLogo&&(g=$("<img />"),g.attr({id:t.titleLogo.slice(1),src:n.PlayerLayoutOptions.Images.TitleLogo.ImageFilename}),$(t.titleArea).prepend(g)),$(t.closePanel).attr({title:Mediasite.Player.Localization.Common.Close}).imageButton().mouseup(function(n){n.which==1&&showPanel(i.None,null,null,Mediasite.Player.PanelFocusResetter.ClickType.MouseClick)}).keyup(function(n){(n.which==13||n.which==32)&&showPanel(i.None,null,null,Mediasite.Player.PanelFocusResetter.ClickType.KeyPress)}),f.isDisabled(f.item.MainControls)&&$(t.controlsArea).hide(),f.isDisabled(f.item.TitleArea)&&$(t.titleArea).remove();var ft=$(t.playButton),rt=$(t.pauseButton),et=$(t.stopButton);r.isDisabled(Mediasite.Player.ViewEvent.TogglePlayPause)?ft.add(rt).add(et).hide():(ft.attr({title:Mediasite.Player.Localization.Buttons.Play}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.TogglePlayPause)}).attr("disabled",!0),rt.attr({title:Mediasite.Player.Localization.Buttons.Pause}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.TogglePlayPause)}).attr("disabled",!0).hide(),et.attr({title:Mediasite.Player.Localization.Buttons.Stop}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.TogglePlayPause)}).attr("disabled",!0).hide()),u=$(t.skipBackButton),r.isDisabled(Mediasite.Player.ViewEvent.SkipBack)?u.hide():u.attr({title:Mediasite.Player.Localization.Buttons.Skipback}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.SkipBack),u.focus()}),k=$(t.flipButton),r.isDisabled(Mediasite.Player.ViewEvent.LayoutChanged)?k.hide():k.attr({title:Mediasite.Player.Localization.PipPlayer.SwapMediaElements}).imageButton().click(function(){d=d===l.Video?l.Slide:l.Video,sizePlayer(),completedResize()}),$info=$(t.infoButton),r.isDisabled(Mediasite.Player.ViewEvent.ShowInfo)?$info.hide():$info.attr({title:Mediasite.Player.Localization.Buttons.Info}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.ShowInfo)}),nt=$(t.ccButton),r.isDisabled(Mediasite.Player.ViewEvent.ToggleCaptions)?nt.hide():nt.attr({title:Mediasite.Player.Localization.Buttons.ShowCaptioning}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.ToggleCaptions)}),it=$(t.searchButton),r.isDisabled(Mediasite.Player.ViewEvent.ToggleSearch)?it.hide():it.imageButton({isCheckButton:!0,normalTitle:Mediasite.Player.Localization.Buttons.ShowCaptionSearch,checkedTitle:Mediasite.Player.Localization.Buttons.HideCaptionSearch}).click(function(){r.fire(Mediasite.Player.ViewEvent.ToggleSearch)}),tt=$(t.speedButton),r.isDisabled(Mediasite.Player.ViewEvent.PlaybackRateChanged)?tt.hide():tt.playerspeed({onPlaybackRateFaster:onPlaybackRateFaster}),c=$(t.volume),r.isDisabled(Mediasite.Player.ViewEvent.VolumeChanged)?c.hide():c.playervolume({onVolumeChanged:onVolumeChanged,onMuteClicked:onMuteClicked}),mayDisplayMediaFidelity()?$(t.fidelityIndicator).hide():$(t.fidelityIndicator).remove(),a=$(t.pollsButton),r.isDisabled(Mediasite.Player.ViewEvent.ShowPolls)?a.hide():a.attr({title:Mediasite.Player.Localization.Buttons.ShowPolls}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.ShowPolls)}),e=$(t.askButton),r.isDisabled(Mediasite.Player.ViewEvent.AskQuestion)?e.hide():e.attr({title:Mediasite.Player.Localization.Buttons.Ask}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.AskQuestion)}),s=$(t.emailButton),r.isDisabled(Mediasite.Player.ViewEvent.OpenEmail)?s.hide():s.attr({title:Mediasite.Player.Localization.Buttons.Email}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.OpenEmail)}),b=$(t.linksButton),r.isDisabled(Mediasite.Player.ViewEvent.ShowLinks)?b.hide():b.attr({title:Mediasite.Player.Localization.Buttons.Links}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.ShowLinks)}),y=$(t.chaptersButton),r.isDisabled(Mediasite.Player.ViewEvent.ShowChapters)?y.hide():y.attr({title:Mediasite.Player.Localization.Buttons.Chapters}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.ShowChapters)}),p=$(t.helpButton),r.isDisabled(Mediasite.Player.ViewEvent.ShowHelp)?p.hide():p.attr({title:Mediasite.Player.Localization.Buttons.Help}).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.ShowHelp)}),ht=$(t.previousSlideButton),ot=$(t.nextSlideButton),st=$(t.firstSlideButton),ut=$(t.lastSlideButton),f.isDisabled(f.item.SlideNavigation)?(ht.hide(),ot.hide(),st.hide(),ut.hide()):(ht.attr("title",Mediasite.Player.Localization.Buttons.PreviousSlide).imageButton().click(previousSlide),ot.attr("title",Mediasite.Player.Localization.Buttons.NextSlide).imageButton().click(nextSlide),st.attr("title",Mediasite.Player.Localization.Buttons.FirstSlide).imageButton().click(firstSlide),ut.attr("title",Mediasite.Player.Localization.Buttons.LastSlide).imageButton().click(lastSlide)),w=$(t.popoutButton),r.isDisabled(Mediasite.Player.ViewEvent.PopOut)?w.hide():w.attr("title",Mediasite.Player.Localization.Buttons.PopOut).imageButton().click(function(){r.fire(Mediasite.Player.ViewEvent.PopOut)}),$(t.sliderDiv).slider({disabled:r.isDisabled(Mediasite.Player.ViewEvent.PositionChanged),range:"min",max:lt,start:function(){dt=!0},slide:function(n,t){showControls(),updatePositionText(getMediaDuration()*(t.value/lt))},stop:function(n,u){dt=!1,r.fire(h.PositionChanged,getMediaDuration()*(u.value/lt)),o===i.Email?$(t.emailPanel).playerinvitepanel({currentPosition:v}):o===i.Ask&&$(t.askPanel).playeraskpanel({currentPosition:v})}}).enableTouch(),increaseSliderToucharea(),adjustVariableSizeContainers(),$(t.sliderHandle).prop("tabindex","-1"),$(".ui-slider-range").addClass("ui-corner-all"),$("#screenReaderPrompt").focus()}function updateControls(){$(t.titleLogo).attr({alt:u.Title,title:u.Title}),u.Chapters.length<1&&$(t.chaptersButton).imageButton("disable"),(!u.HasCaptions||u.DisableCaptionDisplay)&&$(t.ccButton).imageButton("disable"),maySearch()||$(t.searchButton).hide(),u.PollingEnabled||$(t.pollsButton).imageButton("disable"),u.ForumEnabled||$(t.askButton).imageButton("disable"),u.Links.length<1&&$(t.linksButton).imageButton("disable"),u.SharingEnabled||$(t.emailButton).imageButton("disable"),(tt||rt)&&$(t.flipButton).hide(),isLivePresentation()&&($(t.skipBackButton).hide(),$(t.speedButton).hide(),$(t.sliderDiv).slider("disable"),$(t.sliderHandle).hide()),hasSlides()||(ht.hide(),ot.hide(),st.hide(),ut.hide()),adjustVariableSizeContainers()}function mayDisplayMediaFidelity(){return!f.isDisabled(f.item.FidelityIndicator)}function maySetVolume(){return!r.isDisabled(h.VolumeChanged)}function adjustVariableSizeContainers(){$(t.sliderArea).css("left",$(t.leftButtons).outerWidth()).css("right",$(t.rightButtons).outerWidth()),$(t.titleHeader).textOverflow("reflow")}function content_touchstart(){ft=!0,touchShowHideControls()}function slideViewer_tap(){touchShowHideControls()}function content_mouseenter(){ft||showControls()}function content_mouseleave(){ft||hideControls()}function setupElements(){var c,a,i,h;if($(t.overlayPanels).hide(),$(t.mediaStateDiv).add(t.mediaStateStandalone).hide(),d=n.PlayerLayoutOptions.PrimaryContent===l.Video?l.Slide:l.Video,$(window).bind("resize",function(){clearTimeout(this.id),this.id=setTimeout(completedResize,200),updatePipLayout(),updateCCLayout(),updatePipPosition(!1),updateCCPosition(!1)}).bind("orientationchange",sizePlayer),$(t.askPanel).playeraskpanel({presentation:u,onSendQuestion:onSendQuestion}),c=$(t.slideViewer),e=new Mediasite.Player.SlideViewer(c),f.isDisabled(f.item.SlideZoom)&&e.setCanShowZoomHud(!1),e.setPanelCount(1),c.bind({tap:slideViewer_tap,touchstart:function(n){n.stopPropagation()}}),n.PlayerLayoutOptions.Images&&(n.PlayerLayoutOptions.Images.WaitingForPresentationSlide?setStartSlide(n.PlayerLayoutOptions.Images.WaitingForPresentationSlide,Mediasite.Player.Localization.CurrentSlide.SlideImage):n.PlayerLayoutOptions.Images.DefaultSlide&&setStartSlide(n.PlayerLayoutOptions.Images.DefaultSlide,Mediasite.Player.Localization.CurrentSlide.SlideImage),n.PlayerLayoutOptions.Images.VideoThumb&&(a=$("<img />").attr({src:n.PlayerLayoutOptions.Images.VideoThumb.ImageFilename,alt:""}),$(t.videoThumbContainer).empty().append(a))),hi&&(i=null,$("input, textarea",t.overlayPanels).bind("touchstart",function(n){$(n.target).focus(),i=setTimeout(function(){i=null},200)}),$(t.overlayPanels).bind("mouseenter mousedown click",function(n){i&&$(n.target).is(t.overlayPanels)&&(n.preventDefault(),n.stopImmediatePropagation(),n.stopPropagation())})),window.navigator.msPointerEnabled){var r=function(n){return n.pointerType===n.MSPOINTER_TYPE_MOUSE||n.pointerType==="mouse"},o=$("#content").get(0),v,y,s=function(n){n!==y&&(clearTimeout(v),y=n,v=setTimeout(n,50))};o.addEventListener("MSPointerDown",function(n){r(n)||touchShowHideControls()}),o.addEventListener("MSPointerMove",function(n){r(n)&&s(showControls)}),o.addEventListener("MSPointerOver",function(n){r(n)&&s(showControls)}),o.addEventListener("MSPointerOut",function(n){r(n)&&s(hideControls)}),window.navigator.pointerEnabled?h="pointerdown":window.navigator.msPointerEnabled&&(h="MSPointerDown"),$("#content button, #content input").click(function(n){n.stopPropagation()});$("#content button, #sliderArea, .zoomhud, #slideViewer").on(h,function(n){n.stopPropagation()})}else gt?($("#content").bind({touchstart:content_touchstart,mouseenter:content_mouseenter,mouseleave:content_mouseleave}),$("#content button, #content input").click(function(n){n.stopPropagation()}),$("#content button").bind("touchstart",function(n){n.stopPropagation()})):$("#content").mousemove(showControls).mouseleave(hideControls)}function increaseSliderToucharea(){var n=$(document.createElement("div"));n.addClass("ui-slider-handle-toucharea"),n.appendTo($("a.ui-slider-handle"))}function setPipElement(n){d=n,sizePlayer(),completedResize()}function setStartSlide(n,t){e.setStartSlide(makeSpecialSlide(0,t),n.ImageFilename,n.ImageUrl)}function setEndSlide(n,t,i){e.setEndSlide(makeSpecialSlide(i||Number.MAX_VALUE,t),n.ImageFilename,n.ImageUrl)}function makeSpecialSlide(n,t){return new Mediasite.Slide(0,n,t,null)}function setupPanelFocusResetter(){var n=$(t.closePanel),i=[{panelButton:$(t.askButton),panelElement:$(t.askPanel),panelCloseButton:n},{panelButton:$(t.emailButton),panelElement:$(t.emailPanel),panelCloseButton:n},{panelButton:$(t.infoButton),panelElement:$(t.infoPanel),panelCloseButton:n},{panelButton:$(t.searchButton),panelElement:$(t.searchPanel),panelCloseButton:n},{panelButton:$(t.chaptersButton),panelElement:$(t.chaptersPanel),panelCloseButton:n},{panelButton:$(t.linksButton),panelElement:$(t.linksPanel),panelCloseButton:n}];b=new Mediasite.Player.PanelFocusResetter(i)}function hasSlides(){return!u||!s?!1:s.HasSlides()}function ShowPresentationEndedState(){updateEndSlide(),e.setCurrentSlideIndex(Number.MAX_VALUE),isOnDemand()||(ri=!0),yt=!0}function isOnDemand(){return u.PlayStatus===Mediasite.Player.PresentationStatus.OnDemand}function updateEndSlide(){var t=getMediaDuration()||u.Duration;n.PlayerLayoutOptions.Images&&n.PlayerLayoutOptions.Images.PresentationEndedSlide&&setEndSlide(n.PlayerLayoutOptions.Images.PresentationEndedSlide,Mediasite.Player.Localization.CurrentSlide.PresentationHasEnded,t)}function nextSlide(){if(c){if(c.Number==s.Slides.length)return;var n=s.Slides[c.Number].Time;r.fire(Mediasite.Player.ViewEvent.PositionChanged,n)}}function previousSlide(){if(c){if(c.Number-2<0)return;var n=s.Slides[c.Number-2].Time;r.fire(Mediasite.Player.ViewEvent.PositionChanged,n)}}function firstSlide(){if(s.Slides.length>0){var n=s.Slides[0].Time;r.fire(Mediasite.Player.ViewEvent.PositionChanged,n)}}function lastSlide(){if(s.Slides.length>0){var n=s.Slides[s.Slides.length-1].Time;r.fire(Mediasite.Player.ViewEvent.PositionChanged,n)}}function hideVideoThumb(){$(t.videoThumbContainer).css("display","none")}function updateBodyClasses(){var t=$("body").removeClass();u&&t.addClass(getBodyClassForPlayStatus(u.PlayStatus)),u&&!ii&&t.addClass("mediaNotReady"),u&&isLivePresentation()&&t.addClass("isLively"),f.isDisabled(f.item.TitleArea)&&t.addClass("noTitleArea"),f.isDisabled(f.item.MainControls)&&t.addClass("noControlBar"),f.isDisabled(f.item.SlideNavigation)||t.addClass("showSlideNavigation"),isPipHidden()?t.addClass(getBodyClassForPipPosition(y.Hidden)):t.addClass(getBodyClassForPipPosition(n.PlayerLayoutOptions.PipPosition)),Mediasite.BrowserDetect.IOS()?t.addClass("is-ios"):t.addClass("not-ios"),Mediasite.BrowserDetect.Android()||Mediasite.BrowserDetect.IOS()||t.addClass("styledScrollbars"),t.toggleClass("panelShowing",o!==i.None)}function getBodyClassForPipPosition(n){return"PipPosition-"+n}function getBodyClassForPlayStatus(n){return n}function getGreatestSlideTime(){return hasSlides()?s.Slides[s.Slides.length-1].Time:0}function getMediaDuration(){return ct}function setMediaDuration(n){n==Infinity&&(n=getGreatestSlideTime()),ct=Math.max(ct,n),$(t.infoPanel).playerinfopanel("updateDuration",Math.max(u.Duration,ct))}function onCaptionClick(n){v=n,r.fire(h.PositionChanged,n),$(t.mediaStateDiv).add(t.mediaStateStandalone).hide()}function onSendQuestion(n){r.fire(h.SendQuestion,n)}function onVolumeChanged(n){r.fire(h.VolumeChanged,n)}function onMuteClicked(){bt=!0,r.fire(Mediasite.Player.ViewEvent.Mute)}function onPlaybackRateFaster(n){r.fire(h.PlaybackRateFaster,n)}function onChapterChanged(n){r.fire(h.PositionChanged,n)}function onSearch(n){r.fire(h.Search,n)}function onSendEmail(n){r.fire(h.SendEmail,n)}var vt=this,li=Mediasite.Logging.LoggerFactory("playerView",{separator:"\n"}),b,t={errorDiv:"#errorMessage",sliderDiv:"#positionSlider",sliderArea:"#sliderArea",slideViewer:"#slideViewer",sliderHandle:"#positionSlider .ui-slider-handle",titleArea:"#titleArea",titleHeader:"#titleArea h1",duration:"#duration",slideArea:"#slideArea",pipArea:".pipArea",videoThumbContainer:"#videoThumbContainer",mediaStateText:".mediaState p",mediaStateDiv:"#mediaState",mediaStateStandalone:"#mediaStateStandalone",controlsOverlay:".overlay",panelsWrapper:"#panels",infoPanel:"#infoPanel",searchPanel:"#searchPanel",chaptersPanel:"#chaptersPanel",askPanel:"#askPanel",linksPanel:"#linksPanel",emailPanel:"#emailPanel",videoArea:"#videoArea",overlayPanels:".overlayPanel",playButton:"#play",pauseButton:"#pause",stopButton:"#stop",skipBackButton:"#skipBack",infoButton:"#info",chaptersButton:"#chapters",controlsArea:"#controlsArea",ccButton:"#cc",searchButton:"#search",speedButton:"#playSpeedButton",ccArea:"#ccArea",ccPanel:"#ccPanel",emailButton:"#email",flipButton:"#flip",popoutButton:"#popout",pollsButton:"#polls",askButton:"#ask",linksButton:"#links",helpButton:"#help",fidelityIndicator:"#fidelityIndicator",position:"#position",leftButtons:"#leftButtons",rightButtons:"#rightButtons",closePanel:"#closePanel",volume:"#volume",titleLogo:"#titleLogo",previousSlideButton:"#previousSlide",nextSlideButton:"#nextSlide",firstSlideButton:"#firstSlide",lastSlideButton:"#lastSlide",muteWrapper:"#ui-playervolume-mute-wrapper",unmuteWrapper:"#ui-playervolume-unmute-wrapper",volumeSlider:"#ui-playervolume-slider",panelStylesheet:'link[rel="stylesheet"][href*="Panel"]'},si={popup:"popupPanel"},k={fadeSpeed:200,mouseOutSpeed:1e3,controlsTimeout:3e3,touchControlsToggleSpeed:200},y={TopLeft:"TopLeft",TopRight:"TopRight",BottomRight:"BottomRight",BottomLeft:"BottomLeft",Hidden:"Hidden"},ti={Standard:"Standard",Small:"Small"},l={Video:"Video",Slide:"Slide"},ai={Input:"INPUT",Textarea:"TEXTAREA"},vt=this,u,s,wt=[],c,oi,ei,ct=0,dt=!1,a=!0,i={None:"None",Search:"Search",Info:"Info",Chapters:"Chapters",Ask:"Ask",Links:"Links",Email:"Email"},o=i.None,at,kt,w,ni,e,lt=1e4,ci,v=0,ii=!1,rt=!1,tt=!1,et=!0,d=null,hi=$.support.touch,ui=Mediasite.Player.Support.msTouch,gt=Mediasite.Player.Support.touch,fi=Mediasite.BrowserDetect.IOS(),nt=Mediasite.BrowserDetect.Android(),p,yt=!1,ht,ot,st,ut,bt=!1,g=gt||ui?k.touchControlsToggleSpeed:k.fadeSpeed,pt=gt||ui?k.touchControlsToggleSpeed:k.mouseOutSpeed,ri=!1,r=new Mediasite.Player.DisableableEventBundle,h=Mediasite.Player.ViewEvent,f=new Mediasite.Player.FeatureAccess,it,ft;f.item={TitleArea:"TitleArea",TitleImage:"TitleImage",MainControls:"MainControls",FidelityIndicator:"FidelityIndicator",SlideZoom:"SlideZoom",SlideNavigation:"SlideNavigation"},this.SlideStreamType=Mediasite.ContentStreamType.Slide,this.AddEventHandler=function(n,t){r.addHandler(n,t)},setOptionDefault("SlideAspect","4:3"),setOptionDefault("VideoAspect","4:3"),setOptionDefault("PipPosition",y.BottomRight),setOptionDefault("PipSize",ti.Standard),setOptionDefault("AllowPopOut",Mediasite.Player.PopOutPlayer.FullExperience),w=n.PlayerLayoutOptions.AllowPopOut,w===!1?w=Mediasite.Player.PopOutPlayer.Disabled:w===!0&&(w=Mediasite.Player.PopOutPlayer.FullExperience),Mediasite.GetQueryParam("popout")=="true"&&(w=Mediasite.Player.PopOutPlayer.Disabled),nt&&$(window).bind("beforeunload",clearInteractivityPopupWindow),this.GetLayoutElements=function(){var r=[],i,n;return isVideoPip()&&(!isVideoPip()||isPipHidden())||(i=$("#mediaElementArea"),i[0].GetContentDimensions?(n=i[0].GetContentDimensions(),n.contents="media",r.push(n)):(n=i.offset(),n.width=i.width(),n.height=i.height(),n.contents="media",r.push(n))),rt||!isVideoPip()&&isPipHidden()||(i=$(t.slideArea),n=i.position(),n.width=i.width(),n.height=i.height(),n.contents="slide",r.push(n)),r},it=null,ft=!1,this.UpdatePlaybackRate=function(n){$(t.speedButton).playerspeed("setPlaybackRate",n.Current)},this.LoadLayout=function(){jQuery.fx.interval=fi?50:jQuery.fx.interval,setupDisabledFeatures(),setupElements(),setupControls(),sizePlayer(),completedResize(),updateBodyClasses()},this.GetStreamViewHandler=function(n){if(wt.length==2)return undefined;var i=undefined;return n.DisplayContent==Mediasite.ContentType.Video&&(i=new Mediasite.Player.StreamViewHandler({MediaContainer:$("#mediaElementArea"),UpdateCurrentSlide:function(){},AddNewSlide:function(){}}),wt.push(i)),n.DisplayContent==Mediasite.ContentType.Slide&&(this.SlideStreamType=n.StreamType,i=new Mediasite.Player.StreamViewHandler({MediaContainer:$(t.slideViewer),UpdateCurrentSlide:vt.UpdateCurrentSlide,AddNewSlide:vt.AddNewSlide}),wt.push(i)),i},this.ShowErrorMessage=function(n,i){$(t.errorDiv).show().text(n+": "+i)},this.UpdatePosition=function(i){v=i,dt||(updatePositionText(i),setMediaDuration(i),getMediaDuration()>0&&$(t.sliderDiv).slider("option","value",i/getMediaDuration()*lt)),isOnDemand()&&getMediaDuration()>0&&v>=getMediaDuration()&&ShowPresentationEndedState(),tt&&!hasSlides()&&yt&&i>0&&n.PlayerLayoutOptions.Images&&n.PlayerLayoutOptions.Images.DefaultSlide&&(e.setCurrentSlideIndex(-1),yt=!1)},this.UpdatePresentationData=function(i){u=i,s=u.GetStream(this.SlideStreamType),$(document).bind("keydown",function(n){n.keyCode==9&&(a||showControls(0))}),$(document).bind("keyup",function(n){var t=Mediasite.Player.ViewEvent.fromKeyEvent(n),i;if(t){if(n.preventDefault(),i={},t==Mediasite.Player.ViewEvent.NextSlide){nextSlide();return}if(t==Mediasite.Player.ViewEvent.PreviousSlide){previousSlide();return}r.fire(t,i)}}),rt=!hasSlides()&&u.PlayStatus===Mediasite.Player.PresentationStatus.OnDemand||!hasSlides()&&!isOnDemand(),d=n.PlayerLayoutOptions.PrimaryContent===l.Video||rt?l.Slide:l.Video,updateBodyClasses(),$(t.titleHeader).text(u.Title).textOverflow("update",{container:$(t.titleArea),title:!0}),$(t.infoPanel).playerinfopanel({presentation:u,onChapterChanged:onChapterChanged,defaultPresenterImageSrc:n.PlayerLayoutOptions.Images.DefaultPresenterImage.ImageFilename,hideDateTime:n.PlayerLayoutOptions.ShowDateTime===!1}),$(t.chaptersPanel).playerchapterspanel({chapters:u.Chapters,onChapterChanged:onChapterChanged}),$(t.linksPanel).playerlinkspanel({links:u.Links}),$(t.searchPanel).playersearchpanel({presentation:u,disableCaptionDisplay:u.DisableCaptionDisplay,onSearch:onSearch,onCaptionClick:onCaptionClick,margin:81,msgDialogWidth:"340px"}),updateControls(),sizePlayer(),hasSlides()&&(e.setSlideUrlProvider(s.SlideUrlProvider),e.setSlides(s.Slides));var f=0;$(t.slideViewer).bind("navigate",function(n,t){r.fire(h.PositionChanged,t.time)}),updateSlideNavigation(),n.PlayerLayoutOptions.Images&&(u.PlayStatus===Mediasite.Player.PresentationStatus.ScheduledForLive||u.PlayStatus===Mediasite.Player.PresentationStatus.OpenForLive?(setStartSlide(n.PlayerLayoutOptions.Images.WaitingForPresentationSlide,Mediasite.Player.Localization.CurrentSlide.SlideImage),e.setCurrentSlideIndex(-1)):setStartSlide(n.PlayerLayoutOptions.Images.DefaultSlide,Mediasite.Player.Localization.CurrentSlide.SlideImage)),u.PlayStatus===Mediasite.Player.PresentationStatus.OnDemand&&(e.setPanelCount(3),updateEndSlide()),setupPanelFocusResetter()},this.UpdateMediaInfo=function(n){ii=!0,setMediaDuration(n.Duration);var i=Mediasite.Player.TimeHelper.getDisplayFromDuration(getMediaDuration(),!0);$(t.duration).text(i),tt=n.AudioOnly,tt&&setPipElement(l.Video),n.CanChangeSpeed||$(t.speedButton).hide(),updateControls(),updateBodyClasses(),updateEndSlide()},this.AddNewSlide=function(n){hasSlides()&&(e.setSlides(s.Slides),vt.UpdateCurrentSlide(n))},this.UpdateCurrentSlide=function(n){!ri&&hasSlides()&&(c=n,e.setCurrentSlideIndex(n.Number-1),updateSlideNavigation())},this.LiveStatusChange=function(t){switch(t){case Mediasite.Player.PresentationStatus.Live:(!c||c.Number<1)&&(setStartSlide(n.PlayerLayoutOptions.Images.DefaultSlide,Mediasite.Player.Localization.CurrentSlide.SlideImage),e.setCurrentSlideIndex(-1));break;case Mediasite.Player.PresentationStatus.LiveEnded:ShowPresentationEndedState()}},this.UpdateMediaState=function(n){hideVideoThumb();var i=n===Mediasite.Player.MediaState.Undefined?"":Mediasite.Player.MediaState.GetDisplayName(n);$(t.mediaStateText).text(i),n===Mediasite.Player.MediaState.Playing||n===Mediasite.Player.MediaState.Undefined?$(t.mediaStateDiv).add(t.mediaStateStandalone).hide():$(t.videoArea).is(":visible")?$(t.mediaStateDiv).show():$(t.mediaStateStandalone).show(),$(t.playButton).attr("disabled",!1),$(t.pauseButton).attr("disabled",!1),$(t.stopButton).attr("disabled",!1);switch(n){case Mediasite.Player.MediaState.Playing:togglePlayButton(!1);break;case Mediasite.Player.MediaState.Paused:case Mediasite.Player.MediaState.Stopped:case Mediasite.Player.MediaState.MediaEnded:togglePlayButton(!0)}n===Mediasite.Player.MediaState.MediaEnded&&isOnDemand()&&ShowPresentationEndedState()},this.UpdateMediaVolume=function(n){maySetVolume()&&(n>0?$(t.volume).playervolume("unmute",n):$(t.volume).playervolume("mute"),bt&&(bt=!1,n>0?$(t.muteWrapper+" button").focus():$(t.unmuteWrapper+" button").focus()))},this.UpdateMediaFidelity=function(n){if(mayDisplayMediaFidelity()&&n.tracks&&n.tracks.length>1){var i=$(t.fidelityIndicator);i.is(":visible")||(i.show().playerfidelity(),adjustVariableSizeContainers()),i.playerfidelity("update",n)}},this.DismissPanels=function(){o!==i.None&&showPanel(i.None)},this.ShowInfo=function(){r.isDisabled(Mediasite.Player.ViewEvent.ShowInfo)||(o!==i.Info?(showPanel(i.Info),$(t.infoPanel).playerinfopanel("updateLayout")):showPanel(i.None),$(t.infoButton).focus())},this.ToggleSearch=function(){maySearch()&&(o!==i.Search?(showPanel(i.Search),$(t.searchPanel).playersearchpanel("updateLayout")):showPanel(i.None))},this.ShowChapters=function(){r.isDisabled(Mediasite.Player.ViewEvent.ShowChapters)||u.Chapters.length<1||(o!==i.Chapters?(showPanel(i.Chapters),$(".ui-playerchapterspanel-chapteritem").first().focus()):showPanel(i.None))},this.ShowAskQuestionForm=function(){if(u.ForumEnabled)if(o!==i.Ask){showPanel(i.Ask);var n=p?!1:!0;$(t.askPanel).playeraskpanel({currentPosition:v,presentation:u,dismissFunction:dismissInvite,window:window,onSendQuestion:onSendQuestion,javascriptResize:n,msgDialogWidth:"340px"})}else showPanel(i.None)},this.SendQuestionComplete=function(n,i){$(t.askPanel).playeraskpanel("sendQuestionComplete",n,i)},this.ShowHelp=function(){if(!at||at.closed){var i=n.GlobalOptions.AppRoot.length>0?"/":"",t=n.GlobalOptions.AppRoot+i+"Help/Mediasite/OverviewFullVersion.htm";at=Mediasite.Player.CreatePopup(t,"Help",800,600,!0,!0)}},this.LaunchPopOut=function(n){var i,t,e;if(!ni||ni.closed){i=!1,n===Mediasite.Player.MediaState.Playing&&(i=!0);var r=-1,o=Mediasite.GetQueryParam("playFrom")||0,f=Mediasite.GetQueryParam("duration")||0;f>0&&(r=parseInt(o,10)+parseInt(f,10)-parseInt(v,10)),t=window.location.href,t=t.replace(/([\?&])?playFrom=\d+&?/ig,"$1").replace(/[\?&]$/,""),v>0&&(t+=(t.indexOf("?")>0?"&":"?")+"playFrom="+parseInt(v,10)),t=t.replace(/([\?&])?duration=\d+&?/ig,"$1").replace(/[\?&]$/,""),r>0&&(t+=(t.indexOf("?")>0?"&":"?")+"duration="+r),t=t.replace(/([\?&])?autoStart=([T|t]rue|[F|f]alse)&?/ig,"$1").replace(/[\?&]$/,""),t+=(t.indexOf("?")>0?"&":"?")+"autoStart="+i,t=t.replace(/(\?|&)(popout=([^\?&#\s]+))&?/gi,"$1").replace(/[\?&]$/,""),t+=(t.indexOf("?")>0?"&":"?")+"popout=true",window.setupPopoutPlayerUrl&&(t=setupPopoutPlayerUrl(t,w)),e=u?u.PresentationId:"playerpreview",ni=Mediasite.Player.CreatePopup(t,e,800,600,!0,!0)}},this.ShowPolls=function(){u.PollingEnabled&&(!kt||kt.closed)&&(kt=Mediasite.Player.CreatePopup(u.PollingLocation,"Polls",600,450,!0,!0))},this.ShowLinks=function(){u.Links.length>0&&(o!==i.Links?(showPanel(i.Links),$(".ui-playerlinkspanel-list a").first().focus()):showPanel(i.None))},this.DisplaySearchResults=function(n,i){var r=$(t.searchPanel);r.playersearchpanel("displayResults",n,i)},this.DisplaySearchError=function(){var n=$(t.searchPanel);n.playersearchpanel("displayError")},this.UpdateCurrentCaption=function(n){var i=n.Text||"";i=i.replace(/\n/g,"<br/>"),$(t.ccPanel).html(i),updateCCPosition(!1)},this.UpdateEmailInvite=function(n){if(u.SharingEnabled){o==i.Email?showPanel(i.None):n.UseServerForSMTP&&showPanel(i.Email);var r=$(t.emailPanel),f=p?!1:!0;r.playerinvitepanel({presentation:u,currentPosition:v,onSendEmail:onSendEmail,dismissFunction:dismissInvite,window:window,url:window.location.href,javascriptResize:f,msgDialogWidth:"340px"}),r.playerinvitepanel("updateEmailInvite",n)}},this.ToggleCaptionDisplay=function(){if(u.HasCaptions&&!u.DisableCaptionDisplay){var i=$(t.ccArea),n=$(t.ccButton);et?(i.fadeIn(g),n.attr({title:Mediasite.Player.Localization.Buttons.HideCaptioning}),et=!1):(i.fadeOut(pt),n.attr({title:Mediasite.Player.Localization.Buttons.ShowCaptioning}),et=!0)}},this.SendEmailComplete=function(n,i){$(t.emailPanel).playerinvitepanel("sendInviteComplete",n,i)}},Mediasite.Player.Register(Mediasite.Player.PlayerType.PipPlayer,{View:Mediasite.Player.PipPlayerView,LoadFunction:function(n){$LAB.script("Javascript/Scripts/jquery.enableTouch.js").script("Javascript/Scripts/jquery.mousewheel.js").script("Javascript/Scripts/jquery.imageButton.js").script("Javascript/Scripts/SpriteAnimation.js").script("Javascript/Scripts/jquery.ba-resize.js").script("Javascript/Scripts/jquery.iscroll.js").script("Javascript/Scripts/jquery.ui.playerinfopanel.js").script("Javascript/Scripts/jquery.ui.playerccsearchpanel.js").script("Javascript/Scripts/jquery.ui.playercaptionpanel.js").script("Javascript/Scripts/jquery.ui.playerchapterspanel.js").script("Javascript/Scripts/jquery.ui.playeraskpanel.js").script("Javascript/Scripts/jquery.ui.playerlinkspanel.js").script("Javascript/Scripts/jquery.ui.playerinvitepanel.js").script("Javascript/Scripts/jquery.ui.playerspeed.js").script("Javascript/Scripts/jquery.ui.playervolume.js").script("Javascript/Scripts/jquery.ui.playerfidelity.js").script("Javascript/Scripts/Mediasite.Player.PanelFocusResetter.js").script("Javascript/Scripts/SlideNav.js").script("Javascript/Scripts/SlideInspector.js").script("Javascript/Scripts/jquery.text-overflow.js").script("Javascript/Scripts/SlideViewer.js").wait(function(){var t;Mediasite.BrowserDetect.IOS()&&$("html").addClass("fixedViewport"),Mediasite.BrowserDetect.Android()?(t=$('<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,maximum-scale=1.0,target-densitydpi=150" />'),t.appendTo($("head"))):(t=$('<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0" />'),t.appendTo($("head"))),n&&n()})},MarkupUrl:"Javascript/Players/PipPlayer/PipPlayer.html",MediaElementOptions:{backgroundElement:$("#videoArea")},StyleSheetFiles:["PipPlayer.css","PipPanels.css"],ContentCapability:Mediasite.Player.ContentCapability.VideoAndSlides})
Mediasite.namespace("MediaPlayer"),Mediasite.namespace("MediaPlayer.Views"),Mediasite.MediaPlayer.ModelXap=function(n){function nowUnloading(){ut=!0}function positionUpdateTimerCallback(){var n=t.GetPosition();i.fire(r.PositionChanged,n),v=setTimeout(positionUpdateTimerCallback,ft)}function startPositionUpdateTimer(){clearTimeout(v),v=setTimeout(positionUpdateTimerCallback,ft)}function stopPositionUpdateTimer(){clearTimeout(v)}function reconnectOnLiveMediaOpenFailure(){resetLiveMedia()}function handleMediaError(n,t){var o=getScriptApi(),e,u;if(o&&(e=t.ErrorCode||parseInt(t.ErrorMessage),e!==1001||f.toLowerCase().substr(0,4)!=="http")&&!y.HandleLiveMediaOpenFailure(reconnectOnLiveMediaOpenFailure)){if(!st&&!nt&&s.length>0){cueNextSource(),o.Source=f,h.Info("Media element failover source set",f,"of type",b,"on server type",p);return}switch(e){case 4001:u=Mediasite.Player.Localization.MediaPlayer.SilverlightNetworkError+" ("+t.ErrorMessage+")";break;case 3137:if(ut){u=Mediasite.Player.Localization.MediaPlayer.ServerConnectionClosedError+" ("+t.ErrorCode+" - "+t.ErrorMessage+")";break}default:u=Mediasite.Player.Localization.MediaPlayer.GeneralError+" ("+t.ErrorCode+" - "+t.ErrorMessage+")"}i.fire(r.MediaError,u)}}function convertState(n){switch(n.toLowerCase()){case"buffering":return Mediasite.Player.MediaState.Buffering;case"closed":return Mediasite.Player.MediaState.Closed;case"error":return Mediasite.Player.MediaState.Error;case"opening":return Mediasite.Player.MediaState.Opening;case"paused":return Mediasite.Player.MediaState.Paused;case"playing":return Mediasite.Player.MediaState.Playing;case"stopped":return Mediasite.Player.MediaState.Stopped;default:return Mediasite.Player.MediaState.Undefined}}function notifyMediaLoaded(){var u=getScriptApi(),f,o,e;if(u){if(f=!1,!nt)switch(b){case"video/x-ms-wmv":f=p=="IIS"||pt;break;case"video/mp4":f=!0;break;case"video/x-mp4-fragmented":default:f=!1}o=0,u.NaturalVideoHeight>0&&u.NaturalVideoWidth>0&&(o=u.NaturalVideoWidth/u.NaturalVideoHeight),e={AspectRatio:o,Duration:t.GetDuration(),AudioOnly:u.NaturalVideoHeight===0,CanChangeSpeed:f,CanFullScreen:!1,CurrentLanguageIndex:t.GetCurrentAudioLanguageIndex(),Languages:t.GetAudioLanguages(),StreamType:n.streamType,IsMainStream:n.isMainStream},a.UpdateMediaInfo(e),i.fire(r.MediaLoaded,e)}}function handleMediaEvent(n,u){var f=getScriptApi(),e,s,o;if(f)switch(n){case"MediaOpened":g?(f.Play(),g=!1,notifyMediaLoaded()):(st=!0,a.MediaLoadStart(),i.fire(r.MediaLoadStart),notifyMediaLoaded());break;case"MediaEnded":i.fire(r.PositionChanged,t.GetPosition()),t.Stop(),c=0,i.fire(r.PositionChanged,0),i.fire(r.StateChanged,Mediasite.Player.MediaState.MediaEnded);break;case"StateChanged":i.fire(r.PositionChanged,t.GetPosition()),e=convertState(f.CurrentState);switch(e){case Mediasite.Player.MediaState.Playing:t.SetPlaybackRate(tt),l&&!f.IsSmoothStreaming&&f.Position<1e3&&(k=new Date-l-yt),startPositionUpdateTimer();break;case Mediasite.Player.MediaState.Paused:case Mediasite.Player.MediaState.Stopped:stopPositionUpdateTimer();break;default:stopPositionUpdateTimer()}y.setMediaState(e),i.fire(r.StateChanged,e);break;case"MarkerReached":u.Type==="MS6"&&(s=parseInt(u.Command,10),isNaN(s)||(k=s-f.Position)),i.fire(r.MediaEvent,u);break;case"RateChanged":o={Min:w[0],Max:w[w.length-1],Current:Math.round(t.GetPlaybackRate()*100)/100},h.Debug("Playback rate now "+o.Current),i.fire(r.PlaybackRateChanged,o)}}function handleSmoothStreamingTrackSummaryChanged(){var h=getScriptApi(),f,s,e;if(h){var o=h.SmoothStreamingTrackSummary,v=o.TrackBitrates.split(","),l=o.TrackWidths.split(","),a=o.TrackHeights.split(","),c=[];for(f=0,s=o.TrackCount;f<s;f++)c[f]={bitrate:parseInt(v[f],10),width:parseInt(l[f],10),height:parseInt(a[f],10)};e={tracks:c,currentTrackIndex:o.CurrentPlayTrackIndex,streamType:n.streamType},e.currentTrack=e.tracks[e.currentTrackIndex],i.fire(r.MediaFidelityChanged,e)}}function getScriptApi(){try{if(e&&e.content&&e.content.ScriptApi)return e.content.ScriptApi}catch(n){}return!1}function waitForPlayerInit(){var n=getScriptApi();if(!n||e.usable===!1){setTimeout(waitForPlayerInit,200);return}n.MediaOpened=function(n,t){handleMediaEvent("MediaOpened",t)},n.MediaEnded=function(n,t){handleMediaEvent("MediaEnded",t)},n.CurrentStateChanged=function(n,t){handleMediaEvent("StateChanged",t)},n.MarkerReached=function(n,t){handleMediaEvent("MarkerReached",{Type:t.Marker.Type,Command:t.Marker.Text})},n.MediaFailed=function(n,t){handleMediaError(n,t)},n.SmoothStreamingTrackSummaryChanged=handleSmoothStreamingTrackSummaryChanged,n.RateChanged=function(n,t){handleMediaEvent("RateChanged",t)},n.Source=f,h.Info("Media element source set",f,"of type",b,"on server type",p),n.IsSmoothStreaming&&y.setAllowedReconnectAttempts(ct),t.SetVolume(ht)}function resetLiveMedia(){var n,r,i;(g=!0,n=getScriptApi(),n)&&(r=t.GetVolume(),i=t.IsMuted(),n.Source=f,h.Info("Reset media source for live"),t.SetVolume(r),i&&t.Mute(),o&&t.SetVolume(0))}function isLive(){return!!l}function cueNextSource(){var n=s.shift();f=n.Location,p=n.ServerType,b=n.MimeType}function getNextPlaybackRate(n,i){var f,r,e;return n=n!==!1,i=i!==!1,f=Math.round(t.GetPlaybackRate()*100)/100,r=u.extend([],w),r.length==0&&(r=[1]),e=n?1:-1,r.sort(function(n,t){return e*(n-t)}),i&&0>=e*(r[r.length-1]-f)?f=r[0]:u.each(r,function(n,t){if(0>=e*(t-f)&&0<e*(r[n+1]-f))return f=r[n+1],!1}),f}var u=jQuery,t=this,d,e,s=[],f,p,b,w=n.playbackRates,at=3e3,vt=1e4,ct=15,c=0,lt=-500,ht=100,ot=!1,g=!1,et=0,st=!1,nt=!1,pt=n.isStandAlone,l,k=0,yt=15e3,v=null,ft=200,h=Mediasite.Logging.LoggerFactory("Media XAP:"+n.streamType,{separator:"\n"}),y=new Mediasite.MediaPlayer.LiveMediaOpenReconnector,a,it,tt=1,ut=!1,rt;u(window).on("beforeunload",nowUnloading);var wt={position:0,savedAt:0},bt={position:0,savedAt:0},i=new Mediasite.Player.EventBundle,r=Mediasite.MediaPlayer.ModelEvent,o=n.disableVolume==undefined?!1:n.disableVolume;this.GetMediaWrapper=function(){return it},this.SupportsPlayAsVideo=function(){return!1},this.AddEventHandler=function(n,t){i.addHandler(n,t)},this.SetupMediaElement=function(t){var l,o,c;for(a=u.extend({},new Mediasite.MediaPlayer.BaseView,new rt(n)),d=a.CreateMediaElement(),it=a.Wrapper,e=d.get(0),l=[],o=0;o<t.length;o++)t[o].MimeType===n.pluginMimeType?s.push(t[o]):l.push(t[o]);if(s=s.concat(l),s.length>0&&cueNextSource(),typeof f=="undefined"){i.fire(r.MediaError,Mediasite.Player.Localization.MediaPlayer.NoCompatibleMediaError),h.Error("Media - no compatible media source");return}setTimeout(waitForPlayerInit,500),c=document.createElement("param"),c.name="onError",c.value="OnSilverlightError",window.OnSilverlightError=function(){n.isStandAlone&&Mediasite.Urls.ContainsUnicode(document.location.href)&&!Mediasite.BrowserDetect.InternetExplorer()&&i.fire(r.MediaError,Mediasite.Player.Localization.MediaPlayer.SilverlightLoadErrorNonAsciiPath)},e.appendChild(c),u(window).unload(function(){d.remove()})},this.UpdateOptions=function(n){ht=n.Volume},this.LiveStatusChange=function(n){var u=Mediasite.Player.PresentationStatus;nt=n==u.Live||n==u.LivePaused||n==u.OpenForLive||n==u.ScheduledForLive,y.setLiveStatus(n),n===Mediasite.Player.PresentationStatus.LiveEnded&&(handleMediaEvent=function(){},handleMediaError=function(){},t.Stop(),i.fire(r.StateChanged,Mediasite.Player.MediaState.Stopped))},this.InactivityExceeded=function(){ot=!0},this.SetPosition=function(n){var u=getScriptApi();u&&n>=0&&n<t.GetDuration()&&(c=n,u.Position=n,i.fire(r.PositionChanged,n))},this.PlayFaster=function(n){n=n===!0;var i=getNextPlaybackRate(!0,n);t.SetPlaybackRate(i)},this.PlaySlower=function(n){n=n===!0;var i=getNextPlaybackRate(!1,n);t.SetPlaybackRate(i)},this.SkipBack=function(){var n=t.GetPosition()-at;n<0&&(n=0),t.SetPosition(n)},this.SkipForward=function(){var n=t.GetPosition()+vt;n<t.GetDuration()&&t.SetPosition(n)},this.FullScreen=function(){},this.Pause=function(){var n=getScriptApi();n&&(t.GetDuration()>0?n.Pause():t.Stop())},this.Play=function(){var n=getScriptApi();if(n)if(ot===!0)window.location.reload();else{if(isLive()&&et>0)resetLiveMedia();else try{n.Play()}catch(t){}et++}},this.Stop=function(){var n=getScriptApi();if(n){l&&!n.IsSmoothStreaming&&stopPositionUpdateTimer();try{n.Stop()}catch(t){}}},this.GetPosition=function(){var i=getScriptApi(),t,n;if(i)try{return(t=i.Position+k,c>0&&(n=t-c,lt<n&&n<0))?c:t}catch(r){return 0}},this.GetDuration=function(){var n=getScriptApi();if(n)try{return isLive()?0:n.NaturalDuration}catch(t){return 0}},this.SetVolume=function(n){var u=getScriptApi();u&&(o?(u.Volume=0,u.IsMuted=!0):(u.Volume=n/100,u.IsMuted=n==0,i.fire(r.VolumeChanged,Math.round(t.GetVolume()))))},this.GetVolume=function(){var n=getScriptApi();if(n)return n.Volume*100},this.StepVolumeUp=function(){var n=getScriptApi();n&&(o||(n.Volume<=.8?this.SetVolume((n.Volume+.2)*100):this.SetVolume(100)))},this.StepVolumeDown=function(){var n=getScriptApi();n&&(o||(n.Volume>.2?this.SetVolume((n.Volume-.2)*100):this.SetVolume(0)))},this.ToggleMute=function(){o||(t.IsMuted()?t.UnMute():t.Mute())},this.Mute=function(){var n=getScriptApi();n&&(n.IsMuted=!0,t.IsMuted()&&i.fire(r.VolumeChanged,0))},this.UnMute=function(){var n=getScriptApi();n&&(o||(n.IsMuted=!1,t.GetVolume()===0?this.SetVolume(50):i.fire(r.VolumeChanged,Math.round(t.GetVolume()))))},this.IsMuted=function(){var n=getScriptApi();if(n)return n.IsMuted},this.TogglePlayPause=function(){var n=getScriptApi();n&&(convertState(n.CurrentState)===Mediasite.Player.MediaState.Playing?t.Pause():t.Play())},this.SetPlaybackRate=function(n){var t=getScriptApi();t&&(tt=n,t.PlaybackRate=n)},this.GetPlaybackRate=function(){var n=getScriptApi();if(n)return n.PlaybackRate},this.GetCurrentAudioLanguageIndex=function(){return 1},this.GetAudioLanguages=function(){var r=getScriptApi(),n,t,i;if(r){if(t=r.AudioStreamCount,t>1){for(i=[],n=0;n<t;++n)i[n]={Index:n,Locale:0,DisplayName:Mediasite.Player.Localization.Common.AudioTrack+" "+(n+1)};return i}return{}}},this.SetAudioLanguage=function(n){var t=getScriptApi();t&&(t.AudioStreamIndex=n.Index)},this.SetLiveStartTime=function(n){l=n},this.RetrieveBookmark=function(n){wt=n},rt=function(n){function waitForCanvasInit(){var n=u("#MediaElement").get(0).content;if(n)try{i=n.ScriptApi}catch(t){}if(i)u("#MediaElement").attr("tabindex","-1"),i.OnFocus=function(){u("#MediaElement").parent().focus()};else{setTimeout(waitForCanvasInit,200);return}}var r,e,i,f=n&&n.isStandAlone?n.isStandAlone:!1,t;this.Wrapper=undefined,this.CreateMediaElement=function(){var h,e,s,l;n.mediaContainer.find(".MediaWrapper").remove();var a="5.0.61118.0",c=f?"SilverlightMediaPlayerView.xap":"Javascript/ClientBin/SilverlightMediaPlayerView.xap",i,o=u('script[src*="/Javascript"]').attr("src");return o?(h=o.lastIndexOf("/Javascript"),i=o.substring(0,h),i+="/"+c):i=c,e=u('<div id="MediaWrapper" class="MediaWrapper"></div>').appendTo(n.mediaContainer),this.Wrapper=e,s=u(n.backgroundElement.selector),l=s.css("background-color",s.css("background-color")).css("background-color"),Silverlight.createObjectEx({source:i,parentElement:e.get(0),id:"MediaElement",properties:{width:n.width,height:n.height,isWindowless:"true",framerate:"24",version:a},initParams:"FullScreenPromptText="+n.silverlightFullScreenPrompt+",EnableFullScreenOnClick="+n.allowFullScreenVideo+",BackgroundColor="+l.replace(/,/g,"|")+",LiveSmoothStreamingOffset="+n.liveSmoothStreamingOffset,context:null}),waitForCanvasInit(),r=n.mediaContainer.find("#MediaElement"),t&&t.destroy&&t.destroy(),t=Mediasite.MediaPlayer.UserActivation.Create(this,n),r},this.UpdateMediaInfo=function(n){n.AudioOnly&&r.css("height","0px")},this.SetIsStandAlone=function(n){f=n}}},Mediasite.MediaPlayer.UserActivation.Register({mediaPlayerType:Mediasite.Player.MediaPlayerType.Silverlight,usable:function(){return Mediasite.BrowserDetect.Firefox()},constructor:function(n,t){function addOnLoadHandler(){function onLoad(){r.Debug("Media element loaded","detected via onLoad handler"),reset()}var t="onLoadSilverlight"+Math.floor(Math.random()*1e3),n;window[t]=onLoad.bind(this,i),n=document.createElement("param"),n.setAttribute("name","onload"),n.setAttribute("value",t),i.appendChild(n)}function loadCheck(){isAvailable()?(r.Debug("Media element loaded","detected via poll"),reset()):enableUserActivation()}function enableUserActivation(){u||(u=!0,Mediasite.MediaPlayer.UserActivation.ShowPrompt(null,onShowMessage),r.Debug("Showing prompt"))}function onShowMessage(n){var t,u;r.Debug("Adding 'click-me' element"),t=$(i).clone(),t.find("param[name=onload]").remove(),$(i).after(t),n.prepend(t),u=Mediasite.MediaPlayer.UserActivation.MediaElementCss,t.css(u)}function reset(){clearTimeout(f),clearInterval(e),u&&(Mediasite.MediaPlayer.UserActivation.RemovePrompt(),r.Debug("Removing prompt"))}function isAvailable(){try{return i&&i.content&&i.content.ScriptApi&&!0}catch(n){}}var r=Mediasite.Logging.LoggerFactory("MediaPlayer UserActivation",{separator:" - "}),o=3e3,h=500,s=n.get(0),i=s.querySelector("object"),c=$(i).parentsUntil(t.contentContainer||document.body),u=!1,f,e;f=setTimeout(function(){loadCheck(),e=setInterval(loadCheck,h)},o),addOnLoadHandler()}}),Mediasite.MediaPlayer.UserActivation.Register({mediaPlayerType:Mediasite.Player.MediaPlayerType.Silverlight,usable:function(){return Mediasite.BrowserDetect.Safari()},constructor:function(n){function addOnLoadHandler(n,t){var r="onLoadSilverlight"+Math.floor(Math.random()*1e3),i;window[r]=t.bind(this,n),i=document.createElement("param"),i.setAttribute("name","onLoad"),i.setAttribute("value",r),n.appendChild(i)}function onLoad(){r.Debug("Media element loaded","detected via onLoad handler","onLoad called before: "+u),clearTimeout(o),clearInterval(f),u||(o=setTimeout(onLoadCheck,l)),u&&markUsable(!0),u++}function onLoadCheck(){isAvailable()?(r.Debug("Media element appears loaded"),markUsable(!0)):(enableUserActivation(),clearInterval(f),f=setInterval(onLoadCheck,c))}function enableUserActivation(){if(!e){e=!0,Mediasite.MediaPlayer.UserActivation.ShowPrompt({top:"50px"},onShowMessage);$(i).parent().on("click",stopPropagation);r.Debug("Showing click-me prompt")}}function onShowMessage(n){s=!0,r.Debug("Making media element clickable"),css=$.extend({},Mediasite.MediaPlayer.UserActivation.MediaElementCss,{position:"fixed"}),h=i.parentNode,$(i).appendTo(n).css(css)}function reset(){var t,n;if(clearTimeout(o),clearInterval(f),e&&s){e=!1,$(i).appendTo(h),Mediasite.MediaPlayer.UserActivation.RemovePrompt(),t={};for(n in css)css.hasOwnProperty(n)&&(t[n]="");$(i).css(t),r.Debug("Removed 'click-me'")}}function markUsable(n){n===void 0&&(n=!1),i.usable=n,n&&reset()}function isAvailable(){return i.content&&!0}function stopPropagation(n){n.stopPropagation()}var r=Mediasite.Logging.LoggerFactory("MediaPlayer UserActivation",{separator:" - "}),l=2e3,c=500,a="CTA-z-index",i=$(n).find("object")[0],o,f,u=0,e=!1,s=!1,h;markUsable(!1),addOnLoadHandler(i,onLoad)}})
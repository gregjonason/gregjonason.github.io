function X2JS(n,t,i){function d(n){var t=n.localName;return null==t&&(t=n.baseName),(null==t||""==t)&&(t=n.nodeName),t}function e(n){return n.prefix}function f(n){return"string"==typeof n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):n}function g(n){return n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function h(f){var l,it,o,nt,w,c,s,tt,v,y,a,b,p;if(f.nodeType==r.DOCUMENT_NODE){for(c=f.firstChild,l=0,it=f.childNodes.length;it>l;l+=1)if(f.childNodes[l].nodeType!==r.COMMENT_NODE){c=f.childNodes[l];break}return i?o=h(c):(o={},s=d(c),o[s]=h(c)),o}if(f.nodeType==r.ELEMENT_NODE){for(o={},o.__cnt=0,nt=f.childNodes,w=0;w<nt.length;w++)if(c=nt.item(w),s=d(c),o.__cnt++,null==o[s])o[s]=h(c),o[s+"_asArray"]=new Array(1),o[s+"_asArray"][0]=o[s];else{for(null==o[s]||o[s]instanceof Array||(tt=o[s],o[s]=[],o[s][0]=tt,o[s+"_asArray"]=o[s]),v=0;null!=o[s][v];)v++;o[s][v]=h(c)}for(y=0;y<f.attributes.length;y++){a=f.attributes.item(y),o.__cnt++;for(var rt=a.value,k=0,ut=n.length;ut>k;k++)b=n[k],b.test.call(this,a)&&(rt=b.converter.call(this,a.value));o[t+a.name]=rt}return p=e(f),null!=p&&""!=p&&(o.__cnt++,o.__prefix=p),1==o.__cnt&&null!=o["#text"]&&(o=o["#text"]),null!=o["#text"]&&(o.__text=o["#text"],u&&(o.__text=g(o.__text)),delete o["#text"],delete o["#text_asArray"]),null!=o["#cdata-section"]&&(o.__cdata=o["#cdata-section"],delete o["#cdata-section"],delete o["#cdata-section_asArray"]),(null!=o.__text||null!=o.__cdata)&&(o.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),o}return f.nodeType==r.TEXT_NODE||f.nodeType==r.CDATA_SECTION_NODE?f.nodeValue:f.nodeType==r.COMMENT_NODE?null:void 0}function i(n,t,i,r){var o="<"+(null!=n&&null!=n.__prefix?n.__prefix+":":"")+t,u,f,e;if(null!=i)for(u=0;u<i.length;u++)f=i[u],e=n[f],o+=" "+f.substr(1)+"='"+e+"'";return o+=r?"/>":">"}function j(n,t){return"</"+(null!=n.__prefix?n.__prefix+":":"")+t+">"}function k(n,t){return-1!==n.indexOf(t,n.length-t.length)}function l(n,t){return k(t.toString(),"_asArray")||0==t.toString().indexOf("_")||n[t]instanceof Function?!0:!1}function m(n){var i=0,t;if(n instanceof Object)for(t in n)l(n,t)||i++;return i}function n(n){var i=[],t;if(n instanceof Object)for(t in n)-1==t.toString().indexOf("__")&&0==t.toString().indexOf("_")&&i.push(t);return i}function o(n){var t="";return null!=n.__cdata&&(t+="<![CDATA["+n.__cdata+"]\]>"),null!=n.__text&&(t+=u?f(n.__text):n.__text),t}function p(n){var t="";return n instanceof Object?t+=o(n):null!=n&&(t+=u?f(n):n),t}function q(t,u,f){var o="",e;if(0==t.length)o+=i(t,u,f,!0);else for(e=0;e<t.length;e++)o+=i(t[e],u,n(t[e]),!1),o+=r(t[e]),o+=j(t[e],u);return o}function r(t){var e="",h=m(t),f,u,o,s;if(h>0)for(f in t)l(t,f)||(u=t[f],o=n(u),null==u||void 0==u?e+=i(u,f,o,!0):u instanceof Object?u instanceof Array?e+=q(u,f,o):(s=m(u),s>0||null!=u.__text||null!=u.__cdata?(e+=i(u,f,o,!1),e+=r(u),e+=j(u,f)):e+=i(u,f,o,!0)):(e+=i(u,f,o,!1),e+=p(u),e+=j(u,f)));return e+=p(t)}(null===t||void 0===t)&&(t="_"),(null===i||void 0===i)&&(i=!1);var f="1.0.11",u=!1,r={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(n){var t,i;return window.DOMParser?(i=new window.DOMParser,t=i.parseFromString(n,"text/xml")):(0==n.indexOf("<?")&&(n=n.substr(n.indexOf("?>")+2)),t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(n)),t},this.xml2json=function(n){return h(n)},this.xml_str2json=function(n){var t=this.parseXmlString(n);return this.xml2json(t)},this.json2xml_str=function(n){return r(n)},this.json2xml=function(n){var t=this.json2xml_str(n);return this.parseXmlString(t)},this.getVersion=function(){return f},this.escapeMode=function(n){u=n}}function ObjectIron(n){var r;for(r=[],i=0,len=n.length;len>i;i+=1)r.push(n[i].isRoot?"root":n[i].name);var e=function(n,t){var i;if(null!==n&&null!==t)for(i in n)n.hasOwnProperty(i)&&(t.hasOwnProperty(i)||(t[i]=n[i]))},u=function(n,t,i){var o,s,r,u,f;if(null!==n&&0!==n.length)for(o=0,s=n.length;s>o;o+=1)r=n[o],t.hasOwnProperty(r.name)&&(i.hasOwnProperty(r.name)?r.merge&&(u=t[r.name],f=i[r.name],"object"==typeof u&&"object"==typeof f?e(u,f):i[r.name]=null!=r.mergeFunction?r.mergeFunction(u,f):u+f):i[r.name]=t[r.name])},t=function(n,i){var o,l,s,c,h,r,f,e=n;if(null!==e.children&&0!==e.children.length)for(o=0,l=e.children.length;l>o;o+=1)if(r=e.children[o],i.hasOwnProperty(r.name))if(r.isArray)for(h=i[r.name+"_asArray"],s=0,c=h.length;c>s;s+=1)f=h[s],u(e.properties,i,f),t(r,f);else f=i[r.name],u(e.properties,i,f),t(r,f)},f=function(i){var u,h,l,e,o,s,c;if(null===i||"object"!=typeof i)return i;for(u=0,h=r.length;h>u;u+=1)"root"===r[u]&&(o=n[u],s=i,t(o,s));for(e in i)if(i.hasOwnProperty(e)){if(l=r.indexOf(e),-1!==l)if(o=n[l],o.isArray)for(c=i[e+"_asArray"],u=0,h=c.length;h>u;u+=1)s=c[u],t(o,s);else s=i[e],t(o,s);f(i[e])}return i};return{run:f}}var utils,UTF8,BASE64,btoa,atob,ISOBox,ISOBoxer,ISOFile;(function(n){"use strict";var t={VERSION:"0.5.3"};t.System=function(){this._mappings={},this._outlets={},this._handlers={},this.strictInjections=!0,this.autoMapOutlets=!1,this.postInjectionHook="setup"},t.System.prototype={_createAndSetupInstance:function(n,t){var i=new t;return this.injectInto(i,n),i},_retrieveFromCacheOrCreate:function(n,t){var r,i;if("undefined"==typeof t&&(t=!1),!this._mappings.hasOwnProperty(n))throw new Error(1e3);return i=this._mappings[n],!t&&i.isSingleton?(null==i.object&&(i.object=this._createAndSetupInstance(n,i.clazz)),r=i.object):r=i.clazz?this._createAndSetupInstance(n,i.clazz):i.object,r},mapOutlet:function(n,t,i){if("undefined"==typeof n)throw new Error(1010);return t=t||"global",i=i||n,this._outlets.hasOwnProperty(t)||(this._outlets[t]={}),this._outlets[t][i]=n,this},getObject:function(n){if("undefined"==typeof n)throw new Error(1020);return this._retrieveFromCacheOrCreate(n)},mapValue:function(n,t){if("undefined"==typeof n)throw new Error(1030);return this._mappings[n]={clazz:null,object:t,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(n),this.hasMapping(n)&&this.injectInto(t,n),this},hasMapping:function(n){if("undefined"==typeof n)throw new Error(1040);return this._mappings.hasOwnProperty(n)},mapClass:function(n,t){if("undefined"==typeof n)throw new Error(1050);if("undefined"==typeof t)throw new Error(1051);return this._mappings[n]={clazz:t,object:null,isSingleton:!1},this.autoMapOutlets&&this.mapOutlet(n),this},mapSingleton:function(n,t){if("undefined"==typeof n)throw new Error(1060);if("undefined"==typeof t)throw new Error(1061);return this._mappings[n]={clazz:t,object:null,isSingleton:!0},this.autoMapOutlets&&this.mapOutlet(n),this},instantiate:function(n){if("undefined"==typeof n)throw new Error(1070);return this._retrieveFromCacheOrCreate(n,!0)},injectInto:function(n,t){var i,e,u,r,f;if("undefined"==typeof n)throw new Error(1080);if("object"==typeof n){i=[],this._outlets.hasOwnProperty("global")&&i.push(this._outlets.global),"undefined"!=typeof t&&this._outlets.hasOwnProperty(t)&&i.push(this._outlets[t]);for(e in i){u=i[e];for(r in u)f=u[r],(!this.strictInjections||r in n)&&(n[r]=this.getObject(f))}"setup"in n&&n.setup.call(n)}return this},unmap:function(n){if("undefined"==typeof n)throw new Error(1090);return delete this._mappings[n],this},unmapOutlet:function(n,t){if("undefined"==typeof n)throw new Error(1100);if("undefined"==typeof t)throw new Error(1101);return delete this._outlets[n][t],this},mapHandler:function(n,t,i,r,u){if("undefined"==typeof n)throw new Error(1110);return t=t||"global",i=i||n,"undefined"==typeof r&&(r=!1),"undefined"==typeof u&&(u=!1),this._handlers.hasOwnProperty(n)||(this._handlers[n]={}),this._handlers[n].hasOwnProperty(t)||(this._handlers[n][t]=[]),this._handlers[n][t].push({handler:i,oneShot:r,passEvent:u}),this},unmapHandler:function(n,t,i){var r,u,f;if("undefined"==typeof n)throw new Error(1120);if(t=t||"global",i=i||n,this._handlers.hasOwnProperty(n)&&this._handlers[n].hasOwnProperty(t)){r=this._handlers[n][t];for(u in r)if(f=r[u],f.handler===i){r.splice(u,1);break}}return this},notify:function(n){var c,l,h,o,r,e,t,u,f,s,i;if("undefined"==typeof n)throw new Error(1130);if(c=Array.prototype.slice.call(arguments),l=c.slice(1),this._handlers.hasOwnProperty(n)){h=this._handlers[n];for(o in h){for(e=h[o],"global"!==o&&(r=this.getObject(o)),f=[],t=0,u=e.length;u>t;t++)i=e[t],s=r&&"string"==typeof i.handler?r[i.handler]:i.handler,i.oneShot&&f.unshift(t),i.passEvent?s.apply(r,c):s.apply(r,l);for(t=0,u=f.length;u>t;t++)e.splice(f[t],1)}}return this}},n.dijon=t}(this),"undefined"==typeof utils)&&(utils={}),"undefined"==typeof utils.Math&&(utils.Math={}),utils.Math.to64BitNumber=function(n,t){var u,r,i;return u=new goog.math.Long(0,t),r=new goog.math.Long(n,0),i=u.add(r),i.toNumber()},goog={},goog.math={},goog.math.Long=function(n,t){this.low_=0|n,this.high_=0|t},goog.math.Long.IntCache_={},goog.math.Long.fromInt=function(n){var i,t;return n>=-128&&128>n&&(i=goog.math.Long.IntCache_[n],i)?i:(t=new goog.math.Long(0|n,0>n?-1:0),n>=-128&&128>n&&(goog.math.Long.IntCache_[n]=t),t)},goog.math.Long.fromNumber=function(n){return isNaN(n)||!isFinite(n)?goog.math.Long.ZERO:n<=-goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MIN_VALUE:n+1>=goog.math.Long.TWO_PWR_63_DBL_?goog.math.Long.MAX_VALUE:0>n?goog.math.Long.fromNumber(-n).negate():new goog.math.Long(n%goog.math.Long.TWO_PWR_32_DBL_|0,n/goog.math.Long.TWO_PWR_32_DBL_|0)},goog.math.Long.fromBits=function(n,t){return new goog.math.Long(n,t)},goog.math.Long.fromString=function(n,t){var i,f,e,o;if(0==n.length)throw Error("number format error: empty string");if(i=t||10,2>i||i>36)throw Error("radix out of range: "+i);if("-"==n.charAt(0))return goog.math.Long.fromString(n.substring(1),i).negate();if(n.indexOf("-")>=0)throw Error('number format error: interior "-" character: '+n);for(var s=goog.math.Long.fromNumber(Math.pow(i,8)),r=goog.math.Long.ZERO,u=0;u<n.length;u+=8)f=Math.min(8,n.length-u),e=parseInt(n.substring(u,u+f),i),8>f?(o=goog.math.Long.fromNumber(Math.pow(i,f)),r=r.multiply(o).add(goog.math.Long.fromNumber(e))):(r=r.multiply(s),r=r.add(goog.math.Long.fromNumber(e)));return r},goog.math.Long.TWO_PWR_16_DBL_=65536,goog.math.Long.TWO_PWR_24_DBL_=16777216,goog.math.Long.TWO_PWR_32_DBL_=goog.math.Long.TWO_PWR_16_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_31_DBL_=goog.math.Long.TWO_PWR_32_DBL_/2,goog.math.Long.TWO_PWR_48_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_16_DBL_,goog.math.Long.TWO_PWR_64_DBL_=goog.math.Long.TWO_PWR_32_DBL_*goog.math.Long.TWO_PWR_32_DBL_,goog.math.Long.TWO_PWR_63_DBL_=goog.math.Long.TWO_PWR_64_DBL_/2,goog.math.Long.ZERO=goog.math.Long.fromInt(0),goog.math.Long.ONE=goog.math.Long.fromInt(1),goog.math.Long.NEG_ONE=goog.math.Long.fromInt(-1),goog.math.Long.MAX_VALUE=goog.math.Long.fromBits(-1,2147483647),goog.math.Long.MIN_VALUE=goog.math.Long.fromBits(0,-2147483648),goog.math.Long.TWO_PWR_24_=goog.math.Long.fromInt(16777216),goog.math.Long.prototype.toInt=function(){return this.low_},goog.math.Long.prototype.toNumber=function(){return this.high_*goog.math.Long.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},goog.math.Long.prototype.toString=function(n){var t=n||10;if(2>t||t>36)throw Error("radix out of range: "+t);if(this.isZero())return"0";if(this.isNegative()){if(this.equals(goog.math.Long.MIN_VALUE)){var e=goog.math.Long.fromNumber(t),s=this.div(e),i=s.multiply(e).subtract(this);return s.toString(t)+i.toInt().toString(t)}return"-"+this.negate().toString(t)}for(var o=goog.math.Long.fromNumber(Math.pow(t,6)),i=this,u="";;){var f=i.div(o),h=i.subtract(f.multiply(o)).toInt(),r=h.toString(t);if(i=f,i.isZero())return r+u;for(;r.length<6;)r="0"+r;u=""+r+u}},goog.math.Long.prototype.getHighBits=function(){return this.high_},goog.math.Long.prototype.getLowBits=function(){return this.low_},goog.math.Long.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:goog.math.Long.TWO_PWR_32_DBL_+this.low_},goog.math.Long.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.equals(goog.math.Long.MIN_VALUE)?64:this.negate().getNumBitsAbs();for(var t=0!=this.high_?this.high_:this.low_,n=31;n>0&&0==(t&1<<n);n--);return 0!=this.high_?n+33:n+1},goog.math.Long.prototype.isZero=function(){return 0==this.high_&&0==this.low_},goog.math.Long.prototype.isNegative=function(){return this.high_<0},goog.math.Long.prototype.isOdd=function(){return 1==(1&this.low_)},goog.math.Long.prototype.equals=function(n){return this.high_==n.high_&&this.low_==n.low_},goog.math.Long.prototype.notEquals=function(n){return this.high_!=n.high_||this.low_!=n.low_},goog.math.Long.prototype.lessThan=function(n){return this.compare(n)<0},goog.math.Long.prototype.lessThanOrEqual=function(n){return this.compare(n)<=0},goog.math.Long.prototype.greaterThan=function(n){return this.compare(n)>0},goog.math.Long.prototype.greaterThanOrEqual=function(n){return this.compare(n)>=0},goog.math.Long.prototype.compare=function(n){if(this.equals(n))return 0;var i=this.isNegative(),t=n.isNegative();return i&&!t?-1:!i&&t?1:this.subtract(n).isNegative()?-1:1},goog.math.Long.prototype.negate=function(){return this.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.MIN_VALUE:this.not().add(goog.math.Long.ONE)},goog.math.Long.prototype.add=function(n){var s=this.high_>>>16,f=65535&this.high_,e=this.low_>>>16,h=65535&this.low_,c=n.high_>>>16,o=65535&n.high_,a=n.low_>>>16,l=65535&n.low_,u=0,t=0,i=0,r=0;return r+=h+l,i+=r>>>16,r&=65535,i+=e+a,t+=i>>>16,i&=65535,t+=f+o,u+=t>>>16,t&=65535,u+=s+c,u&=65535,goog.math.Long.fromBits(i<<16|r,u<<16|t)},goog.math.Long.prototype.subtract=function(n){return this.add(n.negate())},goog.math.Long.prototype.multiply=function(n){if(this.isZero())return goog.math.Long.ZERO;if(n.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return n.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(n.equals(goog.math.Long.MIN_VALUE))return this.isOdd()?goog.math.Long.MIN_VALUE:goog.math.Long.ZERO;if(this.isNegative())return n.isNegative()?this.negate().multiply(n.negate()):this.negate().multiply(n).negate();if(n.isNegative())return this.multiply(n.negate()).negate();if(this.lessThan(goog.math.Long.TWO_PWR_24_)&&n.lessThan(goog.math.Long.TWO_PWR_24_))return goog.math.Long.fromNumber(this.toNumber()*n.toNumber());var a=this.high_>>>16,h=65535&this.high_,s=this.low_>>>16,e=65535&this.low_,l=n.high_>>>16,c=65535&n.high_,o=n.low_>>>16,f=65535&n.low_,r=0,t=0,i=0,u=0;return u+=e*f,i+=u>>>16,u&=65535,i+=s*f,t+=i>>>16,i&=65535,i+=e*o,t+=i>>>16,i&=65535,t+=h*f,r+=t>>>16,t&=65535,t+=s*o,r+=t>>>16,t&=65535,t+=e*c,r+=t>>>16,t&=65535,r+=a*f+h*o+s*c+e*l,r&=65535,goog.math.Long.fromBits(i<<16|u,r<<16|t)},goog.math.Long.prototype.div=function(n){var e,i,o,u,t;if(n.isZero())throw Error("division by zero");if(this.isZero())return goog.math.Long.ZERO;if(this.equals(goog.math.Long.MIN_VALUE))return n.equals(goog.math.Long.ONE)||n.equals(goog.math.Long.NEG_ONE)?goog.math.Long.MIN_VALUE:n.equals(goog.math.Long.MIN_VALUE)?goog.math.Long.ONE:(e=this.shiftRight(1),i=e.div(n).shiftLeft(1),i.equals(goog.math.Long.ZERO))?n.isNegative()?goog.math.Long.ONE:goog.math.Long.NEG_ONE:(t=this.subtract(n.multiply(i)),o=i.add(t.div(n)),o);if(n.equals(goog.math.Long.MIN_VALUE))return goog.math.Long.ZERO;if(this.isNegative())return n.isNegative()?this.negate().div(n.negate()):this.negate().div(n).negate();if(n.isNegative())return this.div(n.negate()).negate();for(u=goog.math.Long.ZERO,t=this;t.greaterThanOrEqual(n);){for(var i=Math.max(1,Math.floor(t.toNumber()/n.toNumber())),s=Math.ceil(Math.log(i)/Math.LN2),h=48>=s?1:Math.pow(2,s-48),r=goog.math.Long.fromNumber(i),f=r.multiply(n);f.isNegative()||f.greaterThan(t);)i-=h,r=goog.math.Long.fromNumber(i),f=r.multiply(n);r.isZero()&&(r=goog.math.Long.ONE),u=u.add(r),t=t.subtract(f)}return u},goog.math.Long.prototype.modulo=function(n){return this.subtract(this.div(n).multiply(n))},goog.math.Long.prototype.not=function(){return goog.math.Long.fromBits(~this.low_,~this.high_)},goog.math.Long.prototype.and=function(n){return goog.math.Long.fromBits(this.low_&n.low_,this.high_&n.high_)},goog.math.Long.prototype.or=function(n){return goog.math.Long.fromBits(this.low_|n.low_,this.high_|n.high_)},goog.math.Long.prototype.xor=function(n){return goog.math.Long.fromBits(this.low_^n.low_,this.high_^n.high_)},goog.math.Long.prototype.shiftLeft=function(n){var t,i;return(n&=63,0==n)?this:(t=this.low_,32>n)?(i=this.high_,goog.math.Long.fromBits(t<<n,i<<n|t>>>32-n)):goog.math.Long.fromBits(0,t<<n-32)},goog.math.Long.prototype.shiftRight=function(n){var t,i;return(n&=63,0==n)?this:(t=this.high_,32>n)?(i=this.low_,goog.math.Long.fromBits(i>>>n|t<<32-n,t>>n)):goog.math.Long.fromBits(t>>n-32,t>=0?0:-1)},goog.math.Long.prototype.shiftRightUnsigned=function(n){var t,i;return(n&=63,0==n)?this:(t=this.high_,32>n)?(i=this.low_,goog.math.Long.fromBits(i>>>n|t<<32-n,t>>>n)):32==n?goog.math.Long.fromBits(t,0):goog.math.Long.fromBits(t>>>n-32,0)},UTF8={},UTF8.encode=function(n){for(var t,i=[],r=0;r<n.length;++r)t=n.charCodeAt(r),128>t?i.push(t):2048>t?(i.push(192|t>>6),i.push(128|63&t)):65536>t?(i.push(224|t>>12),i.push(128|63&t>>6),i.push(128|63&t)):(i.push(240|t>>18),i.push(128|63&t>>12),i.push(128|63&t>>6),i.push(128|63&t));return i},UTF8.decode=function(n){for(var t,r=[],i=0;i<n.length;)t=n[i++],128>t||(224>t?(t=(31&t)<<6,t|=63&n[i++]):240>t?(t=(15&t)<<12,t|=(63&n[i++])<<6,t|=63&n[i++]):(t=(7&t)<<18,t|=(63&n[i++])<<12,t|=(63&n[i++])<<6,t|=63&n[i++])),r.push(String.fromCharCode(t));return r.join("")},BASE64={},(function(n){var u=function(t){for(var i,u=0,r=[],f=0|t.length/3;0<f--;)i=(t[u]<<16)+(t[u+1]<<8)+t[u+2],u+=3,r.push(n.charAt(63&i>>18)),r.push(n.charAt(63&i>>12)),r.push(n.charAt(63&i>>6)),r.push(n.charAt(63&i));return 2==t.length-u?(i=(t[u]<<16)+(t[u+1]<<8),r.push(n.charAt(63&i>>18)),r.push(n.charAt(63&i>>12)),r.push(n.charAt(63&i>>6)),r.push("=")):1==t.length-u&&(i=t[u]<<16,r.push(n.charAt(63&i>>18)),r.push(n.charAt(63&i>>12)),r.push("==")),r.join("")},i=function(){for(var i=[],t=0;t<n.length;++t)i[n.charCodeAt(t)]=t;return i["=".charCodeAt(0)]=0,i}(),r=function(n){for(var u,r=0,t=[],f=0|n.length/4;0<f--;)u=(i[n.charCodeAt(r)]<<18)+(i[n.charCodeAt(r+1)]<<12)+(i[n.charCodeAt(r+2)]<<6)+i[n.charCodeAt(r+3)],t.push(255&u>>16),t.push(255&u>>8),t.push(255&u),r+=4;return t&&("="==n.charAt(r-2)?(t.pop(),t.pop()):"="==n.charAt(r-1)&&t.pop()),t},t={};t.encode=function(n){for(var i=[],t=0;t<n.length;++t)i.push(n.charCodeAt(t));return i},t.decode=function(){for(var n=0;n<s.length;++n)a[n]=String.fromCharCode(a[n]);return a.join("")},BASE64.decodeArray=function(n){var t=r(n);return new Uint8Array(t)},BASE64.encodeASCII=function(n){var i=t.encode(n);return u(i)},BASE64.decodeASCII=function(n){var i=r(n);return t.decode(i)},BASE64.encode=function(n){var t=UTF8.encode(n);return u(t)},BASE64.decode=function(n){var t=r(n);return UTF8.decode(t)}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),void 0===btoa)&&(btoa=BASE64.encode),void 0===atob&&(atob=BASE64.decode),ISOBoxer=ISOBoxer||{},ISOBoxer.Cursor=function(n){this.offset="undefined"==typeof n?0:n},ISOBox=function(){this._cursor=new ISOBoxer.Cursor},ISOBox.parse=function(n){var t=new ISOBox;return t._offset=n._cursor.offset,t._root=n._root?n._root:n,t._raw=n._raw,t._parent=n,t._parseBox(),n._cursor.offset=t._raw.byteOffset+t._raw.byteLength,t},ISOBox.prototype._readInt=function(n){var t=null;switch(n){case 8:t=this._raw.getInt8(this._cursor.offset-this._raw.byteOffset);break;case 16:t=this._raw.getInt16(this._cursor.offset-this._raw.byteOffset);break;case 32:t=this._raw.getInt32(this._cursor.offset-this._raw.byteOffset)}return this._cursor.offset+=n>>3,t},ISOBox.prototype._readUint=function(n){var t=null,r,i;switch(n){case 8:t=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset);break;case 16:t=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset);break;case 24:r=this._raw.getUint16(this._cursor.offset-this._raw.byteOffset),i=this._raw.getUint8(this._cursor.offset-this._raw.byteOffset+2),t=(r<<8)+i;break;case 32:t=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset);break;case 64:r=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset),i=this._raw.getUint32(this._cursor.offset-this._raw.byteOffset+4),t=r*Math.pow(2,32)+i}return this._cursor.offset+=n>>3,t},ISOBox.prototype._readString=function(n){for(var r,i="",t=0;n>t;t++)r=this._readUint(8),i+=String.fromCharCode(r);return i},ISOBox.prototype._readTerminatedString=function(){for(var n,t="";;){if(n=this._readUint(8),0==n)break;t+=String.fromCharCode(n)}return t},ISOBox.prototype._readTemplate=function(n){var i=this._readUint(n/2),t=this._readUint(n/2);return i+t/Math.pow(2,n/2)},ISOBox.prototype._parseBox=function(){if(this._cursor.offset=this._offset,this._offset+8>this._raw.buffer.byteLength)return void(this._root._incomplete=!0);switch(this.size=this._readUint(32),this.type=this._readString(4),1==this.size&&(this.largesize=this._readUint(64)),"uuid"==this.type&&(this.usertype=this._readString(16)),this.size){case 0:this._raw=new DataView(this._raw.buffer,this._offset,this._raw.byteLength-this._cursor.offset);break;case 1:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.largesize);break;default:this._offset+this.size>this._raw.buffer.byteLength?(this._incomplete=!0,this._root._incomplete=!0):this._raw=new DataView(this._raw.buffer,this._offset,this.size)}!this._incomplete&&this._boxParsers[this.type]&&this._boxParsers[this.type].call(this)},ISOBox.prototype._parseFullBox=function(){this.version=this._readUint(8),this.flags=this._readUint(24)},ISOBox.prototype._boxParsers={},["moov","trak","tref","mdia","minf","stbl","edts","dinf","mvex","moof","traf","mfra","udta","meco","strk"].forEach(function(n){ISOBox.prototype._boxParsers[n]=function(){for(this.boxes=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.boxes.push(ISOBox.parse(this))}}),ISOBox.prototype._boxParsers.emsg=function(){this._parseFullBox(),this.scheme_id_uri=this._readTerminatedString(),this.value=this._readTerminatedString(),this.timescale=this._readUint(32),this.presentation_time_delta=this._readUint(32),this.event_duration=this._readUint(32),this.id=this._readUint(32),this.message_data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},ISOBox.prototype._boxParsers.free=ISOBox.prototype._boxParsers.skip=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},ISOBox.prototype._boxParsers.ftyp=ISOBox.prototype._boxParsers.styp=function(){for(this.major_brand=this._readString(4),this.minor_versions=this._readUint(32),this.compatible_brands=[];this._cursor.offset-this._raw.byteOffset<this._raw.byteLength;)this.compatible_brands.push(this._readString(4))},ISOBox.prototype._boxParsers.mdat=function(){this.data=new DataView(this._raw.buffer,this._cursor.offset,this._raw.byteLength-(this._cursor.offset-this._offset))},ISOBox.prototype._boxParsers.mdhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32));var n=this._readUint(16);this.pad=n>>15,this.language=String.fromCharCode((n>>10&31)+96,(n>>5&31)+96,(31&n)+96),this.pre_defined=this._readUint(16)},ISOBox.prototype._boxParsers.mfhd=function(){this._parseFullBox(),this.sequence_number=this._readUint(32)},ISOBox.prototype._boxParsers.mvhd=function(){var n;for(this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.timescale=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.timescale=this._readUint(32),this.duration=this._readUint(32)),this.rate=this._readTemplate(32),this.volume=this._readTemplate(16),this.reserved1=this._readUint(16),this.reserved2=[this._readUint(32),this._readUint(32)],this.matrix=[],n=0;9>n;n++)this.matrix.push(this._readTemplate(32));for(this.pre_defined=[],n=0;6>n;n++)this.pre_defined.push(this._readUint(32));this.next_track_ID=this._readUint(32)},ISOBox.prototype._boxParsers.sidx=function(){var i,n,r,t;for(this._parseFullBox(),this.reference_ID=this._readUint(32),this.timescale=this._readUint(32),0==this.version?(this.earliest_presentation_time=this._readUint(32),this.first_offset=this._readUint(32)):(this.earliest_presentation_time=this._readUint(64),this.first_offset=this._readUint(64)),this.reserved=this._readUint(16),this.reference_count=this._readUint(16),this.references=[],i=0;i<this.reference_count;i++)n={},r=this._readUint(32),n.reference_type=r>>31&1,n.referenced_size=2147483647&r,n.subsegment_duration=this._readUint(32),t=this._readUint(32),n.starts_with_SAP=t>>31&1,n.SAP_type=t>>28&7,n.SAP_delta_time=268435455&t,this.references.push(n)},ISOBox.prototype._boxParsers.ssix=function(){var i,n,r,t;for(this._parseFullBox(),this.subsegment_count=this._readUint(32),this.subsegments=[],i=0;i<this.subsegment_count;i++){for(n={},n.ranges_count=this._readUint(32),n.ranges=[],r=0;r<n.ranges_count;r++)t={},t.level=this._readUint(8),t.range_size=this._readUint(24),n.ranges.push(t);this.subsegments.push(n)}},ISOBox.prototype._boxParsers.tkhd=function(){this._parseFullBox(),1==this.version?(this.creation_time=this._readUint(64),this.modification_time=this._readUint(64),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(64)):(this.creation_time=this._readUint(32),this.modification_time=this._readUint(32),this.track_ID=this._readUint(32),this.reserved1=this._readUint(32),this.duration=this._readUint(32)),this.reserved2=[this._readUint(32),this._readUint(32)],this.layer=this._readUint(16),this.alternate_group=this._readUint(16),this.volume=this._readTemplate(16),this.reserved3=this._readUint(16),this.matrix=[];for(var n=0;9>n;n++)this.matrix.push(this._readTemplate(32));this.width=this._readUint(32),this.height=this._readUint(32)},ISOBox.prototype._boxParsers.tfdt=function(){this._parseFullBox(),this.baseMediaDecodeTime=this._readUint(1==this.version?64:32)},ISOBox.prototype._boxParsers.tfhd=function(){this._parseFullBox(),this.track_ID=this._readUint(32),1&this.flags&&(this.base_data_offset=this._readUint(64)),2&this.flags&&(this.sample_description_offset=this._readUint(32)),8&this.flags&&(this.default_sample_duration=this._readUint(32)),16&this.flags&&(this.default_sample_size=this._readUint(32)),32&this.flags&&(this.default_sample_flags=this._readUint(32))},ISOBox.prototype._boxParsers.trun=function(){var t,n;for(this._parseFullBox(),this.sample_count=this._readUint(32),1&this.flags&&(this.data_offset=this._readInt(32)),4&this.flags&&(this.first_sample_flags=this._readUint(32)),this.samples=[],t=0;t<this.sample_count;t++)n={},256&this.flags&&(n.sample_duration=this._readUint(32)),512&this.flags&&(n.sample_size=this._readUint(32)),1024&this.flags&&(n.sample_flags=this._readUint(32)),2048&this.flags&&(n.sample_composition_time_offset=0==this.version?this._readUint(32):this._readInt(32)),this.samples.push(n)},ISOBoxer=ISOBoxer||{},ISOBoxer.parseBuffer=function(n){return new ISOFile(n).parse()},ISOBoxer.Utils={},ISOBoxer.Utils.dataViewToString=function(n,t){if("undefined"!=typeof TextDecoder)return new TextDecoder(t||"utf-8").decode(n);for(var r="",i=0;i<n.byteLength;i++)r+=String.fromCharCode(n.getUint8(i));return r},"undefined"!=typeof exports&&(exports.parseBuffer=ISOBoxer.parseBuffer,exports.Utils=ISOBoxer.Utils),ISOFile=function(n){this._raw=new DataView(n),this._cursor=new ISOBoxer.Cursor,this.boxes=[]},ISOFile.prototype.fetch=function(n){var t=this.fetchAll(n,!0);return t.length?t[0]:null},ISOFile.prototype.fetchAll=function(n,t){var i=[];return ISOFile._sweep.call(this,n,i,t),i},ISOFile.prototype.parse=function(){for(this._cursor.offset=0,this.boxes=[];this._cursor.offset<this._raw.byteLength;){var n=ISOBox.parse(this);if("undefined"==typeof n.type)break;this.boxes.push(n)}return this},ISOFile._sweep=function(n,t,i){this.type&&this.type==n&&t.push(this);for(var r in this.boxes){if(t.length&&i)return;ISOFile._sweep.call(this.boxes[r],n,t,i)}},MediaPlayer=function(n){"use strict";var t,u,c,e,i,f,r,k,p,w,g,yt="1.5.0",bt="http://time.akamai.com/?iso",pt="urn:mpeg:dash:utc:http-xsdate:2014",ft=0,tt=null,it=null,s=!1,l=!1,rt=!1,nt=!0,d=!1,b=MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED,ht=!0,o=[],ct=4,lt=!1,a=function(){return!!c&&!!e&&!l},st=function(){if(!s)throw"MediaPlayer not initialized!";if(!this.capabilities.supportsMediaSource())return void this.errHandler.capabilityError("mediasource");if(!c||!e)throw"Missing view or source.";rt=!0,this.debug.log("Playback initiated!"),i=t.getObject("streamController"),r.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,i),r.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,i),r.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY,i),r.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,i),r.setLiveDelayAttributes(ct,lt),i.initialize(nt,tt,it),g.checkInitialBitrate(),"string"==typeof e?i.load(e):i.loadWithManifest(e),i.setUTCTimingSources(o,ht),t.mapValue("scheduleWhilePaused",d),t.mapOutlet("scheduleWhilePaused","stream"),t.mapOutlet("scheduleWhilePaused","scheduleController"),t.mapValue("numOfParallelRequestAllowed",ft),t.mapOutlet("numOfParallelRequestAllowed","scheduleController"),t.mapValue("bufferMax",b),t.mapOutlet("bufferMax","bufferController"),f.initialize()},ut=function(){a()&&st.call(this)},h=function(){var n=p.getReadOnlyMetricsFor("video")||p.getReadOnlyMetricsFor("audio");return k.getCurrentDVRInfo(n)},ni=function(){return h.call(this).manifestInfo.DVRWindowSize},gt=function(n){var i=h.call(this),t=i.range.start+n;return t>i.range.end&&(t=i.range.end),t},dt=function(n){this.getVideoModel().getElement().currentTime=this.getDVRSeekOffset(n)},ri=function(){var n=h.call(this);return null===n?0:this.duration()-(n.range.end-n.time)},ii=function(){var t,n=h.call(this);return null===n?0:(t=n.range.end-n.range.start,t<n.manifestInfo.DVRWindowSize?t:n.manifestInfo.DVRWindowSize)},ot=function(n){var i,r,t=h.call(this);return null===t?0:(i=t.manifestInfo.availableFrom.getTime()/1e3,r=n+(i+t.range.start))},ti=function(){return ot.call(this,this.time())},kt=function(){return ot.call(this,this.duration())},vt=function(n,t,i){var r=new Date(1e3*n),f=r.toLocaleDateString(t),u=r.toLocaleTimeString(t,{hour12:i});return u+" "+f},at=function(n){n=Math.max(n,0);var t=Math.floor(n/3600),r=Math.floor(n%3600/60),i=Math.floor(n%3600%60);return(0===t?"":10>t?"0"+t.toString()+":":t.toString()+":")+(10>r?"0"+r.toString():r.toString())+":"+(10>i?"0"+i.toString():i.toString())},v=function(n,t,i){t&&void 0!==n&&null!==n&&(i?f.setRules(n,t):f.addRules(n,t))},et=function(){if(rt&&i){if(!l){l=!0,r.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,i),r.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,i),r.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY,i),r.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,i);var t={},n=this;t[MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE]=function(){u.reset(),f.reset(),r.reset(),i=null,rt=!1,l=!1,a.call(n)&&ut.call(n)},i.subscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE,t,void 0,!0),i.reset()}}else a.call(this)&&ut.call(this)},wt=dijon.System.prototype.getObject,y;return dijon.System.prototype.getObject=function(n){var t=wt.call(this,n);return"object"!=typeof t||t.getName||(t.getName=function(){return n},t.setMediaType=function(n){t.mediaType=n},t.getMediaType=function(){return t.mediaType}),t},t=new dijon.System,t.mapValue("system",t),t.mapOutlet("system"),t.mapValue("eventBus",new MediaPlayer.utils.EventBus),t.mapOutlet("eventBus"),y=new MediaPlayer.utils.Debug,t.mapValue("debug",y),t.mapOutlet("debug"),t.injectInto(y),y.setup(),t.injectInto(n),{notifier:void 0,debug:void 0,eventBus:void 0,capabilities:void 0,adapter:void 0,errHandler:void 0,uriQueryFragModel:void 0,videoElementExt:void 0,setup:function(){k=t.getObject("metricsExt"),u=t.getObject("abrController"),f=t.getObject("rulesController"),p=t.getObject("metricsModel"),g=t.getObject("DOMStorage"),r=t.getObject("playbackController"),this.restoreDefaultUTCTimingSources()},addEventListener:function(n,t,i){n=n.toLowerCase(),this.eventBus.addEventListener(n,t,i)},removeEventListener:function(n,t,i){n=n.toLowerCase(),this.eventBus.removeEventListener(n,t,i)},getVersion:function(){return yt},startup:function(){s||(t.injectInto(this),s=!0)},getDebug:function(){return this.debug},getVideoModel:function(){return w},setLiveDelayFragmentCount:function(n){ct=n},useSuggestedPresentationDelay:function(n){lt=n},enableLastBitrateCaching:function(n,t){g.enableLastBitrateCaching(n,t)},setNumOfParallelRequestAllowed:function(n){ft=n},setMaxAllowedBitrateFor:function(n,t){u.setMaxAllowedBitrateFor(n,t)},getMaxAllowedBitrateFor:function(n){return u.getMaxAllowedBitrateFor(n)},setAutoPlay:function(n){nt=n},getAutoPlay:function(){return nt},setScheduleWhilePaused:function(n){d=n},getScheduleWhilePaused:function(){return d},setBufferMax:function(n){b=n},getBufferMax:function(){return b},getMetricsExt:function(){return k},getMetricsFor:function(n){return p.getReadOnlyMetricsFor(n)},getQualityFor:function(n){return u.getQualityFor(n,i.getActiveStreamInfo())},setQualityFor:function(n,t){u.setPlaybackQuality(n,i.getActiveStreamInfo(),t)},getBitrateInfoListFor:function(n){var r=i.getActiveStreamInfo(),t=i.getStreamById(r.id);return t.getBitrateListFor(n)},setInitialBitrateFor:function(n,t){u.setInitialBitrateFor(n,t)},getInitialBitrateFor:function(n){return u.getInitialBitrateFor(n)},getAutoSwitchQuality:function(){return u.getAutoSwitchBitrate()},setAutoSwitchQuality:function(n){u.setAutoSwitchBitrate(n)},setSchedulingRules:function(n){v.call(this,f.SCHEDULING_RULE,n,!0)},addSchedulingRules:function(n){v.call(this,f.SCHEDULING_RULE,n,!1)},setABRRules:function(n){v.call(this,f.ABR_RULE,n,!0)},addABRRules:function(n){v.call(this,f.ABR_RULE,n,!1)},createProtection:function(){return t.getObject("protectionController")},retrieveManifest:function(n,i){!function(n){var r=t.getObject("manifestLoader"),f=t.getObject("uriQueryFragModel"),u={};u[MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED]=function(n){n.error?i(null,n.error):i(n.data.manifest),r.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this)},r.subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,u),r.load(f.parseURI(n))}(n)},addUTCTimingSource:function(n,t){this.removeUTCTimingSource(n,t);var i=new Dash.vo.UTCTiming;i.schemeIdUri=n,i.value=t,o.push(i)},removeUTCTimingSource:function(n,t){o.forEach(function(i,r){i.schemeIdUri===n&&i.value===t&&o.splice(r,1)})},clearDefaultUTCTimingSources:function(){o=[]},restoreDefaultUTCTimingSources:function(){this.addUTCTimingSource(pt,bt)},enableManifestDateHeaderTimeSource:function(n){ht=n},attachView:function(n){if(!s)throw"MediaPlayer not initialized!";c=n,w=null,c&&(w=t.getObject("videoModel"),w.setElement(c)),et.call(this)},attachSource:function(n,t,i){if(!s)throw"MediaPlayer not initialized!";"string"==typeof n?(this.uriQueryFragModel.reset(),e=this.uriQueryFragModel.parseURI(n)):e=n,tt=t,it=i,et.call(this)},reset:function(){this.attachSource(null),this.attachView(null),tt=null,it=null},play:st,isReady:a,seek:dt,time:ri,duration:ii,timeAsUTC:ti,durationAsUTC:kt,getDVRWindowSize:ni,getDVRSeekOffset:gt,formatUTC:vt,convertToTimeCode:at}},MediaPlayer.prototype={constructor:MediaPlayer},MediaPlayer.dependencies={},MediaPlayer.dependencies.protection={},MediaPlayer.dependencies.protection.servers={},MediaPlayer.utils={},MediaPlayer.models={},MediaPlayer.vo={},MediaPlayer.vo.metrics={},MediaPlayer.vo.protection={},MediaPlayer.rules={},MediaPlayer.di={},MediaPlayer.events={RESET_COMPLETE:"resetComplete",METRICS_CHANGED:"metricschanged",METRIC_CHANGED:"metricchanged",METRIC_UPDATED:"metricupdated",METRIC_ADDED:"metricadded",MANIFEST_LOADED:"manifestloaded",PROTECTION_CREATED:"protectioncreated",PROTECTION_DESTROYED:"protectiondestroyed",STREAM_SWITCH_STARTED:"streamswitchstarted",STREAM_SWITCH_COMPLETED:"streamswitchcompleted",STREAM_INITIALIZED:"streaminitialized",TEXT_TRACK_ADDED:"texttrackadded",BUFFER_LOADED:"bufferloaded",BUFFER_EMPTY:"bufferstalled",ERROR:"error",LOG:"log"},MediaPlayer.di.Context=function(){"use strict";var n=function(){var n=document.createElement("video");MediaPlayer.models.ProtectionModel_21Jan2015.detect(n)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_21Jan2015):MediaPlayer.models.ProtectionModel_3Feb2014.detect(n)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_3Feb2014):MediaPlayer.models.ProtectionModel_01b.detect(n)?this.system.mapClass("protectionModel",MediaPlayer.models.ProtectionModel_01b):(this.debug.log("No supported version of EME detected on this user agent!"),this.debug.log("Attempts to play encrypted content will fail!"))};return{system:void 0,setup:function(){this.system.autoMapOutlets=!0,this.system.mapClass("eventBusCl",MediaPlayer.utils.EventBus),this.system.mapSingleton("capabilities",MediaPlayer.utils.Capabilities),this.system.mapSingleton("DOMStorage",MediaPlayer.utils.DOMStorage),this.system.mapClass("customTimeRanges",MediaPlayer.utils.CustomTimeRanges),this.system.mapSingleton("virtualBuffer",MediaPlayer.utils.VirtualBuffer),this.system.mapClass("isoFile",MediaPlayer.utils.IsoFile),this.system.mapSingleton("textTrackExtensions",MediaPlayer.utils.TextTrackExtensions),this.system.mapSingleton("vttParser",MediaPlayer.utils.VTTParser),this.system.mapSingleton("ttmlParser",MediaPlayer.utils.TTMLParser),this.system.mapSingleton("boxParser",MediaPlayer.utils.BoxParser),this.system.mapSingleton("videoModel",MediaPlayer.models.VideoModel),this.system.mapSingleton("manifestModel",MediaPlayer.models.ManifestModel),this.system.mapSingleton("metricsModel",MediaPlayer.models.MetricsModel),this.system.mapSingleton("uriQueryFragModel",MediaPlayer.models.URIQueryAndFragmentModel),this.system.mapSingleton("ksPlayReady",MediaPlayer.dependencies.protection.KeySystem_PlayReady),this.system.mapSingleton("ksWidevine",MediaPlayer.dependencies.protection.KeySystem_Widevine),this.system.mapSingleton("ksClearKey",MediaPlayer.dependencies.protection.KeySystem_ClearKey),this.system.mapSingleton("serverPlayReady",MediaPlayer.dependencies.protection.servers.PlayReady),this.system.mapSingleton("serverWidevine",MediaPlayer.dependencies.protection.servers.Widevine),this.system.mapSingleton("serverClearKey",MediaPlayer.dependencies.protection.servers.ClearKey),this.system.mapSingleton("serverDRMToday",MediaPlayer.dependencies.protection.servers.DRMToday),this.system.mapSingleton("requestModifierExt",MediaPlayer.dependencies.RequestModifierExtensions),this.system.mapSingleton("textSourceBuffer",MediaPlayer.dependencies.TextSourceBuffer),this.system.mapSingleton("mediaSourceExt",MediaPlayer.dependencies.MediaSourceExtensions),this.system.mapSingleton("sourceBufferExt",MediaPlayer.dependencies.SourceBufferExtensions),this.system.mapSingleton("abrController",MediaPlayer.dependencies.AbrController),this.system.mapSingleton("errHandler",MediaPlayer.dependencies.ErrorHandler),this.system.mapSingleton("videoExt",MediaPlayer.dependencies.VideoModelExtensions),this.system.mapSingleton("protectionExt",MediaPlayer.dependencies.ProtectionExtensions),this.system.mapClass("protectionController",MediaPlayer.dependencies.ProtectionController),this.system.mapSingleton("playbackController",MediaPlayer.dependencies.PlaybackController),n.call(this),this.system.mapSingleton("liveEdgeFinder",MediaPlayer.dependencies.LiveEdgeFinder),this.system.mapClass("metrics",MediaPlayer.models.MetricsList),this.system.mapClass("insufficientBufferRule",MediaPlayer.rules.InsufficientBufferRule),this.system.mapClass("bufferOccupancyRule",MediaPlayer.rules.BufferOccupancyRule),this.system.mapClass("throughputRule",MediaPlayer.rules.ThroughputRule),this.system.mapSingleton("abrRulesCollection",MediaPlayer.rules.ABRRulesCollection),this.system.mapSingleton("rulesController",MediaPlayer.rules.RulesController),this.system.mapClass("bufferLevelRule",MediaPlayer.rules.BufferLevelRule),this.system.mapClass("pendingRequestsRule",MediaPlayer.rules.PendingRequestsRule),this.system.mapClass("playbackTimeRule",MediaPlayer.rules.PlaybackTimeRule),this.system.mapClass("sameTimeRequestRule",MediaPlayer.rules.SameTimeRequestRule),this.system.mapClass("abandonRequestRule",MediaPlayer.rules.AbandonRequestsRule),this.system.mapSingleton("scheduleRulesCollection",MediaPlayer.rules.ScheduleRulesCollection),this.system.mapClass("liveEdgeBinarySearchRule",MediaPlayer.rules.LiveEdgeBinarySearchRule),this.system.mapClass("liveEdgeWithTimeSynchronizationRule",MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule),this.system.mapSingleton("synchronizationRulesCollection",MediaPlayer.rules.SynchronizationRulesCollection),this.system.mapClass("xlinkController",MediaPlayer.dependencies.XlinkController),this.system.mapClass("xlinkLoader",MediaPlayer.dependencies.XlinkLoader),this.system.mapClass("streamProcessor",MediaPlayer.dependencies.StreamProcessor),this.system.mapClass("eventController",MediaPlayer.dependencies.EventController),this.system.mapClass("textController",MediaPlayer.dependencies.TextController),this.system.mapClass("bufferController",MediaPlayer.dependencies.BufferController),this.system.mapClass("manifestLoader",MediaPlayer.dependencies.ManifestLoader),this.system.mapSingleton("manifestUpdater",MediaPlayer.dependencies.ManifestUpdater),this.system.mapClass("fragmentController",MediaPlayer.dependencies.FragmentController),this.system.mapClass("fragmentLoader",MediaPlayer.dependencies.FragmentLoader),this.system.mapClass("fragmentModel",MediaPlayer.dependencies.FragmentModel),this.system.mapSingleton("streamController",MediaPlayer.dependencies.StreamController),this.system.mapClass("stream",MediaPlayer.dependencies.Stream),this.system.mapClass("scheduleController",MediaPlayer.dependencies.ScheduleController),this.system.mapSingleton("timeSyncController",MediaPlayer.dependencies.TimeSyncController),this.system.mapSingleton("notifier",MediaPlayer.dependencies.Notifier)}}},Dash=function(){"use strict";return{modules:{},dependencies:{},vo:{},di:{}}}(),Dash.di.DashContext=function(){"use strict";return{system:void 0,debug:void 0,setup:function(){Dash.di.DashContext.prototype.setup.call(this),this.system.mapClass("parser",Dash.dependencies.DashParser),this.system.mapClass("indexHandler",Dash.dependencies.DashHandler),this.system.mapSingleton("baseURLExt",Dash.dependencies.BaseURLExtensions),this.system.mapClass("fragmentExt",Dash.dependencies.FragmentExtensions),this.system.mapClass("trackController",Dash.dependencies.RepresentationController),this.system.mapSingleton("manifestExt",Dash.dependencies.DashManifestExtensions),this.system.mapSingleton("metricsExt",Dash.dependencies.DashMetricsExtensions),this.system.mapSingleton("timelineConverter",Dash.dependencies.TimelineConverter),this.system.mapSingleton("adapter",Dash.dependencies.DashAdapter)}}},Dash.di.DashContext.prototype=new MediaPlayer.di.Context,Dash.di.DashContext.prototype.constructor=Dash.di.DashContext,Dash.dependencies.DashAdapter=function(){"use strict";var n=[],t={},i=function(n,t){return t.getRepresentationForQuality(n.quality)},e=function(n){return t[n.streamInfo.id][n.index]},r=function(t){var r,u=n.length,i=0;for(i;u>i;i+=1)if(r=n[i],t.id===r.id)return r;return null},o=function(n,t){var i=new MediaPlayer.vo.TrackInfo,f=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index],r=this.manifestExt.getRepresentationFor(t.index,f);return i.id=t.id,i.quality=t.index,i.bandwidth=this.manifestExt.getBandwidth(r),i.DVRWindow=t.segmentAvailabilityRange,i.fragmentDuration=t.segmentDuration||(t.segments&&t.segments.length>0?t.segments[0].duration:NaN),i.MSETimeOffset=t.MSETimeOffset,i.useCalculatedLiveEdgeTime=t.useCalculatedLiveEdgeTime,i.mediaInfo=u.call(this,n,t.adaptation),i},u=function(n,t){var i=new MediaPlayer.vo.MediaInfo,u=this,r=t.period.mpd.manifest.Period_asArray[t.period.index].AdaptationSet_asArray[t.index];return i.id=t.id,i.index=t.index,i.type=t.type,i.streamInfo=f.call(this,n,t.period),i.trackCount=this.manifestExt.getRepresentationCount(r),i.lang=this.manifestExt.getLanguageForAdaptation(r),i.codec=this.manifestExt.getCodec(r),i.mimeType=this.manifestExt.getMimeType(r),i.contentProtection=this.manifestExt.getContentProtectionData(r),i.bitrateList=this.manifestExt.getBitrateListForAdaptation(r),i.contentProtection&&i.contentProtection.forEach(function(n){n.KID=u.manifestExt.getKID(n)}),i.isText=this.manifestExt.getIsTextTrack(i.mimeType),i},f=function(n,t){var i=new MediaPlayer.vo.StreamInfo,r=1;return i.id=t.id,i.index=t.index,i.start=t.start,i.duration=t.duration,i.manifestInfo=s.call(this,n,t.mpd),i.isLast=1===n.Period_asArray.length||Math.abs(i.start+i.duration-i.manifestInfo.duration)<r,i},s=function(n,t){var i=new MediaPlayer.vo.ManifestInfo;return i.DVRWindowSize=t.timeShiftBufferDepth,i.loadedTime=t.manifest.loadedTime,i.availableFrom=t.availabilityStartTime,i.minBufferTime=t.manifest.minBufferTime,i.maxFragmentDuration=t.maxSegmentDuration,i.duration=this.manifestExt.getDuration(n),i.isDynamic=this.manifestExt.getIsDynamic(n),i},k=function(n,i,f){var s,h=r(i),e=h.id,o=this.manifestExt.getAdaptationForType(n,i.index,f);return o?(s=this.manifestExt.getIndexForAdaptation(o,n,i.index),t[e]=t[e]||this.manifestExt.getAdaptationsForPeriod(n,h),u.call(this,n,t[e][s])):null},b=function(i){var u,o,r,e=[];if(!i)return null;for(u=this.manifestExt.getMpd(i),n=this.manifestExt.getRegularPeriods(i,u),u.checkTime=this.manifestExt.getCheckTime(i,n[0]),t={},o=n.length,r=0;o>r;r+=1)e.push(f.call(this,i,n[r]));return e},w=function(n){var t=this.manifestExt.getMpd(n);return s.call(this,n,t)},d=function(n,t){var i=n.trackController.getRepresentationForQuality(t);return n.indexHandler.getInitRequest(i)},tt=function(n,t){var r=i(t,n.trackController);return n.indexHandler.getNextSegmentRequest(r)},nt=function(n,t,r,u){var f=i(t,n.trackController);return n.indexHandler.getSegmentRequestForTime(f,r,u)},g=function(n,t,r){var u=i(t,n.trackController);return n.indexHandler.generateSegmentRequestForTime(u,r)},l=function(n){return n.indexHandler.getCurrentTime()},c=function(n,t){return n.indexHandler.setCurrentTime(t)},h=function(n,t){var u,o,f=r(t.getStreamInfo()),i=t.getMediaInfo(),h=e(i),s=t.getType();u=i.id,o=u?this.manifestExt.getAdaptationForId(u,n,f.index):this.manifestExt.getAdaptationForIndex(i.index,n,f.index),t.trackController.updateData(o,h,s)},a=function(n,t,i){var r=t.getRepresentationForQuality(i);return r?o.call(this,n,r):null},p=function(n,t){var i=t.getCurrentRepresentation();return i?o.call(this,n,i):null},y=function(n,t,i){var r=new Dash.vo.Event,e=n.scheme_id_uri,c=n.value,u=n.timescale,f=n.presentation_time_delta,l=n.event_duration,h=n.id,o=n.message_data,s=i*u+f;return t[e]?(r.eventStream=t[e],r.eventStream.value=c,r.eventStream.timescale=u,r.duration=l,r.id=h,r.presentationTime=s,r.messageData=o,r.presentationTimeDelta=f,r):null},v=function(n,t,u){var f=[];return t instanceof MediaPlayer.vo.StreamInfo?f=this.manifestExt.getEventsForPeriod(n,r(t)):t instanceof MediaPlayer.vo.MediaInfo?f=this.manifestExt.getEventStreamForAdaptationSet(n,e(t)):t instanceof MediaPlayer.vo.TrackInfo&&(f=this.manifestExt.getEventStreamForRepresentation(n,i(t,u.trackController))),f};return{system:void 0,manifestExt:void 0,timelineConverter:void 0,metricsList:{TCP_CONNECTION:"TcpConnection",HTTP_REQUEST:"HttpRequest",HTTP_REQUEST_TRACE:"HttpRequestTrace",TRACK_SWITCH:"RepresentationSwitch",BUFFER_LEVEL:"BufferLevel",BUFFER_STATE:"BufferState",DVR_INFO:"DVRInfo",DROPPED_FRAMES:"DroppedFrames",SCHEDULING_INFO:"SchedulingInfo",MANIFEST_UPDATE:"ManifestUpdate",MANIFEST_UPDATE_STREAM_INFO:"ManifestUpdatePeriodInfo",MANIFEST_UPDATE_TRACK_INFO:"ManifestUpdateRepresentationInfo",PLAY_LIST:"PlayList",PLAY_LIST_TRACE:"PlayListTrace"},convertDataToTrack:o,convertDataToMedia:u,convertDataToStream:f,getDataForTrack:i,getDataForMedia:e,getDataForStream:r,getStreamsInfo:b,getManifestInfo:w,getMediaInfoForType:k,getCurrentTrackInfo:p,getTrackInfoForQuality:a,updateData:h,getInitRequest:d,getNextFragmentRequest:tt,getFragmentRequestForTime:nt,generateFragmentRequestForTime:g,getIndexHandlerTime:l,setIndexHandlerTime:c,getEventsFor:v,getEvent:y,reset:function(){n=[],t={}}}},Dash.dependencies.DashAdapter.prototype={constructor:Dash.dependencies.DashAdapter},Dash.create=function(n,t,i){if("undefined"==typeof n||"VIDEO"!=n.nodeName)return null;var r,u=n.id||n.name||"video element";if(i=i||new Dash.di.DashContext,t=t||[].slice.call(n.querySelectorAll("source")).filter(function(n){return n.type==Dash.supportedManifestMimeTypes.mimeType})[0],void 0===t&&n.src)t=document.createElement("source"),t.src=n.src;else if(void 0===t&&!n.src)return null;return r=new MediaPlayer(i),r.startup(),r.attachView(n),r.setAutoPlay(n.autoplay),r.attachSource(t.src),r.getDebug().log("Converted "+u+" to dash.js player and added content: "+t.src),r},Dash.createAll=function(n,t,i){var e=[],u,r,f;for(n=n||".dashjs-player",t=t||document,i=i||new Dash.di.DashContext,u=t.querySelectorAll(n),r=0;r<u.length;r++)f=Dash.create(u[r],void 0,i),e.push(f);return e},Dash.supportedManifestMimeTypes={mimeType:"application/dash+xml"},Dash.dependencies.DashHandler=function(){"use strict";var u,t,i,n=-1,s=0,ot=new RegExp("^(?:(?:[a-z]+:)?/)?/","i"),f=function(n,t){for(;n.length<t;)n="0"+n;return n},r=function(n,t,i){for(var e,u,s,l,o,r,c=t.length,h="%0",a=h.length;;){if((e=n.indexOf("$"+t),0>e)||(u=n.indexOf("$",e+c),0>u))return n;if(s=n.indexOf(h,e+c),s>e&&u>s)switch(l=n.charAt(u-1),o=parseInt(n.substring(s+a,u-1),10),l){case"d":case"i":case"u":r=f(i.toString(),o);break;case"x":r=f(i.toString(16),o);break;case"X":r=f(i.toString(16),o).toUpperCase();break;case"o":r=f(i.toString(8),o);break;default:return this.log("Unsupported/invalid IEEE 1003.1 format identifier string in URL"),n}else r=i;n=n.substring(0,e)+r+n.substring(u+1)}},st=function(n){return n.split("$$").join("$")},ft=function(n,t){if(null===t||-1===n.indexOf("$RepresentationID$"))return n;var i=t.toString();return n.split("$RepresentationID$").join(i)},b=function(n,t){return n.representation.startNumber+t},w=function(n,t){var r,i=t.adaptation.period.mpd.manifest.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].BaseURL;return r=n===i?n:ot.test(n)?n:i+n},et=function(n,i){var u,f,e=this,r=new MediaPlayer.vo.FragmentRequest;return u=n.adaptation.period,r.mediaType=i,r.type="Initialization Segment",r.url=w(n.initialization,n),r.range=n.range,f=u.start,r.availabilityStartTime=e.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(f,n.adaptation.period.mpd,t),r.availabilityEndTime=e.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(f+u.duration,u.mpd,t),r.quality=n.index,r},ht=function(n){var r,t=this;return n?r=et.call(t,n,i):null},k=function(i){var o,u,f,s=i.adaptation.period,r=!1;return 0>n?r=!1:t||n<i.availableSegmentsNumber?(u=e(n,i),u&&(f=u.presentationStartTime-s.start,o=i.adaptation.period.duration,this.log(i.segmentInfoType+": "+f+" / "+o),r=f>=o)):r=!0,r},h=function(n,i){var r,u,e,o,f=this;return u=n.segmentDuration,isNaN(u)&&(u=n.adaptation.period.duration),e=n.adaptation.period.start+i*u,o=e+u,r=new Dash.vo.Segment,r.representation=n,r.duration=u,r.presentationStartTime=e,r.mediaStartTime=f.timelineConverter.calcMediaTimeFromPresentationTime(r.presentationStartTime,n),r.availabilityStartTime=f.timelineConverter.calcAvailabilityStartTimeFromPresentationTime(r.presentationStartTime,n.adaptation.period.mpd,t),r.availabilityEndTime=f.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(o,n.adaptation.period.mpd,t),r.wallStartTime=f.timelineConverter.calcWallTimeForSegment(r,t),r.replacementNumber=b(r,i),r.availabilityIdx=i,r},at=function(n){var p,t,s,g,b,r,k,v,o,w,tt,nt,it,i,e=this,rt=n.adaptation.period.mpd.manifest.Period_asArray[n.adaptation.period.index].AdaptationSet_asArray[n.adaptation.index].Representation_asArray[n.index].SegmentTemplate,ut=rt.SegmentTimeline,c=n.availableSegmentsNumber>0,ft=10,a=[],h=0,l=0,f=-1,d=function(t){return y.call(e,n,h,t.d,i,rt.media,t.mediaRange,f)};for(i=n.timescale,p=ut.S_asArray,o=ct.call(e,n),o?(nt=o.start,it=o.end):tt=e.timelineConverter.calcMediaTimeFromPresentationTime(u||0,n),s=0,g=p.length;g>s;s+=1)if(t=p[s],r=0,t.hasOwnProperty("r")&&(r=t.r),t.hasOwnProperty("t")&&(h=t.t,l=h/i),0>r&&(v=p[s+1],v&&v.hasOwnProperty("t")?k=v.t/i:(k=e.timelineConverter.calcMediaTimeFromPresentationTime(n.segmentAvailabilityRange.end,n),n.segmentDuration=t.d/i),r=Math.ceil((k-l)/(t.d/i))-1),w){if(c)break;f+=r+1}else for(b=0;r>=b;b+=1){if(f+=1,o){if(f>it){if(w=!0,c)break;continue}f>=nt&&a.push(d.call(e,t))}else{if(a.length>ft){if(w=!0,c)break;continue}l>=tt-t.d/i&&a.push(d.call(e,t))}h+=t.d,l=h/i}return c||(n.availableSegmentsNumber=f+1),a},vt=function(n){var s,f,y,v,e,l=[],p=this,w=n.adaptation.period.mpd.manifest.Period_asArray[n.adaptation.period.index].AdaptationSet_asArray[n.adaptation.index].Representation_asArray[n.index].SegmentTemplate,o=n.segmentDuration,a=n.segmentAvailabilityRange,i=null,u=null;for(e=n.startNumber,s=isNaN(o)&&!t?{start:e,end:e}:c.call(p,n),y=s.start,v=s.end,f=y;v>=f;f+=1)i=h.call(p,n,f),i.replacementTime=(e+f-1)*n.segmentDuration,u=w.media,u=r(u,"Number",i.replacementNumber),u=r(u,"Time",i.replacementTime),i.media=u,l.push(i),i=null;return n.availableSegmentsNumber=isNaN(o)?1:Math.ceil((a.end-a.start)/o),l},c=function(i){var s,h,v,o=this,f=i.segmentDuration,b=i.adaptation.period.mpd.manifest.minBufferTime,y=i.segmentAvailabilityRange,r={start:o.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(i,y.start),end:o.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(i,y.end)},a=NaN,c=null,l=i.segments,w=2*f,p=Math.max(2*b,10*f);return r||(r=o.timelineConverter.calcSegmentAvailabilityRange(i,t)),r.start=Math.max(r.start,0),t&&!o.timelineConverter.isTimeSyncCompleted()?(s=Math.floor(r.start/f),h=Math.floor(r.end/f),v={start:s,end:h}):(l&&l.length>0?(c=e(n,i),a=c?o.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(i,c.presentationStartTime):n>0?n*f:o.timelineConverter.calcPeriodRelativeTimeFromMpdRelativeTime(i,u||l[0].presentationStartTime)):a=n>0?n*f:t?r.end:r.start,s=Math.floor(Math.max(a-w,r.start)/f),h=Math.floor(Math.min(s+p/f,r.end/f)),v={start:s,end:h})},ct=function(){var e,o,f,s=2,h=10,r=0,i=Number.POSITIVE_INFINITY;return t&&!this.timelineConverter.isTimeSyncCompleted()?f={start:r,end:i}:!t&&u||0>n?null:(e=Math.max(n-s,r),o=Math.min(n+h,i),f={start:e,end:o})},y=function(n,i,u,f,e,o,s){var l,y,h,c=this,v=i/f,a=Math.min(u/f,n.adaptation.period.mpd.maxSegmentDuration);return l=c.timelineConverter.calcPresentationTimeFromMediaTime(v,n),y=l+a,h=new Dash.vo.Segment,h.representation=n,h.duration=a,h.mediaStartTime=v,h.presentationStartTime=l,h.availabilityStartTime=n.adaptation.period.mpd.manifest.loadedTime,h.availabilityEndTime=c.timelineConverter.calcAvailabilityEndTimeFromPresentationTime(y,n.adaptation.period.mpd,t),h.wallStartTime=c.timelineConverter.calcWallTimeForSegment(h,t),h.replacementTime=i,h.replacementNumber=b(h,s),e=r(e,"Number",h.replacementNumber),e=r(e,"Time",h.replacementTime),h.media=e,h.mediaRange=o,h.availabilityIdx=s,h},lt=function(n){var r,t,i,f,s,l,a,e=this,o=[],u=n.adaptation.period.mpd.manifest.Period_asArray[n.adaptation.period.index].AdaptationSet_asArray[n.adaptation.index].Representation_asArray[n.index].SegmentList,y=n.adaptation.period.mpd.manifest.Period_asArray[n.adaptation.period.index].AdaptationSet_asArray[n.adaptation.index].Representation_asArray[n.index].BaseURL,v=u.SegmentURL_asArray.length;for(a=n.startNumber,f=c.call(e,n),s=Math.max(f.start,0),l=Math.min(f.end,u.SegmentURL_asArray.length-1),r=s;l>=r;r+=1)i=u.SegmentURL_asArray[r],t=h.call(e,n,r),t.replacementTime=(a+r-1)*n.segmentDuration,t.media=i.media?i.media:y,t.mediaRange=i.mediaRange,t.index=i.index,t.indexRange=i.indexRange,o.push(t),t=null;return n.availableSegmentsNumber=v,o},o=function(n){var t,r=this,i=n.segmentInfoType;return"SegmentBase"!==i&&"BaseURL"!==i&&it.call(r,n)?("SegmentTimeline"===i?t=at.call(r,n):"SegmentTemplate"===i?t=vt.call(r,n):"SegmentList"===i&&(t=lt.call(r,n)),a.call(r,n,t)):t=n.segments,t},a=function(n,i){var e,r,f,u;n.segments=i,e=i.length-1,t&&isNaN(this.timelineConverter.getExpectedLiveEdge())&&(u=i[e],r=u.presentationStartTime,f=this.metricsModel.getMetricsFor("stream"),this.timelineConverter.setExpectedLiveEdge(r),this.metricsModel.updateManifestUpdateInfo(this.metricsExt.getCurrentManifestUpdate(f),{presentationStartTime:r}))},p=function(n){var t=this;if(!n)throw new Error("no representation");return n.segments=null,o.call(t,n),n},ut=function(r,u){var s,f=this,o=r.initialization,e="BaseURL"!==r.segmentInfoType&&"SegmentBase"!==r.segmentInfoType;return r.segmentDuration||r.segments||p.call(f,r),r.segmentAvailabilityRange=null,r.segmentAvailabilityRange=f.timelineConverter.calcSegmentAvailabilityRange(r,t),r.segmentAvailabilityRange.end<r.segmentAvailabilityRange.start&&!r.useCalculatedLiveEdgeTime?(s=new MediaPlayer.vo.Error(Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE,"no segments are available yet",{availabilityDelay:Math.abs(r.segmentAvailabilityRange.end)}),void f.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:r},s)):(u||(n=-1),r.segmentDuration&&p.call(f,r),o||f.baseURLExt.loadInitialization(r),e||f.baseURLExt.loadSegments(r,i,r.indexRange),void(o&&e&&f.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:r})))},v=function(n,t,i){var o,u,s,e,r,f=t.segments,c=f?f.length:null,h=-1;if(f&&c>0)for(r=0;c>r;r+=1)if(u=f[r],s=u.presentationStartTime,e=u.duration,o=void 0===i||null===i?e/2:i,n+o>=s&&s+e>n-o){h=u.availabilityIdx;break}return h},e=function(n,t){if(!t||!t.segments)return null;for(var r,u=t.segments.length,i=0;u>i;i+=1)if(r=t.segments[i],r.availabilityIdx===n)return r;return null},it=function(t){var f,u,r=!1,i=t.segments;return i&&0!==i.length?(u=i[0].availabilityIdx,f=i[i.length-1].availabilityIdx,r=u>n||n>f):r=!0,r},l=function(n){if(null===n||void 0===n)return null;var u,t=new MediaPlayer.vo.FragmentRequest,f=n.representation,e=f.adaptation.period.mpd.manifest.Period_asArray[f.adaptation.period.index].AdaptationSet_asArray[f.adaptation.index].Representation_asArray[f.index].bandwidth;return u=w(n.media,f),u=r(u,"Number",n.replacementNumber),u=r(u,"Time",n.replacementTime),u=r(u,"Bandwidth",e),u=ft(u,f.id),u=st(u),t.mediaType=i,t.type="Media Segment",t.url=u,t.range=n.mediaRange,t.startTime=n.presentationStartTime,t.duration=n.duration,t.timescale=f.timescale,t.availabilityStartTime=n.availabilityStartTime,t.availabilityEndTime=n.availabilityEndTime,t.wallStartTime=n.wallStartTime,t.quality=f.index,t.index=n.availabilityIdx,t},d=function(t,r,f){var h,y,c,b=n,p=f?f.keepIdx:!1,a=f?f.timeThreshold:null,w=f&&f.ignoreIsFinished?!0:!1,s=this;return t?(u=r,s.log("Getting the request for time: "+r),n=v.call(s,r,t,a),o.call(s,t),0>n&&(n=v.call(s,r,t,a)),s.log("Index for time "+r+" is "+n),c=w?!1:k.call(s,t),c?(h=new MediaPlayer.vo.FragmentRequest,h.action=h.ACTION_COMPLETE,h.index=n,h.mediaType=i,s.log("Signal complete."),s.log(h)):(y=e(n,t),h=l.call(s,y)),p&&(n=b),h):null},nt=function(n,t){var i=(n.segmentAvailabilityRange.end-n.segmentAvailabilityRange.start)/2;return n.segments=null,n.segmentAvailabilityRange={start:t-i,end:t+i},d.call(this,n,t,{keepIdx:!1,ignoreIsFinished:!0})},rt=function(t){var r,h,c,s,f=this;if(!t)return null;if(-1===n)throw"You must call getSegmentRequestForTime first.";return u=null,n+=1,s=n,c=k.call(f,t),c?(r=new MediaPlayer.vo.FragmentRequest,r.action=r.ACTION_COMPLETE,r.index=s,r.mediaType=i,f.log("Signal complete.")):(o.call(f,t),h=e(s,t),r=l.call(f,h)),r},tt=function(n){var t=n.data.representation;t.segments&&this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:t})},g=function(n){if(!n.error&&i===n.data.mediaType){for(var t,o,c=this,h=n.data.segments,r=n.data.representation,f=[],s=0,e=0,u=h.length;u>e;e+=1)t=h[e],o=y.call(c,r,t.startTime,t.duration,t.timescale,t.media,t.mediaRange,s),f.push(o),o=null,s+=1;r.segmentAvailabilityRange={start:f[0].presentationStartTime,end:f[u-1].presentationStartTime},r.availableSegmentsNumber=u,a.call(c,r,f),r.initialization&&this.notify(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,{representation:r})}};return{log:void 0,baseURLExt:void 0,timelineConverter:void 0,metricsModel:void 0,metricsExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED]=tt,this[Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED]=g},initialize:function(n){this.subscribe(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,n.trackController),i=n.getType(),this.setMediaType(i),t=n.isDynamic(),this.streamProcessor=n},getType:function(){return i},setType:function(n){i=n},getIsDynamic:function(){return t},setIsDynamic:function(n){t=n},setCurrentTime:function(n){s=n},getCurrentTime:function(){return s},reset:function(){s=0,u=void 0,n=-1,t=void 0,this.unsubscribe(Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED,this.streamProcessor.trackController)},getInitRequest:ht,getSegmentRequestForTime:d,getNextSegmentRequest:rt,generateSegmentRequestForTime:nt,updateRepresentation:ut}},Dash.dependencies.DashHandler.prototype={constructor:Dash.dependencies.DashHandler},Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE=1,Dash.dependencies.DashHandler.eventList={ENAME_REPRESENTATION_UPDATED:"representationUpdated"},Dash.dependencies.DashParser=function(){"use strict";var y=31536e3,a=2592e3,l=86400,c=3600,t=60,p=60,n=1e3,u=/^([-])?P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,r=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+-])([0-9]{2})([0-9]{2}))?/,v=/^[-+]?[0-9]+[.]?[0-9]*([eE][-+]?[0-9]+)?$/,i=[{type:"duration",test:function(n){for(var i=["minBufferTime","mediaPresentationDuration","minimumUpdatePeriod","timeShiftBufferDepth","maxSegmentDuration","maxSubsegmentDuration","suggestedPresentationDelay","start","starttime","duration"],r=i.length,t=0;r>t;t++)if(n.nodeName===i[t])return u.test(n.value);return!1},converter:function(n){var i=u.exec(n),r=parseFloat(i[2]||0)*y+parseFloat(i[4]||0)*a+parseFloat(i[6]||0)*l+parseFloat(i[8]||0)*c+parseFloat(i[10]||0)*t+parseFloat(i[12]||0);return void 0!==i[1]&&(r=-r),r}},{type:"datetime",test:function(n){return r.test(n.value)},converter:function(i){var f,u=r.exec(i),e;return(f=Date.UTC(parseInt(u[1],10),parseInt(u[2],10)-1,parseInt(u[3],10),parseInt(u[4],10),parseInt(u[5],10),u[6]&&parseInt(u[6],10)||0,u[7]&&parseFloat(u[7])*n||0),u[9]&&u[10])&&(e=parseInt(u[9],10)*p+parseInt(u[10],10),f+=("+"===u[8]?-1:1)*e*t*n),new Date(f)}},{type:"numeric",test:function(n){return v.test(n.value)},converter:function(n){return parseFloat(n)}}],o=function(){var t,n,i,r;return r=[{name:"profiles",merge:!1},{name:"width",merge:!1},{name:"height",merge:!1},{name:"sar",merge:!1},{name:"frameRate",merge:!1},{name:"audioSamplingRate",merge:!1},{name:"mimeType",merge:!1},{name:"segmentProfiles",merge:!1},{name:"codecs",merge:!1},{name:"maximumSAPPeriod",merge:!1},{name:"startsWithSap",merge:!1},{name:"maxPlayoutRate",merge:!1},{name:"codingDependency",merge:!1},{name:"scanType",merge:!1},{name:"FramePacking",merge:!0},{name:"AudioChannelConfiguration",merge:!0},{name:"ContentProtection",merge:!0}],t={},t.name="AdaptationSet",t.isRoot=!1,t.isArray=!0,t.parent=null,t.children=[],t.properties=r,n={},n.name="Representation",n.isRoot=!1,n.isArray=!0,n.parent=t,n.children=[],n.properties=r,t.children.push(n),i={},i.name="SubRepresentation",i.isRoot=!1,i.isArray=!0,i.parent=n,i.children=[],i.properties=r,n.children.push(i),t},s=function(){var t,n,i,r;return r=[{name:"SegmentBase",merge:!0},{name:"SegmentTemplate",merge:!0},{name:"SegmentList",merge:!0}],t={},t.name="Period",t.isRoot=!1,t.isArray=!0,t.parent=null,t.children=[],t.properties=r,n={},n.name="AdaptationSet",n.isRoot=!1,n.isArray=!0,n.parent=t,n.children=[],n.properties=r,t.children.push(n),i={},i.name="Representation",i.isRoot=!1,i.isArray=!0,i.parent=n,i.children=[],i.properties=r,n.children.push(i),t},e=function(){var i,n,t,r,u;return u=[{name:"BaseURL",merge:!0,mergeFunction:function(n,t){var i;return i=0===t.indexOf("http://")?t:n+t}}],i={},i.name="mpd",i.isRoot=!0,i.isArray=!0,i.parent=null,i.children=[],i.properties=u,n={},n.name="Period",n.isRoot=!1,n.isArray=!0,n.parent=null,n.children=[],n.properties=u,i.children.push(n),t={},t.name="AdaptationSet",t.isRoot=!1,t.isArray=!0,t.parent=n,t.children=[],t.properties=u,n.children.push(t),r={},r.name="Representation",r.isRoot=!1,r.isArray=!0,r.parent=t,r.children=[],r.properties=u,t.children.push(r),i},h=function(){var n=[];return n.push(o()),n.push(s()),n.push(e()),n},f=function(n,t,r){var u,c=new X2JS(i,"",!0),o=new ObjectIron(h()),s=new Date,f=null,e=null;try{u=c.xml_str2json(n),f=new Date,u.hasOwnProperty("BaseURL")?(u.BaseURL=u.BaseURL_asArray[0],0!==u.BaseURL.toString().indexOf("http")&&(u.BaseURL=t+u.BaseURL)):u.BaseURL=t,u.hasOwnProperty("Location")&&(u.Location=u.Location_asArray[0]),o.run(u),e=new Date,r.setMatchers(i),r.setIron(o),this.log("Parsing complete: ( xml2json: "+(f.getTime()-s.getTime())+"ms, objectiron: "+(e.getTime()-f.getTime())+"ms, total: "+(e.getTime()-s.getTime())/1e3+"s)")}catch(l){return this.errHandler.manifestError("parsing the manifest failed","parse",n),null}return u};return{log:void 0,errHandler:void 0,parse:f}},Dash.dependencies.DashParser.prototype={constructor:Dash.dependencies.DashParser},Dash.dependencies.TimelineConverter=function(){"use strict";var t=0,n=!1,i=NaN,u=function(n,i,r,u){var f=NaN;return f=u?r&&i.timeShiftBufferDepth!=Number.POSITIVE_INFINITY?new Date(i.availabilityStartTime.getTime()+1e3*(n+i.timeShiftBufferDepth)):i.availabilityEndTime:r?new Date(i.availabilityStartTime.getTime()+1e3*(n-t)):i.availabilityStartTime},v=function(n,t,i){return u.call(this,n,t,i)},a=function(n,t,i){return u.call(this,n,t,i,!0)},r=function(n,i){return(n.getTime()-i.mpd.availabilityStartTime.getTime()+1e3*t)/1e3},l=function(n,t){var r=t.adaptation.period.start,i=t.presentationTimeOffset;return n+(r-i)},w=function(n,t){var r=t.adaptation.period.start,i=t.presentationTimeOffset;return n-r+i},p=function(n,t){var u,r,i;return t&&(u=n.representation.adaptation.period.mpd.suggestedPresentationDelay,r=n.presentationStartTime+u,i=new Date(n.availabilityStartTime.getTime()+1e3*r)),i},y=function(t,i){var o,f,u=t.adaptation.period.start,e=u+t.adaptation.period.duration,s={start:u,end:e},h=t.segmentDuration||(t.segments&&t.segments.length?t.segments[t.segments.length-1].duration:0);return i?!n&&t.segmentAvailabilityRange?t.segmentAvailabilityRange:(o=t.adaptation.period.mpd.checkTime,f=r(new Date,t.adaptation.period),u=Math.max(f-t.adaptation.period.mpd.timeShiftBufferDepth,0),e=(isNaN(o)?f:Math.min(o,f))-h,s={start:u,end:e}):s},e=function(n,t){var i=n.adaptation.period.start;return t-i},o=function(n,t){var i=n.adaptation.period.start;return t+i},f=function(r){n||r.error||(t+=r.data.liveEdge-(i+r.data.searchTime),n=!0)},c=function(i){n||i.error||(t=i.data.offset/1e3,n=!0)},h=function(n){var i=n.presentationTimeOffset,t=n.adaptation.period.start;return t-i},s=function(){t=0,n=!1,i=NaN};return{setup:function(){this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=f,this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=c},calcAvailabilityStartTimeFromPresentationTime:v,calcAvailabilityEndTimeFromPresentationTime:a,calcPresentationTimeFromWallTime:r,calcPresentationTimeFromMediaTime:l,calcPeriodRelativeTimeFromMpdRelativeTime:e,calcMpdRelativeTimeFromPeriodRelativeTime:o,calcMediaTimeFromPresentationTime:w,calcSegmentAvailabilityRange:y,calcWallTimeForSegment:p,calcMSETimeOffset:h,reset:s,isTimeSyncCompleted:function(){return n},setTimeSyncCompleted:function(t){n=t},getClientTimeOffset:function(){return t},getExpectedLiveEdge:function(){return i},setExpectedLiveEdge:function(n){i=n}}},Dash.dependencies.TimelineConverter.prototype={constructor:Dash.dependencies.TimelineConverter},Dash.dependencies.RepresentationController=function(){"use strict";var t,i=null,o=-1,r=!0,n=[],w=function(u,e,o){var h,s=this,a=null,l=s.streamProcessor.getStreamInfo(),v=s.abrController.getTopQualityIndexFor(o,l.id),c;if(r=!0,s.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED),n=d.call(s,e),null===i?(a=s.abrController.getInitialBitrateFor(o,l),h=s.abrController.getQualityForBitrate(s.streamProcessor.getMediaInfo(),a)):h=s.abrController.getQualityFor(o,l),h>v&&(h=v),t=f.call(s,h),i=u,"video"!==o&&"audio"!==o&&"fragmentedText"!==o)return r=!1,void s.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:i,currentRepresentation:t});for(c=0;c<n.length;c+=1)s.indexHandler.updateRepresentation(n[c],!0)},s=function(){var i=new Date,n=this.getCurrentRepresentation(),t=this.streamProcessor.playbackController.getTime();this.metricsModel.addTrackSwitch(n.adaptation.type,i,t,n.id)},u=function(){var n=this.streamProcessor,i=this.timelineConverter.calcSegmentAvailabilityRange(t,n.isDynamic());this.metricsModel.addDVRInfo(n.getType(),n.playbackController.getTime(),n.getStreamInfo().manifestInfo,i)},f=function(t){return n[t]},p=function(t){return n.indexOf(t)},b=function(){for(var i,t=0,r=n.length;r>t;t+=1)if(i=n[t].segmentInfoType,null===n[t].segmentAvailabilityRange||null===n[t].initialization||("SegmentBase"===i||"BaseURL"===i)&&!n[t].segments)return!1;return!0},d=function(n){var u,t=this,r=t.manifestModel.getValue();return o=t.manifestExt.getIndexForAdaptation(i,r,n.period.index),u=t.manifestExt.getRepresentationsForAdaptation(r,n)},e=function(t){for(var r,f=this,i=0,u=n.length;u>i;i+=1)r=n[i],r.segmentAvailabilityRange=f.timelineConverter.calcSegmentAvailabilityRange(r,t)},k=function(i){var u=this,e=1e3*(i+3*t.segmentDuration),f=function(){if(!this.isUpdating()){r=!0,u.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED);for(var t=0;t<n.length;t+=1)u.indexHandler.updateRepresentation(n[t],!0)}};r=!1,setTimeout(f.bind(this),e)},y=function(n){var h;if(this.isUpdating()){var c,a,v,f=this,e=n.data.representation,y=f.metricsModel.getMetricsFor("stream"),w=f.metricsModel.getMetricsFor(this.getCurrentRepresentation().adaptation.type),o=f.metricsExt.getCurrentManifestUpdate(y),l=!1;if(n.error&&n.error.code===Dash.dependencies.DashHandler.SEGMENTS_UNAVAILABLE_ERROR_CODE)return u.call(this),k.call(this,n.error.data.availabilityDelay),a=new MediaPlayer.vo.Error(Dash.dependencies.RepresentationController.SEGMENTS_UPDATE_FAILED_ERROR_CODE,"Segments update failed",null),void this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:i,currentRepresentation:t},a);if(o){for(h=0;h<o.trackInfo.length;h+=1)if(c=o.trackInfo[h],c.index===e.index&&c.mediaType===f.streamProcessor.getType()){l=!0;break}l||f.metricsModel.addManifestUpdateTrackInfo(o,e.id,e.index,e.adaptation.period.index,f.streamProcessor.getType(),e.presentationTimeOffset,e.startNumber,e.segmentInfoType)}b()&&(r=!1,f.abrController.setPlaybackQuality(f.streamProcessor.getType(),f.streamProcessor.getStreamInfo(),p.call(this,t)),f.metricsModel.updateManifestUpdateInfo(o,{latency:t.segmentAvailabilityRange.end-f.streamProcessor.playbackController.getTime()}),v=f.metricsExt.getCurrentRepresentationSwitch(w),v||s.call(f),this.notify(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,{data:i,currentRepresentation:t}))}},c=function(n){e.call(this,n.data.isDynamic)},h=function(n){if(!n.error){e.call(this,!0),this.indexHandler.updateRepresentation(t,!1);var u=this.manifestModel.getValue(),i=t.adaptation.period,r=this.streamController.getActiveStreamInfo();r.isLast&&(i.mpd.checkTime=this.manifestExt.getCheckTime(u,i),i.duration=this.manifestExt.getEndTimeForLastPeriod(this.manifestModel.getValue(),i)-i.start,r.duration=i.duration)}},v=function(){u.call(this)},a=function(n){var i=this;n.data.mediaType===i.streamProcessor.getType()&&i.streamProcessor.getStreamInfo().id===n.data.streamInfo.id&&(t=i.getRepresentationForQuality(n.data.newQuality),l.call(i,n.data.mediaType,t.bandwidth),s.call(i))},l=function(n,t){!this.DOMStorage.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)||"video"!==n&&"audio"!==n||localStorage.setItem(MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+n.toUpperCase()+"_BITRATE_KEY"],JSON.stringify({bitrate:t/1e3,timestamp:+new Date}))};return{system:void 0,log:void 0,manifestExt:void 0,manifestModel:void 0,metricsModel:void 0,metricsExt:void 0,abrController:void 0,streamController:void 0,timelineConverter:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,DOMStorage:void 0,setup:function(){this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=a,this[Dash.dependencies.DashHandler.eventList.ENAME_REPRESENTATION_UPDATED]=y,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=c,this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=h,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED]=v},initialize:function(n){this.streamProcessor=n,this.indexHandler=n.indexHandler},getData:function(){return i},getDataIndex:function(){return o},isUpdating:function(){return r},updateData:w,getRepresentationForQuality:f,getCurrentRepresentation:function(){return t}}},Dash.dependencies.RepresentationController.prototype={constructor:Dash.dependencies.RepresentationController},Dash.dependencies.RepresentationController.SEGMENTS_UPDATE_FAILED_ERROR_CODE=1,Dash.dependencies.RepresentationController.eventList={ENAME_DATA_UPDATE_COMPLETED:"dataUpdateCompleted",ENAME_DATA_UPDATE_STARTED:"dataUpdateStarted"},Dash.dependencies.BaseURLExtensions=function(){"use strict";var f=function(n,t){for(var i,c,o,e,u=n.references,a=u.length,l=n.timescale,h=n.earliest_presentation_time,f=t.range.start+n.first_offset+n.size,s=[],r=0;a>r;r+=1)o=u[r].subsegment_duration,e=u[r].referenced_size,i=new Dash.vo.Segment,i.duration=o,i.media=t.url,i.startTime=h,i.timescale=l,c=f+e-1,i.mediaRange=f+"-"+c,s.push(i),h+=o,f+=e;return s},u=function(n){var u,r,f=n.getBox("ftyp"),t=n.getBox("moov"),i=null;return this.log("Searching for initialization."),t&&t.isComplete&&(u=f?f.offset:t.offset,r=t.offset+t.size-1,i=u+"-"+r,this.log("Found the initialization.  Range: "+i)),i},i=function(n,r){var o=new XMLHttpRequest,s=!0,f=this,h=null,c=null,l=n.adaptation.period.mpd.manifest.Period_asArray[n.adaptation.period.index].AdaptationSet_asArray[n.adaptation.index].Representation_asArray[n.index].BaseURL,e=r||{url:l,range:{start:0,end:1500},searching:!1,bytesLoaded:0,bytesToLoad:1500,request:o};f.log("Start searching for initialization."),o.onload=function(){o.status<200||o.status>299||(s=!1,e.bytesLoaded=e.range.end,c=f.boxParser.parse(o.response),h=u.call(f,c),h?(n.range=h,n.initialization=l,f.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,{representation:n})):(e.range.end=e.bytesLoaded+e.bytesToLoad,i.call(f,n,e)))},o.onloadend=o.onerror=function(){s&&(s=!1,f.errHandler.downloadError("initialization",e.url,o),f.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,{representation:n}))},t.call(f,o,e),f.log("Perform init search: "+e.url)},n=function(i,r,u,e,o){var h=this,y=null!==u,l=new XMLHttpRequest,p=i.adaptation.period.mpd.manifest.Period_asArray[i.adaptation.period.index].AdaptationSet_asArray[i.adaptation.index].Representation_asArray[i.index].BaseURL,v=!0,a=null,c=null,s={url:p,range:y?u:{start:0,end:1500},searching:!y,bytesLoaded:e?e.bytesLoaded:0,bytesToLoad:1500,request:l};l.onload=function(){var y,rt,nt,tt,t,e;if(!(l.status<200||l.status>299))if(y=s.bytesToLoad,rt=l.response.byteLength,v=!1,s.bytesLoaded=s.range.end-s.range.start,a=h.boxParser.parse(l.response),c=a.getBox("sidx"),c&&c.isComplete)if(t=c.references,null!==t&&void 0!==t&&t.length>0&&(nt=1===t[0].reference_type),nt){h.log("Initiate multiple SIDX load."),s.range.end=s.range.start+c.size;for(var k,it,g,p=[],d=0,w=(c.offset||s.range.start)+c.size,ut=function(n){n?(p=p.concat(n),d+=1,d>=b&&o.call(h,p,i,r)):o.call(h,null,i,r)},u=0,b=t.length;b>u;u+=1)k=w,it=w+t[u].referenced_size-1,w+=t[u].referenced_size,g={start:k,end:it},n.call(h,i,null,g,s,ut)}else h.log("Parsing segments from SIDX."),tt=f.call(h,c,s),o.call(h,tt,i,r);else{if(c)s.range.start=c.offset||s.range.start,s.range.end=s.range.start+(c.size||y);else{if(rt<s.bytesLoaded)return void o.call(h,null,i,r);e=a.getLastBox(),e&&e.size?(s.range.start=e.offset+e.size,s.range.end=s.range.start+y):s.range.end+=y}n.call(h,i,r,s.range,s,o)}},l.onloadend=l.onerror=function(){v&&(v=!1,h.errHandler.downloadError("SIDX",s.url,l),o.call(h,null,i,r))},t.call(h,l,s),h.log("Perform SIDX load: "+s.url)},t=function(n,t){n.open("GET",this.requestModifierExt.modifyRequestURL(t.url)),n.responseType="arraybuffer",n.setRequestHeader("Range","bytes="+t.range.start+"-"+t.range.end),n=this.requestModifierExt.modifyRequestHeader(n),n.send(null)},r=function(n,t,i){var r=this;n?r.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,{segments:n,representation:t,mediaType:i}):r.notify(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,{segments:null,representation:t,mediaType:i},new MediaPlayer.vo.Error(null,"error loading segments",null))};return{log:void 0,errHandler:void 0,requestModifierExt:void 0,boxParser:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,loadSegments:function(t,i,u){var f=u?u.split("-"):null;u=f?{start:parseFloat(f[0]),end:parseFloat(f[1])}:null,n.call(this,t,i,u,null,r.bind(this))},loadInitialization:i}},Dash.dependencies.BaseURLExtensions.prototype={constructor:Dash.dependencies.BaseURLExtensions},Dash.dependencies.BaseURLExtensions.eventList={ENAME_INITIALIZATION_LOADED:"initializationLoaded",ENAME_SEGMENTS_LOADED:"segmentsLoaded"},Dash.dependencies.DashManifestExtensions=function(){"use strict";this.timelineConverter=void 0},Dash.dependencies.DashManifestExtensions.prototype={constructor:Dash.dependencies.DashManifestExtensions,getIsTypeOf:function(n,t){"use strict";var u,o,e,f=n.ContentComponent_asArray,s=new RegExp("text"!==t?t:"(vtt|ttml)"),r=!1,i=!1;if(n.Representation_asArray.length>0&&n.Representation_asArray[0].hasOwnProperty("codecs")&&"stpp"==n.Representation_asArray[0].codecs)return"fragmentedText"==t;if(f){if(f.length>1)return"muxed"==t;f[0]&&f[0].contentType===t&&(r=!0,i=!0)}if(n.hasOwnProperty("mimeType")&&(r=s.test(n.mimeType),i=!0),!i)for(u=0,o=n.Representation_asArray.length;!i&&o>u;)e=n.Representation_asArray[u],e.hasOwnProperty("mimeType")&&(r=s.test(e.mimeType),i=!0),u+=1;return r},getIsAudio:function(n){"use strict";return this.getIsTypeOf(n,"audio")},getIsVideo:function(n){"use strict";return this.getIsTypeOf(n,"video")},getIsFragmentedText:function(n){"use strict";return this.getIsTypeOf(n,"fragmentedText")},getIsText:function(n){"use strict";return this.getIsTypeOf(n,"text")},getIsMuxed:function(n){return this.getIsTypeOf(n,"muxed")},getIsTextTrack:function(n){return"text/vtt"===n||"application/ttml+xml"===n},getLanguageForAdaptation:function(n){var t="";return n.hasOwnProperty("lang")&&(t=n.lang),t},getIsMain:function(){"use strict";return!1},processAdaptation:function(n){"use strict";return void 0!==n.Representation_asArray&&null!==n.Representation_asArray&&n.Representation_asArray.sort(function(n,t){return n.bandwidth-t.bandwidth}),n},getAdaptationForId:function(n,t,i){"use strict";for(var u=t.Period_asArray[i].AdaptationSet_asArray,r=0,f=u.length;f>r;r+=1)if(u[r].hasOwnProperty("id")&&u[r].id===n)return u[r];return null},getAdaptationForIndex:function(n,t,i){"use strict";var r=t.Period_asArray[i].AdaptationSet_asArray;return r[n]},getIndexForAdaptation:function(n,t,i){"use strict";for(var u=t.Period_asArray[i].AdaptationSet_asArray,r=0,f=u.length;f>r;r+=1)if(u[r]===n)return r;return-1},getAdaptationsForType:function(n,t,i){"use strict";for(var o=this,u=n.Period_asArray[t].AdaptationSet_asArray,f=[],r=0,e=u.length;e>r;r+=1)this.getIsTypeOf(u[r],i)&&f.push(o.processAdaptation(u[r]));return f},getAdaptationForType:function(n,t,i){"use strict";var u,f,r,e=this;if(r=this.getAdaptationsForType(n,t,i),!r||0===r.length)return null;for(u=0,f=r.length;f>u;u+=1)if(e.getIsMain(r[u]))return r[u];return r[0]},getCodec:function(n){"use strict";var t=n.Representation_asArray[0];return t.mimeType+';codecs="'+t.codecs+'"'},getMimeType:function(n){"use strict";return n.Representation_asArray[0].mimeType},getKID:function(n){"use strict";return n&&n.hasOwnProperty("cenc:default_KID")?n["cenc:default_KID"]:null},getContentProtectionData:function(n){"use strict";return n&&n.hasOwnProperty("ContentProtection_asArray")&&0!==n.ContentProtection_asArray.length?n.ContentProtection_asArray:null},getIsDynamic:function(n){"use strict";var t=!1,i="dynamic";return n.hasOwnProperty("type")&&(t=n.type===i),t},getIsDVR:function(n){"use strict";var t,r,i=this.getIsDynamic(n);return t=!isNaN(n.timeShiftBufferDepth),r=i&&t},getIsOnDemand:function(n){"use strict";var t=!1;return n.profiles&&n.profiles.length>0&&(t=-1!==n.profiles.indexOf("urn:mpeg:dash:profile:isoff-on-demand:2011")),t},getDuration:function(n){var t;return t=n.hasOwnProperty("mediaPresentationDuration")?n.mediaPresentationDuration:Number.MAX_VALUE},getBandwidth:function(n){"use strict";return n.bandwidth},getRefreshDelay:function(n){"use strict";var t=NaN,i=2;return n.hasOwnProperty("minimumUpdatePeriod")&&(t=Math.max(parseFloat(n.minimumUpdatePeriod),i)),t},getRepresentationCount:function(n){"use strict";return n.Representation_asArray.length},getBitrateListForAdaptation:function(n){if(!n||!n.Representation_asArray||!n.Representation_asArray.length)return null;for(var u=this.processAdaptation(n),r=u.Representation_asArray,f=r.length,i=[],t=0;f>t;t+=1)i.push(r[t].bandwidth);return i},getRepresentationFor:function(n,t){"use strict";return t.Representation_asArray[n]},getRepresentationsForAdaptation:function(n,t){for(var i,f,r,u,s,o=this,h=o.processAdaptation(n.Period_asArray[t.period.index].AdaptationSet_asArray[t.index]),c=[],e=0;e<h.Representation_asArray.length;e+=1)u=h.Representation_asArray[e],i=new Dash.vo.Representation,i.index=e,i.adaptation=t,u.hasOwnProperty("id")&&(i.id=u.id),u.hasOwnProperty("bandwidth")&&(i.bandwidth=u.bandwidth),u.hasOwnProperty("maxPlayoutRate")&&(i.maxPlayoutRate=u.maxPlayoutRate),u.hasOwnProperty("SegmentBase")?(r=u.SegmentBase,i.segmentInfoType="SegmentBase"):u.hasOwnProperty("SegmentList")?(r=u.SegmentList,i.segmentInfoType="SegmentList",i.useCalculatedLiveEdgeTime=!0):u.hasOwnProperty("SegmentTemplate")?(r=u.SegmentTemplate,r.hasOwnProperty("SegmentTimeline")?(i.segmentInfoType="SegmentTimeline",s=r.SegmentTimeline.S_asArray[r.SegmentTimeline.S_asArray.length-1],(!s.hasOwnProperty("r")||s.r>=0)&&(i.useCalculatedLiveEdgeTime=!0)):i.segmentInfoType="SegmentTemplate",r.hasOwnProperty("initialization")&&(i.initialization=r.initialization.split("$Bandwidth$").join(u.bandwidth).split("$RepresentationID$").join(u.id))):(r=u.BaseURL,i.segmentInfoType="BaseURL"),r.hasOwnProperty("Initialization")?(f=r.Initialization,f.hasOwnProperty("sourceURL")?i.initialization=f.sourceURL:f.hasOwnProperty("range")&&(i.initialization=u.BaseURL,i.range=f.range)):u.hasOwnProperty("mimeType")&&o.getIsTextTrack(u.mimeType)&&(i.initialization=u.BaseURL,i.range=0),r.hasOwnProperty("timescale")&&(i.timescale=r.timescale),r.hasOwnProperty("duration")&&(i.segmentDuration=r.duration/i.timescale),r.hasOwnProperty("startNumber")&&(i.startNumber=r.startNumber),r.hasOwnProperty("indexRange")&&(i.indexRange=r.indexRange),r.hasOwnProperty("presentationTimeOffset")&&(i.presentationTimeOffset=r.presentationTimeOffset/i.timescale),i.MSETimeOffset=o.timelineConverter.calcMSETimeOffset(i),c.push(i);return c},getAdaptationsForPeriod:function(n,t){for(var r,i,f=n.Period_asArray[t.index],e=[],u=0;u<f.AdaptationSet_asArray.length;u+=1)i=f.AdaptationSet_asArray[u],r=new Dash.vo.AdaptationSet,i.hasOwnProperty("id")&&(r.id=i.id),r.index=u,r.period=t,r.type=this.getIsMuxed(i)?"muxed":this.getIsAudio(i)?"audio":this.getIsVideo(i)?"video":this.getIsFragmentedText(i)?"fragmentedText":"text",e.push(r);return e},getRegularPeriods:function(n,t){for(var s=this,e=[],c=s.getIsDynamic(n),o=null,u=null,r=null,i=null,f=0,h=n.Period_asArray.length;h>f;f+=1)u=n.Period_asArray[f],u.hasOwnProperty("start")?(i=new Dash.vo.Period,i.start=u.start):null!==o&&u.hasOwnProperty("duration")&&null!==r?(i=new Dash.vo.Period,i.start=r.start+r.duration,i.duration=u.duration):0!==f||c||(i=new Dash.vo.Period,i.start=0),null!==r&&isNaN(r.duration)&&(r.duration=i.start-r.start),null!==i&&u.hasOwnProperty("id")&&(i.id=u.id),null!==i&&u.hasOwnProperty("duration")&&(i.duration=u.duration),null!==i&&(i.index=f,i.mpd=t,e.push(i),o=u,r=i),u=null,i=null;return 0===e.length?e:(null!==r&&isNaN(r.duration)&&(r.duration=s.getEndTimeForLastPeriod(n,r)-r.start),e)},getMpd:function(n){var t=new Dash.vo.Mpd;return t.manifest=n,t.availabilityStartTime=new Date(n.hasOwnProperty("availabilityStartTime")?n.availabilityStartTime.getTime():n.loadedTime.getTime()),n.hasOwnProperty("availabilityEndTime")&&(t.availabilityEndTime=new Date(n.availabilityEndTime.getTime())),n.hasOwnProperty("suggestedPresentationDelay")&&(t.suggestedPresentationDelay=n.suggestedPresentationDelay),n.hasOwnProperty("timeShiftBufferDepth")&&(t.timeShiftBufferDepth=n.timeShiftBufferDepth),n.hasOwnProperty("maxSegmentDuration")&&(t.maxSegmentDuration=n.maxSegmentDuration),t},getFetchTime:function(n,t){return this.timelineConverter.calcPresentationTimeFromWallTime(n.loadedTime,t)},getCheckTime:function(n,t){var r,u=this,i=NaN;return n.hasOwnProperty("minimumUpdatePeriod")&&(r=u.getFetchTime(n,t),i=r+n.minimumUpdatePeriod),i},getEndTimeForLastPeriod:function(n,t){var i,r=this.getCheckTime(n,t);if(n.mediaPresentationDuration)i=n.mediaPresentationDuration;else{if(isNaN(r))throw new Error("Must have @mediaPresentationDuration or @minimumUpdatePeriod on MPD or an explicit @duration on the last period.");i=r}return i},getEventsForPeriod:function(n,t){var s=n.Period_asArray,r=s[t.index].EventStream_asArray,o=[],i,f,u,e;if(r)for(i=0;i<r.length;i+=1){if(f=new Dash.vo.EventStream,f.period=t,f.timescale=1,!r[i].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";for(f.schemeIdUri=r[i].schemeIdUri,r[i].hasOwnProperty("timescale")&&(f.timescale=r[i].timescale),r[i].hasOwnProperty("value")&&(f.value=r[i].value),u=0;u<r[i].Event_asArray.length;u+=1)e=new Dash.vo.Event,e.presentationTime=0,e.eventStream=f,r[i].Event_asArray[u].hasOwnProperty("presentationTime")&&(e.presentationTime=r[i].Event_asArray[u].presentationTime),r[i].Event_asArray[u].hasOwnProperty("duration")&&(e.duration=r[i].Event_asArray[u].duration),r[i].Event_asArray[u].hasOwnProperty("id")&&(e.id=r[i].Event_asArray[u].id),o.push(e)}return o},getEventStreams:function(n,t){var u=[],i,r;if(!n)return u;for(i=0;i<n.length;i++){if(r=new Dash.vo.EventStream,r.timescale=1,r.representation=t,!n[i].hasOwnProperty("schemeIdUri"))throw"Invalid EventStream. SchemeIdUri has to be set";r.schemeIdUri=n[i].schemeIdUri,n[i].hasOwnProperty("timescale")&&(r.timescale=n[i].timescale),n[i].hasOwnProperty("value")&&(r.value=n[i].value),u.push(r)}return u},getEventStreamForAdaptationSet:function(n,t){var i=n.Period_asArray[t.period.index].AdaptationSet_asArray[t.index].InbandEventStream_asArray;return this.getEventStreams(i,null)},getEventStreamForRepresentation:function(n,t){var i=n.Period_asArray[t.adaptation.period.index].AdaptationSet_asArray[t.adaptation.index].Representation_asArray[t.index].InbandEventStream_asArray;return this.getEventStreams(i,t)},getUTCTimingSources:function(n){"use strict";var u=this,r=u.getIsDynamic(n),f=n.hasOwnProperty("availabilityStartTime"),t=n.UTCTiming_asArray,i=[];return(r||f)&&t&&t.forEach(function(n){var t=new Dash.vo.UTCTiming;n.hasOwnProperty("schemeIdUri")&&(t.schemeIdUri=n.schemeIdUri,n.hasOwnProperty("value")&&(t.value=n.value.toString(),i.push(t)))}),i}},Dash.dependencies.DashMetricsExtensions=function(){"use strict";var h=function(n,t){for(var e,o,f,i,u=n.AdaptationSet_asArray,r=0;r<u.length;r+=1)for(e=u[r],f=e.Representation_asArray,i=0;i<f.length;i+=1)if(o=f[i],t===o.id)return i;return-1},v=function(n,t){for(var o,e,f,r,u=n.AdaptationSet_asArray,i=0;i<u.length;i+=1)for(o=u[i],f=o.Representation_asArray,r=0;r<f.length;r+=1)if(e=f[r],t===e.id)return e;return null},y=function(n,t){return this.manifestExt.getIsTypeOf(n,t)},l=function(n,t){var r,u,f,i;if(!n||!t)return-1;for(u=n.AdaptationSet_asArray,i=0;i<u.length;i+=1)if(r=u[i],f=r.Representation_asArray,y.call(this,r,t))return f.length;return-1},a=function(n,t){var i,r=this,f=r.manifestModel.getValue(),u=f.Period_asArray[t];return i=v.call(r,u,n),null===i?null:i.bandwidth},p=function(n,t){var f,i=this,u=i.manifestModel.getValue(),r=u.Period_asArray[t];return f=h.call(i,r,n)},k=function(n,t){var u,f=this,i=f.manifestModel.getValue(),r=i.Period_asArray[t];return u=l.call(this,r,n)},d=function(n,t){var r=this.system.getObject("abrController"),i=0;return r&&(i=r.getTopQualityIndexFor(n,t)),i},w=function(n){if(null===n)return null;var r,i,u,t=n.RepSwitchList;return null===t||t.length<=0?null:(r=t.length,i=r-1,u=t[i])},b=function(n){if(null===n)return null;var r,i,u,t=n.BufferLevel;return null===t||t.length<=0?null:(r=t.length,i=r-1,u=t[i])},c=function(n){if(null===n)return null;var t,r,i=n.PlayList;return null===i||i.length<=0?null:(t=i[i.length-1].trace,null===t||t.length<=0?null:r=t[t.length-1].playbackspeed)},n=function(n){if(null===n)return null;var u,i,t=n.HttpList,r=null;if(null===t||t.length<=0)return null;for(u=t.length,i=u-1;i>=0;){if(t[i].responsecode){r=t[i];break}i-=1}return r},t=function(n){return null===n?[]:n.HttpList?n.HttpList:[]},u=function(n){if(null===n)return null;var r,i,u,t=n.DroppedFrames;return null===t||t.length<=0?null:(r=t.length,i=r-1,u=t[i])},r=function(n){if(null===n)return null;var r,i,u,t=n.SchedulingInfo;return null===t||t.length<=0?null:(r=t.length,i=r-1,u=t[i])},s=function(n){if(null===n)return null;var r,i,u,t=n.ManifestUpdate;return null===t||t.length<=0?null:(r=t.length,i=r-1,u=t[i])},f=function(n){if(null===n)return null;var i,r,t=n.DVRInfo;return null===t||t.length<=0?null:(i=t.length-1,r=t[i])},e=function(n,r){if(null===n)return null;var u,e=t(n),f=e[e.length-1];return"MPD"===f.type&&(u=i(f.responseHeaders)),void 0===u[r]?null:u[r]},o=function(t,r){if(null===t)return null;var f,u=n(t);return null===u||null===u.responseHeaders?null:(f=i(u.responseHeaders),void 0===f[r]?null:f[r])},i=function(n){var r={},i,t;if(!n)return r;for(var f=n.split("\r\n"),u=0,e=f.length;e>u;u++)i=f[u],t=i.indexOf(": "),t>0&&(r[i.substring(0,t)]=i.substring(t+2));return r};return{manifestModel:void 0,manifestExt:void 0,system:void 0,getBandwidthForRepresentation:a,getIndexForRepresentation:p,getMaxIndexForBufferType:k,getMaxAllowedIndexForBufferType:d,getCurrentRepresentationSwitch:w,getCurrentBufferLevel:b,getCurrentPlaybackRate:c,getCurrentHttpRequest:n,getHttpRequests:t,getCurrentDroppedFrames:u,getCurrentSchedulingInfo:r,getCurrentDVRInfo:f,getCurrentManifestUpdate:s,getLatestFragmentRequestHeaderValueByID:o,getLatestMPDRequestHeaderValueByID:e}},Dash.dependencies.DashMetricsExtensions.prototype={constructor:Dash.dependencies.DashMetricsExtensions},Dash.dependencies.FragmentExtensions=function(){"use strict";var t=function(n){var c,a,l,s,i,e,t,u,o,r=this.boxParser.parse(n),f=r.getBox("tfhd"),y=r.getBox("tfdt"),h=r.getBox("trun"),v=r.getBox("moof");for(l=h.sample_count,i=y.baseMediaDecodeTime,o=(f.base_data_offset||0)+(h.data_offset||0),e=[],u=0;l>u;u++)t=h.samples[u],c=void 0!==t.sample_duration?t.sample_duration:f.default_sample_duration,s=void 0!==t.sample_size?t.sample_size:f.default_sample_size,a=void 0!==t.sample_composition_time_offset?t.sample_composition_time_offset:0,e.push({dts:i,cts:i+a,duration:c,offset:v.offset+o,size:s}),o+=s,i+=c;return e},n=function(n){var i=this.boxParser.parse(n),t=i.getBox("mdhd");return t.timescale};return{log:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,boxParser:void 0,getSamplesInfo:t,getMediaTimescaleFromMoov:n}},Dash.dependencies.FragmentExtensions.prototype={constructor:Dash.dependencies.FragmentExtensions},Dash.dependencies.FragmentExtensions.eventList={ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},Dash.vo.AdaptationSet=function(){"use strict";this.period=null,this.index=-1,this.type=null},Dash.vo.AdaptationSet.prototype={constructor:Dash.vo.AdaptationSet},Dash.vo.Event=function(){"use strict";this.duration=NaN,this.presentationTime=NaN,this.id=NaN,this.messageData="",this.eventStream=null,this.presentationTimeDelta=NaN},Dash.vo.Event.prototype={constructor:Dash.vo.Event},Dash.vo.EventStream=function(){"use strict";this.adaptionSet=null,this.representation=null,this.period=null,this.timescale=1,this.value="",this.schemeIdUri=""},Dash.vo.EventStream.prototype={constructor:Dash.vo.EventStream},Dash.vo.Mpd=function(){"use strict";this.manifest=null,this.suggestedPresentationDelay=0,this.availabilityStartTime=null,this.availabilityEndTime=Number.POSITIVE_INFINITY,this.timeShiftBufferDepth=Number.POSITIVE_INFINITY,this.maxSegmentDuration=Number.POSITIVE_INFINITY,this.checkTime=NaN,this.clientServerTimeShift=0,this.isClientServerTimeSyncCompleted=!1},Dash.vo.Mpd.prototype={constructor:Dash.vo.Mpd},Dash.vo.Period=function(){"use strict";this.id=null,this.index=-1,this.duration=NaN,this.start=NaN,this.mpd=null},Dash.vo.Period.prototype={constructor:Dash.vo.Period},Dash.vo.Representation=function(){"use strict";this.id=null,this.index=-1,this.adaptation=null,this.segmentInfoType=null,this.initialization=null,this.segmentDuration=NaN,this.timescale=1,this.startNumber=1,this.indexRange=null,this.range=null,this.presentationTimeOffset=0,this.MSETimeOffset=NaN,this.segmentAvailabilityRange=null,this.availableSegmentsNumber=0,this.bandwidth=NaN,this.maxPlayoutRate=NaN},Dash.vo.Representation.prototype={constructor:Dash.vo.Representation},Dash.vo.Segment=function(){"use strict";this.indexRange=null,this.index=null,this.mediaRange=null,this.media=null,this.duration=NaN,this.replacementTime=null,this.replacementNumber=NaN,this.mediaStartTime=NaN,this.presentationStartTime=NaN,this.availabilityStartTime=NaN,this.availabilityEndTime=NaN,this.availabilityIdx=NaN,this.wallStartTime=NaN,this.representation=null},Dash.vo.Segment.prototype={constructor:Dash.vo.Segment},Dash.vo.UTCTiming=function(){"use strict";this.schemeIdUri="",this.value=""},Dash.vo.UTCTiming.prototype={constructor:Dash.vo.UTCTiming},MediaPlayer.dependencies.ErrorHandler=function(){"use strict";var n=MediaPlayer.events.ERROR;return{eventBus:void 0,capabilityError:function(t){this.eventBus.dispatchEvent({type:n,error:"capability",event:t})},downloadError:function(t,i,r){this.eventBus.dispatchEvent({type:n,error:"download",event:{id:t,url:i,request:r}})},manifestError:function(t,i,r){this.eventBus.dispatchEvent({type:n,error:"manifestError",event:{message:t,id:i,manifest:r}})},closedCaptionsError:function(t,i,r){this.eventBus.dispatchEvent({type:n,error:"cc",event:{message:t,id:i,cc:r}})},mediaSourceError:function(t){this.eventBus.dispatchEvent({type:n,error:"mediasource",event:t})},mediaKeySessionError:function(t){this.eventBus.dispatchEvent({type:n,error:"key_session",event:t})},mediaKeyMessageError:function(t){this.eventBus.dispatchEvent({type:n,error:"key_message",event:t})},mediaKeySystemSelectionError:function(t){this.eventBus.dispatchEvent({type:n,error:"key_system_selection",event:t})}}},MediaPlayer.dependencies.ErrorHandler.prototype={constructor:MediaPlayer.dependencies.ErrorHandler},MediaPlayer.dependencies.FragmentLoader=function(){"use strict";var u=3,i=500,n=[],t=function(r,u){var f=new XMLHttpRequest,o=null,c=!0,l=!0,s=null,e=this,h=function(n,t){l=!1;var u,h,i=new Date,r=f.response;n.firstByteDate||(n.firstByteDate=n.requestStartDate),n.requestEndDate=i,u=n.firstByteDate.getTime()-n.requestStartDate.getTime(),h=n.requestEndDate.getTime()-n.firstByteDate.getTime(),e.log((t?"loaded ":"failed ")+n.mediaType+":"+n.type+":"+n.startTime+" ("+f.status+", "+u+"ms, "+h+"ms)"),o.tresponse=n.firstByteDate,o.tfinish=n.requestEndDate,o.responsecode=f.status,o.responseHeaders=f.getAllResponseHeaders(),e.metricsModel.appendHttpTrace(o,i,i.getTime()-s.getTime(),[r?r.byteLength:0]),s=i};n.push(f),r.requestStartDate=new Date,o=e.metricsModel.addHttpRequest(r.mediaType,null,r.type,r.url,null,r.range,r.requestStartDate,null,null,null,null,r.duration,null),e.metricsModel.appendHttpTrace(o,r.requestStartDate,r.requestStartDate.getTime()-r.requestStartDate.getTime(),[0]),s=r.requestStartDate,f.open("GET",e.requestModifierExt.modifyRequestURL(r.url),!0),f.responseType="arraybuffer",f=e.requestModifierExt.modifyRequestHeader(f),r.range&&f.setRequestHeader("Range","bytes="+r.range),f.onprogress=function(n){var t=new Date;c&&(c=!1,(!n.lengthComputable||n.lengthComputable&&n.total!=n.loaded)&&(r.firstByteDate=t,o.tresponse=t)),n.lengthComputable&&(r.bytesLoaded=n.loaded,r.bytesTotal=n.total),e.metricsModel.appendHttpTrace(o,t,t.getTime()-s.getTime(),[f.response?f.response.byteLength:0]),s=t,e.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,{request:r})},f.onload=function(){f.status<200||f.status>299||(h(r,!0),e.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:r,response:f.response}))},f.onloadend=f.onerror=function(){-1!==n.indexOf(f)&&(n.splice(n.indexOf(f),1),l&&(h(r,!1),u>0?(e.log("Failed loading fragment: "+r.mediaType+":"+r.type+":"+r.startTime+", retry in "+i+"ms attempts: "+u),u--,setTimeout(function(){t.call(e,r,u)},i)):(e.log("Failed loading fragment: "+r.mediaType+":"+r.type+":"+r.startTime+" no retry attempts left"),e.errHandler.downloadError("content",r.url,f),e.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:r,bytes:null},new MediaPlayer.vo.Error(null,"failed loading fragment",null)))))},f.send()},r=function(n){var r=this,t=new XMLHttpRequest,i=!1;t.open("HEAD",n.url,!0),t.onload=function(){t.status<200||t.status>299||(i=!0,r.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:n,exists:!0}))},t.onloadend=t.onerror=function(){i||r.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:n,exists:!1})},t.send()};return{metricsModel:void 0,errHandler:void 0,log:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,load:function(n){n?t.call(this,n,u):this.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,{request:n,bytes:null},new MediaPlayer.vo.Error(null,"request is null",null))},checkForExistence:function(n){return n?void r.call(this,n):void this.notify(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,{request:n,exists:!1})},abort:function(){for(var i,r=n.length,t=0;r>t;t+=1)i=n[t],n[t]=null,i.abort(),i=null;n=[]}}},MediaPlayer.dependencies.FragmentLoader.prototype={constructor:MediaPlayer.dependencies.FragmentLoader},MediaPlayer.dependencies.FragmentLoader.eventList={ENAME_LOADING_COMPLETED:"loadingCompleted",ENAME_LOADING_PROGRESS:"loadingProgress",ENAME_CHECK_FOR_EXISTENCE_COMPLETED:"checkForExistenceCompleted"},MediaPlayer.dependencies.LiveEdgeFinder=function(){"use strict";var u,i=!1,t=NaN,n=null,r=MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES,o=function(i){var r=(+new Date-t)/1e3;n=i.value,this.notify(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,{liveEdge:n,searchTime:r},null===n?new MediaPlayer.vo.Error(MediaPlayer.dependencies.LiveEdgeFinder.LIVE_EDGE_NOT_FOUND_ERROR_CODE,"live edge has not been found",null):null)},e=function(n){var f=this;!f.streamProcessor.isDynamic()||i||n.error||(u=f.synchronizationRulesCollection.getRules(r),i=!0,t=+new Date,f.rulesController.applyRules(u,f.streamProcessor,o.bind(f),null,function(n,t){return t}))},f=function(n){r=n.error?MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES:MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES};return{system:void 0,synchronizationRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=e,this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=f},initialize:function(n){this.streamProcessor=n,this.fragmentLoader=n.fragmentLoader},abortSearch:function(){i=!1,t=NaN},getLiveEdge:function(){return n},reset:function(){this.abortSearch(),n=null}}},MediaPlayer.dependencies.LiveEdgeFinder.prototype={constructor:MediaPlayer.dependencies.LiveEdgeFinder},MediaPlayer.dependencies.LiveEdgeFinder.eventList={ENAME_LIVE_EDGE_SEARCH_COMPLETED:"liveEdgeFound"},MediaPlayer.dependencies.LiveEdgeFinder.LIVE_EDGE_NOT_FOUND_ERROR_CODE=1,MediaPlayer.dependencies.ManifestLoader=function(){"use strict";var u=3,r=500,i=function(n){var t="";return-1!==n.indexOf("/")&&(-1!==n.indexOf("?")&&(n=n.substring(0,n.indexOf("?"))),t=n.substring(0,n.lastIndexOf("/")+1)),t},t=function(n,u){var o,a,h,v=i(n),f=new XMLHttpRequest,c=new Date,s=null,l=!0,e=this;a=function(){f.status<200||f.status>299||(l=!1,s=new Date,e.metricsModel.addHttpRequest("stream",null,"MPD",n,null,null,c,s,null,f.status,null,null,f.getAllResponseHeaders()),f.responseURL&&(v=i(f.responseURL),n=f.responseURL),o=e.parser.parse(f.responseText,v,e.xlinkController),o?(o.url=n,o.loadedTime=s,e.metricsModel.addManifestUpdate("stream",o.type,c,s,o.availabilityStartTime),e.xlinkController.resolveManifestOnLoad(o)):e.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:null},new MediaPlayer.vo.Error(null,"Failed loading manifest: "+n,null)))},h=function(){l&&(l=!1,e.metricsModel.addHttpRequest("stream",null,"MPD",n,null,null,c,new Date,f.status,null,null,f.getAllResponseHeaders()),u>0?(e.log("Failed loading manifest: "+n+", retry in "+r+"ms attempts: "+u),u--,setTimeout(function(){t.call(e,n,u)},r)):(e.log("Failed loading manifest: "+n+" no retry attempts left"),e.errHandler.downloadError("manifest",n,f),e.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,null,new Error("Failed loading manifest: "+n+" no retry attempts left"))))};try{f.onload=a,f.onloadend=h,f.onerror=h,f.open("GET",e.requestModifierExt.modifyRequestURL(n),!0),f.send()}catch(y){f.onerror()}},n=function(n){this.notify(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,{manifest:n.data.manifest})};return{log:void 0,parser:void 0,errHandler:void 0,metricsModel:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,system:void 0,load:function(n){t.call(this,n,u)},setup:function(){n=n.bind(this),this.xlinkController=this.system.getObject("xlinkController"),this.xlinkController.subscribe(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,this,n)}}},MediaPlayer.dependencies.ManifestLoader.prototype={constructor:MediaPlayer.dependencies.ManifestLoader},MediaPlayer.dependencies.ManifestLoader.eventList={ENAME_MANIFEST_LOADED:"manifestLoaded"},MediaPlayer.dependencies.ManifestUpdater=function(){"use strict";var t,r=NaN,u=null,n=!0,i=!1,f=function(){null!==u&&(clearInterval(u),u=null)},o=function(){f.call(this),isNaN(r)||(this.log("Refresh manifest in "+r+" seconds."),u=setTimeout(l.bind(this),Math.min(1e3*r,Math.pow(2,31)-1),this))},e=function(t){var u,i;this.manifestModel.setValue(t),this.log("Manifest has been refreshed."),u=this.manifestExt.getRefreshDelay(t),i=(+new Date-t.loadedTime.getTime())/1e3,r=Math.max(u-i,0),this.notify(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,{manifest:t}),n||o.call(this)},l=function(){var r,u,f=this;n||i||(i=!0,r=f.manifestModel.getValue(),u=r.url,r.hasOwnProperty("Location")&&(u=r.Location),t.load(u))},a=function(n){n.error||e.call(this,n.data.manifest)},c=function(){n=!1,o.call(this)},s=function(){n=!0,f.call(this)},h=function(){i=!1};return{log:void 0,system:void 0,subscribe:void 0,unsubscribe:void 0,notify:void 0,manifestModel:void 0,manifestExt:void 0,setup:function(){this[MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED]=h,this[MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED]=a,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED]=c,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED]=s},initialize:function(r){i=!1,n=!0,t=r,t.subscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this)},setManifest:function(n){e.call(this,n)},getManifestLoader:function(){return t},reset:function(){n=!0,i=!1,f.call(this),t.unsubscribe(MediaPlayer.dependencies.ManifestLoader.eventList.ENAME_MANIFEST_LOADED,this),r=NaN}}},MediaPlayer.dependencies.ManifestUpdater.prototype={constructor:MediaPlayer.dependencies.ManifestUpdater},MediaPlayer.dependencies.ManifestUpdater.eventList={ENAME_MANIFEST_UPDATED:"manifestUpdated"},MediaPlayer.dependencies.Notifier=function(){"use strict";var n,i="observableId",r=0,t=function(){return this[i]||(r+=1,this[i]="_id_"+r),this[i]};return{system:void 0,setup:function(){n=this.system,n.mapValue("notify",this.notify),n.mapValue("subscribe",this.subscribe),n.mapValue("unsubscribe",this.unsubscribe)},notify:function(){var r=arguments[0]+t.call(this),i=new MediaPlayer.vo.Event;i.sender=this,i.type=arguments[0],i.data=arguments[1],i.error=arguments[2],i.timestamp=+new Date,n.notify.call(n,r,i)},subscribe:function(i,r,u,f){if(!u&&r[i]&&(u=r[i]=r[i].bind(r)),!r)throw"observer object cannot be null or undefined";if(!u)throw"event handler cannot be null or undefined";i+=t.call(this),n.mapHandler(i,void 0,u,f)},unsubscribe:function(i,r,u){u=u||r[i],i+=t.call(this),n.unmapHandler(i,void 0,u)}}},MediaPlayer.dependencies.Notifier.prototype={constructor:MediaPlayer.dependencies.Notifier},MediaPlayer.dependencies.Stream=function(){"use strict";var t,i,n=[],f=!1,h=!1,r=null,l={},e=!1,c=!1,u=null,b=function(n){n.error&&(this.errHandler.mediaKeySessionError(n.data),this.log(n.data),this.reset())},o=function(t,i){var h,o,s,f=this,y=null,c=f.manifestModel.getValue(),v=function(n){return n.codec},e=f.adapter.getMediaInfoForType(c,r,t),l,a;if("text"===t)v=function(n){return y=n.mimeType};else if("muxed"===t&&e)return o="Multiplexed representations are intentionally not supported, as they are not compliant with the DASH-AVC/264 guidelines",this.log(o),void this.errHandler.manifestError(o,"multiplexedrep",this.manifestModel.getValue());if(null!==e){if(a=v.call(f,e),"text"!==t&&"fragmentedText"!==t)if(h=a,f.log(t+" codec: "+h),l=e.contentProtection,l&&!f.capabilities.supportsEncryptedMedia())f.errHandler.capabilityError("encryptedmedia");else if(!f.capabilities.supportsCodec(f.videoModel.getElement(),h))return o=t+"Codec ("+h+") is not supported.",f.errHandler.manifestError(o,"codec",c),void f.log(o);s=f.system.getObject("streamProcessor"),n.push(s),s.initialize(y||t,f.fragmentController,i,f,u),f.abrController.updateTopQualityIndex(e),s.updateMediaInfo(c,e)}else f.log("No "+t+" data.")},k=function(t){var s,i=this,c=i.manifestModel.getValue(),f;(u=i.system.getObject("eventController"),s=i.adapter.getEventsFor(c,r),u.addInlineEvents(s),e=!0,o.call(i,"video",t),o.call(i,"audio",t),o.call(i,"text",t),o.call(i,"fragmentedText",t),o.call(i,"muxed",t),v.call(i),h=!0,e=!1,0===n.length)?(f="No streams to play.",i.errHandler.manifestError(f,"nostreams",c),i.log(f)):(i.liveEdgeFinder.initialize(n[0]),i.liveEdgeFinder.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,i.playbackController),a.call(this))},a=function(){var u=this,v=n.length,o=!!l.audio||!!l.video,a=o?new MediaPlayer.vo.Error(MediaPlayer.dependencies.Stream.DATA_UPDATE_FAILED_ERROR_CODE,"Data update failed",null):null,i=0;for(i;v>i;i+=1)if(n[i].isUpdating()||e)return;c=!0,u.eventBus.dispatchEvent({type:MediaPlayer.events.STREAM_INITIALIZED,data:{streamInfo:r}}),u.notify(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,{streamInfo:r},a),h&&!f&&(t.init(u.manifestModel.getValue(),s.call(this,"audio"),s.call(this,"video")),f=!0)},s=function(t){for(var u=n.length,i=null,r=0;u>r;r+=1)if(i=n[r],i.getType()===t)return i.getMediaInfo();return null},v=function(){for(var t=0,i=n.length;i>t;t+=1)n[t].createBuffer()},d=function(){var t=w(),i=t.length,n=0;for(n;i>n;n+=1)if(!t[n].isBufferingCompleted())return;this.notify(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,{streamInfo:r})},y=function(n){var t=n.sender.streamProcessor.getType();l[t]=n.error,a.call(this)},w=function(){var i,r,u=[],t=0,f=n.length;for(t;f>t;t+=1)r=n[t],i=r.getType(),("audio"===i||"video"===i)&&u.push(r);return u},p=function(t){var h,v,l,i=this,y=n.length,s=i.manifestModel.getValue(),o=0;for(f=!1,r=t,i.log("Manifest updated... set new data on buffers."),u&&(v=i.adapter.getEventsFor(s,r),u.addInlineEvents(v)),e=!0,c=!1,o;y>o;o+=1)l=n[o],h=i.adapter.getMediaInfoForType(s,r,l.getType()),this.abrController.updateTopQualityIndex(h),l.updateMediaInfo(s,h);e=!1,a.call(i)};return{system:void 0,eventBus:void 0,manifestModel:void 0,sourceBufferExt:void 0,adapter:void 0,videoModel:void 0,fragmentController:void 0,playbackController:void 0,capabilities:void 0,log:void 0,errHandler:void 0,liveEdgeFinder:void 0,abrController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED]=d,this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=y},initialize:function(n,u){r=n,t=u,i=b.bind(this),t.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,i),t.addEventListener(MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,i),t.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,i),t.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,i),t.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,i),t.addEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,i),t.addEventListener(MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,i)},activate:function(n){f?v.call(this):k.call(this,n)},deactivate:function(){var i=n.length,t=0;for(t;i>t;t+=1)n[t].reset();n=[],f=!1,h=!1,this.resetEventController()},reset:function(r){this.playbackController.pause();var s,a=n.length,o=0;for(o;a>o;o+=1)s=n[o],s.reset(r),s=null;u&&u.reset(),n=[],e=!1,c=!1,this.fragmentController&&this.fragmentController.reset(),this.fragmentController=void 0,this.liveEdgeFinder.abortSearch(),this.liveEdgeFinder.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.playbackController),t.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,i),t.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,i),t.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,i),t.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,i),t.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,i),t.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,i),t.removeEventListener(MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,i),h=!1,f=!1,l={}},getDuration:function(){return r.duration},getStartTime:function(){return r.start},getStreamIndex:function(){return r.index},getId:function(){return r.id},getStreamInfo:function(){return r},hasMedia:function(n){return null!==s.call(this,n)},getBitrateListFor:function(n){var t=s.call(this,n);return this.abrController.getBitrateList(t)},startEventController:function(){u.start()},resetEventController:function(){u.reset()},isActivated:function(){return f},isInitialized:function(){return c},updateData:p}},MediaPlayer.dependencies.Stream.prototype={constructor:MediaPlayer.dependencies.Stream},MediaPlayer.dependencies.Stream.DATA_UPDATE_FAILED_ERROR_CODE=1,MediaPlayer.dependencies.Stream.eventList={ENAME_STREAM_UPDATED:"streamUpdated",ENAME_STREAM_BUFFERING_COMPLETED:"streamBufferingCompleted"},MediaPlayer.dependencies.StreamProcessor=function(){"use strict";var r,t=null,i=null,n=null,u=null,f=function(n){var i=this,t="video"===n||"audio"===n||"fragmentedText"===n?"bufferController":"textController";return i.system.getObject(t)};return{system:void 0,videoModel:void 0,indexHandler:void 0,liveEdgeFinder:void 0,timelineConverter:void 0,abrController:void 0,playbackController:void 0,baseURLExt:void 0,adapter:void 0,manifestModel:void 0,initialize:function(i,e,o,s,h){var p,v=this,y=v.system.getObject("trackController"),l=v.system.getObject("scheduleController"),d=v.liveEdgeFinder,w=v.abrController,b=v.indexHandler,g=v.baseURLExt,a=v.playbackController,k=this.system.getObject("fragmentLoader"),c=f.call(v,i);t=s,n=i,u=h,r=t.getStreamInfo().manifestInfo.isDynamic,v.bufferController=c,v.scheduleController=l,v.trackController=y,v.fragmentController=e,v.fragmentLoader=k,y.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,c),e.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,c),"video"===n||"audio"===n||"fragmentedText"===n?(w.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,c),w.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,y),w.subscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,l),d.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.timelineConverter),d.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,y),d.subscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,l),y.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED,l),y.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,l),t.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,l),y.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,a),e.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,c),e.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,l),e.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,l),e.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,c),e.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,l.scheduleRulesCollection.bufferLevelRule),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,a),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,l),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,l),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,l),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,y),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,l),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,l),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,t),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,l),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,l.scheduleRulesCollection.bufferLevelRule),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,l.scheduleRulesCollection.bufferLevelRule),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,a),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,c),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,c),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,c),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,l),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,c),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,l),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,l),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,l.scheduleRulesCollection.playbackTimeRule),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,w.abrRulesCollection.insufficientBufferRule),r&&a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,y),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,c),a.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,l),g.subscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,b),g.subscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,b)):c.subscribe(MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,l),y.subscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,t),b.initialize(this),b.setCurrentTime(a.getStreamStartTime(this.getStreamInfo())),c.initialize(n,o,v),l.initialize(n,this),w.initialize(n,this),p=this.getFragmentModel(),p.setLoader(k),p.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,e),p.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,e),p.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,e),p.subscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,l),k.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,p),k.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,w),("video"===n||"audio"===n||"fragmentedText"===n)&&(c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,p),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,p),c.subscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED,p)),y.initialize(this)},isUpdating:function(){return this.trackController.isUpdating()},getType:function(){return n},getABRController:function(){return this.abrController},getFragmentLoader:function(){return this.fragmentLoader},getFragmentModel:function(){return this.scheduleController.getFragmentModel()},getStreamInfo:function(){return t.getStreamInfo()},updateMediaInfo:function(n,t){t===i||t&&i&&t.type!==i.type||(i=t),this.adapter.updateData(n,this)},getMediaInfo:function(){return i},getScheduleController:function(){return this.scheduleController},getEventController:function(){return u},start:function(){this.scheduleController.start()},stop:function(){this.scheduleController.stop()},getCurrentTrack:function(){return this.adapter.getCurrentTrackInfo(this.manifestModel.getValue(),this.trackController)},getTrackForQuality:function(n){return this.adapter.getTrackInfoForQuality(this.manifestModel.getValue(),this.trackController,n)},isBufferingCompleted:function(){return this.bufferController.isBufferingCompleted()},createBuffer:function(){return this.bufferController.getBuffer()||this.bufferController.createBuffer(i)},isDynamic:function(){return r},reset:function(f){var a=this,e=a.bufferController,l=a.trackController,o=a.scheduleController,p=a.liveEdgeFinder,h=a.fragmentController,v=a.abrController,s=a.playbackController,y=this.indexHandler,b=this.baseURLExt,c=this.getFragmentModel(),w=this.fragmentLoader;v.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,e),v.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,l),v.unsubscribe(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,o),p.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,this.timelineConverter),p.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,o),p.unsubscribe(MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED,l),l.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED,o),l.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,e),l.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,o),l.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,t),l.unsubscribe(Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED,s),t.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,o),h.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED,e),h.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED,e),h.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,o),h.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,o),h.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,e),h.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,o.scheduleRulesCollection.bufferLevelRule),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,s),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,o),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,o),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,o),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,l),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,o),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,o),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED,t),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,o),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,o.scheduleRulesCollection.bufferLevelRule),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,o.scheduleRulesCollection.bufferLevelRule),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,s),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,e),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,e),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,e),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED,o),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,e),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,o),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,o),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,l),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,e),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,o),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,o.scheduleRulesCollection.playbackTimeRule),s.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,v.abrRulesCollection.insufficientBufferRule),b.unsubscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_INITIALIZATION_LOADED,y),b.unsubscribe(Dash.dependencies.BaseURLExtensions.eventList.ENAME_SEGMENTS_LOADED,y),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,c),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,c),e.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED,c),c.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,h),c.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,h),c.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,h),c.unsubscribe(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,o),w.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED,c),w.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS,v),c.reset(),y.reset(),this.bufferController.reset(f),this.scheduleController.reset(),this.bufferController=null,this.scheduleController=null,this.trackController=null,this.videoModel=null,this.fragmentController=null,r=void 0,t=null,i=null,n=null,u=null}}},MediaPlayer.dependencies.StreamProcessor.prototype={constructor:MediaPlayer.dependencies.StreamProcessor},MediaPlayer.utils.TTMLParser=function(){"use strict";var n,f=3600,e=60,o=/^([0-9][0-9]+):([0-5][0-9]):([0-5][0-9])((\.[0-9]+)|(:[0-9][0-9]))$/,t=function(t){var i,u,r,s=o.test(t);if(!s)return NaN;if(i=t.split(":"),u=parseFloat(i[0])*f+parseFloat(i[1])*e+parseFloat(i[2]),i[3]){if(r=n.tt.frameRate,!r||isNaN(r))return NaN;u+=parseFloat(i[3])/r}return u},r=function(){var r=!1,t=n.hasOwnProperty("tt"),i=t?n.tt.hasOwnProperty("head"):!1,e=i?n.tt.head.hasOwnProperty("layout"):!1,f=i?n.tt.head.hasOwnProperty("styling"):!1,u=t?n.tt.hasOwnProperty("body"):!1;return t&&i&&e&&f&&u&&(r=!0),r},i=function(n,t){var i=Object.keys(n).filter(function(i){return"xmlns"===i.split(":")[0]&&n[i]===t}).map(function(n){return n.split(":")[1]});return 1!=i.length?null:i[0]},u=function(u){var p,s,f,a,l,y,w,c,e,h,v=[],b=new X2JS([],"",!1),o;if(n=b.xml_str2json(u),!r())throw p="TTML document has incorrect structure";if(y=i(n.tt,"http://www.w3.org/ns/ttml#parameter"),n.tt.hasOwnProperty(y+":frameRate")&&(n.tt.frameRate=parseInt(n.tt[y+":frameRate"],10)),s=n.tt.body.div_asArray?n.tt.body.div_asArray[0].p_asArray:n.tt.body.p_asArray,!s||0===s.length)throw p="TTML document does not contain any cues";for(c=0;c<s.length;c+=1){if(f=s[c],a=t(f.begin),l=t(f.end),isNaN(a)||isNaN(l))throw p="TTML document has incorrect timing value";if(void 0!==f["smpte:backgroundImage"])for(o=n.tt.head.metadata.image_asArray,e=0;e<o.length;e+=1)"#"+o[e]["xml:id"]==f["smpte:backgroundImage"]&&v.push({start:a,end:l,id:o[e]["xml:id"],data:"data:image/"+o[e].imagetype.toLowerCase()+";base64, "+o[e].__text,type:"image"});else f.span_asArray?(h=f.span_asArray[0],w=h.__text instanceof Array&&h.br_asArray?h.__text.join("\n"):h.__text):w=f.__text,v.push({start:a,end:l,data:w,type:"text"})}return v};return{parse:u}},MediaPlayer.dependencies.TextSourceBuffer=function(){var n,t;return{system:void 0,videoModel:void 0,eventBus:void 0,errHandler:void 0,initialize:function(i,r){t=i,n=r.streamProcessor.getCurrentTrack().mediaInfo,this.buffered=this.system.getObject("customTimeRanges"),this.initializationSegmentReceived=!1,this.timescale=9e4},append:function(i,r){var s,l,c,u,f,o,e=this,h,a;if("fragmentedText"==t)if(this.initializationSegmentReceived)for(h=e.system.getObject("fragmentExt"),u=h.getSamplesInfo(i),f=0;f<u.length;f++){this.firstSubtitleStart||(this.firstSubtitleStart=u[0].cts-r.start*this.timescale),u[f].cts-=this.firstSubtitleStart,this.buffered.add(u[f].cts/this.timescale,(u[f].cts+u[f].duration)/this.timescale),o=window.UTF8.decode(new Uint8Array(i.slice(u[f].offset,u[f].offset+u[f].size))),a=this.system.getObject("ttmlParser");try{s=a.parse(o),this.textTrackExtensions.addCaptions(this.firstSubtitleStart/this.timescale,s)}catch(v){}}else this.initializationSegmentReceived=!0,l=n.id,c=n.lang,this.textTrackExtensions=e.getTextTrackExtensions(),this.textTrackExtensions.addTextTrack(e.videoModel.getElement(),s,l,c,!0),e.eventBus.dispatchEvent({type:MediaPlayer.events.TEXT_TRACK_ADDED}),h=e.system.getObject("fragmentExt"),this.timescale=h.getMediaTimescaleFromMoov(i);else{i=new Uint8Array(i),o=window.UTF8.decode(i);try{s=e.getParser().parse(o),l=n.id,c=n.lang,e.getTextTrackExtensions().addTextTrack(e.videoModel.getElement(),s,l,c,!0),e.eventBus.dispatchEvent({type:MediaPlayer.events.TEXT_TRACK_ADDED})}catch(v){e.errHandler.closedCaptionsError(v,"parse",o)}}},abort:function(){this.getTextTrackExtensions().deleteCues(this.videoModel.getElement())},getParser:function(){var n;return"text/vtt"===t?n=this.system.getObject("vttParser"):"application/ttml+xml"===t&&(n=this.system.getObject("ttmlParser")),n},getTextTrackExtensions:function(){return this.system.getObject("textTrackExtensions")},addEventListener:function(n,t,i){this.eventBus.addEventListener(n,t,i)},removeEventListener:function(n,t,i){this.eventBus.removeEventListener(n,t,i)}}},MediaPlayer.dependencies.TextSourceBuffer.prototype={constructor:MediaPlayer.dependencies.TextSourceBuffer},MediaPlayer.dependencies.TimeSyncController=function(){"use strict";var y,p=5e3,o=0,a=!1,g=!1,t=function(n){a=n},nt=function(){return a},v=function(n){g=n},i=function(n){o=n},k=function(){return o},b=function(n){var i,u,f=60,o=60,r=1e3,e=/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2})(?::([0-9]*)(\.[0-9]*)?)?(?:([+\-])([0-9]{2})([0-9]{2}))?/,t=e.exec(n);return i=Date.UTC(parseInt(t[1],10),parseInt(t[2],10)-1,parseInt(t[3],10),parseInt(t[4],10),parseInt(t[5],10),t[6]&&(parseInt(t[6],10)||0),t[7]&&parseFloat(t[7])*r||0),t[9]&&t[10]&&(u=parseInt(t[9],10)*o+parseInt(t[10],10),i+=("+"===t[8]?-1:1)*u*f*r),+new Date(i)},r=function(n){var t=Date.parse(n);return isNaN(t)&&(t=b(n)),t},s=function(n){return Date.parse(n)},d=function(n){return Date.parse(n)},u=function(n,t,i){i()},l=function(n,t,i){var u=r(n);return isNaN(u)?void i():void t(u)},n=function(t,i,r,u,f){var h,c,o=!1,e=new XMLHttpRequest,l=f?"HEAD":"GET",s=i.match(/\S+/g);i=s.shift(),h=function(){o||(o=!0,s.length?n(t,s.join(" "),r,u,f):u())},c=function(){var i,n;200===e.status&&(i=f?e.getResponseHeader("Date"):e.response,n=t(i),isNaN(n)||(r(n),o=!0))},e.open(l,i),e.timeout=p||0,e.onload=c,e.onloadend=h,e.send()},h=function(t,i,r){n.call(this,d,t,i,r,!0)},c={"urn:mpeg:dash:utc:http-head:2014":h,"urn:mpeg:dash:utc:http-xsdate:2014":n.bind(null,r),"urn:mpeg:dash:utc:http-iso:2014":n.bind(null,s),"urn:mpeg:dash:utc:direct:2014":l,"urn:mpeg:dash:utc:http-head:2012":h,"urn:mpeg:dash:utc:http-xsdate:2012":n.bind(null,r),"urn:mpeg:dash:utc:http-iso:2012":n.bind(null,s),"urn:mpeg:dash:utc:direct:2012":l,"urn:mpeg:dash:utc:http-ntp:2014":u,"urn:mpeg:dash:utc:ntp:2014":u,"urn:mpeg:dash:utc:sntp:2014":u},w=function(){var r=this.metricsModel.getReadOnlyMetricsFor("stream"),t=this.metricsExt.getLatestMPDRequestHeaderValueByID(r,"Date"),n=null!==t?+new Date(t):Number.NaN;isNaN(n)?e.call(this,!0):(i(n-+new Date),e.call(this,!1,n/1e3,o))},e=function(n,i,r){t(!1),this.notify(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,{time:i,offset:r},n?new MediaPlayer.vo.Error(MediaPlayer.dependencies.TimeSyncController.TIME_SYNC_FAILED_ERROR_CODE):null)},f=function(n,r){var u=this,s=r||0,o=n[s],h=function(n,t){var i=!n||!t;i&&y?w.call(u):e.call(u,i,n,t)};t(!0),o?c.hasOwnProperty(o.schemeIdUri)?c[o.schemeIdUri](o.value,function(n){var r=+new Date,t=n-r;i(t),u.log("Local time:      "+new Date(r)),u.log("Server time:     "+new Date(n)),u.log("Difference (ms): "+t),h.call(u,n,t)},function(){f.call(u,n,s+1)}):f.call(u,n,s+1):(i(0),h.call(u))};return{log:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,metricsModel:void 0,metricsExt:void 0,getOffsetToDeviceTimeMs:function(){return k()},initialize:function(n,t){y=t,nt()||(f.call(this,n),v(!0))},reset:function(){v(!1),t(!1)}}},MediaPlayer.dependencies.TimeSyncController.prototype={constructor:MediaPlayer.dependencies.TimeSyncController},MediaPlayer.dependencies.TimeSyncController.eventList={ENAME_TIME_SYNCHRONIZATION_COMPLETED:"timeSynchronizationComplete"},MediaPlayer.dependencies.TimeSyncController.TIME_SYNC_FAILED_ERROR_CODE=1,MediaPlayer.utils.VTTParser=function(){"use strict";var e=/(?:\r\n|\r|\n)/gm,n=/-->/,i=/(^[\s]+|[\s]+$)/g,o=/\s\b/g,t=function(n){var t=n.split(":"),i=t.length-1;return n=60*parseInt(t[i-1],10)+parseFloat(t[i]),2===i&&(n+=3600*parseInt(t[0],10)),n},f=function(t){var r=t.split(n),i=r[1].split(o);return i.shift(),r[1]=i[0],i.shift(),{cuePoints:r,styles:u(i)}},u=function(n){var t={};return n.forEach(function(n){if(n.split(/:/).length>1){var i=n.split(/:/)[1];i&&-1!=i.search(/%/)&&(i=parseInt(i.replace(/%/,""))),(n.match(/align/)||n.match(/A/))&&(t.align=i),(n.match(/line/)||n.match(/L/))&&(t.line=i),(n.match(/position/)||n.match(/P/))&&(t.position=i),(n.match(/size/)||n.match(/S/))&&(t.size=i)}}),t},r=function(t,i){for(var f,o,e=i,u="",r="";""!==t[e]&&e<t.length;)e++;if(o=e-i,o>1)for(f=0;o>f;f++){if(r=t[i+f],r.match(n)){u="";break}u+=r,f!==o-1&&(u+="\n")}else r=t[i],r.match(n)||(u=r);return decodeURI(u)};return{log:void 0,parse:function(u){var v,c,y=[],o,s;for(u=u.split(e),v=u.length,c=-1,o=0;v>o;o++)if(s=u[o],s.length>0&&"WEBVTT"!==s&&s.match(n)){var p=f(s),w=p.cuePoints,b=p.styles,a=r(u,o+1),h=t(w[0].replace(i,"")),l=t(w[1].replace(i,""));!isNaN(h)&&!isNaN(l)&&h>=c&&l>h?""!==a?(c=h,y.push({start:h,end:l,data:a,styles:b})):this.log("Skipping cue due to empty/malformed cue text"):this.log("Skipping cue due to incorrect cue timing")}return y}}},MediaPlayer.dependencies.XlinkLoader=function(){"use strict";var i=1,t=500,r="urn:mpeg:dash:resolve-to-zero:2013",n=function(i,r,u,f){var h,l,c,e=new XMLHttpRequest,o=this,v=null,s=!0,a=new Date;l=function(){e.status<200||e.status>299||(s=!1,o.metricsModel.addHttpRequest("stream",null,"XLink",i,null,null,a,v,null,e.status,null,null,e.getAllResponseHeaders()),c=e.responseText,r.resolved=!0,c?(r.resolvedContent=c,o.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:r,resolveObject:u})):(r.resolvedContent=null,o.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:r,resolveObject:u},new MediaPlayer.vo.Error(null,"Failed loading Xlink element: "+i,null))))},h=function(){s&&(s=!1,o.metricsModel.addHttpRequest("stream",null,"xlink",i,null,null,a,new Date,e.status,null,null,e.getAllResponseHeaders()),f>0?(console.log("Failed loading xLink content: "+i+", retry in "+t+"ms attempts: "+f),f--,setTimeout(function(){n.call(o,i,r,u,f)},t)):(console.log("Failed loading Xlink content: "+i+" no retry attempts left"),o.errHandler.downloadError("xlink",i,e),r.resolvedContent=null,o.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:r,resolveObject:u},new Error("Failed loading xlink Element: "+i+" no retry attempts left"))))};try{e.onload=l,e.onloadend=h,e.onerror=h,e.open("GET",o.requestModifierExt.modifyRequestURL(i),!0),e.send()}catch(y){console.log("Error"),e.onerror()}};return{errHandler:void 0,metricsModel:void 0,requestModifierExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,load:function(t,u,f){t===r?(u.resolvedContent=null,u.resolved=!0,this.notify(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,{element:u,resolveObject:f})):n.call(this,t,u,f,i)}}},MediaPlayer.dependencies.XlinkLoader.prototype={constructor:MediaPlayer.dependencies.XlinkLoader},MediaPlayer.dependencies.XlinkLoader.eventList={ENAME_XLINKELEMENT_LOADED:"xlinkElementLoaded"},MediaPlayer.dependencies.AbrController=function(){"use strict";var h,e=!0,n={},t={},i={},r={},f={},u={},s=function(n,i){var r;return t[i]=t[i]||{},t[i].hasOwnProperty(n)||(t[i][n]=0),r=t[i][n]},l=function(n,i,r){t[i]=t[i]||{},t[i][n]=r},a=function(n,t){var r;return i[t]=i[t]||{},i[t].hasOwnProperty(n)||(i[t][n]=0),r=i[t][n]},k=function(n,t,r){i[t]=i[t]||{},i[t][n]=r},b=function(t,i,r){n[i]=n[i]||{},n[i][t]=r},w=function(n){return r[n]},d=function(n,t){r[n]=t},c=function(n){return r.hasOwnProperty("max")&&r.max.hasOwnProperty(n)?r.max[n]:NaN},v=function(n,t){r.max=r.max||{},r.max[n]=t},o=function(t,i){var r;return n[i]=n[i]||{},n[i].hasOwnProperty(t)||(n[i][t]=0),r=p.call(this,n[i][t],t)},p=function(n,t){var r=c(t),i;return isNaN(r)?n:(i=this.getQualityForBitrate(f[t].getMediaInfo(),r),Math.min(n,i))},y=function(n){if(0===MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD&&e){var t=this,i=n.data.request.mediaType,s=t.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.ABANDON_FRAGMENT_RULES),u=f[i].getScheduleController(),r=u.getFragmentModel(),o=function(n){function c(n){h=setTimeout(function(){t.setAbandonmentStateFor(n,MediaPlayer.dependencies.AbrController.ALLOW_LOAD)},MediaPlayer.dependencies.AbrController.ABANDON_TIMEOUT)}if(n.confidence===MediaPlayer.rules.SwitchRequest.prototype.STRONG){var o=r.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING}),f=n.value,e=t.getQualityFor(i,t.streamController.getActiveStreamInfo());e>f&&(r.abortRequests(),t.setAbandonmentStateFor(i,MediaPlayer.dependencies.AbrController.ABANDON_LOAD),t.setPlaybackQuality(i,t.streamController.getActiveStreamInfo(),f),u.replaceCanceledRequests(o),c(i))}};t.rulesController.applyRules(s,f[i],o,n,function(n,t){return t})}};return{log:void 0,abrRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,streamController:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_PROGRESS]=y},initialize:function(n,t){f[n]=t,u[n]=u[n]||{},u[n].state=MediaPlayer.dependencies.AbrController.ALLOW_LOAD},getAutoSwitchBitrate:function(){return e},setAutoSwitchBitrate:function(n){e=n},getPlaybackQuality:function(n){var t,h,v,c,f=this,i=n.getType(),r=n.getStreamInfo().id,y=function(e){var a=o.call(f,i,r);t=e.value,c=e.confidence,0>t&&(t=0),t>a&&(t=a),h=s(i,r),t===h||u[i].state===MediaPlayer.dependencies.AbrController.ABANDON_LOAD&&t>h||(l(i,r,t),k(i,r,c),f.notify(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,{mediaType:i,streamInfo:n.getStreamInfo(),oldQuality:h,newQuality:t}))};t=s(i,r),c=a(i,r),e&&(v=f.abrRulesCollection.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES),f.rulesController.applyRules(v,n,y.bind(f),t,function(n,t){return n=n===MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE?0:n,Math.max(n,t)}))},setPlaybackQuality:function(n,t,i){var u=t.id,r=s(n,u),f=null!==i&&!isNaN(i)&&i%1==0;if(!f)throw"argument is not an integer";i!==r&&i>=0&&i<=o.call(this,n,u)&&(l(n,t.id,i),this.notify(MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED,{mediaType:n,streamInfo:t,oldQuality:r,newQuality:i}))},setAbandonmentStateFor:function(n,t){u[n].state=t},getAbandonmentStateFor:function(n){return u[n].state},getQualityFor:function(n,t){return s(n,t.id)},getConfidenceFor:function(n,t){return a(n,t.id)},setInitialBitrateFor:function(n,t){d(n,t)},getInitialBitrateFor:function(n){return w(n)},setMaxAllowedBitrateFor:function(n,t){v(n,t)},getMaxAllowedBitrateFor:function(n){return c(n)},getQualityForBitrate:function(n,t){for(var r,f=this.getBitrateList(n),u=f.length,i=0;u>i;i+=1)if(r=f[i],1e3*t<=r.bitrate)return Math.max(i-1,0);return u-1},getBitrateList:function(n){if(!n||!n.bitrateList)return null;for(var t,r=n.bitrateList,e=n.type,u=[],i=0,f=r.length;f>i;i+=1)t=new MediaPlayer.vo.BitrateInfo,t.mediaType=e,t.qualityIndex=i,t.bitrate=r[i],u.push(t);return u},updateTopQualityIndex:function(n){var t,r=n.type,i=n.streamInfo.id;return t=n.trackCount-1,b(r,i,t),t},isPlayingAtTopQuality:function(n){var f,i=this,t=n.id,u=i.getQualityFor("audio",n),r=i.getQualityFor("video",n);return f=u===o.call(this,"audio",t)&&r===o.call(this,"video",t)},getTopQualityIndexFor:o,reset:function(){e=!0,n={},t={},i={},f={},u={},clearTimeout(h),h=null}}},MediaPlayer.dependencies.AbrController.prototype={constructor:MediaPlayer.dependencies.AbrController},MediaPlayer.dependencies.AbrController.eventList={ENAME_QUALITY_CHANGED:"qualityChanged"},MediaPlayer.dependencies.AbrController.DEFAULT_VIDEO_BITRATE=1e3,MediaPlayer.dependencies.AbrController.DEFAULT_AUDIO_BITRATE=100,MediaPlayer.dependencies.AbrController.ABANDON_LOAD="abandonload",MediaPlayer.dependencies.AbrController.ALLOW_LOAD="allowload",MediaPlayer.dependencies.AbrController.ABANDON_TIMEOUT=1e4,MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY=.9,MediaPlayer.dependencies.BufferController=function(){"use strict";var s,t,f,o,vt=.5,i=0,r=-1,d=!1,u=0,ot=0,l=Number.POSITIVE_INFINITY,k=-1,et=-1,n=null,a=null,c=!1,e=!1,ct=!1,ei=function(n){if(!n||!s||!this.streamProcessor)return null;var r=null;try{r=this.sourceBufferExt.createSourceBuffer(s,n),r&&r.hasOwnProperty("initialize")&&r.initialize(t,this)}catch(u){this.errHandler.mediaSourceError("Error creating "+t+" source buffer.")}return this.setBuffer(r),nt.call(this,this.streamProcessor.getTrackForQuality(i).MSETimeOffset),r},oi=function(){var t=this.streamProcessor.getStreamInfo().id,n=this.streamController.getActiveStreamInfo().id;return t===n},v=function(){var f=this.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING}),u=rt.call(this),n=this.virtualBuffer.getChunks({streamId:u,mediaType:t,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,quality:r});return r>i&&(at(n,r)||at(f,r))?!1:r!==i},at=function(n,t){var i=0,r=n.length;for(i;r>i;i+=1)if(n[i].quality===t)return!0;return!1},fi=function(n){var r,t=this;n.data.fragmentModel===t.streamProcessor.getFragmentModel()&&(t.log("Initialization finished loading"),r=n.data.chunk,this.virtualBuffer.append(r),r.quality===i&&v.call(t)&&st.call(t))},ri=function(n){if(n.data.fragmentModel===this.streamProcessor.getFragmentModel()){var e,t=n.data.chunk,s=t.bytes,o=t.quality,c=t.index,l=this.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,quality:o,index:c})[0],i=this.streamProcessor.getTrackForQuality(o),r=this.manifestModel.getValue(),u=this.adapter.getEventsFor(r,i.mediaInfo,this.streamProcessor),f=this.adapter.getEventsFor(r,i,this.streamProcessor);(u.length>0||f.length>0)&&(e=ui.call(this,s,l,u,f),this.streamProcessor.getEventController().addInbandEvents(e)),t.bytes=li.call(this,s),this.virtualBuffer.append(t),h.call(this)}},yt=function(t){e=!0,o=t;var s=this,u=t.quality,f=isNaN(t.index);return u!==i&&f||u!==r&&!f?void hi.call(s,u,t.index):void s.sourceBufferExt.append(n,t)},y=function(t){var r,i,u,f;if(n===t.data.buffer){if(this.isBufferingCompleted()&&this.streamProcessor.getStreamInfo().isLast&&this.mediaSourceExt.signalEndOfStream(s),i=this,t.error)return t.error.code===MediaPlayer.dependencies.SourceBufferExtensions.QUOTA_EXCEEDED_ERROR_CODE&&(i.virtualBuffer.append(o),l=.8*i.sourceBufferExt.getTotalBufferedTime(n),i.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,{criticalBufferLevel:l}),tt.call(i)),void(e=!1);if(ft.call(i),b.call(i)||(i.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED,{criticalBufferLevel:l}),tt.call(i)),r=i.sourceBufferExt.getAllRanges(n),r&&r.length>0)for(u=0,f=r.length;f>u;u+=1)i.log("Buffered Range: "+r.start(u)+" - "+r.end(u));i.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED,{quality:o.quality,index:o.index,bufferedRanges:r}),si.call(i,o.quality,o.index)}},ft=function(){var t=this,i=t.playbackController.getTime();return u=t.sourceBufferExt.getBufferLength(n,i),t.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED,{bufferLevel:u}),ai.call(t),pt.call(t),vt>u&&it.call(t,!1),!0},ui=function(n,t,i,r){var o,s,l,e,a=[],v=Math.max(isNaN(t.startTime)?0:t.startTime,0),c=[],u,f,h;for(ct=!1,e=i.concat(r),u=0;u<e.length;u++)c[e[u].schemeIdUri]=e[u];for(l=this.boxParser.parse(n),o=l.getBoxes("emsg"),f=0,h=o.length;h>f;f+=1)s=this.adapter.getEvent(o[f],c,v),s&&a.push(s);return a},li=function(n){var i;if(!ct)return n;for(var e,u,o=n.length,t=0,r=0,s=Math.pow(256,2),h=Math.pow(256,3),f=new Uint8Array(n.length);o>t;){if(e=String.fromCharCode(n[t+4],n[t+5],n[t+6],n[t+7]),u=n[t]*h+n[t+1]*s+256*n[t+2]+1*n[t+3],"emsg"!=e)for(i=t;t+u>i;i++)f[r]=n[i],r+=1;t+=u}return f.subarray(0,r)},ai=function(){var i=ci.call(this),t=2*f,n=u-i;n>=t&&!c?(c=!0,this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN)):t/2>n&&c&&(this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED),c=!1,h.call(this))},ci=function(){var r=this.metricsModel.getReadOnlyMetricsFor("video"),t=this.metricsExt.getCurrentBufferLevel(r),u=this.metricsModel.getReadOnlyMetricsFor("audio"),n=this.metricsExt.getCurrentBufferLevel(u),i=null;return i=null===t||null===n?null!==n?n.level:null!==t?t.level:null:Math.min(n.level,t.level)},b=function(){var i=this,t=i.sourceBufferExt.getTotalBufferedTime(n);return l>t},tt=function(){var r,f,u,e,i,t=this;n&&(r=t.playbackController.getTime(),i=t.streamProcessor.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,time:r})[0],u=i&&!isNaN(i.startTime)?i.startTime:Math.floor(r),e=t.sourceBufferExt.getBufferRange(n,r),null===e&&n.buffered.length>0&&(u=n.buffered.end(n.buffered.length-1)),f=n.buffered.start(0),t.sourceBufferExt.remove(n,f,u,s))},p=function(t){n===t.data.buffer&&(ft.call(this),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED,{from:t.data.from,to:t.data.to,hasEnoughSpaceToAppend:b.call(this)}),b.call(this)||setTimeout(tt.bind(this),1e3*f))},ht=function(){var n=k===et-1;n&&!d&&(d=!0,this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFERING_COMPLETED))},pt=function(){var n=this.playbackController.getTimeToStreamEnd();vt>u&&n>f||f>=n&&!d?it.call(this,!1):it.call(this,!0)},lt=function(){return a?MediaPlayer.dependencies.BufferController.BUFFER_LOADED:MediaPlayer.dependencies.BufferController.BUFFER_EMPTY},it=function(n){if(a!==n){a=n;var r=lt(),i=r===MediaPlayer.dependencies.BufferController.BUFFER_LOADED?MediaPlayer.events.BUFFER_LOADED:MediaPlayer.events.BUFFER_EMPTY;g.call(this),this.eventBus.dispatchEvent({type:i,data:{bufferType:t}}),this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED,{hasSufficientBuffer:n}),this.log(a?"Got enough buffer to start.":"Waiting for more buffer before starting playback.")}},nt=function(t){n&&n.timestampOffset!==t&&!isNaN(t)&&(n.timestampOffset=t)},ut=function(){if(n){var i=this,t=this.streamProcessor.getScheduleController().getFragmentToLoadCount(),r=this.streamProcessor.getCurrentTrack().fragmentDuration;ft.call(i),ot=t>0?t*r+u:ot,g.call(this),h.call(i)}},h=function(){v.call(this)?st.call(this):kt.call(this)},g=function(){if(oi.call(this)){this.metricsModel.addBufferState(t,lt(),ot);var n,i=u;n=this.virtualBuffer.getTotalBufferLevel(this.streamProcessor.getMediaInfo()),n&&(i+=n),this.metricsModel.addBufferLevel(t,new Date,i)}},rt=function(){return this.streamProcessor.getStreamInfo().id},si=function(n,t){e=!1,isNaN(t)?wt.call(this,n):bt.call(this,t),h.call(this)},hi=function(n,t){e=!1,this.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED,{quality:n,index:t}),h.call(this)},wt=function(n){r=n},bt=function(n){k=Math.max(n,k),ht.call(this)},kt=function(){var i,r=rt.call(this);!n||c||e||v.call(this)||!b.call(this)||(i=this.virtualBuffer.extract({streamId:r,mediaType:t,segmentType:MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE,limit:1})[0],i&&yt.call(this,i))},dt=function(n){if(!n.error){var i,t=this;nt.call(t,n.data.currentRepresentation.MSETimeOffset),i=t.streamProcessor.getStreamInfo().manifestInfo.minBufferTime,f!==i&&(t.setMinBufferTime(i),t.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_MIN_BUFFER_TIME_UPDATED,{minBufferTime:i}))}},gt=function(n){var t=this;n.data.fragmentModel===t.streamProcessor.getFragmentModel()&&(et=n.data.request.index,ht.call(t))},ii=function(n){if(t===n.data.mediaType&&this.streamProcessor.getStreamInfo().id===n.data.streamInfo.id){var r=this,u=n.data.newQuality;i!==u&&(nt.call(r,r.streamProcessor.getTrackForQuality(u).MSETimeOffset),i=u,v.call(r)&&st.call(r))}},w=function(){g.call(this)},st=function(){var r=this,f=rt.call(r),o={streamId:f,mediaType:t,segmentType:MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE,quality:i},u=r.virtualBuffer.getChunks(o)[0];if(u){if(e||!n)return;yt.call(r,u)}else r.notify(MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED,{requiredQuality:i})},ti=function(){h.call(this)},ni=function(){pt.call(this)};return{sourceBufferExt:void 0,eventBus:void 0,bufferMax:void 0,manifestModel:void 0,errHandler:void 0,mediaSourceExt:void 0,metricsModel:void 0,metricsExt:void 0,streamController:void 0,playbackController:void 0,adapter:void 0,log:void 0,abrController:void 0,boxParser:void 0,system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,virtualBuffer:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=dt,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED]=fi,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED]=ri,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=gt,this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=ii,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS]=ut,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=ut,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED]=ut,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED]=ni,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=ti,y=y.bind(this),p=p.bind(this),w=w.bind(this),this.sourceBufferExt.subscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,this,y),this.sourceBufferExt.subscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,this,p),this.virtualBuffer.subscribe(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,this,w)},initialize:function(n,r,u){var f=this;t=n,f.setMediaType(t),f.setMediaSource(r),f.streamProcessor=u,f.fragmentController=u.fragmentController,f.scheduleController=u.scheduleController,i=f.abrController.getQualityFor(t,u.getStreamInfo())},createBuffer:ei,getStreamProcessor:function(){return this.streamProcessor},setStreamProcessor:function(n){this.streamProcessor=n},getBuffer:function(){return n},setBuffer:function(t){n=t},getBufferLevel:function(){return u},getMinBufferTime:function(){return f},setMinBufferTime:function(n){f=n},getCriticalBufferLevel:function(){return l},setMediaSource:function(n){s=n},isBufferingCompleted:function(){return d},reset:function(t){var u=this;l=Number.POSITIVE_INFINITY,a=null,f=null,r=-1,et=-1,k=-1,i=0,u.sourceBufferExt.unsubscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,u,y),u.sourceBufferExt.unsubscribe(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,u,p),o=null,this.virtualBuffer.unsubscribe(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,u,w),c=!1,e=!1,t||(u.sourceBufferExt.abort(s,n),u.sourceBufferExt.removeSourceBuffer(s,n)),n=null}}},MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED="required",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN="min",MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY="infinity",MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME=12,MediaPlayer.dependencies.BufferController.LOW_BUFFER_THRESHOLD=4,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY=30,MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY_LONG_FORM=300,MediaPlayer.dependencies.BufferController.LONG_FORM_CONTENT_DURATION_THRESHOLD=600,MediaPlayer.dependencies.BufferController.RICH_BUFFER_THRESHOLD=20,MediaPlayer.dependencies.BufferController.BUFFER_LOADED="bufferLoaded",MediaPlayer.dependencies.BufferController.BUFFER_EMPTY="bufferStalled",MediaPlayer.dependencies.BufferController.prototype={constructor:MediaPlayer.dependencies.BufferController},MediaPlayer.dependencies.BufferController.eventList={ENAME_BUFFER_LEVEL_STATE_CHANGED:"bufferLevelStateChanged",ENAME_BUFFER_LEVEL_UPDATED:"bufferLevelUpdated",ENAME_QUOTA_EXCEEDED:"quotaExceeded",ENAME_BYTES_APPENDED:"bytesAppended",ENAME_BYTES_REJECTED:"bytesRejected",ENAME_BUFFERING_COMPLETED:"bufferingCompleted",ENAME_BUFFER_CLEARED:"bufferCleared",ENAME_INIT_REQUESTED:"initRequested",ENAME_BUFFER_LEVEL_OUTRUN:"bufferLevelOutrun",ENAME_BUFFER_LEVEL_BALANCED:"bufferLevelBalanced",ENAME_MIN_BUFFER_TIME_UPDATED:"minBufferTimeUpdated"},MediaPlayer.dependencies.EventController=function(){"use strict";var i={},r={},n={},t=null,u=100,v=u/1e3,a="urn:mpeg:dash:event:2012",y=1,w=function(){e(),i=null,r=null,n=null},e=function(){null!==t&&(clearInterval(t),t=null)},p=function(){var n=this;n.log("Start Event Controller"),isNaN(u)||(t=setInterval(s.bind(this),u))},l=function(n){var u=this,t,r;if(i={},n)for(t=0;t<n.length;t++)r=n[t],i[r.id]=r,u.log("Add inline event with id "+r.id);u.log("Added "+n.length+" inline events")},o=function(n){for(var t,u=this,i=0;i<n.length;i++)t=n[i],t.id in r?u.log("Repeated event with id "+t.id):(r[t.id]=t,u.log("Add inband event with id "+t.id))},s=function(){f.call(this,r),f.call(this,i),c.call(this)},f=function(t){var f,s=this,o=this.videoModel.getCurrentTime(),e,u,r,i;if(t)for(e=Object.keys(t),u=0;u<e.length;u++)r=e[u],i=t[r],void 0!==i&&(f=i.presentationTime/i.eventStream.timescale,(0===f||o>=f&&f+v>o)&&(s.log("Start Event "+r+" at "+o),i.duration>0&&(n[r]=i),i.eventStream.schemeIdUri==a&&i.eventStream.value==y&&h.call(this),delete t[r]))},c=function(){var e=this,i,t;if(n)for(var u=this.videoModel.getCurrentTime(),f=Object.keys(n),r=0;r<f.length;r++)i=f[r],t=n[i],null!==t&&(t.duration+t.presentationTime)/t.eventStream.timescale<u&&(e.log("Remove Event "+i+" at time "+u),t=null,delete n[i])},h=function(){var t=this.manifestModel.getValue(),n=t.url;t.hasOwnProperty("Location")&&(n=t.Location),this.log("Refresh manifest @ "+n),this.manifestUpdater.getManifestLoader().load(n)};return{manifestModel:void 0,manifestUpdater:void 0,log:void 0,system:void 0,videoModel:void 0,addInlineEvents:l,addInbandEvents:o,reset:w,clear:e,start:p}},MediaPlayer.dependencies.EventController.prototype={constructor:MediaPlayer.dependencies.EventController},MediaPlayer.dependencies.FragmentController=function(){"use strict";var n=[],i=!1,s=function(t){for(var r=n.length,i=0;r>i;i++)if(n[i].getContext()==t)return n[i];return null},o=function(t,i){var f=this,u=n[0].getContext().streamProcessor,e=u.getStreamInfo().id,r=f.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES);-1!==r.indexOf(this.scheduleRulesCollection.sameTimeRequestRule)&&this.scheduleRulesCollection.sameTimeRequestRule.setFragmentModels(n,e),f.rulesController.applyRules(r,u,i,t,function(n,t){return t})},c=function(n,t,i){var r=new MediaPlayer.vo.DataChunk;return r.streamId=i,r.mediaType=t.mediaType,r.segmentType=t.type,r.start=t.startTime,r.duration=t.duration,r.end=r.start+r.duration,r.bytes=n,r.index=t.index,r.quality=t.quality,r},f=function(n){var i=this,t=n.data.request;i.isInitializationRequest(t)?i.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADING_START,{request:t,fragmentModel:n.sender}):i.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START,{request:t,fragmentModel:n.sender})},h=function(n){var u,f=this,i=n.data.request,r=n.data.response,s=n.sender.getContext().streamProcessor.getStreamInfo().id,o=this.isInitializationRequest(i),e=o?MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED:MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADED;return r?(u=c.call(this,r,i,s),f.notify(e,{chunk:u,fragmentModel:n.sender}),void t.call(this)):void f.log("No "+i.mediaType+" bytes to push.")},r=function(n){this.notify(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,{request:n.data.request,fragmentModel:n.sender})},u=function(){t.call(this)},e=function(t){for(var s,r,e,f,o=t.value,u=0;u<o.length;u+=1)if(r=o[u])for(f=0;f<n.length;f+=1)e=n[f],s=e.getContext().streamProcessor.getType(),r.mediaType===s&&(r instanceof MediaPlayer.vo.FragmentRequest||(r=e.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING,time:r.startTime})[0]),e.executeRequest(r));i=!1},t=function(n){i||(i=!0,o.call(this,n,e.bind(this)))};return{system:void 0,log:void 0,scheduleRulesCollection:void 0,rulesController:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED]=f,this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED]=h,this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED]=r,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED]=u,this.scheduleRulesCollection.sameTimeRequestRule&&this.subscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,this.scheduleRulesCollection.sameTimeRequestRule)},process:function(n){var t=null;return null!==n&&void 0!==n&&n.byteLength>0&&(t=new Uint8Array(n)),t},getModel:function(t){if(!t)return null;var i=s(t);return i||(i=this.system.getObject("fragmentModel"),i.setContext(t),n.push(i)),i},detachModel:function(t){var i=n.indexOf(t);i>-1&&n.splice(i,1)},isInitializationRequest:function(n){return n&&n.type&&n.type===MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE},prepareFragmentForLoading:function(n,i){n&&i&&n.addRequest(i)&&t.call(this,i)},executePendingRequests:function(){t.call(this)},reset:function(){n=[],this.scheduleRulesCollection.sameTimeRequestRule&&this.unsubscribe(MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED,this.scheduleRulesCollection.sameTimeRequestRule)}}},MediaPlayer.dependencies.FragmentController.prototype={constructor:MediaPlayer.dependencies.FragmentController},MediaPlayer.dependencies.FragmentController.eventList={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_INIT_FRAGMENT_LOADING_START:"initFragmentLoadingStart",ENAME_MEDIA_FRAGMENT_LOADING_START:"mediaFragmentLoadingStart",ENAME_INIT_FRAGMENT_LOADED:"initFragmentLoaded",ENAME_MEDIA_FRAGMENT_LOADED:"mediaFragmentLoaded"},MediaPlayer.dependencies.PlaybackController=function(){"use strict";var t,n,f,nt,at=1e3,tt=0,u=NaN,b=null,r={},i={},d=NaN,k=function(n){var t,i=parseInt(this.uriQueryFragModel.getURIFragmentData().s);return f?(!isNaN(i)&&i>1262304e3&&(t=i-n.manifestInfo.availableFrom.getTime()/1e3,(t>u||t<u-n.manifestInfo.DVRWindowSize)&&(t=null)),t=t||u):t=!isNaN(i)&&i<n.duration&&i>=0?i:n.start,t},lt=function(n){var f,r=this,e=r.metricsModel.getReadOnlyMetricsFor("video")||r.metricsModel.getReadOnlyMetricsFor("audio"),u=r.metricsExt.getCurrentDVRInfo(e),i=u?u.range:null;return i?n>=i.start&&n<=i.end?n:f=Math.max(i.end-2*t.manifestInfo.minBufferTime,i.start):NaN},g=function(){if(null===b){var t=this,n=function(){ot.call(t)};b=setInterval(n,at)}},ut=function(){clearInterval(b),b=null},rt=function(){if(!i[t.id]&&!this.isSeeking()){var n=k.call(this,t);this.log("Starting playback at offset: "+n),this.seek(n)}},ft=function(){if(!this.isPaused()&&f&&0!==n.getElement().readyState){var i=this.getTime(),t=lt.call(this,i),r=!isNaN(t)&&t!==i;r&&this.seek(t)}},yt=function(n){if(!n.error){var i=this.adapter.convertDataToTrack(this.manifestModel.getValue(),n.data.currentRepresentation),r=i.mediaInfo.streamInfo;t.id===r.id&&(t=i.mediaInfo.streamInfo,ft.call(this))}},vt=function(t){t.error||0===n.getElement().readyState||rt.call(this)},et=function(){n&&(n.unlisten("play",s),n.unlisten("playing",h),n.unlisten("pause",c),n.unlisten("error",w),n.unlisten("seeking",o),n.unlisten("seeked",e),n.unlisten("timeupdate",y),n.unlisten("progress",p),n.unlisten("ratechange",v),n.unlisten("loadedmetadata",l),n.unlisten("ended",a))},it=function(){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY)},s=function(){this.log("<video> play"),ft.call(this),g.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,{startTime:this.getTime()})},h=function(){this.log("<video> playing"),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PLAYING,{playingTime:this.getTime()})},c=function(){this.log("<video> pause"),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED)},o=function(){this.log("<video> seek"),g.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING,{seekTime:this.getTime()})},e=function(){this.log("<video> seeked"),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKED)},y=function(){var n=this.getTime();n!==tt&&(tt=n,this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED,{timeToEnd:this.getTimeToStreamEnd()}))},p=function(){var r,f,u,i=n.getElement().buffered;i.length&&(r=i.length-1,f=i.end(r),u=k.call(this,t)+t.duration-f),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PROGRESS,{bufferedRanges:n.getElement().buffered,remainingUnbufferedDuration:u})},v=function(){this.log("<video> ratechange: ",this.getPlaybackRate()),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED)},l=function(){this.log("<video> loadedmetadata"),(!f||this.timelineConverter.isTimeSyncCompleted())&&rt.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_METADATA_LOADED),g.call(this)},a=function(){this.log("<video> ended"),ut.call(this),this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED)},w=function(n){var t=n.target||n.srcElement;this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR,{error:t.error})},ot=function(){this.notify(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED,{isDynamic:f,time:new Date})},st=function(n){var f,e=n.data.bufferedRanges,u=t.id,h=this.getTime(),c=n.sender.streamProcessor.getType(),o=this.system.getObject("streamController").getStreamById(t.id),s=r[u];0===n.data.index&&(i[u]=i[u]||{},i[u][c]=!0,i.ready=!(o.hasMedia("audio")&&!i[u].audio||o.hasMedia("video")&&!i[u].video)),e&&e.length&&(f=Math.max(e.start(0),t.start),r[u]=void 0===r[u]?f:Math.max(r[u],f),s===r[u]&&h===s||!i.ready||h>r[u]||this.seek(r[u]))},ht=function(i){var u=i.sender.streamProcessor.getType(),r=i.sender.streamProcessor.getStreamInfo();r.id===t.id&&n.setStallState(u,!i.data.hasSufficientBuffer)},ct=function(){n.listen("canplay",it),n.listen("play",s),n.listen("playing",h),n.listen("pause",c),n.listen("error",w),n.listen("seeking",o),n.listen("seeked",e),n.listen("timeupdate",y),n.listen("progress",p),n.listen("ratechange",v),n.listen("loadedmetadata",l),n.listen("ended",a)};return{system:void 0,log:void 0,timelineConverter:void 0,uriQueryFragModel:void 0,metricsModel:void 0,metricsExt:void 0,manifestModel:void 0,manifestExt:void 0,videoModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,adapter:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=yt,this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=vt,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED]=st,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED]=ht,it=it.bind(this),s=s.bind(this),h=h.bind(this),c=c.bind(this),w=w.bind(this),o=o.bind(this),e=e.bind(this),y=y.bind(this),p=p.bind(this),v=v.bind(this),l=l.bind(this),a=a.bind(this)},initialize:function(i){n=this.videoModel,t=i,r={},et.call(this),ct.call(this),f=t.manifestInfo.isDynamic,u=i.start},getStreamStartTime:k,getTimeToStreamEnd:function(){var i=n.getCurrentTime();return k.call(this,t)+t.duration-i},getStreamId:function(){return t.id},getStreamDuration:function(){return t.duration},getTime:function(){return n.getCurrentTime()},getPlaybackRate:function(){return n.getPlaybackRate()},getPlayedRanges:function(){return n.getElement().played},setLiveStartTime:function(n){u=n},getLiveStartTime:function(){return u},setLiveDelayAttributes:function(n,t){d=n,nt=t},getLiveDelay:function(n){var r,i=this.manifestExt.getMpd(this.manifestModel.getValue());return r=nt&&i.hasOwnProperty("suggestedPresentationDelay")?i.suggestedPresentationDelay:isNaN(n)?2*t.manifestInfo.minBufferTime:n*d},start:function(){n.play()},isPaused:function(){return n.isPaused()},pause:function(){n&&n.pause()},isSeeking:function(){return n.getElement().seeking},seek:function(t){n&&t!==this.getTime()&&(this.log("Do seek: "+t),n.setCurrentTime(t))},reset:function(){ut.call(this),et.call(this),n=null,t=null,tt=0,u=NaN,r={},i={},f=void 0,nt=void 0,d=NaN}}},MediaPlayer.dependencies.PlaybackController.prototype={constructor:MediaPlayer.dependencies.PlaybackController},MediaPlayer.dependencies.PlaybackController.eventList={ENAME_CAN_PLAY:"canPlay",ENAME_PLAYBACK_STARTED:"playbackStarted",ENAME_PLAYBACK_PLAYING:"playbackPlaying",ENAME_PLAYBACK_STOPPED:"playbackStopped",ENAME_PLAYBACK_PAUSED:"playbackPaused",ENAME_PLAYBACK_ENDED:"playbackEnded",ENAME_PLAYBACK_SEEKING:"playbackSeeking",ENAME_PLAYBACK_SEEKED:"playbackSeeked",ENAME_PLAYBACK_TIME_UPDATED:"playbackTimeUpdated",ENAME_PLAYBACK_PROGRESS:"playbackProgress",ENAME_PLAYBACK_RATE_CHANGED:"playbackRateChanged",ENAME_PLAYBACK_METADATA_LOADED:"playbackMetaDataLoaded",ENAME_PLAYBACK_ERROR:"playbackError",ENAME_WALLCLOCK_TIME_UPDATED:"wallclockTimeUpdated"},MediaPlayer.dependencies.ProtectionController=function(){"use strict";var r,t,u,p=null,n=[],i=[],e=!1,y=function(n){var i=null,t=n.systemString;return u&&(i=t in u?u[t]:null),i},f=function(i,u){var f=this,y=[],v=[],e,a,s,l,h,c,o;if(t&&v.push(new MediaPlayer.vo.protection.MediaCapability(t.codec)),r&&y.push(new MediaPlayer.vo.protection.MediaCapability(r.codec)),a=new MediaPlayer.vo.protection.KeySystemConfiguration(y,v),s=[],this.keySystem){for(e=0;e<i.length;e++)if(this.keySystem===i[e].ks){s.push({ks:i[e].ks,configs:[a]}),l={},l[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(n){n.error?u||f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: KeySystem Access Denied! -- "+n.error}):(f.log("KeySystem Access Granted"),f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:n.data}),f.createKeySession(i[e].initData))},this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,l,void 0,!0),this.protectionModel.requestKeySystemAccess(s);break}}else if(void 0===this.keySystem){for(this.keySystem=null,n.push(i),h=0;h<i.length;h++)s.push({ks:i[h].ks,configs:[a]});o={},o[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE]=function(n){n.error?(f.keySystem=void 0,f.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,o),u||f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: KeySystem Access Denied! -- "+n.error})):(c=n.data,f.log("KeySystem Access Granted ("+c.keySystem.systemString+")!  Selecting key system..."),f.protectionModel.selectKeySystem(c))},o[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED]=function(t){if(t.error)f.keySystem=void 0,u||f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,error:"DRM: Error selecting key system! -- "+t.error});else{f.keySystem=f.protectionModel.keySystem,f.protectionExt.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,f),f.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SYSTEM_SELECTED,data:c});for(var i=0;i<n.length;i++)for(e=0;e<n[i].length;e++)if(f.keySystem===n[i][e].ks){f.createKeySession(n[i][e].initData);break}}},this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,o,void 0,!0),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,o,void 0,!0),this.protectionModel.requestKeySystemAccess(s)}else n.push(i)},v=function(n){if(n.error)this.log(n.error);else{var t=n.data;this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_MESSAGE,data:n.data}),i.push(t.sessionToken),this.protectionExt.requestLicense(this.keySystem,y(this.keySystem),t.message,t.defaultURL,t.sessionToken)}},k=function(n){for(var r=n.error?n.data:n.data.requestData,t=0;t<i.length;t++)if(i[t]===r){i.splice(t,1),n.error?(this.log("DRM: License request failed! -- "+n.error),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,data:null,error:"DRM: License request failed! -- "+n.error})):(this.log("DRM: License request successful.  Session ID = "+n.data.requestData.getSessionID()),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.LICENSE_REQUEST_COMPLETE,data:r}),this.updateKeySession(r,n.data.message));break}},b=function(n){var t,i;return"cenc"!==n.data.initDataType?void this.log("DRM:  Only 'cenc' initData is supported!  Ignoring initData of type: "+n.data.initDataType):(t=n.data.initData,ArrayBuffer.isView(t)&&(t=t.buffer),i=this.protectionExt.getSupportedKeySystems(t),0===i.length?void this.log("Received needkey event with initData, but we don't support any of the key systems!"):void f.call(this,i,!0))},w=function(n){n.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,data:null,error:"DRM: Failed to update license server certificate. -- "+n.error}):(this.log("DRM: License server certificate successfully updated."),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.SERVER_CERTIFICATE_UPDATED,data:null,error:null}))},h=function(n){n.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"DRM: Failed to create key session. -- "+n.error}):(this.log("DRM: Session created.  SessionID = "+n.data.getSessionID()),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:n.data,error:null}))},s=function(){this.log("DRM: Key added."),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,data:null,error:null})},o=function(n){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_ADDED,data:null,error:"DRM: MediaKeyError - sessionId: "+n.data.sessionToken.getSessionID()+".  "+n.data.error})},a=function(n){n.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CLOSED,data:null,error:"DRM Failed to close key session. -- "+n.error}):(this.log("DRM: Session closed.  SessionID = "+n.data),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CLOSED,data:n.data,error:null}))},c=function(n){n.error?this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_REMOVED,data:null,error:"DRM Failed to remove key session. -- "+n.error}):(this.log("DRM: Session removed.  SessionID = "+n.data),this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_REMOVED,data:n.data,error:null}))},l=function(n){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_STATUSES_CHANGED,data:n.data,error:null})};return{system:void 0,log:void 0,protectionExt:void 0,keySystem:void 0,sessionType:"temporary",setup:function(){this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE]=v.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY]=b.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED]=w.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED]=s.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR]=o.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED]=h.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED]=a.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED]=c.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED]=l.bind(this),this[MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE]=k.bind(this),p=this.protectionExt.getKeySystems(),this.protectionModel=this.system.getObject("protectionModel"),this.protectionModel.init(),this.eventBus=this.system.getObject("eventBusCl"),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this)},init:function(n,i,u){var h,o,c,s;e||(i||u||(h=this.system.getObject("adapter"),o=h.getStreamsInfo(n)[0]),r=i||(o?h.getMediaInfoForType(n,o,"audio"):null),t=u||(o?h.getMediaInfoForType(n,o,"video"):null),c=t?t:r,s=this.protectionExt.getSupportedKeySystemsFromContentProtection(c.contentProtection),s&&s.length>0&&f.call(this,s,!1),e=!0)},addEventListener:function(n,t){this.eventBus.addEventListener(n,t)},removeEventListener:function(n,t){this.eventBus.removeEventListener(n,t)},teardown:function(){this.setMediaElement(null),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.keySystem&&this.protectionExt.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,this),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this),this.keySystem=void 0,this.protectionModel.teardown(),this.protectionModel=void 0},createKeySession:function(n){var r=MediaPlayer.dependencies.protection.CommonEncryption.getPSSHForKeySystem(this.keySystem,n),i,t;if(r){for(i=this.protectionModel.getAllInitData(),t=0;t<i.length;t++)if(this.protectionExt.initDataEquals(r,i[t]))return void this.log("Ignoring initData because we have already seen it!");try{this.protectionModel.createKeySession(r,this.sessionType)}catch(u){this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"Error creating key session! "+u.message})}}else this.eventBus.dispatchEvent({type:MediaPlayer.dependencies.ProtectionController.events.KEY_SESSION_CREATED,data:null,error:"Selected key system is "+this.keySystem.systemString+".  needkey/encrypted event contains no initData corresponding to that key system!"})},updateKeySession:function(n,t){this.protectionModel.updateKeySession(n,t)},loadKeySession:function(n){this.protectionModel.loadKeySession(n)},removeKeySession:function(n){this.protectionModel.removeKeySession(n)},closeKeySession:function(n){this.protectionModel.closeKeySession(n)},setServerCertificate:function(n){this.protectionModel.setServerCertificate(n)},setMediaElement:function(n){n?(this.protectionModel.setMediaElement(n),this.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,this)):null===n&&(this.protectionModel.setMediaElement(n),this.protectionModel.unsubscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,this))},setSessionType:function(n){this.sessionType=n},setProtectionData:function(n){u=n}}},MediaPlayer.dependencies.ProtectionController.events={KEY_SYSTEM_SELECTED:"keySystemSelected",SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",KEY_ADDED:"keyAdded",KEY_SESSION_CREATED:"keySessionCreated",KEY_SESSION_REMOVED:"keySessionRemoved",KEY_SESSION_CLOSED:"keySessionClosed",KEY_STATUSES_CHANGED:"keyStatusesChanged",KEY_MESSAGE:"keyMessage",LICENSE_REQUEST_COMPLETE:"licenseRequestComplete"},MediaPlayer.dependencies.ProtectionController.prototype={constructor:MediaPlayer.dependencies.ProtectionController},MediaPlayer.dependencies.ScheduleController=function(){"use strict";var s,a,t,v,n,i=0,c=!0,p=null,l=!1,w=null,e=null,f=!0,r=function(n,t){var r=0,i=null;f===!1&&(i=e.start,r=n.getTime()-i.getTime(),e.duration=r,e.stopreason=t,f=!0)},h=function(){a&&(l=!1,c&&(c=!1),this.log("start"),o.call(this))},vt=function(){c&&(y.call(this,n.quality),k.call(this,MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON)),h.call(this)},u=function(n){l||(l=!0,this.log("stop"),n&&t.cancelPendingRequests(),r(new Date,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON))},yt=function(n){var t=this,i=t.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES);t.rulesController.applyRules(i,t.streamProcessor,n,null,function(n,t){return t})},y=function(n){var i,r=this;return i=r.adapter.getInitRequest(r.streamProcessor,n),null!==i&&r.fragmentController.prepareFragmentForLoading(t,i),i},pt=function(n){var t=this,r=t.scheduleRulesCollection.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES);t.rulesController.applyRules(r,t.streamProcessor,n,i,function(n,t){return n=n===MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE?0:n,Math.max(n,t)})},d=function(i){for(var r,f,o=i.length,e=.1,u=0;o>u;u+=1)r=i[u],f=r.startTime+r.duration/2+e,r=this.adapter.getFragmentRequestForTime(this.streamProcessor,n,f,{timeThreshold:0,ignoreIsFinished:!0}),this.fragmentController.prepareFragmentForLoading(t,r)},ct=function(n){var t=this;return i=n.value,0>=i?void t.fragmentController.executePendingRequests():void yt.call(t,lt.bind(t))},lt=function(r){var u=r.value;null===u||u instanceof MediaPlayer.vo.FragmentRequest||(u=this.adapter.getFragmentRequestForTime(this.streamProcessor,n,u.startTime)),u?(i--,this.fragmentController.prepareFragmentForLoading(t,u)):this.fragmentController.executePendingRequests()},o=function(){var n=+new Date,i=p?n-p>t.getLoadingTime():!0;this.abrController.getPlaybackQuality(this.streamProcessor),!i||l||this.playbackController.isPaused()&&this.playbackController.getPlayedRanges().length>0&&(!this.scheduleWhilePaused||v)||(p=n,pt.call(this,ct.bind(this)))},at=function(t){t.error||(n=this.adapter.convertDataToTrack(this.manifestModel.getValue(),t.data.currentRepresentation))},wt=function(t){t.error||(n=this.streamProcessor.getCurrentTrack(),v&&null===this.liveEdgeFinder.getLiveEdge()||(a=!0),a&&vt.call(this))},gt=function(n){n.data.fragmentModel===this.streamProcessor.getFragmentModel()&&(this.log("Stream is complete"),r(new Date,MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON))},ni=function(n){var t=this;n.data.fragmentModel===t.streamProcessor.getFragmentModel()&&o.call(t)},ti=function(n){n.error&&u.call(this)},bt=function(){b.call(this)},kt=function(){u.call(this,!1)},dt=function(n){y.call(this,n.data.requiredQuality)},nt=function(n){t.removeExecutedRequestsBeforeTime(n.data.to),n.data.hasEnoughSpaceToAppend&&h.call(this)},g=function(n){var t=this;n.data.hasSufficientBuffer||t.playbackController.isSeeking()||(t.log("Stalling Buffer"),r(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON))},tt=function(){o.call(this)},it=function(){u.call(this,!1)},rt=function(i){if(s===i.data.mediaType&&this.streamProcessor.getStreamInfo().id===i.data.streamInfo.id){var f,u=this;if(f=t.cancelPendingRequests(i.data.oldQuality),n=u.streamProcessor.getTrackForQuality(i.data.newQuality),null===n||void 0===n)throw"Unexpected error!";d.call(u,f),r(new Date,MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON)}},k=function(n){var t=new Date,i=this.playbackController.getTime();r(t,MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON),w=this.metricsModel.addPlayList(s,t,i,n)},b=function(){var t=this,u=t.playbackController.getTime(),r=t.playbackController.getPlaybackRate(),i=new Date;f===!0&&n&&w&&(f=!1,e=t.metricsModel.appendPlayListTrace(w,n.id,null,i,u,null,r,null))},ot=function(n){var r=this,i=y.call(r,n.data.CCIndex);t.executeRequest(i)},st=function(){h.call(this)},ht=function(i){c||t.cancelPendingRequests();var u=this.metricsModel.getMetricsFor("stream"),r=this.metricsExt.getCurrentManifestUpdate(u);this.log("seek: "+i.data.seekTime),k.call(this,MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON),this.metricsModel.updateManifestUpdateInfo(r,{latency:n.DVRWindow.end-this.playbackController.getTime()})},ut=function(){b.call(this)},ft=function(){o.call(this)},et=function(t){if(!t.error){var e,r,i=this,u=t.data.liveEdge,h=n.mediaInfo.streamInfo.manifestInfo,s=u-Math.min(i.playbackController.getLiveDelay(n.fragmentDuration),h.DVRWindowSize/2),c=i.metricsModel.getMetricsFor("stream"),o=i.metricsExt.getCurrentManifestUpdate(c),f=i.playbackController.getLiveStartTime();e=i.adapter.getFragmentRequestForTime(i.streamProcessor,n,s,{ignoreIsFinished:!0}),r=e.startTime,(isNaN(f)||r>f)&&i.playbackController.setLiveStartTime(r),i.metricsModel.updateManifestUpdateInfo(o,{currentTime:r,presentationStartTime:u,latency:u-r,clientTimeOffset:i.timelineConverter.getClientTimeOffset()}),a=!0}};return{log:void 0,system:void 0,metricsModel:void 0,manifestModel:void 0,metricsExt:void 0,scheduleWhilePaused:void 0,timelineConverter:void 0,abrController:void 0,playbackController:void 0,adapter:void 0,scheduleRulesCollection:void 0,rulesController:void 0,numOfParallelRequestAllowed:void 0,setup:function(){this[MediaPlayer.dependencies.LiveEdgeFinder.eventList.ENAME_LIVE_EDGE_SEARCH_COMPLETED]=et,this[MediaPlayer.dependencies.AbrController.eventList.ENAME_QUALITY_CHANGED]=rt,this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_STARTED]=kt,this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=at,this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=wt,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_MEDIA_FRAGMENT_LOADING_START]=ni,this[MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED]=ti,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=gt,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_CLEARED]=nt,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_APPENDED]=bt,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_STATE_CHANGED]=g,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_UPDATED]=tt,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_INIT_REQUESTED]=dt,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_QUOTA_EXCEEDED]=it,this[MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED]=ot,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED]=st,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=ht,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_RATE_CHANGED]=ut,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_WALLCLOCK_TIME_UPDATED]=ft},initialize:function(n,i){var r=this;s=n,r.setMediaType(s),r.streamProcessor=i,r.fragmentController=i.fragmentController,r.liveEdgeFinder=i.liveEdgeFinder,r.bufferController=i.bufferController,v=i.isDynamic(),t=this.fragmentController.getModel(this),MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD=r.numOfParallelRequestAllowed,r.scheduleRulesCollection.bufferLevelRule&&r.scheduleRulesCollection.bufferLevelRule.setScheduleController(r),r.scheduleRulesCollection.pendingRequestsRule&&r.scheduleRulesCollection.pendingRequestsRule.setScheduleController(r),r.scheduleRulesCollection.playbackTimeRule&&r.scheduleRulesCollection.playbackTimeRule.setScheduleController(r)},getFragmentModel:function(){return t},getFragmentToLoadCount:function(){return i},replaceCanceledRequests:d,reset:function(){var n=this;u.call(n,!0),n.bufferController.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN,n.scheduleRulesCollection.bufferLevelRule),n.bufferController.unsubscribe(MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED,n.scheduleRulesCollection.bufferLevelRule),t.abortRequests(),n.fragmentController.detachModel(t),i=0},start:h,stop:u}},MediaPlayer.dependencies.ScheduleController.prototype={constructor:MediaPlayer.dependencies.ScheduleController},MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD=0,MediaPlayer.dependencies.StreamController=function(){"use strict";var n,r,u,t,d,l,i=[],s=!1,ot=.2,a=!0,c=!1,f=!1,o=!1,h=!1,k=function(n){n.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder),n.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,this)},b=function(n){n.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this.liveEdgeFinder),n.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED,this)},e=function(n,t,i){this.eventBus.dispatchEvent({type:n,data:{fromStreamInfo:t?t.getStreamInfo():null,toStreamInfo:i.getStreamInfo()}})},y=function(){n.isActivated()&&c&&0===n.getStreamInfo().index&&(n.startEventController(),a&&this.playbackController.start())},st=function(){c=!0,y.call(this)},ft=function(n){var i=n.data.error.code,t="";if(-1!==i){switch(i){case 1:t="MEDIA_ERR_ABORTED";break;case 2:t="MEDIA_ERR_NETWORK";break;case 3:t="MEDIA_ERR_DECODE";break;case 4:t="MEDIA_ERR_SRC_NOT_SUPPORTED";break;case 5:t="MEDIA_ERR_ENCRYPTED"}h=!0,this.log("Video Element Error: "+t),n.error&&this.log(n.error),this.errHandler.mediaSourceError(t),this.reset()}},et=function(n){var i=this,r=i.videoExt.getPlaybackQuality(i.videoModel.getElement());r&&i.metricsModel.addDroppedFrames("video",r),i.playbackController.isSeeking()||n.data.timeToEnd<ot&&this.mediaSourceExt.signalEndOfStream(t)},lt=function(){g.call(this,n,p())},at=function(t){var i=ct(t.data.seekTime);i&&i!==n&&g.call(this,n,i,t.data.seekTime)},ht=function(n){var i=p(),r=n.data.streamInfo.isLast;t&&r&&this.mediaSourceExt.signalEndOfStream(t),i&&i.activate(t)},p=function(){var r=n.getStreamInfo().start,t=n.getStreamInfo().duration;return i.filter(function(n){return n.getStreamInfo().start===r+t})[0]},ct=function(n){var u=0,r=null,f=i.length,t;for(f>0&&(u+=i[0].getStartTime()),t=0;f>t;t++)if(r=i[t],u+=r.getDuration(),u>n)return r;return null},g=function(t,i,r){if(!f&&t&&i&&t!==i){e.call(this,MediaPlayer.events.STREAM_SWITCH_STARTED,t,i),f=!0;var u=this,o=function(){void 0!==r&&u.playbackController.seek(r),u.playbackController.start(),n.startEventController(),f=!1,e.call(u,MediaPlayer.events.STREAM_SWITCH_COMPLETED,t,i)};setTimeout(function(){b.call(u,t),t.deactivate(),n=i,k.call(u,i),u.playbackController.initialize(n.getStreamInfo()),w.call(u,o)},0)}},w=function(i){var f,r=this,u=function(e){r.log("MediaSource is open!"),r.log(e),window.URL.revokeObjectURL(f),t.removeEventListener("sourceopen",u),t.removeEventListener("webkitsourceopen",u),tt.call(r),n.activate(t),i&&i()};t?r.mediaSourceExt.detachMediaSource(r.videoModel):t=r.mediaSourceExt.createMediaSource(),t.addEventListener("sourceopen",u,!1),t.addEventListener("webkitsourceopen",u,!1),f=r.mediaSourceExt.attachMediaSource(t,r.videoModel)},tt=function(){var u,r,i=this;u=n.getStreamInfo().manifestInfo.duration,r=i.mediaSourceExt.setDuration(t,u),i.log("Duration successfully set to: "+r)},ut=function(){var c,nt,g,p,l,a,h,f=this,y=f.manifestModel.getValue(),tt=f.metricsModel.getMetricsFor("stream"),d=f.metricsExt.getCurrentManifestUpdate(tt),b=[];if(y){a=f.adapter.getStreamsInfo(y),this.capabilities.supportsEncryptedMedia()&&(r||(r=this.system.getObject("protectionController"),this.eventBus.dispatchEvent({type:MediaPlayer.events.PROTECTION_CREATED,data:{controller:r,manifest:y}}),s=!0),r.setMediaElement(this.videoModel.getElement()),u&&r.setProtectionData(u));try{if(0===a.length)throw new Error("There are no streams");for(f.metricsModel.updateManifestUpdateInfo(d,{currentTime:f.videoModel.getCurrentTime(),buffered:f.videoModel.getElement().buffered,presentationStartTime:a[0].start,clientTimeOffset:f.timelineConverter.getClientTimeOffset()}),o=!0,p=0,nt=a.length;nt>p;p+=1){for(c=a[p],l=0,g=i.length;g>l;l+=1)i[l].getId()===c.id&&(h=i[l],b.push(h),h.updateData(c));h||(h=f.system.getObject("stream"),h.initialize(c,r,u),h.subscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,f),b.push(h),n&&h.updateData(c)),f.metricsModel.addManifestUpdateStreamInfo(d,c.id,c.index,c.start,c.duration),h=null}i=b,n||(n=i[0],e.call(f,MediaPlayer.events.STREAM_SWITCH_STARTED,null,n),f.playbackController.initialize(n.getStreamInfo()),k.call(f,n),e.call(f,MediaPlayer.events.STREAM_SWITCH_COMPLETED,null,n)),t||w.call(this),o=!1,v.call(f)}catch(it){f.errHandler.manifestError(it.message,"nostreamscomposed",y),f.reset()}}},v=function(){if(!o){var t=this,r=i.length,n=0;for(y.call(this),n;r>n;n+=1)if(!i[n].isInitialized())return;t.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED)}},rt=function(){v.call(this)},it=function(){ut.call(this)},nt=function(n){var t,u;if(n.error)this.reset();else{this.log("Manifest has loaded.");var i=n.data.manifest,e=this.adapter.getStreamsInfo(i)[0],f=this.adapter.getMediaInfoForType(i,e,"video"),o=this.adapter.getDataForMedia(f),r=this.manifestExt.getRepresentationsForAdaptation(i,o)[0].useCalculatedLiveEdgeTime;r&&(this.log("SegmentTimeline detected using calculated Live Edge Time"),l=!1),t=this.manifestExt.getUTCTimingSources(n.data.manifest),u=!this.manifestExt.getIsDynamic(i)||r?t:t.concat(d),this.timeSyncController.initialize(r?t:u,l)}};return{system:void 0,capabilities:void 0,videoModel:void 0,manifestUpdater:void 0,manifestLoader:void 0,manifestModel:void 0,manifestExt:void 0,adapter:void 0,playbackController:void 0,log:void 0,metricsModel:void 0,metricsExt:void 0,videoExt:void 0,liveEdgeFinder:void 0,mediaSourceExt:void 0,timelineConverter:void 0,protectionExt:void 0,timeSyncController:void 0,virtualBuffer:void 0,errHandler:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED]=nt,this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED]=rt,this[MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_BUFFERING_COMPLETED]=ht,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=at,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_TIME_UPDATED]=et,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED]=lt,this[MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED]=it,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_CAN_PLAY]=st,this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ERROR]=ft},getAutoPlay:function(){return a},getActiveStreamInfo:function(){return n?n.getStreamInfo():null},isStreamActive:function(t){return n.getId()===t.id},setUTCTimingSources:function(n,t){d=n,l=t},getStreamById:function(n){return i.filter(function(t){return t.getId()===n})[0]},initialize:function(n,t,i){a=n,r=t,u=i,this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.timelineConverter),this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.liveEdgeFinder),this.timeSyncController.subscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this),this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),this.playbackController.subscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED,this),this.subscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED,this.manifestUpdater),this.manifestUpdater.subscribe(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,this),this.manifestUpdater.initialize(this.manifestLoader)},load:function(n){this.manifestLoader.load(n)},loadWithManifest:function(n){this.manifestUpdater.setManifest(n)},reset:function(){var e,p,y,v,l,a;for(n&&b.call(this,n),this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.timelineConverter),this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this.liveEdgeFinder),this.timeSyncController.unsubscribe(MediaPlayer.dependencies.TimeSyncController.eventList.ENAME_TIME_SYNCHRONIZATION_COMPLETED,this),this.timeSyncController.reset(),e=0,p=i.length;p>e;e++)y=i[e],y.unsubscribe(MediaPlayer.dependencies.Stream.eventList.ENAME_STREAM_UPDATED,this),y.reset(h);i=[],this.unsubscribe(MediaPlayer.dependencies.StreamController.eventList.ENAME_STREAMS_COMPOSED,this.manifestUpdater),this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_STARTED,this.manifestUpdater),this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_PAUSED,this.manifestUpdater),this.playbackController.unsubscribe(MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_ENDED,this),this.manifestUpdater.unsubscribe(MediaPlayer.dependencies.ManifestUpdater.eventList.ENAME_MANIFEST_UPDATED,this),this.manifestUpdater.reset(),this.metricsModel.clearAllCurrentMetrics(),v=this.manifestModel.getValue()?this.manifestModel.getValue().url:null,(this.manifestModel.setValue(null),this.timelineConverter.reset(),this.liveEdgeFinder.reset(),this.adapter.reset(),this.virtualBuffer.reset(),f=!1,o=!1,n=null,c=!1,h=!1,t&&(this.mediaSourceExt.detachMediaSource(this.videoModel),t=null),s)?(l={},a=this,l[MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE]=function(){s=!1,r=null,u=null,v&&a.eventBus.dispatchEvent({type:MediaPlayer.events.PROTECTION_DESTROYED,data:v}),a.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE)},r.protectionModel.subscribe(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,l,void 0,!0),r.teardown()):(r.setMediaElement(null),r=null,u=null,this.notify(MediaPlayer.dependencies.StreamController.eventList.ENAME_TEARDOWN_COMPLETE))}}},MediaPlayer.dependencies.StreamController.prototype={constructor:MediaPlayer.dependencies.StreamController},MediaPlayer.dependencies.StreamController.eventList={ENAME_STREAMS_COMPOSED:"streamsComposed",ENAME_TEARDOWN_COMPLETE:"streamTeardownComplete"},MediaPlayer.dependencies.TextController=function(){var r=!1,t=null,n=null,i=null,f=function(){this.notify(MediaPlayer.dependencies.TextController.eventList.ENAME_CLOSED_CAPTIONING_REQUESTED,{CCIndex:0})},u=function(t){var i=this;t.data.fragmentModel===i.streamProcessor.getFragmentModel()&&t.data.chunk.bytes&&i.sourceBufferExt.append(n,t.data.chunk)};return{sourceBufferExt:void 0,log:void 0,system:void 0,errHandler:void 0,videoModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[Dash.dependencies.RepresentationController.eventList.ENAME_DATA_UPDATE_COMPLETED]=f,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_INIT_FRAGMENT_LOADED]=u},initialize:function(n,t,r){var u=this;i=n,u.setMediaSource(t),u.trackController=r.trackController,u.streamProcessor=r},createBuffer:function(u){try{n=this.sourceBufferExt.createSourceBuffer(t,u),r||(n.hasOwnProperty("initialize")&&n.initialize(i,this),r=!0)}catch(f){this.errHandler.mediaSourceError("Error creating "+i+" source buffer.")}return n},getBuffer:function(){return n},setBuffer:function(t){n=t},setMediaSource:function(n){t=n},reset:function(i){i||(this.sourceBufferExt.abort(t,n),this.sourceBufferExt.removeSourceBuffer(t,n))}}},MediaPlayer.dependencies.TextController.prototype={constructor:MediaPlayer.dependencies.TextController},MediaPlayer.dependencies.TextController.eventList={ENAME_CLOSED_CAPTIONING_REQUESTED:"closedCaptioningRequested"},MediaPlayer.dependencies.XlinkController=function(){"use strict";var c,h,n,l,t="onLoad",w="onActuate",i="Period",r="AdaptationSet",u="EventStream",b="urn:mpeg:dash:resolve-to-zero:2013",k=function(r){var u,e=this;l=new X2JS(c,"",!0),n=r,u=f(n.Period_asArray,n,i,t),s.call(e,u,i,t)},s=function(n,t,i){var u,e,f,s=this,r={};for(r.elements=n,r.type=t,r.resolveType=i,0===r.elements.length&&o.call(s,r),f=0;f<r.elements.length;f+=1)u=r.elements[f],e=-1!==u.url.indexOf("http://")?u.url:u.originalContent.BaseURL+u.url,s.xlinkLoader.load(e,u,r)},e=function(n){var t,r,i,f="<response>",e="</response>",u="";t=n.data.element,r=n.data.resolveObject,t.resolvedContent&&(i=t.resolvedContent.indexOf(">")+1,u=t.resolvedContent.substr(0,i)+f+t.resolvedContent.substr(i)+e,t.resolvedContent=l.xml_str2json(u)),v.call(this,r)&&o.call(this,r)},o=function(e){var c,o,h=[];if(p.call(this,e),e.resolveType===w&&this.notify(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,{manifest:n}),e.resolveType===t)switch(e.type){case i:for(c=0;c<n[i+"_asArray"].length;c++)o=n[i+"_asArray"][c],o.hasOwnProperty(r+"_asArray")&&(h=h.concat(f.call(this,o[r+"_asArray"],o,r,t))),o.hasOwnProperty(u+"_asArray")&&(h=h.concat(f.call(this,o[u+"_asArray"],o,u,t)));s.call(this,h,r,t);break;case r:this.notify(MediaPlayer.dependencies.XlinkController.eventList.ENAME_XLINK_READY,{manifest:n})}},f=function(n,t,i,r){for(var f,o,e=[],u=n.length-1;u>=0;u-=1)f=n[u],f.hasOwnProperty("xlink:href")&&f["xlink:href"]===b&&n.splice(u,1);for(u=0;u<n.length;u++)f=n[u],f.hasOwnProperty("xlink:href")&&f.hasOwnProperty("xlink:actuate")&&f["xlink:actuate"]===r&&(o=y(f["xlink:href"],t,i,u,r,f),e.push(o));return e},p=function(t){for(var i,f,s,e,r,u=[],o=t.elements.length-1;o>=0;o--){if(i=t.elements[o],f=i.type+"_asArray",!i.resolvedContent||a())delete i.originalContent["xlink:actuate"],delete i.originalContent["xlink:href"],u.push(i.originalContent);else if(i.resolvedContent)for(e=0;e<i.resolvedContent[f].length;e++)s=i.resolvedContent[f][e],u.push(s);for(i.parentElement[f].splice(i.index,1),r=0;r<u.length;r++)i.parentElement[f].splice(i.index+r,0,u[r]);u=[]}t.elements.length>0&&h.run(n)},y=function(n,t,i,r,u,f){return{url:n,parentElement:t,type:i,index:r,resolveType:u,originalContent:f,resolvedContent:null,resolved:!1}},v=function(n){for(var i,t=0;t<n.elements.length;t++)if(i=n.elements[t],i.resolved===!1)return!1;return!0},a=function(){return!1};return{xlinkLoader:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){e=e.bind(this),this.xlinkLoader.subscribe(MediaPlayer.dependencies.XlinkLoader.eventList.ENAME_XLINKELEMENT_LOADED,this,e)},resolveManifestOnLoad:function(n){k.call(this,n)},setMatchers:function(n){c=n},setIron:function(n){h=n}}},MediaPlayer.dependencies.XlinkController.prototype={constructor:MediaPlayer.dependencies.XlinkController},MediaPlayer.dependencies.XlinkController.eventList={ENAME_XLINK_ALLELEMENTSLOADED:"xlinkAllElementsLoaded",ENAME_XLINK_READY:"xlinkReady"},MediaPlayer.dependencies.MediaSourceExtensions=function(){"use strict"},MediaPlayer.dependencies.MediaSourceExtensions.prototype={constructor:MediaPlayer.dependencies.MediaSourceExtensions,createMediaSource:function(){"use strict";var t="WebKitMediaSource"in window,n="MediaSource"in window;return n?new MediaSource:t?new WebKitMediaSource:null},attachMediaSource:function(n,t){"use strict";var i=window.URL.createObjectURL(n);return t.setSource(i),i},detachMediaSource:function(n){"use strict";n.setSource("")},setDuration:function(n,t){"use strict";return n.duration!=t&&(n.duration=t),n.duration},signalEndOfStream:function(n){"use strict";var i=n.sourceBuffers,r=i.length,t=0;if("open"===n.readyState){for(t;r>t;t+=1)if(i[t].updating)return;n.endOfStream()}}},MediaPlayer.dependencies.ProtectionExtensions=function(){"use strict";this.system=void 0,this.log=void 0,this.keySystems=[],this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0,this.clearkeyKeySystem=void 0},MediaPlayer.dependencies.ProtectionExtensions.prototype={constructor:MediaPlayer.dependencies.ProtectionExtensions,setup:function(){var n;n=this.system.getObject("ksPlayReady"),this.keySystems.push(n),n=this.system.getObject("ksWidevine"),this.keySystems.push(n),n=this.system.getObject("ksClearKey"),this.keySystems.push(n),this.clearkeyKeySystem=n},getKeySystems:function(){return this.keySystems},getKeySystemBySystemString:function(n){for(var t=0;t<this.keySystems.length;t++)if(this.keySystems[t].systemString===n)return this.keySystems[t];return null},isClearKey:function(n){return n===this.clearkeyKeySystem},initDataEquals:function(n,t){if(n.byteLength===t.byteLength){for(var r=new Uint8Array(n),u=new Uint8Array(t),i=0;i<r.length;i++)if(r[i]!==u[i])return!1;return!0}return!1},getSupportedKeySystemsFromContentProtection:function(n){var f,u,t,i,e=[],r;if(n)for(t=0;t<this.keySystems.length;++t)for(u=this.keySystems[t],i=0;i<n.length;++i)(f=n[i],f.schemeIdUri.toLowerCase()===u.schemeIdURI)&&(r=u.getInitData(f),r&&e.push({ks:this.keySystems[t],initData:r}));return e},getSupportedKeySystems:function(n){for(var r=[],i=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(n),t=0;t<this.keySystems.length;++t)this.keySystems[t].uuid in i&&r.push({ks:this.keySystems[t],initData:i[this.keySystems[t].uuid]});return r},requestLicense:function(n,t,i,r,u){var f=null,c,l,h;if(t&&t.hasOwnProperty("drmtoday"))f=this.system.getObject("serverDRMToday");else if("com.widevine.alpha"===n.systemString)f=this.system.getObject("serverWidevine");else if("com.microsoft.playready"===n.systemString)f=this.system.getObject("serverPlayReady");else{if("org.w3.clearkey"!==n.systemString)return void this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,u,"DRM: Unknown key system! -- "+n.keySystemStr);f=this.system.getObject("serverClearKey")}if("org.w3.clearkey"===n.systemString)try{if(c=f.getClearKeysFromProtectionData(t,i),c)return l=new MediaPlayer.vo.protection.LicenseRequestComplete(c,u),void this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,l)}catch(a){return void this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,u,a.message)}var e=new XMLHttpRequest,o=t&&t.laURL&&""!==t.laURL?t.laURL:r,s=this;if(o=f.getServerURLFromMessage(o,i),!o)return void this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,u,"DRM: No license server URL specified!");e.open(f.getHTTPMethod(),o,!0),e.responseType=f.getResponseType(n.systemString),e.onload=function(){if(200==this.status){var t=new MediaPlayer.vo.protection.LicenseRequestComplete(f.getLicenseMessage(this.response,n.systemString),u);s.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,t)}else s.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,u,"DRM: "+n.systemString+' update, XHR status is "'+this.statusText+'" ('+this.status+"), expected to be 200. readyState is "+this.readyState+".  Response is "+(this.response?f.getErrorResponse(this.response,n.systemString):"NONE"))},e.onabort=function(){s.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,u,"DRM: "+n.systemString+' update, XHR aborted. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},e.onerror=function(){s.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_LICENSE_REQUEST_COMPLETE,u,"DRM: "+n.systemString+' update, XHR error. status is "'+this.statusText+'" ('+this.status+"), readyState is "+this.readyState)},h=function(n){var t;if(n)for(t in n)"authorization"===t.toLowerCase()&&(e.withCredentials=!0),e.setRequestHeader(t,n[t])},t&&h(t.httpRequestHeaders),h(n.getRequestHeadersFromMessage(i)),t&&t.withCredentials&&(e.withCredentials=!0),e.send(n.getLicenseRequestFromMessage(i))}},MediaPlayer.dependencies.RequestModifierExtensions=function(){"use strict";return{modifyRequestURL:function(n){return n},modifyRequestHeader:function(n){return n}}},MediaPlayer.dependencies.SourceBufferExtensions=function(){"use strict";this.system=void 0,this.notify=void 0,this.subscribe=void 0,this.unsubscribe=void 0},MediaPlayer.dependencies.SourceBufferExtensions.prototype={constructor:MediaPlayer.dependencies.SourceBufferExtensions,createSourceBuffer:function(n,t){"use strict";var u=this,r=t.codec,i=null;try{i=n.addSourceBuffer(r)}catch(f){if(!t.isText&&-1==r.indexOf('codecs="stpp"'))throw f;i=u.system.getObject("textSourceBuffer")}return i},removeSourceBuffer:function(n,t){"use strict";try{n.removeSourceBuffer(t)}catch(i){}},getBufferRange:function(n,t,i){"use strict";var l,s,r=null,u=0,o=0,f=null,e=null,h=0,c=i||.15;try{r=n.buffered}catch(a){return null}if(null!==r&&void 0!==r){for(s=0,l=r.length;l>s;s+=1)if(u=r.start(s),o=r.end(s),null===f)h=Math.abs(u-t),t>=u&&o>t?(f=u,e=o):c>=h&&(f=u,e=o);else{if(h=u-e,!(c>=h))break;e=o}if(null!==f)return{start:f,end:e}}return null},getAllRanges:function(n){var t=null;try{return t=n.buffered}catch(i){return null}},getTotalBufferedTime:function(n){var u,t,i=this.getAllRanges(n),r=0;if(!i)return r;for(t=0,u=i.length;u>t;t+=1)r+=i.end(t)-i.start(t);return r},getBufferLength:function(n,t,i){"use strict";var r,f,u=this;return r=u.getBufferRange(n,t,i),f=null===r?0:r.end-t},waitForUpdateEnd:function(n,t){"use strict";var i,f=50,u=function(){n.updating||(clearInterval(i),t())},r=function(){n.updating||(n.removeEventListener("updateend",r,!1),t())};if(!n.updating)return void t();if("function"==typeof n.addEventListener)try{n.addEventListener("updateend",r,!1)}catch(e){i=setInterval(u,f)}else i=setInterval(u,f)},append:function(n,t){var i=this,r=t.bytes,u="append"in n?"append":"appendBuffer"in n?"appendBuffer":null;if(u)try{i.waitForUpdateEnd(n,function(){n[u](r,t),i.waitForUpdateEnd(n,function(){i.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,{buffer:n,bytes:r})})})}catch(f){i.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_APPEND_COMPLETED,{buffer:n,bytes:r},new MediaPlayer.vo.Error(f.code,f.message,null))}},remove:function(n,t,i,r){var u=this;try{u.waitForUpdateEnd(n,function(){t>=0&&i>t&&"ended"!==r.readyState&&n.remove(t,i),u.waitForUpdateEnd(n,function(){u.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,{buffer:n,from:t,to:i})})})}catch(f){u.notify(MediaPlayer.dependencies.SourceBufferExtensions.eventList.ENAME_SOURCEBUFFER_REMOVE_COMPLETED,{buffer:n,from:t,to:i},new MediaPlayer.vo.Error(f.code,f.message,null))}},abort:function(n,t){"use strict";try{"open"===n.readyState&&t.abort()}catch(i){}}},MediaPlayer.dependencies.SourceBufferExtensions.QUOTA_EXCEEDED_ERROR_CODE=22,MediaPlayer.dependencies.SourceBufferExtensions.eventList={ENAME_SOURCEBUFFER_REMOVE_COMPLETED:"sourceBufferRemoveCompleted",ENAME_SOURCEBUFFER_APPEND_COMPLETED:"sourceBufferAppendCompleted"},MediaPlayer.utils.TextTrackExtensions=function(){"use strict";var n;return{setup:function(){n=window.VTTCue||window.TextTrackCue},addTextTrack:function(n,t,i,r,u){return this.track=n.addTextTrack("captions",i,r),this.track.default=u,this.track.mode="showing",this.video=n,this.addCaptions(0,t),this.track},addCaptions:function(t,i){var e,u,r,f;for(e in i)r=i[e],f=this.video,"image"==r.type?(u=new n(r.start-t,r.end-t,""),u.image=r.data,u.id=r.id,u.size=0,u.type="image",u.onenter=function(){var n=new Image;n.id="ttmlImage_"+this.id,n.src=this.image,n.className="cue-image",f.parentNode.appendChild(n)},u.onexit=function(){for(var t=f.parentNode.childNodes,n=0;n<t.length;n++)t[n].id=="ttmlImage_"+this.id&&f.parentNode.removeChild(t[n])}):(u=new n(r.start-t,r.end-t,r.data),r.styles&&(void 0!==r.styles.align&&u.hasOwnProperty("align")&&(u.align=r.styles.align),void 0!==r.styles.line&&u.hasOwnProperty("line")&&(u.line=r.styles.line),void 0!==r.styles.position&&u.hasOwnProperty("position")&&(u.position=r.styles.position),void 0!==r.styles.size&&u.hasOwnProperty("size")&&(u.size=r.styles.size))),this.track.addCue(u)},deleteCues:function(n){for(var t=0,r=!1;!r;){if(null!==n.textTracks[t].cues){r=!0;break}t++}var i=n.textTracks[t],u=i.cues,f=u.length-1;for(t=f;t>=0;t--)i.removeCue(u[t]);i.mode="disabled",i.default=!1}}},MediaPlayer.dependencies.VideoModelExtensions=function(){"use strict";return{getPlaybackQuality:function(n){var i="webkitDroppedFrameCount"in n,r="getVideoPlaybackQuality"in n,t=null;return r?t=n.getVideoPlaybackQuality():i&&(t={droppedVideoFrames:n.webkitDroppedFrameCount,creationTime:new Date}),t}}},MediaPlayer.dependencies.VideoModelExtensions.prototype={constructor:MediaPlayer.dependencies.VideoModelExtensions},MediaPlayer.dependencies.FragmentModel=function(){"use strict";var o=null,n=[],i=[],t=[],f=[],e=!1,y=function(n){var t=this;t.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_STARTED,{request:n}),t.fragmentLoader.load(n)},u=function(n,t){var i=n.indexOf(t);-1!==i&&n.splice(i,1)},v=function(n,t,i){for(var o=n.length-1,r=NaN,e=NaN,u=null,f=o;f>=0;f-=1)if(u=n[f],r=u.startTime,e=r+u.duration,i=i||u.duration/2,!isNaN(r)&&!isNaN(e)&&t+i>=r&&e>t-i||isNaN(r)&&isNaN(t))return u;return null},a=function(n,t){return t?t.hasOwnProperty("time")?[v.call(this,n,t.time,t.threshold)]:n.filter(function(n){for(var i in t)if("state"!==i&&t.hasOwnProperty(i)&&n[i]!=t[i])return!1;return!0}):n},p=function(r){var u;switch(r){case MediaPlayer.dependencies.FragmentModel.states.PENDING:u=i;break;case MediaPlayer.dependencies.FragmentModel.states.LOADING:u=t;break;case MediaPlayer.dependencies.FragmentModel.states.EXECUTED:u=n;break;case MediaPlayer.dependencies.FragmentModel.states.REJECTED:u=f;break;default:u=[]}return u},r=function(n,t){if(n){var o=n.mediaType,e=new Date,h=n.type,s=n.startTime,r=n.availabilityStartTime,i=n.duration,f=n.quality,u=n.range;this.metricsModel.addSchedulingInfo(o,e,h,s,r,i,f,u,t)}},h=function(i){var u=i.data.request,e=i.data.response,f=i.error;t.splice(t.indexOf(u),1),e&&!f&&n.push(u),r.call(this,u,f?MediaPlayer.dependencies.FragmentModel.states.FAILED:MediaPlayer.dependencies.FragmentModel.states.EXECUTED),this.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_FRAGMENT_LOADING_COMPLETED,{request:u,response:e},f)},s=function(t){var i=this.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,quality:t.data.quality,index:t.data.index})[0];i&&(u.call(this,n,i),isNaN(t.data.index)||(f.push(i),r.call(this,i,MediaPlayer.dependencies.FragmentModel.states.REJECTED)))},l=function(){e=!0},c=function(){e=!1};return{system:void 0,log:void 0,metricsModel:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN]=l,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED]=c,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BYTES_REJECTED]=s,this[MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_LOADING_COMPLETED]=h},setLoader:function(n){this.fragmentLoader=n},setContext:function(n){o=n},getContext:function(){return o},getIsPostponed:function(){return e},addRequest:function(n){return!n||this.isFragmentLoadedOrPending(n)?!1:(i.push(n),r.call(this,n,MediaPlayer.dependencies.FragmentModel.states.PENDING),!0)},isFragmentLoadedOrPending:function(r){var o=function(n,t){return"complete"===n.action&&n.action===t.action},f=function(n,t){return n.url===t.url&&n.startTime===t.startTime},e=function(n,t){return isNaN(n.index)&&isNaN(t.index)&&n.quality===t.quality},u=function(n){for(var i,u=!1,s=n.length,t=0;s>t;t+=1)if(i=n[t],f(r,i)||e(r,i)||o(r,i)){u=!0;break}return u};return u(i)||u(t)||u(n)},getRequests:function(n){var u,i=[],r=[],f=1,t;if(!n||!n.state)return i;for(n.state instanceof Array?(f=n.state.length,u=n.state):u=[n.state],t=0;f>t;t+=1)i=p.call(this,u[t]),r=r.concat(a.call(this,i,n));return r},getLoadingTime:function(){for(var t,r=0,i=n.length-1;i>=0;i-=1)if(t=n[i],t.requestEndDate instanceof Date&&t.firstByteDate instanceof Date){r=t.requestEndDate.getTime()-t.firstByteDate.getTime();break}return r},removeExecutedRequest:function(t){u.call(this,n,t)},removeRejectedRequest:function(n){u.call(this,f,n)},removeExecutedRequestsBeforeTime:function(t){for(var e=n.length-1,r=NaN,f=null,i=e;i>=0;i-=1)f=n[i],r=f.startTime,!isNaN(r)&&t>r&&u.call(this,n,f)},cancelPendingRequests:function(n){var f=this,u=i,t=u;return i=[],void 0!==n&&(i=u.filter(function(i){return i.quality===n?!1:(t.splice(t.indexOf(i),1),!0)})),t.forEach(function(n){r.call(f,n,MediaPlayer.dependencies.FragmentModel.states.CANCELED)}),t},abortRequests:function(){var n=[];for(this.fragmentLoader.abort();t.length>0;)n.push(t[0]),u.call(this,t,t[0]);return t=[],n},executeRequest:function(u){var f=this,e=i.indexOf(u);if(u&&-1!==e)switch(i.splice(e,1),u.action){case"complete":n.push(u),r.call(f,u,MediaPlayer.dependencies.FragmentModel.states.EXECUTED),f.notify(MediaPlayer.dependencies.FragmentModel.eventList.ENAME_STREAM_COMPLETED,{request:u});break;case"download":t.push(u),r.call(f,u,MediaPlayer.dependencies.FragmentModel.states.LOADING),y.call(f,u);break;default:this.log("Unknown request action.")}},reset:function(){this.abortRequests(),this.cancelPendingRequests(),o=null,n=[],i=[],t=[],f=[],e=!1}}},MediaPlayer.dependencies.FragmentModel.prototype={constructor:MediaPlayer.dependencies.FragmentModel},MediaPlayer.dependencies.FragmentModel.eventList={ENAME_STREAM_COMPLETED:"streamCompleted",ENAME_FRAGMENT_LOADING_STARTED:"fragmentLoadingStarted",ENAME_FRAGMENT_LOADING_COMPLETED:"fragmentLoadingCompleted"},MediaPlayer.dependencies.FragmentModel.states={PENDING:"pending",LOADING:"loading",EXECUTED:"executed",REJECTED:"rejected",CANCELED:"canceled",FAILED:"failed"},MediaPlayer.models.ManifestModel=function(){"use strict";var n;return{system:void 0,eventBus:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,getValue:function(){return n},setValue:function(t){n=t,this.eventBus.dispatchEvent({type:MediaPlayer.events.MANIFEST_LOADED,data:t}),this.notify(MediaPlayer.models.ManifestModel.eventList.ENAME_MANIFEST_UPDATED,{manifest:t})}}},MediaPlayer.models.ManifestModel.prototype={constructor:MediaPlayer.models.ManifestModel},MediaPlayer.models.ManifestModel.eventList={ENAME_MANIFEST_UPDATED:"manifestUpdated"},MediaPlayer.models.MetricsModel=function(){"use strict";return{system:void 0,eventBus:void 0,adapter:void 0,streamMetrics:{},metricsChanged:function(){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRICS_CHANGED,data:{}})},metricChanged:function(n){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_CHANGED,data:{stream:n}}),this.metricsChanged()},metricUpdated:function(n,t,i){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_UPDATED,data:{stream:n,metric:t,value:i}}),this.metricChanged(n)},metricAdded:function(n,t,i){this.eventBus.dispatchEvent({type:MediaPlayer.events.METRIC_ADDED,data:{stream:n,metric:t,value:i}}),this.metricChanged(n)},clearCurrentMetricsForType:function(n){delete this.streamMetrics[n],this.metricChanged(n)},clearAllCurrentMetrics:function(){var n=this;this.streamMetrics={},this.metricsChanged.call(n)},getReadOnlyMetricsFor:function(n){return this.streamMetrics.hasOwnProperty(n)?this.streamMetrics[n]:null},getMetricsFor:function(n){var t;return this.streamMetrics.hasOwnProperty(n)?t=this.streamMetrics[n]:(t=this.system.getObject("metrics"),this.streamMetrics[n]=t),t},addTcpConnection:function(n,t,i,r,u,f){var e=new MediaPlayer.vo.metrics.TCPConnection;return e.tcpid=t,e.dest=i,e.topen=r,e.tclose=u,e.tconnect=f,this.getMetricsFor(n).TcpList.push(e),this.metricAdded(n,this.adapter.metricsList.TCP_CONNECTION,e),e},addHttpRequest:function(n,t,i,r,u,f,e,o,s,h,c,l,a){var v=new MediaPlayer.vo.metrics.HTTPRequest;return v.stream=n,v.tcpid=t,v.type=i,v.url=r,v.actualurl=u,v.range=f,v.trequest=e,v.tresponse=o,v.tfinish=s,v.responsecode=h,v.interval=c,v.mediaduration=l,v.responseHeaders=a,this.getMetricsFor(n).HttpList.push(v),this.metricAdded(n,this.adapter.metricsList.HTTP_REQUEST,v),v},appendHttpTrace:function(n,t,i,r){var u=new MediaPlayer.vo.metrics.HTTPRequest.Trace;return u.s=t,u.d=i,u.b=r,n.trace.push(u),this.metricUpdated(n.stream,this.adapter.metricsList.HTTP_REQUEST_TRACE,n),u},addTrackSwitch:function(n,t,i,r,u){var f=new MediaPlayer.vo.metrics.TrackSwitch;return f.t=t,f.mt=i,f.to=r,f.lto=u,this.getMetricsFor(n).RepSwitchList.push(f),this.metricAdded(n,this.adapter.metricsList.TRACK_SWITCH,f),f},addBufferLevel:function(n,t,i){var r=new MediaPlayer.vo.metrics.BufferLevel;return r.t=t,r.level=i,this.getMetricsFor(n).BufferLevel.push(r),this.metricAdded(n,this.adapter.metricsList.BUFFER_LEVEL,r),r},addBufferState:function(n,t,i){var r=new MediaPlayer.vo.metrics.BufferState;return r.target=i,r.state=t,this.getMetricsFor(n).BufferState.push(r),this.metricAdded(n,this.adapter.metricsList.BUFFER_STATE,r),r},addDVRInfo:function(n,t,i,r){var u=new MediaPlayer.vo.metrics.DVRInfo;return u.time=t,u.range=r,u.manifestInfo=i,this.getMetricsFor(n).DVRInfo.push(u),this.metricAdded(n,this.adapter.metricsList.DVR_INFO,u),u},addDroppedFrames:function(n,t){var r=new MediaPlayer.vo.metrics.DroppedFrames,i=this.getMetricsFor(n).DroppedFrames;return r.time=t.creationTime,r.droppedFrames=t.droppedVideoFrames,i.length>0&&i[i.length-1]==r?i[i.length-1]:(i.push(r),this.metricAdded(n,this.adapter.metricsList.DROPPED_FRAMES,r),r)},addSchedulingInfo:function(n,t,i,r,u,f,e,o,s){var h=new MediaPlayer.vo.metrics.SchedulingInfo;return h.mediaType=n,h.t=t,h.type=i,h.startTime=r,h.availabilityStartTime=u,h.duration=f,h.quality=e,h.range=o,h.state=s,this.getMetricsFor(n).SchedulingInfo.push(h),this.metricAdded(n,this.adapter.metricsList.SCHEDULING_INFO,h),h},addManifestUpdate:function(n,t,i,r,u,f,e,o,s,h){var c=new MediaPlayer.vo.metrics.ManifestUpdate,l=this.getMetricsFor("stream");return c.mediaType=n,c.type=t,c.requestTime=i,c.fetchTime=r,c.availabilityStartTime=u,c.presentationStartTime=f,c.clientTimeOffset=e,c.currentTime=o,c.buffered=s,c.latency=h,l.ManifestUpdate.push(c),this.metricAdded(n,this.adapter.metricsList.MANIFEST_UPDATE,c),c},updateManifestUpdateInfo:function(n,t){if(n){for(var i in t)n[i]=t[i];this.metricUpdated(n.mediaType,this.adapter.metricsList.MANIFEST_UPDATE,n)}},addManifestUpdateStreamInfo:function(n,t,i,r,u){if(n){var f=new MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo;return f.id=t,f.index=i,f.start=r,f.duration=u,n.streamInfo.push(f),this.metricUpdated(n.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_STREAM_INFO,n),f}return null},addManifestUpdateTrackInfo:function(n,t,i,r,u,f,e,o){if(n){var s=new MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo;return s.id=t,s.index=i,s.streamIndex=r,s.mediaType=u,s.startNumber=e,s.fragmentInfoType=o,s.presentationTimeOffset=f,n.trackInfo.push(s),this.metricUpdated(n.mediaType,this.adapter.metricsList.MANIFEST_UPDATE_TRACK_INFO,n),s}return null},addPlayList:function(n,t,i,r){var u=new MediaPlayer.vo.metrics.PlayList;return u.stream=n,u.start=t,u.mstart=i,u.starttype=r,this.getMetricsFor(n).PlayList.push(u),this.metricAdded(n,this.adapter.metricsList.PLAY_LIST,u),u},appendPlayListTrace:function(n,t,i,r,u,f,e,o){var s=new MediaPlayer.vo.metrics.PlayList.Trace;return s.representationid=t,s.subreplevel=i,s.start=r,s.mstart=u,s.duration=f,s.playbackspeed=e,s.stopreason=o,n.trace.push(s),this.metricUpdated(n.stream,this.adapter.metricsList.PLAY_LIST_TRACE,n),s}}},MediaPlayer.models.MetricsModel.prototype={constructor:MediaPlayer.models.MetricsModel},MediaPlayer.models.ProtectionModel={},MediaPlayer.models.ProtectionModel.eventList={ENAME_NEED_KEY:"needkey",ENAME_KEY_SYSTEM_ACCESS_COMPLETE:"keySystemAccessComplete",ENAME_KEY_SYSTEM_SELECTED:"keySystemSelected",ENAME_VIDEO_ELEMENT_SELECTED:"videoElementSelected",ENAME_SERVER_CERTIFICATE_UPDATED:"serverCertificateUpdated",ENAME_KEY_MESSAGE:"keyMessage",ENAME_KEY_ADDED:"keyAdded",ENAME_KEY_ERROR:"keyError",ENAME_KEY_SESSION_CREATED:"keySessionCreated",ENAME_KEY_SESSION_REMOVED:"keySessionRemoved",ENAME_KEY_SESSION_CLOSED:"keySessionClosed",ENAME_KEY_STATUSES_CHANGED:"keyStatusesChanged",ENAME_TEARDOWN_COMPLETE:"protectionTeardownComplete",ENAME_LICENSE_REQUEST_COMPLETE:"licenseRequestComplete"},MediaPlayer.models.ProtectionModel_01b=function(){var e,t=null,n=null,i=[],r=[],s=function(){var t=this;return{handleEvent:function(u){var o=null,s;switch(u.type){case n.needkey:t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(u.initData,"cenc"));break;case n.keyerror:if(o=f(r,u.sessionId),o||(o=f(i,u.sessionId)),o){s="";switch(u.errorCode.code){case 1:s+="MEDIA_KEYERR_UNKNOWN - An unspecified error occurred. This value is used for errors that don't match any of the other codes.";break;case 2:s+="MEDIA_KEYERR_CLIENT - The Key System could not be installed or updated.";break;case 3:s+="MEDIA_KEYERR_SERVICE - The message passed into update indicated an error from the license service.";break;case 4:s+="MEDIA_KEYERR_OUTPUT - There is no available output device with the required characteristics for the content protection system.";break;case 5:s+="MEDIA_KEYERR_HARDWARECHANGE - A hardware configuration change caused a content protection error.";break;case 6:s+="MEDIA_KEYERR_DOMAIN - An error occurred in a multi-device domain licensing configuration. The most common error is a failure to join the domain."}s+="  System Code = "+u.systemCode,t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(o,s))}else t.log("No session token found for key error");break;case n.keyadded:o=f(r,u.sessionId),o||(o=f(i,u.sessionId)),o?t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,o):t.log("No session token found for key added");break;case n.keymessage:e=null!==u.sessionId&&void 0!==u.sessionId,e?(o=f(r,u.sessionId),!o&&i.length>0&&(o=i.shift(),r.push(o),o.sessionID=u.sessionId)):i.length>0&&(o=i.shift(),r.push(o),0!==i.length&&t.errHandler.mediaKeyMessageError("Multiple key sessions were creates with a user-agent that does not support sessionIDs!! Unpredictable behavior ahead!")),o?(o.keyMessage=u.message,t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(o,u.message,u.defaultURL))):t.log("No session token found for key message")}}}},u=null,f=function(n,t){if(t&&n){for(var r=n.length,i=0;r>i;i++)if(n[i].sessionID==t)return n[i];return null}return null},o=function(){t.removeEventListener(n.keyerror,u),t.removeEventListener(n.needkey,u),t.removeEventListener(n.keymessage,u),t.removeEventListener(n.keyadded,u)};return{system:void 0,log:void 0,errHandler:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){u=s.call(this)},init:function(){var t=document.createElement("video");n=MediaPlayer.models.ProtectionModel_01b.detect(t)},teardown:function(){t&&o();for(var n=0;n<r.length;n++)this.closeKeySession(r[n])},getAllInitData:function(){for(var t=[],n=0;n<i.length;n++)t.push(i[n].initData);for(n=0;n<r.length;n++)t.push(r[n].initData);return t},requestKeySystemAccess:function(n){var s=t,h,f,r,u;for(s||(s=document.createElement("video")),h=!1,f=0;f<n.length;f++)for(var l=n[f].ks.systemString,c=n[f].configs,e=null,i=null,o=0;o<c.length;o++){if(r=c[o].videoCapabilities,r&&0!==r.length)for(i=[],u=0;u<r.length;u++)""!==s.canPlayType(r[u].contentType,l)&&i.push(r[u]);if(!(!e&&!i||e&&0===e.length||i&&0===i.length)){h=!0;var y=new MediaPlayer.vo.protection.KeySystemConfiguration(e,i),v=this.protectionExt.getKeySystemBySystemString(l),a=new MediaPlayer.vo.protection.KeySystemAccess(v,y);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,a);break}}h||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(n){this.keySystem=n.keySystem,this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)},setMediaElement:function(i){t&&o(),t=i,t.addEventListener(n.keyerror,u),t.addEventListener(n.needkey,u),t.addEventListener(n.keymessage,u),t.addEventListener(n.keyadded,u),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)},createKeySession:function(u){if(!this.keySystem)throw new Error("Can not create sessions until you have selected a key system");if(e||0===r.length){var f={prototype:(new MediaPlayer.models.SessionToken).prototype,sessionID:null,initData:u,getSessionID:function(){return this.sessionID}};return i.push(f),t[n.generateKeyRequest](this.keySystem.systemString,new Uint8Array(u)),f}throw new Error("Multiple sessions not allowed!");},updateKeySession:function(i,r){var f=i.sessionID,u;if(this.protectionExt.isClearKey(this.keySystem))for(u=0;u<r.keyPairs.length;u++)t[n.addKey](this.keySystem.systemString,r.keyPairs[u].key,r.keyPairs[u].keyID,f);else t[n.addKey](this.keySystem.systemString,r,i.initData,f)},closeKeySession:function(i){t[n.cancelKeyRequest](this.keySystem.systemString,i.sessionID)},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){}}},MediaPlayer.models.ProtectionModel_01b.prototype={constructor:MediaPlayer.models.ProtectionModel_01b},MediaPlayer.models.ProtectionModel_01b.APIs=[{generateKeyRequest:"generateKeyRequest",addKey:"addKey",cancelKeyRequest:"cancelKeyRequest",needkey:"needkey",keyerror:"keyerror",keyadded:"keyadded",keymessage:"keymessage"},{generateKeyRequest:"webkitGenerateKeyRequest",addKey:"webkitAddKey",cancelKeyRequest:"webkitCancelKeyRequest",needkey:"webkitneedkey",keyerror:"webkitkeyerror",keyadded:"webkitkeyadded",keymessage:"webkitkeymessage"}],MediaPlayer.models.ProtectionModel_01b.detect=function(n){for(var t,r=MediaPlayer.models.ProtectionModel_01b.APIs,i=0;i<r.length;i++)if(t=r[i],"function"==typeof n[t.generateKeyRequest]&&"function"==typeof n[t.addKey]&&"function"==typeof n[t.cancelKeyRequest])return t;return null},MediaPlayer.models.ProtectionModel_21Jan2015=function(){var n=null,t=null,i=[],e=function(n,t){var i=this;!function(t){var r=n[t].ks,u=n[t].configs;navigator.requestMediaKeySystemAccess(r.systemString,u).then(function(n){var u="function"==typeof n.getConfiguration?n.getConfiguration():null,t=new MediaPlayer.vo.protection.KeySystemAccess(r,u);t.mksa=n,i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,t)}).catch(function(){++t<n.length?e.call(i,n,t):i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied!")})}(t)},o=function(n){var t=n.session;return t.removeEventListener("keystatuseschange",n),t.removeEventListener("message",n),t.close()},s=function(){var n=this;return{handleEvent:function(t){switch(t.type){case"encrypted":t.initData&&n.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(t.initData,t.initDataType))}}}},r=null,u=function(n){for(var t=0;t<i.length;t++)if(i[t]===n){i.splice(t,1);break}},f=function(n,t){var f=this,r={prototype:(new MediaPlayer.models.SessionToken).prototype,session:n,initData:t,handleEvent:function(n){switch(n.type){case"keystatuseschange":f.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_STATUSES_CHANGED,this);break;case"message":f.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,n.message,void 0,n.messageType))}},getSessionID:function(){return this.session.sessionId},getExpirationTime:function(){return this.session.expiration},getKeyStatuses:function(){return this.session.keyStatuses}};return n.addEventListener("keystatuseschange",r),n.addEventListener("message",r),n.closed.then(function(){u(r),f.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,r.getSessionID())}),i.push(r),r};return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){r=s.call(this)},init:function(){},teardown:function(){var f,h=i.length,s=this,e,t;if(0!==h)for(e=function(t){u(t),0===i.length&&(n?(n.removeEventListener("encrypted",r),n.setMediaKeys(null).then(function(){s.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)})):s.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE))},t=0;h>t;t++)f=i[t],function(n){f.session.closed.then(function(){e(n)}),o(f).catch(function(){e(n)})}(f);else this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)},getAllInitData:function(){for(var t=[],n=0;n<i.length;n++)t.push(i[n].initData);return t},requestKeySystemAccess:function(n){e.call(this,n,0)},selectKeySystem:function(i){var r=this;i.mksa.createMediaKeys().then(function(u){r.keySystem=i.keySystem,t=u,n&&n.setMediaKeys(t),r.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}).catch(function(){r.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+i.keySystem.systemString+")! Could not create MediaKeys -- TODO")})},setMediaElement:function(i){n!==i&&(n&&(n.removeEventListener("encrypted",r),n.setMediaKeys(null)),n=i,n&&(n.addEventListener("encrypted",r),t&&n.setMediaKeys(t)))},setServerCertificate:function(n){if(!this.keySystem||!t)throw new Error("Can not set server certificate until you have selected a key system");var i=this;t.setServerCertificate(n).then(function(){i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED)}).catch(function(n){i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_SERVER_CERTIFICATE_UPDATED,null,"Error updating server certificate -- "+n.name)})},createKeySession:function(n,i){if(!this.keySystem||!t)throw new Error("Can not create sessions until you have selected a key system");var o=t.createSession(i),e=f.call(this,o,n),r=this;o.generateRequest("cenc",n).then(function(){r.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,e)}).catch(function(n){u(e),r.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Error generating key request -- "+n.name)})},updateKeySession:function(n,t){var r=n.session,i=this;this.protectionExt.isClearKey(this.keySystem)&&(t=t.toJWK()),r.update(t).catch(function(t){i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(n,"Error sending update() message! "+t.name))})},loadKeySession:function(n){if(!this.keySystem||!t)throw new Error("Can not load sessions until you have selected a key system");var r=t.createSession(),i=this;r.load(n).then(function(t){if(t){var u=f.call(this,r);i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,u)}else i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Could not load session! Invalid Session ID ("+n+")")}).catch(function(t){i.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,null,"Could not load session ("+n+")! "+t.name)})},removeKeySession:function(n){var i=n.session,t=this;i.remove().then(function(){t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,n.getSessionID())}).catch(function(i){t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_REMOVED,null,"Error removing session ("+n.getSessionID()+"). "+i.name)})},closeKeySession:function(n){var t=this;o(n).catch(function(i){u(n),t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,null,"Error closing session ("+n.getSessionID()+") "+i.name)})}}},MediaPlayer.models.ProtectionModel_21Jan2015.detect=function(n){return void 0===n.onencrypted||void 0===n.mediaKeys?!1:void 0===navigator.requestMediaKeySystemAccess||"function"!=typeof navigator.requestMediaKeySystemAccess?!1:!0},MediaPlayer.models.ProtectionModel_21Jan2015.prototype={constructor:MediaPlayer.models.ProtectionModel_21Jan2015},MediaPlayer.models.ProtectionModel_3Feb2014=function(){var t=null,r=null,f=null,n=null,i=[],s=function(){var t=this;return{handleEvent:function(i){switch(i.type){case n.needkey:i.initData&&t.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_NEED_KEY,new MediaPlayer.vo.protection.NeedKey(i.initData,"cenc"))}}}},u=null,e=function(){var i=null,u=function(){t.removeEventListener("loadedmetadata",i),t[n.setMediaKeys](r),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_VIDEO_ELEMENT_SELECTED)};t.readyState>=1?u.call(this):(i=u.bind(this),t.addEventListener("loadedmetadata",i))},o=function(t,i){var r=this;return{prototype:(new MediaPlayer.models.SessionToken).prototype,session:t,initData:i,handleEvent:function(t){switch(t.type){case n.error:var i="KeyError";r.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ERROR,new MediaPlayer.vo.protection.KeyError(this,i));break;case n.message:r.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_MESSAGE,new MediaPlayer.vo.protection.KeyMessage(this,t.message,t.destinationURL));break;case n.ready:r.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_ADDED,this);break;case n.close:r.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CLOSED,this.getSessionID())}},getSessionID:function(){return this.session.sessionId}}};return{system:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,protectionExt:void 0,keySystem:null,setup:function(){u=s.call(this)},init:function(){var t=document.createElement("video");n=MediaPlayer.models.ProtectionModel_3Feb2014.detect(t)},teardown:function(){try{for(var r=0;r<i.length;r++)this.closeKeySession(i[r]);t&&t.removeEventListener(n.needkey,u),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE)}catch(f){this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_TEARDOWN_COMPLETE,null,"Error tearing down key sessions and MediaKeys! -- "+f.message)}},getAllInitData:function(){for(var t=[],n=0;n<i.length;n++)t.push(i[n].initData);return t},requestKeySystemAccess:function(t){for(var f,i,e,o,c=!1,s=0;s<t.length;s++)for(var l=t[s].ks.systemString,a=t[s].configs,r=null,u=null,h=0;h<a.length;h++){if(f=a[h].audioCapabilities,i=a[h].videoCapabilities,f&&0!==f.length)for(r=[],e=0;e<f.length;e++)window[n.MediaKeys].isTypeSupported(l,f[e].contentType)&&r.push(f[e]);if(i&&0!==i.length)for(u=[],o=0;o<i.length;o++)window[n.MediaKeys].isTypeSupported(l,i[o].contentType)&&u.push(i[o]);if(!(!r&&!u||r&&0===r.length||u&&0===u.length)){c=!0;var p=new MediaPlayer.vo.protection.KeySystemConfiguration(r,u),y=this.protectionExt.getKeySystemBySystemString(l),v=new MediaPlayer.vo.protection.KeySystemAccess(y,p);this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,v);break}}c||this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_ACCESS_COMPLETE,null,"Key system access denied! -- No valid audio/video content configurations detected!")},selectKeySystem:function(i){try{r=i.mediaKeys=new window[n.MediaKeys](i.keySystem.systemString),this.keySystem=i.keySystem,f=i,t&&e.call(this),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED)}catch(u){this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SYSTEM_SELECTED,null,"Error selecting keys system ("+this.keySystem.systemString+")! Could not create MediaKeys -- TODO")}},setMediaElement:function(i){t!==i&&(t&&t.removeEventListener(n.needkey,u),t=i,t&&(t.addEventListener(n.needkey,u),r&&e.call(this)))},createKeySession:function(t){if(!this.keySystem||!r||!f)throw new Error("Can not create sessions until you have selected a key system");var s=f.ksConfiguration.videoCapabilities[0].contentType,e=r.createSession(s,new Uint8Array(t)),u=o.call(this,e,t);e.addEventListener(n.error,u),e.addEventListener(n.message,u),e.addEventListener(n.ready,u),e.addEventListener(n.close,u),i.push(u),this.notify(MediaPlayer.models.ProtectionModel.eventList.ENAME_KEY_SESSION_CREATED,u)},updateKeySession:function(n,t){var i=n.session;i.update(this.protectionExt.isClearKey(this.keySystem)?new Uint8Array(t.toJWK()):t)},closeKeySession:function(t){var u=t.session,r;for(u.removeEventListener(n.error,t),u.removeEventListener(n.message,t),u.removeEventListener(n.ready,t),u.removeEventListener(n.close,t),r=0;r<i.length;r++)if(i[r]===t){i.splice(r,1);break}u[n.release]()},setServerCertificate:function(){},loadKeySession:function(){},removeKeySession:function(){}}},MediaPlayer.models.ProtectionModel_3Feb2014.APIs=[{setMediaKeys:"setMediaKeys",MediaKeys:"MediaKeys",release:"close",needkey:"needkey",error:"keyerror",message:"keymessage",ready:"keyadded",close:"keyclose"},{setMediaKeys:"msSetMediaKeys",MediaKeys:"MSMediaKeys",release:"close",needkey:"msneedkey",error:"mskeyerror",message:"mskeymessage",ready:"mskeyadded",close:"mskeyclose"}],MediaPlayer.models.ProtectionModel_3Feb2014.detect=function(n){for(var i,r=MediaPlayer.models.ProtectionModel_3Feb2014.APIs,t=0;t<r.length;t++)if(i=r[t],"function"==typeof n[i.setMediaKeys]&&"function"==typeof window[i.MediaKeys])return i;return null},MediaPlayer.models.ProtectionModel_3Feb2014.prototype={constructor:MediaPlayer.models.ProtectionModel_3Feb2014},MediaPlayer.models.URIQueryAndFragmentModel=function(){"use strict";var t=new MediaPlayer.vo.URIFragmentData,n=[],i=function(i){function d(n,t,i,r){var u=r[0].split(/[=]/);return r.push({key:u[0],value:u[1]}),r.shift(),r}function e(t,i,e){return i>0&&(u&&0===n.length?n=e[i].split(/[&]/):f&&(r=e[i].split(/[&]/))),e}if(!i)return null;var o,r=[],s=new RegExp(/[?]/),e=new RegExp(/[#]/),u=s.test(i),f=e.test(i);return o=i.split(/[?#]/).map(e),n.length>0&&(n=n.reduce(d,null)),r.length>0&&(r=r.reduce(d,null),r.forEach(function(n){t[n.key]=n.value})),i};return{parseURI:i,getURIFragmentData:function(){return t},getURIQueryData:function(){return n},reset:function(){t=new MediaPlayer.vo.URIFragmentData,n=[]}}},MediaPlayer.models.URIQueryAndFragmentModel.prototype={constructor:MediaPlayer.models.URIQueryAndFragmentModel},MediaPlayer.models.VideoModel=function(){"use strict";var n,t=[],u=function(){return t.length>0},f=function(i){null===i||n.seeking||(this.setPlaybackRate(0),t[i]!==!0&&(t.push(i),t[i]=!0))},i=function(n){if(null!==n){t[n]=!1;var i=t.indexOf(n);-1!==i&&t.splice(i,1),u()===!1&&this.setPlaybackRate(1)}},r=function(n,t){t?f.call(this,n):i.call(this,n)};return{system:void 0,play:function(){n.play()},pause:function(){n.pause()},isPaused:function(){return n.paused},getPlaybackRate:function(){return n.playbackRate},setPlaybackRate:function(t){!n||n.readyState<2||(n.playbackRate=t)},getCurrentTime:function(){return n.currentTime},setCurrentTime:function(t){if(n.currentTime!=t)try{n.currentTime=t}catch(i){0===n.readyState&&i.code===i.INVALID_STATE_ERR&&setTimeout(function(){n.currentTime=t},400)}},setStallState:function(n,t){r.call(this,n,t)},listen:function(t,i){n.addEventListener(t,i,!1)},unlisten:function(t,i){n.removeEventListener(t,i,!1)},getElement:function(){return n},setElement:function(t){n=t},setSource:function(t){n.src=t}}},MediaPlayer.models.VideoModel.prototype={constructor:MediaPlayer.models.VideoModel},MediaPlayer.dependencies.protection.CommonEncryption={findCencContentProtection:function(n){for(var i,r=null,t=0;t<n.length;++t)i=n[t],"urn:mpeg:dash:mp4protection:2011"===i.schemeIdUri.toLowerCase()&&"cenc"===i.value.toLowerCase()&&(r=i);return r},getPSSHData:function(n){return n.slice(32)},getPSSHForKeySystem:function(n,t){var i=MediaPlayer.dependencies.protection.CommonEncryption.parsePSSHList(t);return i.hasOwnProperty(n.uuid.toLowerCase())?i[n.uuid.toLowerCase()]:null},parseInitDataFromContentProtection:function(n){return"pssh"in n?BASE64.decodeArray(n.pssh.__text).buffer:null},parsePSSHList:function(n){var h,e,o,u,l,s,i,r;if(null===n)return[];for(var f=new DataView(n),a=!1,c={},t=0;!a;){if(s=t,t>=f.buffer.byteLength)break;if(h=f.getUint32(t),e=t+h,t+=4,1886614376===f.getUint32(t))if(t+=4,o=f.getUint8(t),0===o||1===o){for(t+=1,t+=3,u="",i=0;4>i;i++)r=f.getUint8(t+i).toString(16),u+=1===r.length?"0"+r:r;for(t+=4,u+="-",i=0;2>i;i++)r=f.getUint8(t+i).toString(16),u+=1===r.length?"0"+r:r;for(t+=2,u+="-",i=0;2>i;i++)r=f.getUint8(t+i).toString(16),u+=1===r.length?"0"+r:r;for(t+=2,u+="-",i=0;2>i;i++)r=f.getUint8(t+i).toString(16),u+=1===r.length?"0"+r:r;for(t+=2,u+="-",i=0;6>i;i++)r=f.getUint8(t+i).toString(16),u+=1===r.length?"0"+r:r;t+=6,u=u.toLowerCase(),l=f.getUint32(t),t+=4,c[u]=f.buffer.slice(s,e),t=e}else t=e;else t=e}return c}},MediaPlayer.dependencies.protection.KeySystem={},MediaPlayer.dependencies.protection.KeySystem_Access=function(){"use strict"},MediaPlayer.dependencies.protection.KeySystem_Access.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Access},MediaPlayer.dependencies.protection.KeySystem_ClearKey=function(){"use strict";var t="org.w3.clearkey",n="1077efec-c0b2-4d02-ace3-3c1e52e2fb4b";return{system:void 0,schemeIdURI:"urn:uuid:"+n,systemString:t,uuid:n,getInitData:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(n){return new Uint8Array(n)}}},MediaPlayer.dependencies.protection.KeySystem_ClearKey.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_ClearKey},MediaPlayer.dependencies.protection.KeySystem_PlayReady=function(){"use strict";var r="com.microsoft.playready",n="9a04f079-9840-4286-ab92-e65be0885f95",u=function(n){var f,i,u={},e=new DOMParser;f=String.fromCharCode.apply(null,new Uint16Array(n.buffer)),i=e.parseFromString(f,"application/xml");for(var r=i.getElementsByTagName("name"),o=i.getElementsByTagName("value"),t=0;t<r.length;t++)u[r[t].childNodes[0].nodeValue]=o[t].childNodes[0].nodeValue;return u},t=function(n){var r,i,f=new DOMParser,u=null,t;return(r=String.fromCharCode.apply(null,new Uint16Array(n.buffer)),i=f.parseFromString(r,"application/xml"),i.getElementsByTagName("Challenge")[0])&&(t=i.getElementsByTagName("Challenge")[0].childNodes[0].nodeValue,t&&(u=BASE64.decode(t))),u},i=function(n){var u,h,e,i,s,t=0,o=new Uint8Array([112,115,115,104,0,0,0,0]),f=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]),r=null;if("pssh"in n)return MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection(n);if("pro"in n)r=BASE64.decodeArray(n.pro.__text);else{if(!("prheader"in n))return null;r=BASE64.decodeArray(n.prheader.__text)}return u=r.length,h=4+o.length+f.length+4+u,e=new ArrayBuffer(h),i=new Uint8Array(e),s=new DataView(e),s.setUint32(t,h),t+=4,i.set(o,t),t+=o.length,i.set(f,t),t+=f.length,s.setUint32(t,u),t+=4,i.set(r,t),t+=u,i.buffer};return{schemeIdURI:"urn:uuid:"+n,systemString:r,uuid:n,getInitData:i,getRequestHeadersFromMessage:u,getLicenseRequestFromMessage:t}},MediaPlayer.dependencies.protection.KeySystem_PlayReady.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_PlayReady},MediaPlayer.dependencies.protection.KeySystem_Widevine=function(){"use strict";var t="com.widevine.alpha",n="edef8ba9-79d6-4ace-a3c8-27dcd51d21ed";return{schemeIdURI:"urn:uuid:"+n,systemString:t,uuid:n,getInitData:MediaPlayer.dependencies.protection.CommonEncryption.parseInitDataFromContentProtection,getRequestHeadersFromMessage:function(){return null},getLicenseRequestFromMessage:function(n){return new Uint8Array(n)}}},MediaPlayer.dependencies.protection.KeySystem_Widevine.prototype={constructor:MediaPlayer.dependencies.protection.KeySystem_Widevine},MediaPlayer.dependencies.protection.servers.ClearKey=function(){"use strict";return{getServerURLFromMessage:function(n,t){var r=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),i;for(n+="/?",i=0;i<r.kids.length;i++)n+=r.kids[i]+"&";return n=n.substring(0,n.length-1)},getHTTPMethod:function(){return"GET"},getResponseType:function(){return"json"},getLicenseMessage:function(n){var t,i;if(!n.hasOwnProperty("keys"))return null;for(i=[],t=0;t<n.keys.length;t++){var r=n.keys[t],f=r.kid.replace(/=/g,""),u=r.k.replace(/=/g,"");i.push(new MediaPlayer.vo.protection.KeyPair(f,u))}return new MediaPlayer.vo.protection.ClearKeyKeySet(i)},getErrorResponse:function(n){return String.fromCharCode.apply(null,new Uint8Array(n))},getClearKeysFromProtectionData:function(n,t){var e=null,i,u;if(n){for(var f=JSON.parse(String.fromCharCode.apply(null,new Uint8Array(t))),o=[],r=0;r<f.kids.length;r++){if(i=f.kids[r],u=n.clearkeys.hasOwnProperty(i)?n.clearkeys[i]:null,!u)throw new Error("DRM: ClearKey keyID ("+i+") is not known!");o.push(new MediaPlayer.vo.protection.KeyPair(i,u))}e=new MediaPlayer.vo.protection.ClearKeyKeySet(o)}return e}}},MediaPlayer.dependencies.protection.servers.ClearKey.prototype={constructor:MediaPlayer.dependencies.protection.servers.ClearKey},MediaPlayer.dependencies.protection.servers.DRMToday=function(){"use strict";var n={"com.widevine.alpha":{responseType:"json",getLicenseMessage:function(n){return new Uint8Array(BASE64.decodeArray(n.license))},getErrorResponse:function(n){return n}},"com.microsoft.playready":{responseType:"arraybuffer",getLicenseMessage:function(n){return new Uint8Array(n)},getErrorResponse:function(n){return String.fromCharCode.apply(null,new Uint8Array(n))}}};return{getServerURLFromMessage:function(n){return n},getHTTPMethod:function(){return"POST"},getResponseType:function(t){return n[t].responseType},getLicenseMessage:function(t,i){return n[i].getLicenseMessage(t)},getErrorResponse:function(t,i){return n[i].getErrorResponse(t)}}},MediaPlayer.dependencies.protection.servers.DRMToday.prototype={constructor:MediaPlayer.dependencies.protection.servers.DRMToday},MediaPlayer.dependencies.protection.servers.PlayReady=function(){"use strict";return{getServerURLFromMessage:function(n){return n},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(n){return new Uint8Array(n)},getErrorResponse:function(n){return String.fromCharCode.apply(null,new Uint8Array(n))}}},MediaPlayer.dependencies.protection.servers.PlayReady.prototype={constructor:MediaPlayer.dependencies.protection.servers.PlayReady},MediaPlayer.dependencies.protection.servers.Widevine=function(){"use strict";return{getServerURLFromMessage:function(n){return n},getHTTPMethod:function(){return"POST"},getResponseType:function(){return"arraybuffer"},getLicenseMessage:function(n){return new Uint8Array(n)},getErrorResponse:function(n){return String.fromCharCode.apply(null,new Uint8Array(n))}}},MediaPlayer.dependencies.protection.servers.Widevine.prototype={constructor:MediaPlayer.dependencies.protection.servers.Widevine},MediaPlayer.rules.ABRRulesCollection=function(){"use strict";var n=[],t=[];return{insufficientBufferRule:void 0,bufferOccupancyRule:void 0,throughputRule:void 0,abandonRequestRule:void 0,getRules:function(i){switch(i){case MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES:return n;case MediaPlayer.rules.ABRRulesCollection.prototype.ABANDON_FRAGMENT_RULES:return t;default:return null}},setup:function(){n.push(this.insufficientBufferRule),n.push(this.throughputRule),n.push(this.bufferOccupancyRule),t.push(this.abandonRequestRule)}}},MediaPlayer.rules.ABRRulesCollection.prototype={constructor:MediaPlayer.rules.ABRRulesCollection,QUALITY_SWITCH_RULES:"qualitySwitchRules",ABANDON_FRAGMENT_RULES:"abandonFragmentRules"},MediaPlayer.rules.AbandonRequestsRule=function(){"use strict";var u=500,r=1.5,n={},t={},i=function(t,i){n[t]=n[t]||{},n[t][i]=n[t][i]||{}};return{metricsExt:void 0,log:void 0,execute:function(f,e){var o,y=+new Date,a=f.getMediaInfo(),h=a.type,v=f.getCurrentValue(),p=f.getTrackInfo(),s=v.data.request,w=f.getStreamProcessor().getABRController(),c=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK),l;if(!isNaN(s.index)){if(i(h,s.index),o=n[h][s.index],null===o||null===s.firstByteDate||t.hasOwnProperty(o.id))return void e(c);if(void 0===o.firstByteTime&&(o.firstByteTime=s.firstByteDate.getTime(),o.segmentDuration=s.duration,o.bytesTotal=s.bytesTotal,o.id=s.index),o.bytesLoaded=s.bytesLoaded,o.elapsedTime=y-o.firstByteTime,o.bytesLoaded<o.bytesTotal&&o.elapsedTime>=u){if(o.measuredBandwidthInKbps=Math.round(8*o.bytesLoaded/o.elapsedTime),o.estimatedTimeOfDownload=(8*o.bytesTotal*.001/o.measuredBandwidthInKbps).toFixed(2),o.estimatedTimeOfDownload<o.segmentDuration*r||0===p.quality)return void e(c);t.hasOwnProperty(o.id)||(l=w.getQualityForBitrate(a,o.measuredBandwidthInKbps*MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY),c=new MediaPlayer.rules.SwitchRequest(l,MediaPlayer.rules.SwitchRequest.prototype.STRONG),t[o.id]=o,this.log("AbandonRequestsRule ( ",h,"frag id",o.id,") is asking to abandon and switch to quality to ",l," measured bandwidth was",o.measuredBandwidthInKbps),delete n[h][o.id])}else o.bytesLoaded===o.bytesTotal&&delete n[h][o.id]}e(c)},reset:function(){n={},t={}}}},MediaPlayer.rules.AbandonRequestsRule.prototype={constructor:MediaPlayer.rules.AbandonRequestsRule},MediaPlayer.rules.BufferOccupancyRule=function(){"use strict";var n=0;return{log:void 0,metricsModel:void 0,execute:function(t,i){var p=this,y=+new Date/1e3,s=t.getMediaInfo(),h=t.getTrackInfo(),o=s.type,v=isNaN(h.fragmentDuration)?2:h.fragmentDuration/2,l=t.getCurrentValue(),b=t.getStreamProcessor(),w=b.getABRController(),u=this.metricsModel.getReadOnlyMetricsFor(o),e=u.BufferLevel.length>0?u.BufferLevel[u.BufferLevel.length-1]:null,f=u.BufferState.length>0?u.BufferState[u.BufferState.length-1]:null,c=!1,a=s.trackCount-1,r=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);return v>y-n||w.getAbandonmentStateFor(o)===MediaPlayer.dependencies.AbrController.ABANDON_LOAD?void i(r):(null!==e&&null!==f&&e.level>f.target&&(c=e.level-f.target>MediaPlayer.dependencies.BufferController.RICH_BUFFER_THRESHOLD,c&&s.trackCount>1&&(r=new MediaPlayer.rules.SwitchRequest(a,MediaPlayer.rules.SwitchRequest.prototype.STRONG))),r.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&r.value!==l&&p.log("BufferOccupancyRule requesting switch to index: ",r.value,"type: ",o," Priority: ",r.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":r.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak"),void i(r))},reset:function(){n=0}}},MediaPlayer.rules.BufferOccupancyRule.prototype={constructor:MediaPlayer.rules.BufferOccupancyRule},MediaPlayer.rules.InsufficientBufferRule=function(){"use strict";var n={},t=0,u=1e3,r=function(t,i){n[t]=n[t]||{},n[t].state=i,i!==MediaPlayer.dependencies.BufferController.BUFFER_LOADED||n[t].firstBufferLoadedEvent||(n[t].firstBufferLoadedEvent=!0)},i=function(){n={}};return{log:void 0,metricsModel:void 0,playbackController:void 0,setup:function(){this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=i},execute:function(i,f){var c=this,l=+new Date,o=i.getMediaInfo().type,a=i.getCurrentValue(),s=c.metricsModel.getReadOnlyMetricsFor(o),h=s.BufferState.length>0?s.BufferState[s.BufferState.length-1]:null,e=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK);return u>l-t||null===h?void f(e):(r(o,h.state),h.state===MediaPlayer.dependencies.BufferController.BUFFER_EMPTY&&void 0!==n[o].firstBufferLoadedEvent&&(e=new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG)),e.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&e.value!==a&&c.log("InsufficientBufferRule requesting switch to index: ",e.value,"type: ",o," Priority: ",e.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":e.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak"),t=l,void f(e))},reset:function(){n={},t=0}}},MediaPlayer.rules.InsufficientBufferRule.prototype={constructor:MediaPlayer.rules.InsufficientBufferRule},MediaPlayer.rules.ThroughputRule=function(){"use strict";var n=[],t=0,u=2,f=3,i=function(t,i){n[t]=n[t]||[],1/0!==i&&i!==n[t][n[t].length-1]&&n[t].push(i)},r=function(t,i){var c=0,r=i?u:f,o=n[t],e=o.length;if(r=r>e?e:r,e>0){for(var l=e-r,h=0,s=l;e>s;s++)h+=o[s];c=h/r}return o.length>r&&o.shift(),c*MediaPlayer.dependencies.AbrController.BANDWIDTH_SAFETY};return{log:void 0,metricsExt:void 0,metricsModel:void 0,manifestExt:void 0,manifestModel:void 0,execute:function(n,u){var w,h,k,c=this,it=+new Date/1e3,b=n.getMediaInfo(),s=b.type,tt=n.getCurrentValue(),g=n.getTrackInfo(),e=c.metricsModel.getReadOnlyMetricsFor(s),d=n.getStreamProcessor(),l=d.getABRController(),a=d.isDynamic(),o=c.metricsExt.getCurrentHttpRequest(e),nt=isNaN(g.fragmentDuration)?2:g.fragmentDuration/2,p=e.BufferState.length>0?e.BufferState[e.BufferState.length-1]:null,y=e.BufferLevel.length>0?e.BufferLevel[e.BufferLevel.length-1]:null,f=new MediaPlayer.rules.SwitchRequest(MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,MediaPlayer.rules.SwitchRequest.prototype.WEAK),v;if(nt>it-t||!e||null===o||o.type!==MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE||null===p||null===y)return void u(f);(w=(o.tfinish.getTime()-o.tresponse.getTime())/1e3,k=Math.round(8*o.trace[o.trace.length-1].b/w),i(s,k),h=Math.round(r(s,a)),l.getAbandonmentStateFor(s)!==MediaPlayer.dependencies.AbrController.ABANDON_LOAD)&&(p.state===MediaPlayer.dependencies.BufferController.BUFFER_LOADED&&(y.level>=2*MediaPlayer.dependencies.BufferController.LOW_BUFFER_THRESHOLD||a)&&(v=l.getQualityForBitrate(b,h/1e3),f=new MediaPlayer.rules.SwitchRequest(v,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)),f.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&f.value!==tt&&c.log("ThroughputRule requesting switch to index: ",f.value,"type: ",s," Priority: ",f.priority===MediaPlayer.rules.SwitchRequest.prototype.DEFAULT?"Default":f.priority===MediaPlayer.rules.SwitchRequest.prototype.STRONG?"Strong":"Weak","Average throughput",Math.round(h/1024),"kbps")),u(f)},reset:function(){n=[],t=0}}},MediaPlayer.rules.ThroughputRule.prototype={constructor:MediaPlayer.rules.ThroughputRule},MediaPlayer.rules.RulesContext=function(n,t){"use strict";var i=n.getCurrentTrack(),r=n;return{getStreamInfo:function(){return i.mediaInfo.streamInfo},getMediaInfo:function(){return i.mediaInfo},getTrackInfo:function(){return i},getCurrentValue:function(){return t},getManifestInfo:function(){return i.mediaInfo.streamInfo.manifestInfo},getStreamProcessor:function(){return r}}},MediaPlayer.rules.RulesContext.prototype={constructor:MediaPlayer.rules.RulesContext},MediaPlayer.rules.RulesController=function(){"use strict";var n={},r=["execute"],u=function(n){return n===this.SCHEDULING_RULE||n===this.ABR_RULE},t=function(n){var i=r.length,t=0;for(t;i>t;t+=1)if(!n.hasOwnProperty(r[t]))return!1;return!0},f=function(n,t){return new MediaPlayer.rules.RulesContext(n,t)},e=function(n){var t=n.execute.bind(n);return n.execute=function(i,r){var u=function(t){r.call(n,new MediaPlayer.rules.SwitchRequest(t.value,t.priority))};t(i,u)},"function"!=typeof n.reset&&(n.reset=function(){}),n},i=function(n,i,r){var u,o,h,s,c,f;for(o in i)if(s=i[o],c=s.length)for(f=0;c>f;f+=1)u=s[f],t.call(this,u)&&(u=e.call(this,u),h=n.getRules(o),r&&(r=!1,h.length=0),this.system.injectInto(u),h.push(u))};return{system:void 0,log:void 0,SCHEDULING_RULE:0,ABR_RULE:1,SYNC_RULE:2,initialize:function(){n[this.ABR_RULE]=this.system.getObject("abrRulesCollection"),n[this.SCHEDULING_RULE]=this.system.getObject("scheduleRulesCollection"),n[this.SYNC_RULE]=this.system.getObject("synchronizationRulesCollection")},setRules:function(t,r){u.call(this,t)&&r&&i.call(this,n[t],r,!0)},addRules:function(t,r){u.call(this,t)&&r&&i.call(this,n[t],r,!1)},applyRules:function(n,i,r,u,e){var c,s,h=n.length,v=h,o={},a=f.call(this,i,u),l=function(n){var i,t;n.value!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(o[n.priority]=e(o[n.priority],n.value)),--h||(o[MediaPlayer.rules.SwitchRequest.prototype.WEAK]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(t=MediaPlayer.rules.SwitchRequest.prototype.WEAK,i=o[MediaPlayer.rules.SwitchRequest.prototype.WEAK]),o[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(t=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,i=o[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]),o[MediaPlayer.rules.SwitchRequest.prototype.STRONG]!==MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE&&(t=MediaPlayer.rules.SwitchRequest.prototype.STRONG,i=o[MediaPlayer.rules.SwitchRequest.prototype.STRONG]),t!=MediaPlayer.rules.SwitchRequest.prototype.STRONG&&t!=MediaPlayer.rules.SwitchRequest.prototype.WEAK&&(t=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT),r({value:void 0!==i?i:u,confidence:t}))};for(o[MediaPlayer.rules.SwitchRequest.prototype.STRONG]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,o[MediaPlayer.rules.SwitchRequest.prototype.WEAK]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,o[MediaPlayer.rules.SwitchRequest.prototype.DEFAULT]=MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE,s=0;v>s;s+=1)c=n[s],t.call(this,c)?c.execute(a,l):h--},reset:function(){for(var r,o=n[this.ABR_RULE],i=n[this.SCHEDULING_RULE],f=n[this.SYNC_RULE],u=(o.getRules(MediaPlayer.rules.ABRRulesCollection.prototype.QUALITY_SWITCH_RULES)||[]).concat(i.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES)||[]).concat(i.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES)||[]).concat(i.getRules(MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES)||[]).concat(f.getRules(MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES)||[]).concat(f.getRules(MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES)||[]),e=u.length,t=0;e>t;t+=1)r=u[t],"function"==typeof r.reset&&r.reset();n={}}}},MediaPlayer.rules.RulesController.prototype={constructor:MediaPlayer.rules.RulesController},MediaPlayer.rules.BufferLevelRule=function(){"use strict";var n={},t={},i={},r=function(n){var t=this.metricsExt.getCurrentHttpRequest(n);return null!==t?(t.tresponse.getTime()-t.trequest.getTime())/1e3:0},s=function(n,t,i){var r;return r=i?this.playbackController.getLiveDelay():isNaN(t)||MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME<t&&t>n?Math.max(MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME,n):n>=t?Math.min(t,MediaPlayer.dependencies.BufferController.DEFAULT_MIN_BUFFER_TIME):Math.min(t,n)},h=function(n,t,i){var f=this,a=i.bufferController.getCriticalBufferLevel(),c=f.metricsModel.getReadOnlyMetricsFor("video"),l=f.metricsModel.getReadOnlyMetricsFor("audio"),h=s.call(this,i.bufferController.getMinBufferTime(),t,n),o=h,e=i.bufferController.bufferMax,u=0;return e===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_MIN?u=h:e===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_INFINITY?u=t:e===MediaPlayer.dependencies.BufferController.BUFFER_SIZE_REQUIRED&&(!n&&f.abrController.isPlayingAtTopQuality(i.streamProcessor.getStreamInfo())&&(o=MediaPlayer.dependencies.BufferController.BUFFER_TIME_AT_TOP_QUALITY),u=o+Math.max(r.call(f,c),r.call(f,l))),u=Math.min(u,a)},c=function(n,i){return t[n]&&t[n][i]},o=function(t,i){return n[t]&&n[t][i]},u=function(n){var i=n.data.fragmentModel.getContext().streamProcessor.getStreamInfo().id;t[i]=t[i]||{},t[i][n.data.request.mediaType]=!0},f=function(t){var i=t.sender.streamProcessor.getStreamInfo().id;n[i]=n[i]||{},n[i][t.sender.streamProcessor.getType()]=!0},e=function(t){var i=t.sender.streamProcessor.getStreamInfo().id;n[i]=n[i]||{},n[i][t.sender.streamProcessor.getType()]=!1};return{metricsExt:void 0,metricsModel:void 0,abrController:void 0,playbackController:void 0,setup:function(){this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_OUTRUN]=f,this[MediaPlayer.dependencies.BufferController.eventList.ENAME_BUFFER_LEVEL_BALANCED]=e,this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=u},setScheduleController:function(n){var t=n.streamProcessor.getStreamInfo().id;i[t]=i[t]||{},i[t][n.streamProcessor.getType()]=n},execute:function(n,t){var y=n.getStreamInfo(),s=y.id,r=n.getMediaInfo().type;if(o(s,r))return void t(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.STRONG));var u,e=this.metricsModel.getReadOnlyMetricsFor(r),g=this.metricsExt.getCurrentBufferLevel(e)?this.metricsExt.getCurrentBufferLevel(e).level:0,f=i[s][r],d=f.streamProcessor.getCurrentTrack(),l=f.streamProcessor.isDynamic(),tt=this.metricsExt.getCurrentPlaybackRate(e),v=y.manifestInfo.duration,p=g/Math.max(tt,1),nt=d.fragmentDuration,w=this.playbackController.getTime(),a=l?Number.POSITIVE_INFINITY:v-w,k=Math.min(h.call(this,l,v,f),a),b=Math.max(k-p,0);u=Math.ceil(b/nt),p>=a&&!c(s,r)&&(u=u||1),t(new MediaPlayer.rules.SwitchRequest(u,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){n={},t={},i={}}}},MediaPlayer.rules.BufferLevelRule.prototype={constructor:MediaPlayer.rules.BufferLevelRule},MediaPlayer.rules.PendingRequestsRule=function(){"use strict";var t=3,n={};return{metricsExt:void 0,setScheduleController:function(t){var i=t.streamProcessor.getStreamInfo().id;n[i]=n[i]||{},n[i][t.streamProcessor.getType()]=t},execute:function(i,r){var h=i.getMediaInfo().type,l=i.getStreamInfo().id,s=i.getCurrentValue(),c=n[l][h],u=c.getFragmentModel(),a=u.getRequests({state:[MediaPlayer.dependencies.FragmentModel.states.PENDING,MediaPlayer.dependencies.FragmentModel.states.LOADING]}),v=u.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.REJECTED}),f=v.length,e=a.length,o=Math.max(s-e,0);return f>0?void r(new MediaPlayer.rules.SwitchRequest(f,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):e>t?void r(new MediaPlayer.rules.SwitchRequest(0,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT)):0===s?void r(new MediaPlayer.rules.SwitchRequest(o,MediaPlayer.rules.SwitchRequest.prototype.NO_CHANGE)):void r(new MediaPlayer.rules.SwitchRequest(o,MediaPlayer.rules.SwitchRequest.prototype.DEFAULT))},reset:function(){n={}}}},MediaPlayer.rules.PendingRequestsRule.prototype={constructor:MediaPlayer.rules.PendingRequestsRule},MediaPlayer.rules.PlaybackTimeRule=function(){"use strict";var n={},t={},i=function(t){setTimeout(function(){var i=t.data.seekTime;n.audio=i,n.video=i,n.fragmentedText=i},0)};return{adapter:void 0,sourceBufferExt:void 0,playbackController:void 0,setup:function(){this[MediaPlayer.dependencies.PlaybackController.eventList.ENAME_PLAYBACK_SEEKING]=i},setScheduleController:function(n){var i=n.streamProcessor.getStreamInfo().id;t[i]=t[i]||{},t[i][n.streamProcessor.getType()]=n},execute:function(i,r){var s,u,h=i.getMediaInfo().type,p=i.getStreamInfo().id,w=t[p][h],d=.1,e=t[p][h].streamProcessor,v=e.getCurrentTrack(),y=n?n[h]:null,o=void 0!==y&&null!==y,b=o?MediaPlayer.rules.SwitchRequest.prototype.STRONG:MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,f=w.getFragmentModel().getRequests({state:MediaPlayer.dependencies.FragmentModel.states.REJECTED})[0],k=!!f&&!o,l=this.adapter.getIndexHandlerTime(e),nt=this.playbackController.getTime(),tt=f?f.startTime+f.duration:null,a=!o&&f&&(tt>nt&&f.startTime<=l||isNaN(l)),g=e.bufferController.getBuffer(),c=null;if(s=o?y:a?f.startTime:l,f&&w.getFragmentModel().removeRejectedRequest(f),isNaN(s))return void r(new MediaPlayer.rules.SwitchRequest(null,b));for(o&&(n[h]=null),g&&(c=this.sourceBufferExt.getBufferRange(e.bufferController.getBuffer(),s),null!==c&&(s=c.end)),u=this.adapter.getFragmentRequestForTime(e,v,s,{keepIdx:k}),a&&u&&u.index!==f.index&&(u=this.adapter.getFragmentRequestForTime(e,v,f.startTime+f.duration/2+d,{keepIdx:k,timeThreshold:0}));u&&e.getFragmentModel().isFragmentLoadedOrPending(u);){if("complete"===u.action){u=null,this.adapter.setIndexHandlerTime(e,NaN);break}u=this.adapter.getNextFragmentRequest(e,v)}u&&!a&&this.adapter.setIndexHandlerTime(e,u.startTime+u.duration),r(new MediaPlayer.rules.SwitchRequest(u,b))},reset:function(){n={},t={}}}},MediaPlayer.rules.PlaybackTimeRule.prototype={constructor:MediaPlayer.rules.PlaybackTimeRule},MediaPlayer.rules.SameTimeRequestRule=function(){"use strict";var n={},u=function(n,t){var i,u,o,e,s,f=0,h=n.length;for(f;h>f;f+=1)for(o=n[f].getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING}),r.call(this,o,"index"),e=0,s=o.length;s>e;e++){if(i=o[e],isNaN(i.startTime)&&"complete"!==i.action){u=i;break}i.startTime>t&&(!u||i.startTime<u.startTime)&&(u=i)}return u||i},f=function(n,t){for(var u,f=n.length,i=null,r=0;f>r;r+=1)u=n[r].getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING,time:t})[0],u&&(!i||u.startTime>i.startTime)&&(i=u);return i},r=function(n,t){var i=function(n,i){return n[t]<i[t]||isNaN(n[t])&&"complete"!==n.action?-1:n[t]>i[t]?1:0};n.sort(i)},t=function(t,i){return n[t]&&n[t][i]?n[t][i]:NaN},i=function(t){var f=t.data.fragmentModel,r=t.data.request,i=f.getContext().streamProcessor.getStreamInfo().id,u=r.mediaType;n[i]=n[i]||{},n[i][u]=r.index-1};return{playbackController:void 0,setup:function(){this[MediaPlayer.dependencies.FragmentController.eventList.ENAME_STREAM_COMPLETED]=i},setFragmentModels:function(n,t){this.fragmentModels=this.fragmentModels||{},this.fragmentModels[t]=n},execute:function(n,i){var a,e,o,y,r,v,w,p,d,g=n.getStreamInfo().id,nt=n.getCurrentValue(),c=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,s=this.fragmentModels[g],tt=new Date,l=null,b=s?s.length:null,k=!1,h=[];if(!s||!b)return void i(new MediaPlayer.rules.SwitchRequest([],c));if(v=this.playbackController.getTime(),w=f(s,v),r=w||u(s,v)||nt,!r)return void i(new MediaPlayer.rules.SwitchRequest([],c));for(y=0;b>y;y+=1)if(e=s[y],a=e.getContext().streamProcessor.getType(),("video"===a||"audio"===a||"fragmentedText"===a)&&(p=e.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING}),d=e.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING}).length,!e.getIsPostponed()||isNaN(r.startTime))){if(d>MediaPlayer.dependencies.ScheduleController.LOADING_REQUEST_THRESHOLD)return void i(new MediaPlayer.rules.SwitchRequest([],c));if(l=l||(r===w?v:r.startTime),-1===p.indexOf(r)){if(o=e.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.PENDING,time:l})[0],o||0!==r.index||(o=p.filter(function(n){return n.index===r.index})[0]),o)h.push(o);else if(o=e.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.LOADING,time:l})[0]||e.getRequests({state:MediaPlayer.dependencies.FragmentModel.states.EXECUTED,time:l})[0],!o&&r.index!==t.call(this,g,r.mediaType)){k=!0;break}}else h.push(r)}return h=h.filter(function(n){return"complete"===n.action||tt.getTime()>=n.availabilityStartTime.getTime()}),k?void i(new MediaPlayer.rules.SwitchRequest([],c)):void i(new MediaPlayer.rules.SwitchRequest(h,c))},reset:function(){n={}}}},MediaPlayer.rules.SameTimeRequestRule.prototype={constructor:MediaPlayer.rules.SameTimeRequestRule},MediaPlayer.rules.ScheduleRulesCollection=function(){"use strict";var n=[],i=[],t=[];return{bufferLevelRule:void 0,pendingRequestsRule:void 0,playbackTimeRule:void 0,sameTimeRequestRule:void 0,getRules:function(r){switch(r){case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_SCHEDULE_RULES:return n;case MediaPlayer.rules.ScheduleRulesCollection.prototype.NEXT_FRAGMENT_RULES:return t;case MediaPlayer.rules.ScheduleRulesCollection.prototype.FRAGMENTS_TO_EXECUTE_RULES:return i;default:return null}},setup:function(){n.push(this.bufferLevelRule),n.push(this.pendingRequestsRule),t.push(this.playbackTimeRule),i.push(this.sameTimeRequestRule)}}},MediaPlayer.rules.ScheduleRulesCollection.prototype={constructor:MediaPlayer.rules.ScheduleRulesCollection,FRAGMENTS_TO_SCHEDULE_RULES:"fragmentsToScheduleRules",NEXT_FRAGMENT_RULES:"nextFragmentRules",FRAGMENTS_TO_EXECUTE_RULES:"fragmentsToExecuteRules"},MediaPlayer.rules.SwitchRequest=function(n,t){"use strict";this.value=n,this.priority=t,void 0===this.value&&(this.value=999),void 0===this.priority&&(this.priority=.5)},MediaPlayer.rules.SwitchRequest.prototype={constructor:MediaPlayer.rules.SwitchRequest,NO_CHANGE:999,DEFAULT:.5,STRONG:1,WEAK:0},MediaPlayer.rules.LiveEdgeBinarySearchRule=function(){"use strict";var u,o,r,y=43200,n=NaN,t=null,c=NaN,i=null,h=!1,s=NaN,e=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,f=function(n,t,u,e){var c,s=this,h;null===e?(c=s.adapter.generateFragmentRequestForTime(r,i,n),f.call(s,n,t,u,c)):(h=function(i){o.unsubscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,s,h),i.data.exists?t.call(s,i.data.request,n):u.call(s,i.data.request,n)},o.subscribe(MediaPlayer.dependencies.FragmentLoader.eventList.ENAME_CHECK_FOR_EXISTENCE_COMPLETED,s,h),o.checkForExistence(e))},a=function(o,s){var y,w,p;return h?void v.call(this,!1,s):(p=s-n,y=p>0?n-p:n+Math.abs(p)+c,void(y<t.start&&y>t.end?u(new MediaPlayer.rules.SwitchRequest(null,e)):(w=this.adapter.getFragmentRequestForTime(r,i,y,{ignoreIsFinished:!0}),f.call(this,y,l,a,w))))},l=function(o,l){var p,a,w=o.startTime,y=this;if(!h){if(!i.fragmentDuration)return void u(new MediaPlayer.rules.SwitchRequest(w,e));if(h=!0,t.end=w+2*c,l===n)return a=l+s,p=y.adapter.getFragmentRequestForTime(r,i,a,{ignoreIsFinished:!0}),void f.call(y,a,function(){v.call(y,!0,a)},function(){u(new MediaPlayer.rules.SwitchRequest(a,e))},p)}v.call(this,!0,l)},v=function(n,o){var c,v,h;n?t.start=o:t.end=o,c=Math.floor(t.end-t.start)<=s,c?u(new MediaPlayer.rules.SwitchRequest(n?o:o-s,e)):(h=(t.start+t.end)/2,v=this.adapter.getFragmentRequestForTime(r,i,h,{ignoreIsFinished:!0}),f.call(this,h,l,a,v))};return{metricsExt:void 0,adapter:void 0,timelineConverter:void 0,execute:function(h,v){var k,p,w=this,b;if(u=v,r=h.getStreamProcessor(),o=r.getFragmentLoader(),i=h.getTrackInfo(),s=i.fragmentDuration,p=i.DVRWindow,n=p.end,i.useCalculatedLiveEdgeTime)return b=w.timelineConverter.getExpectedLiveEdge(),w.timelineConverter.setExpectedLiveEdge(n),void u(new MediaPlayer.rules.SwitchRequest(b,e));t={start:Math.max(0,n-y),end:n+y},c=Math.floor((p.end-p.start)/2),k=w.adapter.getFragmentRequestForTime(r,i,n,{ignoreIsFinished:!0}),f.call(w,n,l,a,k)},reset:function(){n=NaN,t=null,c=NaN,i=null,h=!1,s=NaN,r=null,o=null}}},MediaPlayer.rules.LiveEdgeBinarySearchRule.prototype={constructor:MediaPlayer.rules.LiveEdgeBinarySearchRule},MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule=function(){"use strict";return{timelineConverter:void 0,execute:function(n,t){var u=n.getTrackInfo(),f=u.DVRWindow.end,i=MediaPlayer.rules.SwitchRequest.prototype.DEFAULT,r;u.useCalculatedLiveEdgeTime?(r=this.timelineConverter.getExpectedLiveEdge(),this.timelineConverter.setExpectedLiveEdge(f),t(new MediaPlayer.rules.SwitchRequest(r,i))):t(new MediaPlayer.rules.SwitchRequest(f,i))}}},MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule.prototype={constructor:MediaPlayer.rules.LiveEdgeWithTimeSynchronizationRule},MediaPlayer.rules.SynchronizationRulesCollection=function(){"use strict";var t=[],n=[];return{liveEdgeBinarySearchRule:void 0,liveEdgeWithTimeSynchronizationRule:void 0,getRules:function(i){switch(i){case MediaPlayer.rules.SynchronizationRulesCollection.prototype.TIME_SYNCHRONIZED_RULES:return t;case MediaPlayer.rules.SynchronizationRulesCollection.prototype.BEST_GUESS_RULES:return n;default:return null}},setup:function(){t.push(this.liveEdgeWithTimeSynchronizationRule),n.push(this.liveEdgeBinarySearchRule)}}},MediaPlayer.rules.SynchronizationRulesCollection.prototype={constructor:MediaPlayer.rules.SynchronizationRulesCollection,TIME_SYNCHRONIZED_RULES:"withAccurateTimeSourceRules",BEST_GUESS_RULES:"bestGuestRules"},MediaPlayer.utils.BoxParser=function(){"use strict";var n=function(n){if(!n)return null;void 0===n.fileStart&&(n.fileStart=0);var i=ISOBoxer.parseBuffer(n),t=this.system.getObject("isoFile");return t.setData(i),t};return{system:void 0,log:void 0,parse:n}},MediaPlayer.utils.BoxParser.prototype={constructor:MediaPlayer.utils.BoxParser},MediaPlayer.utils.Capabilities=function(){"use strict"},MediaPlayer.utils.Capabilities.prototype={constructor:MediaPlayer.utils.Capabilities,system:void 0,log:void 0,supportsMediaSource:function(){"use strict";var t="WebKitMediaSource"in window,n="MediaSource"in window;return t||n},supportsEncryptedMedia:function(){return this.system.hasMapping("protectionModel")},supportsCodec:function(n,t){"use strict";if(!(n instanceof HTMLMediaElement))throw"element must be of type HTMLMediaElement.";var i=n.canPlayType(t);return"probably"===i||"maybe"===i}},MediaPlayer.utils.CustomTimeRanges=function(){return{customTimeRangeArray:[],length:0,add:function(n,t){for(var i=0,i=0;i<this.customTimeRangeArray.length&&n>this.customTimeRangeArray[i].start;i++);for(this.customTimeRangeArray.splice(i,0,{start:n,end:t}),i=0;i<this.customTimeRangeArray.length-1;i++)this.mergeRanges(i,i+1)&&i--;this.length=this.customTimeRangeArray.length},remove:function(n,t){for(var i=0;i<this.customTimeRangeArray.length;i++)if(n<=this.customTimeRangeArray[i].start&&t>=this.customTimeRangeArray[i].end)this.customTimeRangeArray.splice(i,1),i--;else{if(n>this.customTimeRangeArray[i].start&&t<this.customTimeRangeArray[i].end){this.customTimeRangeArray.splice(i+1,0,{start:t,end:this.customTimeRangeArray[i].end}),this.customTimeRangeArray[i].end=n;break}n>this.customTimeRangeArray[i].start&&n<this.customTimeRangeArray[i].end?this.customTimeRangeArray[i].end=n:t>this.customTimeRangeArray[i].start&&t<this.customTimeRangeArray[i].end&&(this.customTimeRangeArray[i].start=t)}this.length=this.customTimeRangeArray.length},mergeRanges:function(n,t){var r=this.customTimeRangeArray[n],i=this.customTimeRangeArray[t];return r.start<=i.start&&i.start<=r.end&&r.end<=i.end?(r.end=i.end,this.customTimeRangeArray.splice(t,1),!0):i.start<=r.start&&r.start<=i.end&&i.end<=r.end?(r.start=i.start,this.customTimeRangeArray.splice(t,1),!0):i.start<=r.start&&r.start<=i.end&&r.end<=i.end?(this.customTimeRangeArray.splice(n,1),!0):r.start<=i.start&&i.start<=r.end&&i.end<=r.end?(this.customTimeRangeArray.splice(t,1),!0):!1},start:function(n){return this.customTimeRangeArray[n].start},end:function(n){return this.customTimeRangeArray[n].end}}},MediaPlayer.utils.CustomTimeRanges.prototype={constructor:MediaPlayer.utils.CustomTimeRanges},MediaPlayer.utils.DOMStorage=function(){var n,t=!0,i=function(){["video","audio"].forEach(function(n){if(void 0===this.abrController.getInitialBitrateFor(n)){if(this.isSupported(MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL)&&t){var f=MediaPlayer.utils.DOMStorage["LOCAL_STORAGE_"+n.toUpperCase()+"_BITRATE_KEY"],r=JSON.parse(localStorage.getItem(f))||{},u=+new Date-parseInt(r.timestamp)>=MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_BITRATE_EXPIRATION||!1,i=parseInt(r.bitrate);isNaN(i)||u?u&&localStorage.removeItem(f):(this.abrController.setInitialBitrateFor(n,i),this.log("Last bitrate played for "+n+" was "+i))}void 0===this.abrController.getInitialBitrateFor(n)&&this.abrController.setInitialBitrateFor(n,MediaPlayer.dependencies.AbrController["DEFAULT_"+n.toUpperCase()+"_BITRATE"])}},this)};return{system:void 0,log:void 0,abrController:void 0,checkInitialBitrate:i,enableLastBitrateCaching:function(n,i){t=n,void 0===i||isNaN(i)||"number"!=typeof i||(MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_BITRATE_EXPIRATION=i)},isSupported:function(t){if(void 0!==n)return n;n=!1;var i,r="1",u="1";try{i=window[t]}catch(f){return this.log("Warning: DOMStorage access denied: "+f.message),n}if(!i||t!==MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL&&t!==MediaPlayer.utils.DOMStorage.STORAGE_TYPE_SESSION)return n;try{i.setItem(r,u),i.removeItem(r),n=!0}catch(f){this.log("Warning: DOMStorage is supported, but cannot be used: "+f.message)}return n}}},MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_VIDEO_BITRATE_KEY="dashjs_vbitrate",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_AUDIO_BITRATE_KEY="dashjs_abitrate",MediaPlayer.utils.DOMStorage.LOCAL_STORAGE_BITRATE_EXPIRATION=36e4,MediaPlayer.utils.DOMStorage.STORAGE_TYPE_LOCAL="localStorage",MediaPlayer.utils.DOMStorage.STORAGE_TYPE_SESSION="sessionStorage",MediaPlayer.utils.DOMStorage.prototype={constructor:MediaPlayer.utils.DOMStorage},MediaPlayer.utils.Debug=function(){"use strict";var r,n=!0,i=!1,t=!1,u=+new Date;return{system:void 0,eventBus:void 0,setup:function(){this.system.mapValue("log",this.log),this.system.mapOutlet("log"),r=this.eventBus},setLogTimestampVisible:function(n){i=n},showCalleeName:function(n){t=n},setLogToBrowserConsole:function(t){n=t},getLogToBrowserConsole:function(){return n},log:function(){var f="",e=null;i&&(e=+new Date,f+="["+(e-u)+"]"),t&&this.getName&&(f+="["+this.getName()+"]"),this.getMediaType&&this.getMediaType()&&(f+="["+this.getMediaType()+"]"),f.length>0&&(f+=" "),Array.apply(null,arguments).forEach(function(n){f+=n+" "}),n&&console.log(f),r.dispatchEvent({type:"log",message:f})}}},MediaPlayer.utils.EventBus=function(){"use strict";var n,t=function(t,i){var r=(i?"1":"0")+t;return r in n||(n[r]=[]),n[r]},i=function(){n={}};return i(),{addEventListener:function(n,i,r){var u=t(n,r),f=u.indexOf(i);-1===f&&u.push(i)},removeEventListener:function(n,i,r){var f=t(n,r),u=f.indexOf(i);-1!==u&&f.splice(u,1)},dispatchEvent:function(n){for(var r=t(n.type,!1).slice(),i=0;i<r.length;i++)r[i].call(this,n);return!n.defaultPrevented}}},MediaPlayer.utils.IsoFile=function(){"use strict";var n,e={offset:"_offset",size:"size",type:"type"},u={references:"references",timescale:"timescale",earliest_presentation_time:"earliest_presentation_time",first_offset:"first_offset"},l={reference_type:"reference_type",referenced_size:"referenced_size",subsegment_duration:"subsegment_duration"},c={id:"id",value:"value",timescale:"timescale",scheme_id_uri:"scheme_id_uri",presentation_time_delta:"presentation_time_delta",event_duration:"event_duration",message_data:"message_data"},h={timescale:"timescale"},o={base_data_offset:"base_data_offset",sample_description_index:"sample_description_index",default_sample_duration:"default_sample_duration",default_sample_size:"default_sample_size",default_sample_flags:"default_sample_flags",flags:"flags"},v={version:"version",baseMediaDecodeTime:"baseMediaDecodeTime",flags:"flags"},a={sample_count:"sample_count",first_sample_flags:"first_sample_flags",data_offset:"data_offset",flags:"flags",samples:"samples"},f={sample_size:"sample_size",sample_duration:"sample_duration",sample_composition_time_offset:"sample_composition_time_offset"},t=function(n,t,i){for(var r in i)t[r]=n[i[r]]},r=function(n){if(!n)return null;var r,s,i=new MediaPlayer.vo.IsoBox;switch(t(n,i,e),n.hasOwnProperty("_incomplete")&&(i.isComplete=!n._incomplete),i.type){case"sidx":if(t(n,i,u),i.references)for(r=0,s=i.references.length;s>r;r+=1)t(n.references[r],i.references[r],l);break;case"emsg":t(n,i,c);break;case"mdhd":t(n,i,h);break;case"tfhd":t(n,i,o);break;case"tfdt":t(n,i,v);break;case"trun":if(t(n,i,a),i.samples)for(r=0,s=i.samples.length;s>r;r+=1)t(n.samples[r],i.samples[r],f)}return i},s=function(t){return t&&n&&n.boxes&&0!==n.boxes.length?r.call(this,n.fetch(t)):null},i=function(t){for(var u,e=n.fetchAll(t),f=[],i=0,o=e.length;o>i;i+=1)u=r.call(this,e[i]),u&&f.push(u);return f};return{getBox:s,getBoxes:i,setData:function(t){n=t},getLastBox:function(){if(!n||!n.boxes||!n.boxes.length)return null;var r=n.boxes[n.boxes.length-1].type,t=i.call(this,r);return t[t.length-1]},getOffset:function(){return n._cursor.offset}}},MediaPlayer.utils.IsoFile.prototype={constructor:MediaPlayer.utils.IsoFile},MediaPlayer.utils.VirtualBuffer=function(){var n={},r=function(n,t){var i=function(n,i){return n[t]<i[t]?-1:n[t]>i[t]?1:0};n.sort(i)},i=function(t){var i=t.streamId,r=t.mediaType;return n[i]?n[i][r]:null},t=function(){var n={};return n.audio={buffered:new MediaPlayer.utils.CustomTimeRanges},n.audio[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],n.audio[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],n.video={buffered:new MediaPlayer.utils.CustomTimeRanges},n.video[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],n.video[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],n.fragmentedText={buffered:new MediaPlayer.utils.CustomTimeRanges},n.fragmentedText[MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE]=[],n.fragmentedText[MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE]=[],n};return{system:void 0,sourceBufferExt:void 0,notify:void 0,subscribe:void 0,unsubscribe:void 0,append:function(i){var u=i.streamId,f=i.mediaType,s=i.segmentType,o=i.start,e=i.end;n[u]=n[u]||t(),n[u][f][s].push(i),r(n[u][f][s],"index"),isNaN(o)||isNaN(e)||(n[u][f].buffered.add(o,e),this.notify(MediaPlayer.utils.VirtualBuffer.eventList.CHUNK_APPENDED,{chunk:i}))},getChunks:function(n){var t=i.call(this,n),e=n.segmentType,f=n.removeOrigin,o=n.limit||Number.POSITIVE_INFINITY,r=0,u=[];return t?(delete n.streamId,delete n.mediaType,delete n.segmentType,delete n.removeOrigin,delete n.limit,u=t[e].filter(function(i,u,e){if(r>=o)return!1;for(var s in n)if(n.hasOwnProperty(s)&&i[s]!=n[s])return!1;return f&&(t.buffered.remove(i.start,i.end),e.splice(u,1)),r+=1,!0})):u},extract:function(n){return n.removeOrigin=!0,this.getChunks(n)},getTotalBufferLevel:function(t){var u=t.type,r=0,i;for(i in n)n.hasOwnProperty(i)&&(r+=this.sourceBufferExt.getTotalBufferedTime(n[i][u]));return r},reset:function(){n={}}}},MediaPlayer.utils.VirtualBuffer.prototype={constructor:MediaPlayer.utils.VirtualBuffer},MediaPlayer.utils.VirtualBuffer.eventList={CHUNK_APPENDED:"chunkAppended"},MediaPlayer.vo.BitrateInfo=function(){"use strict";this.mediaType=null,this.bitrate=null,this.qualityIndex=NaN},MediaPlayer.vo.BitrateInfo.prototype={constructor:MediaPlayer.vo.BitrateInfo},MediaPlayer.vo.DataChunk=function(){"use strict";this.streamId=null,this.mediaType=null,this.segmentType=null,this.quality=NaN,this.index=NaN,this.bytes=null,this.start=NaN,this.end=NaN,this.duration=NaN},MediaPlayer.vo.DataChunk.prototype={constructor:MediaPlayer.vo.DataChunk},MediaPlayer.vo.Error=function(n,t,i){"use strict";this.code=n||null,this.message=t||null,this.data=i||null},MediaPlayer.vo.Error.prototype={constructor:MediaPlayer.vo.Error},MediaPlayer.vo.Event=function(){"use strict";this.type=null,this.sender=null,this.data=null,this.error=null,this.timestamp=NaN},MediaPlayer.vo.Event.prototype={constructor:MediaPlayer.vo.Event},MediaPlayer.vo.FragmentRequest=function(){"use strict";this.action="download",this.startTime=NaN,this.mediaType=null,this.type=null,this.duration=NaN,this.timescale=NaN,this.range=null,this.url=null,this.requestStartDate=null,this.firstByteDate=null,this.requestEndDate=null,this.quality=NaN,this.index=NaN,this.availabilityStartTime=null,this.availabilityEndTime=null,this.wallStartTime=null,this.bytesLoaded=NaN,this.bytesTotal=NaN},MediaPlayer.vo.FragmentRequest.prototype={constructor:MediaPlayer.vo.FragmentRequest,ACTION_DOWNLOAD:"download",ACTION_COMPLETE:"complete"},MediaPlayer.vo.IsoBox=function(){"use strict";this.offset=NaN,this.type=null,this.size=NaN,this.isComplete=!0},MediaPlayer.vo.IsoBox.prototype={constructor:MediaPlayer.vo.IsoBox},MediaPlayer.vo.ManifestInfo=function(){"use strict";this.DVRWindowSize=NaN,this.loadedTime=null,this.availableFrom=null,this.minBufferTime=NaN,this.duration=NaN,this.isDynamic=!1,this.maxFragmentDuration=null},MediaPlayer.vo.ManifestInfo.prototype={constructor:MediaPlayer.vo.ManifestInfo},MediaPlayer.vo.MediaInfo=function(){"use strict";this.id=null,this.index=null,this.type=null,this.streamInfo=null,this.trackCount=0,this.lang=null,this.codec=null,this.mimeType=null,this.contentProtection=null,this.isText=!1,this.KID=null,this.bitrateList=null},MediaPlayer.vo.MediaInfo.prototype={constructor:MediaPlayer.vo.MediaInfo},MediaPlayer.models.MetricsList=function(){"use strict";return{TcpList:[],HttpList:[],RepSwitchList:[],BufferLevel:[],BufferState:[],PlayList:[],DroppedFrames:[],SchedulingInfo:[],DVRInfo:[],ManifestUpdate:[]}},MediaPlayer.models.MetricsList.prototype={constructor:MediaPlayer.models.MetricsList},MediaPlayer.vo.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=NaN,this.duration=NaN,this.manifestInfo=null,this.isLast=!0},MediaPlayer.vo.StreamInfo.prototype={constructor:MediaPlayer.vo.StreamInfo},MediaPlayer.vo.TrackInfo=function(){"use strict";this.id=null,this.quality=null,this.DVRWindow=null,this.fragmentDuration=null,this.mediaInfo=null,this.MSETimeOffset=null},MediaPlayer.vo.TrackInfo.prototype={constructor:MediaPlayer.vo.TrackInfo},MediaPlayer.vo.URIFragmentData=function(){"use strict";this.t=null,this.xywh=null,this.track=null,this.id=null,this.s=null},MediaPlayer.vo.URIFragmentData.prototype={constructor:MediaPlayer.vo.URIFragmentData},MediaPlayer.vo.metrics.BufferLevel=function(){"use strict";this.t=null,this.level=null},MediaPlayer.vo.metrics.BufferLevel.prototype={constructor:MediaPlayer.vo.metrics.BufferLevel},MediaPlayer.vo.metrics.BufferState=function(){"use strict";this.target=null,this.state=MediaPlayer.dependencies.BufferController.BUFFER_EMPTY},MediaPlayer.vo.metrics.BufferState.prototype={constructor:MediaPlayer.vo.metrics.BufferState},MediaPlayer.vo.metrics.DVRInfo=function(){"use strict";this.time=null,this.range=null,this.manifestInfo=null},MediaPlayer.vo.metrics.DVRInfo.prototype={constructor:MediaPlayer.vo.metrics.DVRInfo},MediaPlayer.vo.metrics.DroppedFrames=function(){"use strict";this.time=null,this.droppedFrames=null},MediaPlayer.vo.metrics.DroppedFrames.prototype={constructor:MediaPlayer.vo.metrics.DroppedFrames},MediaPlayer.vo.metrics.HTTPRequest=function(){"use strict";this.stream=null,this.tcpid=null,this.type=null,this.url=null,this.actualurl=null,this.range=null,this.trequest=null,this.tresponse=null,this.tfinish=null,this.responsecode=null,this.interval=null,this.mediaduration=null,this.responseHeaders=null,this.trace=[]},MediaPlayer.vo.metrics.HTTPRequest.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest},MediaPlayer.vo.metrics.HTTPRequest.Trace=function(){"use strict";this.s=null,this.d=null,this.b=[]},MediaPlayer.vo.metrics.HTTPRequest.Trace.prototype={constructor:MediaPlayer.vo.metrics.HTTPRequest.Trace},MediaPlayer.vo.metrics.HTTPRequest.MEDIA_SEGMENT_TYPE="Media Segment",MediaPlayer.vo.metrics.HTTPRequest.INIT_SEGMENT_TYPE="Initialization Segment",MediaPlayer.vo.metrics.HTTPRequest.MPD_TYPE="MPD",MediaPlayer.vo.metrics.ManifestUpdate=function(){"use strict";this.mediaType=null,this.type=null,this.requestTime=null,this.fetchTime=null,this.availabilityStartTime=null,this.presentationStartTime=0,this.clientTimeOffset=0,this.currentTime=null,this.buffered=null,this.latency=0,this.streamInfo=[],this.trackInfo=[]},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo=function(){"use strict";this.id=null,this.index=null,this.start=null,this.duration=null},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo=function(){"use strict";this.id=null,this.index=null,this.mediaType=null,this.streamIndex=null,this.presentationTimeOffset=null,this.startNumber=null,this.fragmentInfoType=null},MediaPlayer.vo.metrics.ManifestUpdate.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate},MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.StreamInfo},MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo.prototype={constructor:MediaPlayer.vo.metrics.ManifestUpdate.TrackInfo},MediaPlayer.vo.metrics.PlayList=function(){"use strict";this.stream=null,this.start=null,this.mstart=null,this.starttype=null,this.trace=[]},MediaPlayer.vo.metrics.PlayList.Trace=function(){"use strict";this.representationid=null,this.subreplevel=null,this.start=null,this.mstart=null,this.duration=null,this.playbackspeed=null,this.stopreason=null},MediaPlayer.vo.metrics.PlayList.prototype={constructor:MediaPlayer.vo.metrics.PlayList},MediaPlayer.vo.metrics.PlayList.INITIAL_PLAY_START_REASON="initial_start",MediaPlayer.vo.metrics.PlayList.SEEK_START_REASON="seek",MediaPlayer.vo.metrics.PlayList.Trace.prototype={constructor:MediaPlayer.vo.metrics.PlayList.Trace()},MediaPlayer.vo.metrics.PlayList.Trace.USER_REQUEST_STOP_REASON="user_request",MediaPlayer.vo.metrics.PlayList.Trace.REPRESENTATION_SWITCH_STOP_REASON="representation_switch",MediaPlayer.vo.metrics.PlayList.Trace.END_OF_CONTENT_STOP_REASON="end_of_content",MediaPlayer.vo.metrics.PlayList.Trace.REBUFFERING_REASON="rebuffering",MediaPlayer.vo.metrics.TrackSwitch=function(){"use strict";this.t=null,this.mt=null,this.to=null,this.lto=null},MediaPlayer.vo.metrics.TrackSwitch.prototype={constructor:MediaPlayer.vo.metrics.TrackSwitch},MediaPlayer.vo.metrics.SchedulingInfo=function(){"use strict";this.mediaType=null,this.t=null,this.type=null,this.startTime=null,this.availabilityStartTime=null,this.duration=null,this.quality=null,this.range=null,this.state=null},MediaPlayer.vo.metrics.SchedulingInfo.prototype={constructor:MediaPlayer.vo.metrics.SchedulingInfo},MediaPlayer.vo.metrics.TCPConnection=function(){"use strict";this.tcpid=null,this.dest=null,this.topen=null,this.tclose=null,this.tconnect=null},MediaPlayer.vo.metrics.TCPConnection.prototype={constructor:MediaPlayer.vo.metrics.TCPConnection},MediaPlayer.vo.protection.ClearKeyKeySet=function(n,t){if(t&&"persistent"!==t&&"temporary"!==t)throw new Error("Invalid ClearKey key set type!  Must be one of 'persistent' or 'temporary'");this.keyPairs=n,this.type=t,this.toJWK=function(){var n,o=this.keyPairs.length,t={},f;for(t.keys=[],n=0;o>n;n++)f={kty:"oct",alg:"A128KW",kid:this.keyPairs[n].keyID,k:this.keyPairs[n].key},t.keys.push(f);this.type&&(t.type=this.type);var u=JSON.stringify(t),i=u.length,r=new ArrayBuffer(i),e=new Uint8Array(r);for(n=0;i>n;n++)e[n]=u.charCodeAt(n);return r}},MediaPlayer.vo.protection.ClearKeyKeySet.prototype={constructor:MediaPlayer.vo.protection.ClearKeyKeySet},MediaPlayer.vo.protection.KeyError=function(n,t){"use strict";this.sessionToken=n,this.error=t},MediaPlayer.vo.protection.KeyError.prototype={constructor:MediaPlayer.vo.protection.KeyError},MediaPlayer.vo.protection.KeyMessage=function(n,t,i,r){"use strict";this.sessionToken=n,this.message=t,this.defaultURL=i,this.messageType=r},MediaPlayer.vo.protection.KeyMessage.prototype={constructor:MediaPlayer.vo.protection.KeyMessage},MediaPlayer.vo.protection.KeyPair=function(n,t){"use strict";this.keyID=n,this.key=t},MediaPlayer.vo.protection.KeyPair.prototype={constructor:MediaPlayer.vo.protection.KeyPair},MediaPlayer.vo.protection.KeySystemAccess=function(n,t){this.keySystem=n,this.ksConfiguration=t},MediaPlayer.vo.protection.KeySystemAccess.prototype={constructor:MediaPlayer.vo.protection.KeySystemAccess},MediaPlayer.vo.protection.KeySystemConfiguration=function(n,t,i,r){this.initDataTypes=["cenc"],this.audioCapabilities=n,this.videoCapabilities=t,this.distinctiveIdentifier=i,this.persistentState=r},MediaPlayer.vo.protection.KeySystemConfiguration.prototype={constructor:MediaPlayer.vo.protection.KeySystemConfiguration},MediaPlayer.vo.protection.LicenseRequestComplete=function(n,t){"use strict";this.message=n,this.requestData=t},MediaPlayer.vo.protection.LicenseRequestComplete.prototype={constructor:MediaPlayer.vo.protection.LicenseRequestComplete},MediaPlayer.vo.protection.MediaCapability=function(n,t){this.contentType=n,this.robustness=t},MediaPlayer.vo.protection.MediaCapability.prototype={constructor:MediaPlayer.vo.protection.MediaCapability},MediaPlayer.vo.protection.NeedKey=function(n,t){this.initData=n,this.initDataType=t},MediaPlayer.vo.protection.NeedKey.prototype={constructor:MediaPlayer.vo.protection.NeedKey},MediaPlayer.vo.protection.ProtectionData=function(n,t,i){this.laURL=n,this.httpRequestHeaders=t,this.clearkeys=i},MediaPlayer.vo.protection.ProtectionData.prototype={constructor:MediaPlayer.vo.protection.ProtectionData},MediaPlayer.models.SessionToken=function(){"use strict"},MediaPlayer.models.SessionToken.prototype={initData:null,getSessionID:function(){return""},getExpirationTime:function(){return NaN},getKeyStatuses:function(){return null}}
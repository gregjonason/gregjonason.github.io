(function(n){var t={raw:"raw",fresh:"fresh",stale:"stale",expiring:"expiring",expired:"expired"};n.widget("ui.playercaptionpanel",{options:{classes:{slider:"ui-playercaptionpanel-slider",captionPanel:"ui-playercaptionpanel",captionItem:"ui-playercaptionpanel-item",roundedCorner:"ui-corner-all",ages:{stale:"ui-playercaptionpanel-stale-item",expiring:"ui-playercaptionpanel-expiring-item"}},fadeSpeed:400,currentPosition:0,maxVisibleCaptions:3,expiredAfter:3e4,expiringAfter:25e3,staleAfter:2e4,allowBefore:1e3},_setOption:function(n,t){var r=this,i=this.options;this._super(n,t),n=="currentPosition"&&this.pruneAndAge()},_create:function(){var i=this,t=this.options;i.element.addClass(t.classes.captionPanel),n("<div>").addClass(t.classes.slider).appendTo(i.element),this.captions=[]},_destroy:function(){var t=this,n=this.options;this.element.removeClass(n.classes.captionPanel).empty()},_getSlider:function(){return this.element.find("."+this.options.classes.slider)},show:function(){var t=this,n=this.options;this.element.stop(!0,!0).css("visibility","visible").animate({opacity:1},n.fadeSpeed),this.visible=!0},hide:function(){var t=this,n=this.options;this.element.stop(!0,!0).animate({opacity:0},{duration:n.fadeSpeed,complete:function(){t.element.css("visibility","hidden")}}),this.visible=!1},toggle:function(){this.visible?this.hide():this.show()},addCaption:function(t){var f=this,u=this.options,i=n.extend({},t),r=this._createElement(i);i.element=r,this.captions.push(i),this._slideCaption(r),this.pruneExcessiveCaptions(),this.ageCaptions()},_createElement:function(t){var f=this,u=this.options,i=t.Text||"",r;return i=i.formatAsHtml(),r=n("<div>").addClass(u.classes.captionItem).html(i)},_slideCaption:function(n){var t=this,i=this.options;Mediasite.Player.Support.csstransforms3d?t._cssSlideCaption(n):t._jqSlideCaption(n)},_jqSlideCaption:function(t){var e=this,r=this.options,f=this._getSlider(),u=0,i;this.element.find("."+r.classes.captionItem).each(function(){u+=n(this).outerHeight(!0)}),t.appendTo(f),i=0,this.element.find("."+r.classes.captionItem).each(function(){i+=n(this).outerHeight(!0)}),i=u-i,this.element.find("."+r.classes.captionItem).css("position","absolute").stop(!0,!0).animate({top:["+="+i,"swing"]},1500)},_cssSlideCaption:function(t){var h=this,o=this.options,u=this._getSlider(),e=u.height(),s,r,f,i;t.appendTo(u),s=u.height()-e,r=this.element.find("."+o.classes.captionItem),r.css("position","absolute"),f=[],i=0,r.each(function(){i+=n(this).outerHeight(!0)}),r.each(function(){var r="translate3d(0px,-"+(i+3)+"px,0px)";n(this).css({"-moz-transform":r,"-webkit-transform":r,transform:r}),i-=n(this).outerHeight(!0)})},removeCaption:function(n){function remove(){clearTimeout(i),t.element.remove()}var u=this,r=this.options,t,i;return n||(n=0),t=this.captions.splice(n,1),t=t[0],t&&t.element&&(this.visible?(t.element.fadeOut(r.fadeSpeed,remove),i=setTimeout(remove,r.fadeSpeed+10)):remove()),t},pruneAndAge:function(){var t=this,n=this.options;this.pruneExcessiveCaptions(),this.pruneAgedOutCaptions(),this.ageCaptions()},ageCaptions:function(){for(var f=this,t=this.options,n=0;n<this.captions.length;n++){var i=this.captions[n],r=this.getAge(i.Time),u=t.classes.ages[r];i.element.removeClass([t.classes.ages.stale,t.classes.expiring].join(" ")).addClass(u)}},pruneExcessiveCaptions:function(){while(this.captions.length>this.options.maxVisibleCaptions)this.removeCaption()},pruneAgedOutCaptions:function(){for(var r,i,n=0;n<this.captions.length;n++)r=this.captions[n],i=this.getAge(r.Time),(i===t.expired||i===t.raw)&&(this.removeCaption(n),n--)},getAge:function(n){var u=this,i=this.options,r;return r=n+i.expiredAfter<i.currentPosition?t.expired:n+i.expiringAfter<i.currentPosition?t.expiring:n+i.staleAfter<i.currentPosition?t.stale:i.currentPosition<n-i.allowBefore?t.raw:t.fresh}})})(jQuery)
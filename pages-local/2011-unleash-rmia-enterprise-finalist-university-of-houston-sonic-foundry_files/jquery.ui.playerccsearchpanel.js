(function(n){n.widget("ui.playersearchpanel",{options:{presentation:null,ids:{header:"ui-playersearchpanel-header",scroll:"ui-playersearchpanel-scroll",scrollWrapper:"ui-playersearchpanel-scroll-wrapper",searchWrapper:"ui-playersearchpanel-search-wrapper",searchBar:"ui-playersearchpanel-search-bar",searchField:"ui-playersearchpanel-search-field",searchButton:"ui-playersearchpanel-search-button",searchResults:"ui-playersearchpanel-search-results",searchResultsWrapper:"ui-playersearchpanel-search-results-wrapper",searchResultsScroll:"ui-playersearchpanel-search-results-scroll",searchTotalResults:"ui-playersearchpanel-search-total-results",modalMask:"ui-playersearchpanel-modalmask",msgDialog:"ui-playersearchpanel-dialog"},classes:{panel:"ui-playersearchpanel",header:"panel-header",searchListItem:"ui-playersearchpanel-search-list-item",searchHighlight:"ui-playersearchpanel-search-highlight",searchResultType:"ui-playersearchpanel-search-list-item-type",searchListItemText:"ui-playersearchpanel-search-list-item-text",searchListItemTime:"ui-playersearchpanel-search-list-item-time",inputStretch:"input-stretch",header:"panel-header",modalMask:"panel-modal-mask"},scrollbarColor:"rgba(255,255,255,0.5)",javascriptResize:!0,margin:50,onCaptionClick:null,onSearch:null,disableCaptionDisplay:!1,scrollbarColor:"rgba(255,255,255,0.5)",searchResultMaxLength:100},_setOption:function(n,t){this.options[n]=t,this._bindCaptions(),this._super("_setOption",n,t)},_create:function(){var i=this,t=i.options,u,r;this.element.addClass(t.classes.panel),u='<p id="'+t.ids.header+'" class="'+t.classes.header+'">'+Mediasite.Player.Localization.Search.Header+'</p><div id="'+t.ids.searchWrapper+'"><div id="'+t.ids.searchBar+'"><form><input type="text" name="name" id="'+t.ids.searchField+'" class="'+t.classes.inputStretch+'" /><input id="'+t.ids.searchButton+'" type="submit" value="'+Mediasite.Player.Localization.Common.Search+'" /></form></div><div id="'+t.ids.searchTotalResults+'">'+Mediasite.Player.Localization.Search.Search+'</div><div id="'+t.ids.searchResultsWrapper+'"><div id="'+t.ids.searchResultsScroll+'"><ul id="'+t.ids.searchResults+'" /></ul></div></div></div><div id="'+t.ids.modalMask+'" class="'+t.classes.modalMask+'"><div id="'+t.ids.msgDialog+'" class="'+t.classes.dialog+'"><div id="'+t.ids.dialogTitle+'" class="'+t.classes.dialogTitle+'"/><div id="'+t.ids.dialogText+'" class="'+t.classes.dialogText+'"/><button id="'+t.ids.dismissDialog+'" class="'+t.classes.dismissDialog+'">'+Mediasite.Player.Localization.Common.OK+"</button></div></div>",this.divMarkup=n(u).appendTo(this.element),r=function(n){n.preventDefault(),i._bindCaptions()},n("#"+t.ids.searchButton).click(r),n("form",this.element).submit(r),n("#"+t.ids.modalMask,i.element).hide(),n("#"+t.ids.dismissDialog).click(function(){n("#"+t.ids.modalMask,i.element).hide()}),n(window).resize(function(){i._updateLayout()})},destroy:function(){var n=this.options;this.element.removeClass(n.classes.panel),this.divMarkup.remove()},_init:function(){this._bindCaptions(),this._updateLayout()},updateLayout:function(){this._updateLayout()},_updateLayout:function(){var e=this,t=e.options,u=e.element;if(t.javascriptResize){n("."+t.classes.inputStretch,u).width(u.innerWidth()-n("#"+t.ids.searchButton).outerWidth()-t.margin);var r=n("#"+t.ids.searchResultsWrapper),i=u.height(),f=r.offset().top;f-=u.offset().top,f-=parseInt(u.css("padding-top"),10)||0,i-=f,i-=parseInt(r.css("margin-top"),10)||0,i-=parseInt(r.css("margin-bottom"),10)||0,i-=parseInt(r.css("padding-top"),10)||0,i-=parseInt(r.css("padding-bottom"),10)||0,r.height(i),n("#"+t.ids.searchResultsScroll).iscroll({scrollbarColor:t.scrollbarColor})}},_formatsearchTerm:function(n){var r=0,t=n,i;return(n.charAt(0)=="+"||n.charAt(0)=="*"||n.charAt(0)=="?")&&(n=n.substring(1,n.length)),i=/[()\[\]\\]/g,n=n.replace(i,""),t!=n&&n==""&&(n=t),n=jQuery.trim(n)},_containsInvalidChars:function(n){var t=/[()\[\]\\]/g;return n.charAt(0)=="+"||n.charAt(0)=="*"||n.charAt(0)=="?"||n!=n.replace(t,"")},_bindCaptions:function(){var r=this,t=r.options,f=t.presentation,i=n("#"+t.ids.searchField).val(),u=n("#"+t.ids.searchResults,r.element);if(i=this._formatsearchTerm(i),i!="")if(n("li",u).remove(),this._containsInvalidChars(i))n("#"+t.ids.searchTotalResults).html(Mediasite.Player.Localization.Search.SearchTotal.replaceholders(0,'<span class="'+t.classes.searchHighlight+'">'+i+"</span>")),this._updateLayout();else if(n("#"+t.ids.searchTotalResults).html(Mediasite.Player.Localization.Search.CurrentlySearching.replaceholders('<span class="'+t.classes.searchHighlight+'">'+i+"</span>")),jQuery.isFunction(t.onSearch))t.onSearch(i)},displayResults:function(t,i){var p=this,r=p.options,d=r.presentation,g=t.toLowerCase(),y,f,v,l,s,h;if(n("#"+r.ids.searchTotalResults).html(Mediasite.Player.Localization.Search.SearchTotal.replaceholders(i.length,'<span class="'+r.classes.searchHighlight+'">'+t+"</span>")),y=n("#"+r.ids.searchResults,p.element),y.empty(),i.length>0){f=Mediasite.Player.Localization.Search.SearchHitsInItem,f&&f.length>0||(f="%%0%%%");for(v in i){var e=i[v],u=e.Text,o=e.Time;switch(e.Type){case Mediasite.TimingEventType.Caption:this.options.disableCaptionDisplay?u=Mediasite.Player.Localization.Search.VoiceSearchResult:u&&(l=new RegExp("("+t+")","gi"),s=u.match(l),u=u.replace(l,'<span class="'+r.classes.searchHighlight+'">$1</span>'),s&&s.length>1&&(u+='<span class="'+r.classes.searchHighlight+'"> ('+f.replaceholders(s.length)+")</span>"));break;case Mediasite.TimingEventType.SlideText:u=Mediasite.Player.Localization.Search.SlideSearchResult}h="";switch(e.Type){case Mediasite.TimingEventType.Caption:h=this.options.disableCaptionDisplay?Mediasite.Player.Localization.Search.VoiceResult:Mediasite.Player.Localization.Search.CaptionResult;break;case Mediasite.TimingEventType.SlideText:h=Mediasite.Player.Localization.Search.OcrTextResult}var w=parseInt(v)+1,a=Mediasite.Player.TimeHelper.Duration(o),k=Mediasite.Player.Localization.Common.TimeAriaLabel.replaceholders(a.hours,a.minutes,a.seconds),b=Mediasite.Player.Localization.Common.SearchResultsAriaLabel.replaceholders(w,k,e.Text),c=n('<li class="'+r.classes.searchListItem+'" tabindex="0" role="button" aria-label="'+b+'" ><div class="'+r.classes.searchListItemText+'">'+u+'</div><span class="'+r.classes.searchResultType+'">'+h+'</span><span class="'+r.classes.searchListItemTime+'">'+Mediasite.Player.TimeHelper.getDisplayFromDuration(o,!0)+"</span></li>");if(r.onCaptionClick){c.click({onCaptionClick:r.onCaptionClick,itemTime:o},this._onCaptionClick);c.on("keyup",function(t){(t.keyCode==32||t.keyCode==13)&&(t.stopPropagation(),t.preventDefault(),n(this).trigger("click",{onCaptionClick:r.onCaptionClick,itemTime:o}))})}y.append(c)}}this._updateLayout()},_onCaptionClick:function(n){n.data.onCaptionClick(n.data.itemTime)},displayError:function(){var t=this,r=t.options,f=Mediasite.Player.Localization.Search.SearchFailureTitle,e=Mediasite.Player.Localization.Search.SearchFailureDetail,i,u;t._overlayState(!0),t._killDisplayMessage(),i=n('<div id="'+r.ids.msgDialog+'"></div>'),i.appendTo(t.element),u={title:f,message:e,allowClose:!1,dialogClass:"panelMessage",width:r.msgDialogWidth?r.msgDialogWidth:t.element.innerWidth()-4,modal:!1,close:function(){t._overlayState(!1)},position:{my:"center top",at:"center top+100",of:t.element},appendTo:t.element},i.messagedisplay(u),t._msgDialogInterval=setInterval(function(){t.element.is(":visible")||(t._overlayState(!1),clearInterval(t._msgDialogInterval))},500)},_overlayState:function(t){var i=this,r=i.options;t?n("#"+r.ids.modalMask,i.element).show():n("#"+r.ids.modalMask,i.element).hide()},_killDisplayMessage:function(){var i=this,r=i.options,t=n("#"+r.ids.msgDialog,i.element);t.length>0&&(t.hasClass("messagedisplayinit")&&t.messagedisplay("destroy"),t.remove())}})})(jQuery)
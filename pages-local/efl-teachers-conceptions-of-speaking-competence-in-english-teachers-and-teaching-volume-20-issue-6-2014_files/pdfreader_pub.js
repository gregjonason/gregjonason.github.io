var CWFileAPI={fsMode:"fsAPI",fs:null,blobUrl:null,dontHideSplash:!1,fallBackObj:{},defferredAction:{obj:null,callback:void 0,reset:function(){this.obj=null;this.callback=void 0;CWPDFReader.processingPub=!1}},checkAvailableFS:function(){return"blobAPI"},updateProgFunc:function(a){a.lengthComputable?CWPDFReader.showLoadProgress(a.loaded/a.total,!0):CWPDFReader.showLoadProgress()},initFileSystem:function(a){CWFileAPI.fallBackObj=a;window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;
window.requestFileSystem(window.TEMPORARY,52428800,function(b){CWFileAPI.fs=b;void 0!=a.blob&&CWFileAPI.writeFileBlob(a)},CWFileAPI.fileSysErrHand)},writeFileBlob:function(a){var b=(new Date).getTime();a.metaData&&a.metaData.identifier&&(b=a.metaData.identifier,b=b.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,""));var c=a.blob,e=a.metaData,d=a.action;CWFileAPI.fs.root.getFile(b,{create:!0},function(a){a.createWriter(function(b){b.onwriteend=function(b){CWUtils.log("Write completed.");b=a.toURL();CWFileAPI.performAction(d,
b,e)};b.onerror=function(a){CWUtils.log("Write failed: "+a.toString())};b.write(c)},CWFileAPI.fileSysErrHand)},CWFileAPI.fileSysErrHand)},fileSysErrHand:function(a){var b="";switch(a.code){case FileError.QUOTA_EXCEEDED_ERR:b="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:b="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:b="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:b="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:b="INVALID_STATE_ERR";break;default:b=
"Unknown Error"}CWFileAPI.setBlobUrl(CWFileAPI.fallBackObj);CWUtils.log("Error: "+b)},getFileBlob:function(a,b,c,e){function d(a){try{var b=new XMLHttpRequest;b.open("GET",a);b.responseType="blob";b.send();return b}catch(c){window.chrome&&(CWlogger.logConsole("This PDF violates content security policy, please install Chrome extension to view this PDF in colwiz Reader.","Content Security Policy",!0),window.location.hash="",CWPDFReader.hideSplashScr())}}var f=a;CwZ("#cw-loader").find(".cross").off("click").on("click",
function(a){g.abort();CWPDFReader.hideSplashScr()});var h=!1;CWFileAPI.fsMode=CWFileAPI.checkAvailableFS();if(0>a.indexOf("blob")){var g=d(a);"vir"==b?(CWPDFReader.showSplashScr(),g.addEventListener("progress",CWFileAPI.updateProgFunc,!1),CwZ("#cw-loader").find(".cross").show()):"atl"==b&&g.addEventListener("progress",function(a){a.lengthComputable&&(a=a.loaded/a.total,a=Math.floor(100*a),CWPDFReader.showProgress("pdfDownload","",a,c.index))},!1);g.onabort=function(a){h=!1;setTimeout(CWPDFReader.closeDialog,
300);CwZ("#cw-loader").find(".cross").off("click");g.abort()};g.onerror=function(a){a=f;var b=document.createElement("a");b.href=a;a=b.hostname==location.hostname;if(0==g.status&&!a)if(CWUtils.log("CrossDomain"),window.location.hash="",CWPDFReader.hideSplashScr(),CWPDFReader.openPDFBlobLink=null,CwZ("#cw-pdfFrame").hide(),CwZ("#cw-pdfFrame").remove(),CwZ("#cw-loader").hide(),CwZ("body").css("overflow",""),CWPDFReader.urlToOpen="",CWPDFReader.pageURL="",CWDataCenter.sendOnce=!1,CWPDFReader.pdfFrameRef=
null,a=c.index,CWPDFReaderConfig.readerMode==CWPDFReaderMode.Webimporter)CwZ("#bmkcommunication")[0].contentWindow.postMessage(JSON.stringify({message:"crossoriginpdf",params:{index:a}}),"*"),window.chrome&&CWlogger.logConsole("This PDF violates content security policy, please install Chrome extension to view this PDF in colwiz Reader.","Content Security Policy",!0);else if(c.index){if(a=CwZ(".cw-btnContainer a[data-pub='"+a+"']").parent().eq(0))a=CwZ(a).find(".cw-openPdfReader"),CWPDFReader.selectedPDFIndex=
-1,a.removeClass("cw-ldr"),a.addClass("cw-vir"),a.find("span").html(CWPDFReaderConfig.pubModeBtnsTxt.add),a.find("em").html("Save article PDF and metadata to your colwiz Library. Access anywhere, cite them and generate bibliographies.");CWlogger.logConsole("This PDF violates content security policy, please install Chrome extension to view this PDF in colwiz Reader.","Content Security Policy",!0)}};g.onreadystatechange=function(d){if(!h&&CwZ("#cw-loader").is(":visible"))h=!0,CwZ("#cw-loader").find(".cross").show();
else if(200==this.status){if(4==this.readyState){var f=this.response;c&&(c.blobType=f.type);if("vir"==b&&0<=f.type.indexOf("text/html"))if(CWFileAPI.dontHideSplash=!0,CWPDFReaderConfig.readerMode==CWPDFReaderMode.Webimporter){window.location.hash="";d=c.index;f=CwZ(".cw-btnContainer a[data-pub='"+d+"']");f.removeClass("cw-ldr").addClass("cw-vir");CWPDFReader.selectedPDFIndex=-1;var g=CWPDFReaderConfig.pubModeBtnsTxt.add,k="Save article PDF and metadata to your colwiz Library. Access anywhere, cite them and generate bibliographies.";
"undefined"!=typeof publisher&&"undefined"!=typeof publisher.pubModeBtnsTxt&&(publisher.pubModeBtnsTxt.view&&(g=publisher.pubModeBtnsTxt.view),publisher.pubModeBtnsTxt.viewHover&&(k=publisher.pubModeBtnsTxt.viewHover));f.find("span").html(g);f.find("em").html(k);CwZ("#bmkcommunication")[0].contentWindow.postMessage(JSON.stringify({message:"closeaccesspdf",params:{index:d}}),"*");CwZ(".cw-splash-content .cw-content").hide();CwZ(".cw-splash-content .cw-access").show();CwZ(".cw-splash .cw-progress").hide()}else d=
CWHtmlStructure.generateReaderHash(e.PDFURL,e.INDEX,!0),history.replaceState({},{},CWPDFReader.pageURL+"#"+d),a=CWPDFReader.UpdateQueryString("redirect",1,a),window.location.replace(a),publisher.readerOptions.showClosedAccessmessage&&(CwZ(".cw-splash-content .cw-content").hide(),CwZ(".cw-splash-content .cw-access").show(),CwZ(".cw-splash .cw-progress span").text("Please wait, we are redirecting you to login page"));else CWPDFReader.processingPub=!1,CWUtils.log(f),CWPDFReader.fileBlob.blob=f,d={blob:f,
action:b,metaData:c},"fsAPI"==CWFileAPI.fsMode?CWFileAPI.initFileSystem(d):"blobAPI"==CWFileAPI.fsMode&&CWFileAPI.setBlobUrl(d)}}else if(200!=this.status&&0!=this.status&&"atl"!=b)CWPDFReader.processingPub=!1,window.location=a;else if(4==this.readyState&&403==this.status){CWPDFReader.processingPub=!1;if(f=this.response)c.blobType=f.type;d={blob:f,action:b,metaData:c};CWFileAPI.setBlobUrl(d)}else 200!=this.status&&"atl"==b&&4==this.readyState&&(CWUtils.log("302 error in downloading"),CWPDFReader.processingPub=
!1,CWPDFReader.fileBlob.blob=f,d={blob:f,action:b,metaData:c},"fsAPI"==CWFileAPI.fsMode?CWFileAPI.initFileSystem(d):"blobAPI"==CWFileAPI.fsMode&&CWFileAPI.setBlobUrl(d))}}else CWPDFReader.processingPub=!1,CWFileAPI.performAction(b,a,c)},setBlobUrl:function(a){window.URL=window.URL||window.webkitURL;var b=a.action,c=a.metaData;a=a.blob;try{var e=window.URL.createObjectURL(a)}catch(d){}CWFileAPI.performAction(b,e,c)},performAction:function(a,b,c){CWFileAPI.blobUrl=b;CWFileAPI.defferredAction.reset();
void 0!=c&&"text/html"!==c.blobType&&(c.blobLink=b,c.data&&(c.data.blobLink=b));if(isMobileDevice())window.location.href=b,CWPDFReader.hideSplashScr();else try{switch(CWPDFReader.urlToOpen=b,a){case "atl":CWDataCenter.setPubSelected(c);CWDataCenter.setMetaData(c,c.index);CWDataCenter.addToLibrary(c.index);break;case "vir":CWPDFReader.initIFrame()}}catch(e){CWDataCenter.postMsgToSentry(e)}}},CWDataAggregator=function(){function a(){if(0<c){var a=b;b={};c=0;CWDataCenter.postToTracker("events",JSON.stringify(a))}}
var b={},c=0;setInterval(a,5E3);return{increment:function(a){b.hasOwnProperty(a)?b[a]++:(b[a]=1,c++)},keys:function(){var a=[],c;for(c in b)b.hasOwnProperty(c)&&a.push(c);return a},forceFlush:function(){a()},clearAll:function(){b={};c=0}}}(),CWDataCenter={pub:[],pubSelected:null,sendOnce:!1,eventsHolder:[],exceptionHolder:[],postMsgToSentry:function(a){CWPDFReader.isErrorlogsFrameLoaded?(CWUtils.log("SENTRY ERROR "+a.message),-1!=CWPDFReaderConfig.cwURL.indexOf(CWPDFReaderConfig.sentryDomain)&&a.message&&
0<CwZ("#errorlogs").length&&(a.stack+="\n\n ******* -- publisherVersion",CWUtils.log("sending post msg in publisher version"),0<CwZ("#errorlogs").length&&CwZ("#errorlogs")[0].contentWindow.postMessage({message:"sentryException",data:a.stack},"*"))):(0==CwZ("#errorlogs").length&&CWPDFReader.initSentryFrame(),CWDataCenter.exceptionHolder.push(a))},signoutCall:function(){CWComManager.tell("signoutCallToColwiz",{view:"cwFrame"},"cwFrame")},redirectToMyProfile:function(){CWComManager.tell("redirectToMyProfile",
{view:"cwFrame"},"cwFrame")},postToTracker:function(a,b){CWPDFReader.isColwizFrameLoaded?CWComManager.tell("postToTracker",{view:"cwFrame",action:a,metaData:b},"cwFrame"):(CWPDFReader.initColwizFrame(),CWDataCenter.eventsHolder.push(a))},polling:function(){CWComManager.tell("polling",{view:"cwFrame"},"cwFrame")},setPubSelected:function(a){a&&(CWDataCenter.pubSelected=a,CWComManager.tell("pubSelected",{metaData:a,view:"cwFrame"},"cwFrame"))},loadConfig:function(){CWComManager.tell("loadConfig",{view:"cwFrame"},
"cwFrame")},updateUserDOM:function(){CWComManager.tell("updateUserDOM",{view:"cwFrame"},"cwFrame")},getFileId:function(){CWComManager.tell("getFileId",{view:"cwFrame"},"cwFrame")},syncData:function(){var a=CWFileAPI.defferredAction;a.obj||a.callback||(a.obj="sync",a.callback=function(){CWComManager.tell("syncData",{view:"cwFrame"},"cwFrame");CWFileAPI.defferredAction.reset()});CWComManager.tell("checkLogin",{view:"cwFrame"},"cwFrame")},saveComments:function(a){CWComManager.tell("saveComments",{cmtString:a,
view:"cwFrame"},"cwFrame")},createPublication:function(a){void 0==a||0==a.data.length?CWPDFReader.getMetaData(CWDataCenter.pubSelected,CWDataCenter.processTasks):CWComManager.tell("createPublication",{obj:a,view:"cwFrame"},"cwFrame")},addToLibrary:function(a,b){CWUtils.log(a);a||(a=CWDataCenter.pubSelected.index,CWUtils.log("correctedPublink"),CWUtils.log(a));this.postToTracker("addlib");var c=CWFileAPI.defferredAction;c.obj||c.callback||(c.obj=a,c.callback=function(){CWComManager.tell("addToLibrary",
{index:a,view:"cwFrame"},"cwFrame");CWFileAPI.defferredAction.reset()},CWComManager.tell("checkLogin",{showSignIn:b,view:"cwFrame"},"cwFrame"))},downloadPDF:function(a){saveAs(a.blob,a.name+".pdf")},shareFile:function(){},setPublisherOptions:function(a){CWComManager.tell("setPublisherOptions",{colwizOptions:a,view:"cwFrame"},"cwFrame")},resetVariables:function(){CWComManager.tell("resetVariables",{view:"cwFrame"},"cwFrame")},setLoginShown:function(a){CWComManager.tell("isLoginShown",{isLoginShown:a,
view:"cwFrame"},"cwFrame")},setPageMeta:function(a){CWComManager.tell("setPageMeta",{hashMeta:a,view:"cwFrame"},"cwFrame")},setMetaData:function(a,b){CWComManager.tell("setMetaData",{metaData:a,index:b,view:"cwFrame"},"cwFrame")},processTasks:function(){CWComManager.tell("processTasks",{view:"cwFrame"},"cwFrame")},findFile:function(a){CWComManager.tell("findFile",{bAccess:a,view:"cwFrame"},"cwFrame")},removeAllTasks:function(){CWComManager.tell("removeAllTasks",{view:"cwFrame"},"cwFrame")},checkPendingTasks:function(){CWComManager.tell("checkPendingTasks",
{view:"cwFrame"},"cwFrame")},setImporter:function(){CWComManager.tell("setImporter",{view:"cwFrame"},"cwFrame")}},CWComManager={init:function(){window.addEventListener("message",CWComManager.dom_onMessage,!1)},dom_onMessage:function(a){a=a.data;if("hideLoginFrame"==a)CWComManager.tell("hideLoginPrompt",{view:"pdfFrame"},"pdfFrame"),CwZ("#cw-loginFrame").hide(),CWDataCenter.setLoginShown(!1),CWDataCenter.loadConfig(),CWDataCenter.postToTracker("login"),null!==CWFileAPI.defferredAction.obj&&void 0!==
CWFileAPI.defferredAction.callback&&CWFileAPI.defferredAction.callback(),CWDataCenter.updateUserDOM(),CWFileAPI.defferredAction.reset();else{if("loginFailed"!=a){if("closeLoginFrame"==a){"#nbb"!=location.hash?(CWPDFReader.closeLoginFrame(),CWDataCenter.setLoginShown(!1)):window.history.back();CWFileAPI.defferredAction.reset();return}if("signupSuccess"==a){CWComManager.tell("hideLoginPrompt",{view:"pdfFrame"},"pdfFrame");CwZ("#cw-loginFrame").hide();CWDataCenter.setLoginShown(!1);CWDataCenter.loadConfig();
CWDataCenter.postToTracker("signup");null!==CWFileAPI.defferredAction.obj&&void 0!==CWFileAPI.defferredAction.callback&&CWFileAPI.defferredAction.callback();CWFileAPI.defferredAction.reset();CWDataCenter.updateUserDOM();return}}!a.message||void 0!=a.data&&"mainExt"!=a.data.view||CWComManager.processMessage(a)}},tell:function(a,b,c){b=b||{};var e;"cwFrame"==c?(e=CwZ("#cw-colwizFrame")[0],CWPDFReader.isColwizFrameLoaded||CWUtils.log("message lost:"+a)):"pdfFrame"==c?e=CwZ("#cw-pdfFrame")[0]:"cwAuth"==
c&&(e=CwZ("#cw-loginFrame")[0]);e&&e.contentWindow.postMessage({message:a,data:b},"*")},processMessage:function(a){if(a.message){switch(a.message){case "parseTargetLink":CWParser.parsePDFText(a.data.data.linkIndex,a.data.data.linkRect,a.data.data.divRect,a.data.data.preTargetText,a.data.data.postTargetText,a.data.data.targetText,a.data.data.dest,a.data.data.annotLinkPosX,a.data.data.annotLinkPosY,a.data.data.itemsArr);break;case "cwSentryLoaded":CWPDFReader.isErrorlogsFrameLoaded=!0;for(var b in CWDataCenter.exceptionHolder)CWDataCenter.postMsgToSentry(CWDataCenter.exceptionHolder[b]);
CWDataCenter.exceptionHolder=[];break;case "setPublicationId":CWComManager.tell("setPublicationId",{gotoLibUrl:a.data.pubId,view:"pdfFrame"},"pdfFrame");break;case "webpdfloaded":CWDataCenter.setImporter();CWUtils.log("webpdf success");break;case "addlib":CWDataCenter.postToTracker(a.message);break;case "showLogoutBox":CWPDFReader.showLogoutBox();break;case "postToTracker":CWDataCenter.postToTracker(a.data.message);break;case "dialogEvent":CWDataAggregator.increment(a.data.message);break;case "writeCookie":CWDataCenter.writeCookie(a.data.cookieName,
a.data.cookieValue);break;case "closeDialog":CWPDFReader.closeDialog(!0);break;case "addtolib":CWDataCenter.addToLibrary(void 0,a.data.showSignIn);break;case "downloadPDF":CWDataCenter.downloadPDF(CWPDFReader.fileBlob);break;case "shareFile":CWDataCenter.shareFile();break;case "setBlobUrl":CWFileAPI.setBlobUrl(a.data);break;case "sendException":CWDataCenter.postMsgToSentry(a.data);break;case "redirectToMyProfile":CWDataCenter.redirectToMyProfile();break;case "signoutCall":CWDataCenter.signoutCall();
break;case "sync":CWDataCenter.syncData();break;case "initIframe":CWPDFReader.initIFrame();break;case "commentAdded":CWDataCenter.sendOnce||(CWDataCenter.sendOnce=!0,CWPDFReader.isLogin||CWComManager.tell("showLoginPrompt",{view:"pdfFrame"},"pdfFrame"));break;case "setPdfFrame":CWPDFReader.setPdfFrame(a.data.frameString);break;case "iframe-loaded":if("pdfFrame"==a.data.source){var c=function(){CWPDFReader.loginResponse&&CWPDFReader.isColwizFrameLoaded?(CWDataCenter.setPageMeta(CWPDFReader.hashMeta),
CWDataCenter.setPubSelected(e),CWPDFReader.isLogin&&CWDataCenter.getFileId()):setTimeout(function(){c()},500)};CwZ("#cw-pdfFrame").show();void 0!=colwizOptions&&(CWPDFReaderConfig.readerMode==CWPDFReaderMode.Webimporter&&(publisher=b=CwZ("#cw-pdfFrame")[0].contentWindow.publisher),colwizOptions&&document.getElementById("cw-pdfFrame").contentWindow.CWPDFReader.changeReaderLogo());CWComManager.tell("url",{url:CWPDFReader.urlToOpen,pubSelected:CWPDFReader.records[CWPDFReader.selectedPDFIndex],view:"pdfFrame"},
"pdfFrame");CWDataCenter.resetVariables();CWDataCenter.setPublisherOptions(CWPDFReader.colwizOptions);b=CWPDFReader.selectedPDFIndex;var e;if(0<=b){CWDataCenter.loadConfig();(e=CWPDFReader.records[b])&&(0<=CWPDFReader.urlToOpen.indexOf("filesystem:")||0<=CWPDFReader.urlToOpen.indexOf("blob:"))&&(e.blobLink=CWPDFReader.urlToOpen);CWDataCenter.setPubSelected(e);var d=(new Date).toLocaleDateString(),f=e.title,f=Base64.decode(f),f=f.substr(0,10);CWPDFReader.fileBlob.name=d+("_"+f);CWPDFReader.selectedPDFIndex=
-1;CWDataCenter.postToTracker("openpdf");b=CwZ(".cw-btnContainer").eq(b);try{0<b.length&&(b.find("span").eq(0).text(CWPDFReaderConfig.pubModeBtnsTxt.view),b.removeClass("cw-ldr").addClass("cw-vir"))}catch(h){}CWPDFReader.extractReferenceFromPage(e)}CWPDFReader.loginResponse?(CWDataCenter.setPageMeta(CWPDFReader.hashMeta),CWDataCenter.setPubSelected(e),CWPDFReader.isLogin&&CWDataCenter.getFileId()):c();CwZ("body").css("overflow","hidden");e&&e.identifier&&CWComManager.tell("logAnalytics",CWPDFReaderConfig.cwURL+
"/openReader?pubId="+CWPDFReader.colwizOptions.appId+"&ident="+e.identifier,"cwAuth")}else if("cwFrame"==a.data.source&&(CWPDFReader.isColwizFrameLoaded=!0,CWDataCenter.loadConfig(),CWDataCenter.setPublisherOptions(CWPDFReader.colwizOptions),0<CWDataCenter.eventsHolder.length)){for(d in CWDataCenter.eventsHolder)CWComManager.tell("postToTracker",{view:"cwFrame",action:CWDataCenter.eventsHolder[d],metaData:CWDataCenter.pubSelected},"cwFrame");CWDataCenter.eventsHolder=[]}CWDataCenter.updateUserDOM();
0==CWPDFReader.buttonsInjected&&(CWPDFReader.buttonsInjected=!0);break;case "saveComments":CWUtils.log("Save Comments String:"+a.data.cmtString);CWDataCenter.saveComments(a.data.cmtString);break;case "loadComments":CWPDFReader.pdfFrameRef&&CWPDFReader.pdfFrameRef.CWCommentManager.loadComments(a.data.commentStr);break;case "getComments":CWPDFReader.pdfFrameRef&&CWDataCenter.saveComments(CWPDFReader.pdfFrameRef.CWCommentManager.getCommentsString());break;case "getData":if(CWParser){var g=a.data.metadata;
CWParser.getData({metadata:g,success:function(a,b){g.data=a;g.type=b;CWDataCenter.setMetaData(g,g.index)}})}break;case "defferredAction":b=CWFileAPI.defferredAction;CWPDFReader.checkLoginInProgress=!1;a.data.loggedIn?void 0!=b.obj&&b.callback&&b.callback():"checkForDownloadPopup"==b.obj||"checkForAddLibPopup"==b.obj?void 0!=b.obj&&b.callback&&b.callback():(a.data.showSignIn&&CwZ("#cw-loginFrame")[0].contentWindow.postMessage({message:"sendShowLogin",param:{}},"*"),CwZ("#cw-loginFrame").show(),CWDataCenter.setLoginShown(!0));
break;case "showLoginFrame":CwZ("#cw-loginFrame").show();CWDataCenter.setLoginShown(!0);break;case "sendJSONToReader":CWComManager.tell("sendJSONToReader",{jsonData:a.data.jsonData,view:"pdfFrame"},"pdfFrame");break;case "sendShowLogin":CwZ("#cw-loginFrame")[0].contentWindow.postMessage({message:"sendShowLogin",param:{}},"*");CwZ("#cw-loginFrame").show();CWDataCenter.setLoginShown(!0);break;case "hideSplashScr":CWPDFReader.hideSplashScr();break;case "showProgress":CWPDFReader.showProgress(a.data.type,
a.data.message,a.data.progress,a.data.index);break;case "hideProgress":CWPDFReader.hideProgress(a.data.timeout,a.data.index);break;case "hasPubInLib":CWPDFReader.hasPubInLib(a.data.bValue,a.data.index);break;case "updateUser":null!=CWPDFReader.pdfFrameRef&&void 0!=CWPDFReader.pdfFrameRef.CWPDFReader&&CWPDFReader.pdfFrameRef.CWPDFReader.updateUser(a.data);break;case "uploadFile":void 0!=CWPDFReader.urlToOpen&&(0<=CWPDFReader.urlToOpen.indexOf("filesystem:")||0<=CWPDFReader.urlToOpen.indexOf("blob:"))&&
(a.data.blobLink=CWPDFReader.urlToOpen);CWPDFReader.uploadFile(a.data.pdfLink,a.data.index,a.data.params,a.data.blobLink);break;case "postFile":CWPDFReader.postFile(a.data.obj,a.data.url);break;case "getMetaData":CWPDFReader.getMetaData(a.data.metaData,CWDataCenter.setMetaData);break;case "showSyncMode":null!=CWPDFReader.pdfFrameRef&&CWPDFReader.pdfFrameRef.CWPDFReader.showSyncMode();break;case "showAddMode":null!=CWPDFReader.pdfFrameRef&&CWPDFReader.pdfFrameRef.CWPDFReader.showAddMode();break;case "logoutCallback":CWComManager.tell("logoutCallback",
{view:"pdfFrame"},"pdfFrame");break;case "unsyncedChanges":CWPDFReader.unsyncedChanges=!0;break;case "syncedChanges":CWPDFReader.unsyncedChanges=!1;CwZ(window).off("beforeunload");break;case "set_bLogin":CWPDFReader.set_bLogin(a.data.bLogin);break;case "logConsole":CWPDFReader.logConsole(a.data.strText,a.data.strHeading,a.data.bPromptUser);break;case "hideSyncingDisplay":CWPDFReader.hideSyncingDisplay();break;case "checkForPDFAccess":CWPDFReader.checkForPDFAccess(a.data.pdfLink);break;case "setPendingTasks":CWPDFReader.setPendingTasks(a.data.value);
break;case "checkDropdownLogin":0==CWPDFReader.checkLoginInProgress&&(b=CWFileAPI.defferredAction,b.obj="checkForAddLibPopup",b.callback=function(){CWComManager.tell("checkLoginResponse",{isLogin:CWPDFReader.isLogin,view:"pdfFrame"},"pdfFrame");CWFileAPI.defferredAction.reset()},CWPDFReader.checkLoginInProgress=!0,CWComManager.tell("checkLogin",{view:"cwFrame"},"cwFrame"));break;case "checkDownloadLogin":0==CWPDFReader.checkLoginInProgress&&(b=CWFileAPI.defferredAction,b.obj="checkForDownloadPopup",
b.callback=function(){CWComManager.tell("checkDownloadResponse",{isLogin:CWPDFReader.isLogin,view:"pdfFrame"},"pdfFrame");CWFileAPI.defferredAction.reset()},CWPDFReader.checkLoginInProgress=!0,CWComManager.tell("checkLogin",{view:"cwFrame"},"cwFrame"));break;case "getRelatedPubs":CWComManager.tell("getRelatedPubs",{view:"cwFrame",data:a.data.message.url},"cwFrame");break;case "setRelatedPubs":CWComManager.tell("setRelatedPubs",{data:a.data,view:"pdfFrame"},"pdfFrame");break;case "addRelatedPub":b=
CWFileAPI.defferredAction;b.obj={};b.callback=function(){CWComManager.tell("addRelatedPub",{view:"cwFrame",eId:a.data.eId},"cwFrame");CWFileAPI.defferredAction.reset()};CWComManager.tell("checkLogin",{view:"cwFrame"},"cwFrame");break;case "addRelatedPubResp":CWComManager.tell("addRelatedPubResp",{data:a.data.value,view:"pdfFrame"},"pdfFrame")}CWUtils.log("pdfreader_pub.js processMessage:"+a.message)}}},CWPDFReader={urlToOpen:"",pageURL:"",pdfFrameRef:null,colwizOptions:null,bPDFFrameLoaded:!1,records:[],
hashMeta:{},fileBlob:{blob:null,name:null},btnHash:null,frameHTML:"",isLogin:!1,oldPageHash:"",processingPub:!1,unsyncedChanges:!1,bPdfFrameLoaded:!1,buttonsInjected:!1,isColwizFrameLoaded:!1,isErrorlogsFrameLoaded:!1,currentPubReferences:null,selectedPDFIndex:-1,loginResponse:!1,checkLoginInProgress:!1,init:function(){CWUtils.log("LOADING PARSER Pub: "+CWPDFReaderConfig.parser);try{CWParser.parsePage?(clearTimeout(CWPDFReader.initilizeTimeout),CWComManager.init(),CWPDFReader.colwizOptions=window.colwizOptions,
CWParser.parsePage({success:function(a){CWUtils.log("linkCount:"+a);CwZ("body").append('<div style="display: none" id="CWDailogOverlay" class="cw-dialog-overlay" ><div class="cw-dailog cw-success"><h1>Sign up Successful</h1><i></i><p>Welcome to colwiz. An activation email has been sent. To get back into your account, follow the instructions we\'ve sent to you.</p><button id="btnCancel" class="primary-btn" >Close</button></div></div>');if(0<CwZ(".cw-addToLib").length)CwZ(".cw-addToLib").off("click").on("click",
CWPDFReader.addToLibrary);if(0<CwZ(".cw-openPdfReader").length)CwZ(".cw-openPdfReader").off("click").on("click",function(){var a=CwZ(this);CWUtils.log(a);a=a.closest(".cw-btnContainer").data("metadata");void 0!=a.blobLink&&(CWPDFReader.openPDFBlobLink=a.blobLink);CWPDFReader.openDialog();CWPDFReader.onHashChange()});if(0<CwZ(".showDownloadPopup").length)CwZ(".showDownloadPopup").off("click").on("click",function(a){function b(){function a(){CwZ("#downloadPopupOverlay").remove();e.each(function(a){"downloadPopupOverlay"!=
CwZ(e[a]).attr("id")&&CwZ(e[a]).attr("aria-hidden","false")});CwZ(h).focus()}0!=CwZ("#downloadPopupOverlay").length&&CwZ("#downloadPopupOverlay").remove();c.pubLink=c.pubLink.replace("abs/","full/");var d;d='<div role="dialog" aria-labelledby="downloadPopupHead" id="downloadPopupOverlay" aria-describedby="downloadPopupHead" class="cw-dialog-overlay"><div id="downloadPopup" class="cw-dailog"><a href="javascript:void(0);" id="closeDownloadPopup" title="Close"></a><div id="downloadPopupHead">';d+="<h1>"+
Base64.decode(c.title)+"</h1>";d+="</div>";d+='<div id="downloadPopupBody">';d+='<a href="'+c.pdfLink+'" target="_blank" id="downloadPdf">';d+="<b></b>";d+="<span>Download as PDF</span>";d+="</a>";d+='<a href="'+c.pubLink+"#"+btoa(c.pdfLink+"@@@0")+'" id="viewIPDF" style="position:relative">';d+="<b></b>";d+="<span>View Interactive PDF</span>";d+='<em style="">'+publisher.pubModeBtnsTxt.viewHover+"</em>";d+="</a>";d+='<a href="javascript:void(0);" id="resetTabInd"></a>';publisher.showAddButton&&(d+=
'<a href="javascript:void(0);" id="SavePDF" style="width:140px; float:left; margin-left:10px; position:relative">',d+="<b></b>",d+="<span>Save Interactive PDF to colwiz</span>",d+="<em>Want to read later? Save it to a free library which you can access from your computer and mobile.</em>",d+="</a>");d+="</div>";d+="</div></div>";CwZ("body").append(d);var e=CwZ("body").children();e.each(function(a){"downloadPopupOverlay"!=CwZ(e[a]).attr("id")&&CwZ(e[a]).attr("aria-hidden","true")});var h=CwZ(":focus");
d=CwZ("#downloadPopupOverlay");d.attr("aria-hidden","false");d.find("*").filter("a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]").filter(":visible").first().focus();CwZ("#closeDownloadPopup,#downloadPopupBody a").off("click").on("click",function(b){if("downloadPdf"===CwZ(this).attr("id")){if(CWDataCenter.postToTracker("downloadPopup",c),CwZ("#downloadPopupOverlay").hide(),
CWPDFReaderConfig.readerMode==CWPDFReaderMode.Publisher)try{ga("send","event","button","colwiz \u2013 Download PDF")}catch(d){}}else if("viewIPDF"===CwZ(this).attr("id")){b.preventDefault();if(CWPDFReaderConfig.readerMode==CWPDFReaderMode.Publisher)try{ga("send","event","button","colwiz \u2013 Interactive PDF")}catch(e){}CWDataCenter.postToTracker("viewIPDFPopup",c);b=c.pubLink+"#"+btoa(c.pdfLink+"@@@0");CwZ("#downloadPopupOverlay").hide();publisher.readerOptions.readerSamePage?window.location.hash=
btoa(c.pdfLink+"@@@"+c.index):window.open(b,"_blank")}else"SavePDF"===CwZ(this).attr("id")?CWDataCenter.addToLibrary(c.index):CwZ("#downloadPopupOverlay").hide();a()});CwZ("#downloadPopupOverlay").on("click",function(b){"cw-dialog-overlay"==b.target.classList&&a()});CwZ("#resetTabInd").on("focus",function(){CwZ("#closeDownloadPopup").focus()});CwZ("body").off("keydown").on("keydown",function(b){27==b.keyCode&&a()})}a.preventDefault();var c=CwZ(this).data("metadata"),h=c.pubLink+"#"+btoa(c.pdfLink+
"@@@0");switch(a.which){case 1:a.ctrlKey?window.open(h):(CWDataCenter.postToTracker("optionPopup",c),b());break;case 2:window.open(h)}});var c={};0<a.length&&(CWPDFReader.records=a,CwZ(a).each(function(e){var d=a[e];d.index=e;c[e]||(d.title=Base64.encode(d.title));c[e]=d}),CWPDFReader.hashMeta=c);CWPDFReader.onHashChange()},addButton:CWHtmlStructure.insertButtonsOnPage}),CWDataCenter.loadConfig(),CWPDFReader.checkBrowser(),setTimeout(function(){try{CwZ("#bmkcommunication")[0].contentWindow.postMessage(JSON.stringify({message:"webpdfloaded",
param:{}}),"*")}catch(a){}},2E3)):CWPDFReader.initilizeTimeout=setTimeout(CWPDFReader.init,100)}catch(a){CWUtils.log(a),CWDataCenter.postMsgToSentry({view:"mainExt",message:a.message,stack:a.stack})}},UpdateQueryString:function(a,b,c){c||(c=window.location.href);var e=new RegExp("([?&])"+a+"=.*?(&|#|$)(.*)","gi"),d;if(e.test(c)){if("undefined"!==typeof b&&null!==b)return c.replace(e,"$1"+a+"="+b+"$2$3");d=c.split("#");c=d[0].replace(e,"$1$3").replace(/(&|\?)$/,"");"undefined"!==typeof d[1]&&null!==
d[1]&&(c+="#"+d[1]);return c}"undefined"!==typeof b&&null!==b&&(e=-1!==c.indexOf("?")?"&":"?",d=c.split("#"),c=d[0]+e+a+"="+b,"undefined"!==typeof d[1]&&null!==d[1]&&(c+="#"+d[1]));return c},initSentryFrame:function(){var a='<iframe id="errorlogs" style="display: none; position: fixed; top: 0px; left:0px; z-index:9001; border: 0px;" width="100%" height="100%" src="https://'+CWPDFReaderConfig.sentryDomain+'/errorlogs?type=1"></iframe>';CwZ("body").append(a)},initIFrame:function(){if(0<CwZ("#cw-pdfFrame").length)return!0;
0>=CwZ("#cw-pdfFrame").length&&CwZ("body").append("<iframe allowfullscreen webkitallowfullscreen mozallowfullscreen id='cw-pdfFrame' style='display: none; position: fixed; top: 0px; left:0px; z-index:9000; border: 0px; background-color: rgba(0, 0, 0, 0.5)' width='100%' height='100%' onload='CWPDFReader.onLoadIframe()' data-version='1.001'></iframe>");return!1},onLoadIframe:function(){try{if(!CWPDFReader.bPDFFrameLoaded){0<=CWPDFReader.urlToOpen.indexOf("filesystem:")||0<=CWPDFReader.urlToOpen.indexOf("blob:")?
CWPDFReader.updateIFrame(CWPDFReader.urlToOpen):CWFileAPI.getFileBlob(CWPDFReader.urlToOpen,"vir");CWPDFReader.bPDFFrameLoaded=!0;try{CwZ("html").css("overflow","hidden")}catch(a){}}}catch(b){CWDataCenter.postMsgToSentry({view:"mainExt",message:b.message,stack:b.stack})}},closeDialog:function(a){if(1==CWPDFReader.unsyncedChanges)1==confirm("You have unsaved changes. If you leave the page these changes will be lost.")?(CWPDFReader.unsyncedChanges=!1,CWPDFReader.close(a),CWDataAggregator.forceFlush()):
location.hash=CWPDFReader.oldPageHash;else{CWPDFReader.unsyncedChanges=!1;try{CwZ("html").css("overflow","")}catch(b){}CWPDFReader.close();CWDataAggregator.forceFlush()}},initSplashScr:function(){var a="";CwZ(".cw-btnContainer").eq(1).hasClass("ascelibrary-detail")&&(a="asceOverlay");a=CWHtmlStructure.getSplashScreen(a);CwZ("body").append(a);CwZ.fn.center=function(){this.css("position","fixed");this.css("top","0px");this.css("left","0px");return this}},showSplashScr:function(){CwZ("#cw-loader").center();
setTimeout(function(){CwZ("#cw-loader").show();CwZ("#cw-loader").center()},200);CwZ("#cw-loader").find(".cross").hide();CWUtils.log("shown cw-loader")},hideSplashScr:function(){CwZ(".cw-splash-content .cw-content").show();CwZ(".cw-splash-content .cw-access").hide();CwZ(".cw-splash .cw-progress span").text("Loading article...");CwZ(".cw-splash .cw-progress").show();CwZ("#cw-loader").remove()},showLoadProgress:function(a){CwZ("#cw-loader .cw-progress").addClass("cw-indefinite");isNaN(a)?CwZ("#cw-loader .cw-bar").width("100%"):
CwZ("#cw-loader .cw-bar").width(Math.floor(100*a)+"%")},updateIFrame:function(a){var b=CWHtmlStructure.getHead(CWPDFReaderConfig.staticDomainURL+"/js/webpdf",CWPDFReaderConfig.staticDomainURL+"/css/webpdf",cPDF?cPDF.version:"15.10.13-161-29"),c=CWHtmlStructure.getBody(CWPDFReaderConfig.cwURL+"/images/webpdf/",a),c=c.replace(/reqFilesURL/g,CWPDFReaderConfig.staticDomainURL),c=c.replace('<input id="cw-pdfURL" type="hidden" value="pdfUrl"/>','<input id="cw-pdfURL" type="hidden" value="'+a+'"/>'),b="<html><head>"+
b+"</head><body class='cw-prefix'>"+c+"</body></html>";CWUtils.log("IFRAME UPDATED");CWPDFReader.pdfFrameRef=CwZ("#cw-pdfFrame").get(0).contentWindow;c=CWPDFReader.pdfFrameRef.document.open("text/html","replace");c.write(b);c.close();CwZ("#cw-pdfURL").attr("value",a)},setPdfFrame:function(a){CWPDFReader.frameHTML=a},initLoginFrame:function(){var a='<iframe id="cw-loginFrame" style="display: none; position: fixed; top: 0px; left:0px; z-index:9001; border: 0px;" width="100%" height="100%" src="'+(CWPDFReaderConfig.cwURL+
"/cwauth?appid="+("undefined"!==typeof publisher&&publisher.appId?publisher.appId:location.hostname)+"&public=1")+'"></iframe>';CwZ("body").append(a)},initColwizFrame:function(){var a="",a=CWPDFReaderConfig.cwURL+"/js/webpdf/pages/ireader.html?v="+cPDF.version;0>=CwZ("#cw-colwizFrame").length&&(a="<iframe allowfullscreen webkitallowfullscreen mozallowfullscreen id='cw-colwizFrame' style='display: none; position: fixed; top: 0px; left:0px; z-index:0; border: 0px;' width='0%' height='0%' onload='CWPDFReader.onLoadColwizIframe()' src='"+
a+"' data-version='"+cPDF.version+"'></iframe>",CwZ("body").append(a))},onLoadColwizIframe:function(){CWDataCenter.setPublisherOptions(CWPDFReader.colwizOptions);CWDataCenter.setPubSelected(CWDataCenter.pubSelected);for(var a in CWPDFReader.hashMeta)break},showLogoutBox:function(){CWComManager.tell("showLogoutBox",{view:"pdfFrame"},"pdfFrame")},showServerDown:function(){CWComManager.tell("showLogoutBox",{view:"pdfFrame"},"pdfFrame")},hideSyncingDisplay:function(){CWComManager.tell("hideSyncingDisplay",
{view:"pdfFrame"},"pdfFrame")},postFile:function(a,b){var c=CWFileUpload.fileData,e=CwZ("#cw-fileUpload").data("blueimpFileupload");e.options.formData=a;e.options.url=b;c.submit()},openDialog:function(a){if(!(void 0!=a&&a.originalEvent instanceof MouseEvent)){var b=null,c="";CWUtils.log(a);if(void 0!=a)if(b=CwZ(".cw-openPdfReader[data-pub="+a.INDEX+"]"),null!=CWPDFReader.openPDFBlobLink?(CWUtils.log("opening the pdf from blob that's already in browser's memory"),c=CWPDFReader.openPDFBlobLink):c=a.PDFURL,
a.FORWARDED)c=CWHtmlStructure.generateReaderHash(a.PDFURL,a.INDEX),history.replaceState({},{},CWPDFReader.pageURL+"#"+c),history.back();else if(b&&c){CWPDFReader.initSplashScr();CWPDFReader.btnHash=a;var e=parseInt(a.INDEX);CWFileAPI.getFileBlob(c,"vir",CWPDFReader.records[e],a);CWUtils.log("initializing colwiz and login iframes");CWPDFReader.initColwizFrame();CWPDFReader.initLoginFrame();CWDataCenter.setPubSelected(CWPDFReader.records[e]);CWDataCenter.postToTracker("clickpdf",CWPDFReader.records[e]);
CWPDFReader.selectedPDFIndex=e;CWPDFReader.records.length-1>=e?CWPDFReader.records[e].pdfLink!==a.PDFURL&&(e=a.PDFURL.replace("/pdf/","/abs/")+"#"+btoa(a.PDFURL+"@@@0"),window.location.replace(e)):(e=a.PDFURL.replace("/pdf/","/abs/")+"#"+btoa(a.PDFURL+"@@@0"),window.location.replace(e));CWPDFReaderConfig.readerMode===CWPDFReaderMode.Webimporter&&CWDataCenter.setPubSelected(CWPDFReader.records[a.INDEX]);b.removeClass("cw-vir").addClass("cw-ldr");b.find("span").text("Loading IPDF Reader");a=b.closest(".cw-btnContainer").data("metadata");
CWPDFReader.urlToOpen=void 0!=a&&void 0!=a.blobLink?a.blobLink:c}}},onHashChange:function(){if(location.hash!=CWPDFReader.PDFHash){var a=location.href,b=location.hash;CWPDFReader.PDFHash=location.hash;CWUtils.log("HASH CHANGE: "+b);var c=-1<Base64.decode(b).indexOf("@@@");if("#nbb"==location.hash&&"hidden"==CwZ("body").css("overflow"))window.history.back(),window.history.back();else if("#nbb"!=location.hash)if(c){for(var c=b.split("#"),e=0;e<c.length;e++)try{if(-1<Base64.decode(c[e]).indexOf("@@@")){b=
c[e];break}else b=""}catch(d){CWUtils.log(d)}b=b.replace("#","");0<b.length?(CWPDFReader.oldPageHash=window.location.hash,CWPDFReader.pageURL=a.replace("#"+b,""),a=CWHtmlStructure.decodeReaderHash(b),void 0!=a&&void 0!=a.PDFURL&&a.PDFURL!=CWPDFReader.urlToOpen&&CWPDFReader.openDialog(a)):1==CWPDFReader.unsyncedChanges?1==confirm("You have unsaved changes. If you leave the page these changes will be lost.")?(CWPDFReader.unsyncedChanges=!1,CWPDFReader.close(),CWPDFReader.closeLoginFrame()):location.hash=
CWPDFReader.oldPageHash:(CWPDFReader.close(),CWPDFReader.closeLoginFrame())}else setTimeout(function(){CWPDFReader.closeDialog()},1E3)}},close:function(a){CWPDFReader.PDFHash="";CWPDFReader.bPDFFrameLoaded=!1;PDFHash="";CWPDFReader.openPDFBlobLink=null;CwZ("#cw-pdfFrame").hide();CwZ("#cw-pdfFrame").remove();CWFileAPI.dontHideSplash||(CwZ("#cw-loader").hide(),CwZ(".cw-splash-content .cw-content").show(),CwZ(".cw-splash-content .cw-access").hide(),CwZ(".cw-splash .cw-progress span").text("Loading article..."),
CwZ(".cw-splash .cw-progress").show());CwZ("body").css("overflow","");CWPDFReader.urlToOpen="";CWPDFReader.pageURL="";CWDataCenter.sendOnce=!1;CWPDFReader.pdfFrameRef=null;history.replaceState({},{},location.protocol+"//"+location.host+location.pathname+(location.search?location.search:""));var b=CwZ(".cw-openPdfReader.cw-ldr");0<b.length&&(b.removeClass("cw-ldr").addClass("cw-vir"),b.find("span").text(CWPDFReaderConfig.pubModeBtnsTxt.view));a&&(location.hash="");CWComManager.tell("findPubsCall",
{view:"cwFrame"},"cwFrame")},addToLibrary:function(a,b){try{b=CwZ(this);var c=b.closest(".cw-btnContainer").data("metadata");b.hasClass("cw-vil")?window.open(CWPDFReaderConfig.cwURL+"/app?x=1c","_blank"):(CWPDFReader.processingPub?CWPDFReader.showProgress("queue","Queued to add","",c.index):(CWPDFReader.processingPub=!0,void 0!=c.pdfLink&&0<c.pdfLink.length?CWPDFReader.showProgress("wait","Processing PDF","",c.index):CWPDFReader.showProgress("wait","Processing...","",c.index)),void 0!=c&&(CWFileAPI.defferredAction.obj=
c,CWFileAPI.defferredAction.callback=c.blobLink?function(){CWFileAPI.getFileBlob(c.blobLink,"atl",c);CWFileAPI.defferredAction.reset()}:function(){CWFileAPI.getFileBlob(c.pdfLink,"atl",c);CWFileAPI.defferredAction.reset()},CWComManager.tell("checkLogin",{view:"cwFrame"},"cwFrame")))}catch(e){CWDataCenter.postMsgToSentry({view:"mainExt",message:e.message,stack:e.stack})}},setPendingTasks:function(a){if(a)CwZ(window).on("beforeunload",function(){return"You have unsaved changes. If you leave the page these changes will be lost."});
else CwZ(window).off("beforeunload")},showLoginFrame:function(){CwZ("#cw-loginFrame").show()},closeLoginFrame:function(){CwZ("#cw-loginFrame").hide();var a=CwZ(".cw-qta");0<a.length&&(a.removeClass("cw-qta").addClass("cw-atl"),a.find("span").html(CWPDFReaderConfig.pubModeBtnsTxt.add),a.find("em").html("Save article PDF and metadata to your colwiz Library. Access anywhere, cite them and generate bibliographies."));a=CwZ(".cw-ail");0<a.length&&(a.removeClass("cw-ail").addClass("cw-atl"),a.find("span").html(CWPDFReaderConfig.pubModeBtnsTxt.add),
a.find("em").html("Save article PDF and metadata to your colwiz Library. Access anywhere, cite them and generate bibliographies."));CWComManager.tell("hideWaitingMsg",{view:"pdfFrame"},"pdfFrame");CWDataCenter.removeAllTasks();CWDataCenter.checkPendingTasks()},showProgress:function(a,b,c,e){if(CWPDFReader.isLogin||"wait"==a)if(CWPDFReader.pdfFrameRef)CWPDFReader.pdfFrameRef.CWPDFReader.showProgress(a,b,c);else if(void 0!=e&&(b=CwZ(".cw-btnContainer a[data-pub='"+e+"']").parent().eq(0))){var d=CwZ(b).find(".cw-addToLib");
if("queue"==a)d.removeClass("cw-atl"),d.addClass("cw-qta"),d.find("span").html("Queued to Add"),d.find("b").width("0%"),d.find("em").html("Adding Reference to colwiz Library");else if("pdfDownload"==a)d.find("b").width(c+"%");else if("bInLibrary"==a)d.find("b").width("100%"),setTimeout(function(){d.removeClass("cw-atl");d.removeClass("cw-ail");d.removeClass("cw-qta");d.addClass("cw-vil");var a="View in colwiz Library",b="This article is already in your Library. Click to view in colwiz.";"undefined"!=
typeof publisher&&"undefined"!=typeof publisher.pubModeBtnsTxt&&(publisher.pubModeBtnsTxt.inMyLib&&(a=publisher.pubModeBtnsTxt.inMyLib),publisher.pubModeBtnsTxt.inMyLibHover&&(b=publisher.pubModeBtnsTxt.inMyLibHover));d.find("span").html(a);d.find("em").html(b)},600);else if("addPub"==a)d.removeClass("cw-atl"),d.removeClass("cw-qta"),d.addClass("cw-ail"),d.find("span").html("Adding Metadata"),d.find("b").width(c+"%"),d.find("em").html("Adding Reference to colwiz Library");else if("progress"==a)d.removeClass("cw-atl"),
d.removeClass("cw-qta"),d.addClass("cw-ail"),d.find("span").html("Adding PDF"),50>=c&&d.find("b").width(parseInt(c+50)+"%"),d.find("em").html("Uploading PDF to colwiz Library");else if("wait"==a)d.removeClass("cw-atl"),d.removeClass("cw-qta"),d.addClass("cw-ail"),d.find("span").html("Processing PDF"),d.find("em").html("Please wait");else if("userLoggedOut"==a||"failure"==a)d.removeClass("cw-vil"),d.removeClass("cw-ail"),d.removeClass("cw-qta"),d.addClass("cw-atl"),d.find("span").html(CWPDFReaderConfig.pubModeBtnsTxt.add),
d.find("em").html("Save article PDF and metadata to your colwiz Library. Access anywhere, cite them and generate bibliographies.")}},hideProgress:function(a,b){try{if(CWPDFReader.pdfFrameRef)CWPDFReader.pdfFrameRef.CWPDFReader.hideProgress(a);else if(void 0!=b){var c=CwZ(".cw-btnContainer:eq("+b+") .cw-addToLib");c&&(void 0==a&&(a=0),setTimeout(function(){CwZ(c).find(".cw-process-btn, .cw-progress, .cw-sync").hide();CwZ(c).find(".cw-progress i").width("0%")},a))}}catch(e){CWDataCenter.postMsgToSentry(e)}},
hasPubInLib:function(a,b){null!=CWPDFReader.pdfFrameRef&&void 0!=CWPDFReader.pdfFrameRef.CWPDFReader?CWDataCenter.pubSelected.index==b&&CWPDFReader.pdfFrameRef.CWPDFReader.hasPubInLib(a):a&&CWPDFReader.showProgress("bInLibrary","View in colwiz Library",0,b)},uploadFile:function(a,b,c,e){try{null!=c.euId&&(CWFileUpload.euId=c.euId),null!=c.fileId&&(CWFileUpload.fileId=c.fileId),CWFileUpload.upload(a,b,e)}catch(d){CWDataCenter.postMsgToSentry({view:"mainExt",message:d.message,stack:d.stack})}},getUploadParams:function(a){CWComManager.tell("getUploadParams",
a,"cwFrame")},uploadSync:function(a){CWPDFReader.pdfFrameRef&&(a.doSync=!0);CWComManager.tell("uploadSync",a,"cwFrame")},failureHandler:function(a){CWComManager.tell("failureHandler",a,"cwFrame")},logConsole:function(a,b,c){CWPDFReader.pdfFrameRef?CWPDFReader.pdfFrameRef.CWPDFReader.logConsole(a,b,c):c?(c=CwZ("#CWDailogOverlay"),c.find("#btnCancel").off("click").on("click",function(){CwZ("#CWDailogOverlay").hide()}),b&&c.find("h1").text(b),a&&c.find("p").text(a),"Sign up Successful"!=b&&"Log in Successful"!=
b?CwZ("#CWDailogOverlay").find(".cw-dailog").removeClass("cw-success").addClass("cw-error"):CwZ("#CWDailogOverlay").find(".cw-dailog").addClass("cw-success").removeClass("cw-error"),0==CwZ("#CWDailogOverlay").is(":visible")&&c.show()):CWUtils.log(a)},getData:function(a,b){},getMetaData:function(a,b){try{a.dataUrl?CWParser.getData({metadata:a,success:function(c,d){a.data=Base64.encode(c);b&&b(a,a.index)}}):CWUtils.log("No meta object found"+a)}catch(c){CWDataCenter.postMsgToSentry({view:"mainExt",
message:c.message,stack:c.stack})}},set_bLogin:function(a){CWPDFReader.loginResponse=!0;CWPDFReader.checkLoginInProgress=!1;CWPDFReader.isLogin=a;CWComManager.tell("setLogin",{value:a,view:"pdfFrame"},"pdfFrame")},checkForPDFAccess:function(a){CwZ.ajax({type:"HEAD",url:a,success:function(a,c,e){0<=e.getResponseHeader("Content-Type").indexOf("pdf")?CWDataCenter.findFile(!0):CWDataCenter.findFile(!1)},error:function(a){switch(a.status){case 401:case 403:case 0:CWDataCenter.findFile(!1)}}})},extractReferenceFromPage:function(a){CWParser.extractReference&&
(CWParser.isListingPage()||CWParser.isSearchingPage&&CWParser.isSearchingPage()?ajaxRequest.get({url:a.refLink,type:"GET",success:function(a){a=CwZ(a);CWPDFReader.currentPubReferences=CWParser.getReference(a);CWPDFReader.processReference()},error:function(){CWPDFReader.processReference()}}):CWParser.isPubPage()&&(CWPDFReader.currentPubReferences=CWParser.getReference(CwZ("body")),CWPDFReader.currentPubReferences&&1==CWPDFReader.currentPubReferences.length&&1==CWPDFReader.currentPubReferences[0].refsNotFound?
ajaxRequest.get({url:a.refLink,type:"GET",success:function(a){a=CwZ(a);CWPDFReader.currentPubReferences=CWParser.getReference(a);CWPDFReader.processReference()}}):CWPDFReader.processReference()))},processReference:function(){var a=!1;1==CWPDFReader.currentPubReferences.length&&CWPDFReader.currentPubReferences[0].refsNotFound&&(a=!0,CWPDFReader.currentPubReferences.pop());0!=CWPDFReader.currentPubReferences.length||a||CWDataCenter.postMsgToSentry({view:"mainExt",message:"References Not Extracted",
stack:"Could not extract references from page: "+window.location.toString()});CWComManager.tell("recordsOnPage",{records:CWPDFReader.currentPubReferences,view:"pdfFrame"},"pdfFrame")},postBadReference:function(){var a="",b;for(b in CWPDFReader.currentPubReferences){var c=CWPDFReader.currentPubReferences[b];c.bad&&(a+=""==a?c.id:", "+c.id)}a=a.trim();""!==a&&CWDataCenter.postMsgToSentry({view:"mainExt",message:"Bad References found",stack:"Bad references found on page: "+window.location.toString()+
"\r\n Reference number: "+a})},checkBrowser:function(){}},ajaxRequest={get:function(a){var b=new XMLHttpRequest;b.open(a.type,a.url);b.onreadystatechange=function(){4==b.readyState&&(200==b.status?a.success(b.responseText):a.error(b.responseText))};b.send()}};window.onbeforeunload=function(){var a=!1;CwZ(".cw-btnContainer .cw-addToLib").each(function(){1==CwZ(this).hasClass("cw-ail")&&(a=!0)});if(1==a)return"Are you sure you want to navigate away. All changes will be lost."};
initFunction=function(){try{var a=function(){var c=window.location.href,f="";try{f=atob(window.location.hash.replace("#",""))}catch(l){}-1!=f.indexOf("@@@")&&(c=c.split("#")[0]);if(d!=c){c=window.location.hash;try{c=Base64.decode(c)}catch(m){}if(-1==c.indexOf("@@@")||-1==window.location.hash.indexOf("nbb")||-1==d.indexOf("nbb"))CWPDFReader.init(),CWDataCenter.pubSelected=null;try{b=atob(window.location.hash.replace("#",""))}catch(n){}e=-1!=b.indexOf("@@@");d=window.location.href;e&&(d=d.split("#")[0])}setTimeout(function(){a()},
5E3)};if(!CWUtils.isIframe)if(""==CWPDFReaderConfig.parser)CWUtils.log("NO PARSER LOADED");else{CWUtils.log("LOADED PARSER : "+CWPDFReaderConfig.parser);window.addEventListener("hashchange",CWPDFReader.onHashChange,!1);var b="";try{b=atob(window.location.hash.replace("#",""))}catch(c){}var e=-1!=b.indexOf("@@@"),d=window.location.href;e&&(d=d.split("#")[0]);a();CWPDFReader.init()}}catch(f){}};initFunction();

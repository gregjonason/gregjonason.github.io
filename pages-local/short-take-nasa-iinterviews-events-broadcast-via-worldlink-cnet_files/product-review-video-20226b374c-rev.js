define(["jquery","version!fly/managers/debug","managers/tealium","managers/page-vars","version!fly/components/base","components/"+("string"==typeof CnetPageVars.tracking.data.testGroup&&"uvp"===CnetPageVars.tracking.data.testGroup?"cnet-video-uvp":"cnet-video")],function(e,t,i,a){t=t.init("productReviewVideo"),e.widget("cnet.productReviewVideo",e.fly.base,{options:{closeButtonParent:"#mediaCarousel",shouldAutoplay:!1,scrollOnClick:!1,videoParent:"#mediaCarousel",playVideoElement:".videoSlide"},playerLoaded:!1,playBackStarted:!1,playerOpen:!1,autoPlayInitiated:!0,$player:null,$playerObject:null,timer:null,_create:function(){t.log("_create"),this._setup(),this._findPlayer(),this._setupPlayerListeners(),this.initializeVideo()},_findPlayer:function(){this.$player=this.$element.find(".cnetVideoPlayer, .videoPlayer"),t.log("this.$player",this.$player),this.$playerObject=this.$player.find("object")},_setupPlayerListeners:function(){t.log("_setupPlayerListeners");var e=this;e.$element.find(e.options.videoParent).addBack(e.$element).on("onPlayerLoaded onPlayerLoaded_cbsi",function(i){t.log("onPlayerLoaded"),e.playerLoaded=!0});var i=(e.$player.data("cnetVideo"),e.$player.data("cnetVideo"));i&&i.readyToPlay?e.playerLoaded=!0:e.$element.find(e.options.videoParent).addBack(e.$element).on("onShowPlayOverlay",function(i){t.log("onShowPlayOverlay"),e.playerLoaded=!0})},_waitForPlayerLoad:function(){t.log("_waitForPlayerLoad"),this.playerLoaded?(clearTimeout(this.timer),this.toggleVideo(null,!1)):this.timer=setTimeout(e.proxy(this._waitForPlayerLoad,this),250)},initializeVideo:function(){t.log("initializeVideo");var e=this;e.$element.find(e.options.playVideoElement).addBack(e.$element).last().click(function(t){e.toggleVideo(t,!0)}),this.$element.find('[data-item="playOverlay"]').show(),"#autoplay"==window.location.hash&&e.toggleVideo(event,!1)},_makeCloseButton:function(){var e=this,t="<div class='closeButton'>&nbsp;</div>";e.$element.find(e.options.closeButtonParent).addBack(e.$element).prepend(t),e.$element.find(e.options.videoParent).addBack(e.$element).addClass("videoPlaying"),e.$element.find(".closeButton").click(function(t){t.stopPropagation(),e.$element.find(".closeButton").remove(),e.$element.find(e.options.videoParent).addBack(e.$element).removeClass("videoPlaying"),e._trackCloseButton(t),e.toggleVideo(null,!1)})},_toggleVideoPlayerVisibility:function(){var e=this;this.playerOpen?(e.$player.addClass("hide"),e.$playerObject.addClass("hide")):(e.$player.removeClass("hide"),e.$playerObject.removeClass("hide")),e.playerOpen=!e.playerOpen},toggleVideo:function(i,a){var o=this;a=null!=a?a:!0,i&&i.stopPropagation();var n=e("[data-cnet-video-options]",o.$element).data("cnetVideoOptions"),l={};n&&n.videos&&n.videos.length>0&&(l.videoTitle=n.videos[0].title||n.videos[0].headline,l.videoId=n.videos[0].mpxRefId,l.videoSegments="0:M:0",l.collectionId=[null!=n.videos[0].primaryCollection?n.videos[0].primaryCollection.id:null]),"none"==o.$player.css("display")&&o.$player.css("display","block");var d=o.$player.find(".tpPlayer").attr("id");if(o.playerOpen)"undefined"!=typeof window.$pdk?window.$pdk.controller.pause(!0,[d]):"undefined"!=typeof o.$playerObject[0]&&"undefined"!=typeof o.$playerObject[0].pauseVideo?o.$playerObject[0].pauseVideo():window.uvpPlayerRef&&window.uvpPlayerRef.pauseVideo(),o._toggleVideoPlayerVisibility(),o.playerOpen=!1;else{if(!o.playerLoaded)return void o._waitForPlayerLoad();o.playBackStarted?(o._toggleVideoPlayerVisibility(),o._makeCloseButton(),"undefined"!=typeof window.$pdk?(window.$pdk.controller.pause(!1,[d]),a&&o.$player.cnetVideo("trackPerformanceEvent","playclick")):("undefined"!=typeof o.$playerObject[0]&&"undefined"!=typeof o.$playerObject[0].playVideo?o.$playerObject[0].playVideo():window.uvpPlayerRef&&window.uvpPlayerRef.playVideo(),a&&o.$player.cnetVideoUvp("trackPerformanceEvent","playclick"))):(o.$element.find(o.options.videoParent).addBack(o.$element).on("onReleaseStart onPlaylistStart_cbsi",function(e){t.log("onReleaseStart"),o.playerOpen||o._toggleVideoPlayerVisibility()}),o.$element.find(o.options.videoParent).addBack(o.$element).on("onMediaStart",function(e){o._makeCloseButton()}),"undefined"!=typeof window.$pdk?o.$player.cnetVideo("clickPlayButton",a):(o.$player.cnetVideoUvp("playVideo"),o._toggleVideoPlayerVisibility()),o.playBackStarted=!0)}},_trackCloseButton:function(e){i.trackCustomEvent("closeButtonClick",{levtType:"ria",event:"log",mapp:"reviews4505",comp:"closeButton",comptyp:"click",riaevent:"click",pageType:a.tracking.data.pageType,siteEdition:a.tracking.data.siteEdition,siteType:a.tracking.data.siteType,deviceType:a.tracking.data.deviceType,siteSection:a.tracking.data.siteSection,_pageChannelType:a.tracking.data._pageChannelType,articleId:a.tracking.data.articleId,articleTitle:a.tracking.data.articleTitle,articleType:a.tracking.data.articleType,siteHier:a.tracking.data.siteHier,_pageTitle:a.tracking.data._pageTitle,clickGenericText:"close-video"},"trackClick")}})});
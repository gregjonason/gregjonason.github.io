var Library;!function(r){r.container=angular.module("library",["common"])}(Library||(Library={}));
var Library;!function(r){"use strict";var e=function(){function r(r,e,o){var i=this;this.$scope=r,this.libraryService=e,this.urlGenerator=o,r.submitFreeSearch=function(e){if(r.freeSearchForm.freeSearchInput.$valid){var i;e=window.utils.replaceAtWithBlankspace(e);var t=[];t.push({modifier:"AllWords",value:e}),e=window.utils.convertKeywordTermsToNewTermString(t),i=o.getGlobalSearchUrlByFilterType("keywords",e)+"&includeFreePublicationsOnly=true",window.location=i}},r.libraryPicks={popularBooks:[],featuredBooks:[],freeBooks:[],newlyAddedBooks:[]},this.getLibraryItems().success(function(e){angular.forEach(e,function(e){switch(e.Title){case"Popular":r.libraryPicks.popularBooks=e;break;case"NewlyAdded":r.libraryPicks.newlyAddedBooks=e;break;case"PopularFree":r.libraryPicks.freeBooks=e;break;case"Featured":r.libraryPicks.featuredBooks=e,i.topFeaturedBooks=r.libraryPicks.featuredBooks.ReadingMaterial.splice(0,3)}})})}return r.prototype.bookCover=function(r){return"/read/bookcover/"+r},r.prototype.bookUrl=function(r){return this.urlGenerator.getReaderURL(r,"ItemType")},r.prototype.getLibraryItems=function(){return this.libraryService.getLibraryPicks()},r.$inject=["$scope","LibraryService","UrlGenerator"],r}();r.container.controller("LibraryController",e)}(Library||(Library={}));
var Library;!function(t){"use strict";function e(t){return{controller:r,controllerAs:"lic",scope:{title:"@",books:"=qtLibraryIndex"},replace:!0,transclude:!0,templateUrl:"/app/library/directives/qt-library-index/qt-library-index.html",link:function(e,r,i,n){t(function(){e.$watch("title",function(t){n.title=t}),e.$watch("books",function(t){n.books=t})},0)}}}var r=function(){function t(t,e){this.urlGenerator=t,this.authManager=e,e.promiseCurrentUserInfo(),this.itemTypeEnum=this.urlGenerator.APILibraryItemTypeEnum,this.getPageStartId=this.urlGenerator.getPageStartId}return t.prototype.isUserFullAccess=function(){return this.authManager.isUserFullAccess()},t.prototype.isFree=function(t){return"Free"==t},t.prototype.isPromo=function(t){return"TemporarilyFree"==t},t.prototype.isPaid=function(t){return"Paid"==t},t.prototype.contributors=function(t){var e=t.Contributor,r=[];return angular.forEach(e,function(t){r.push(t.Value)}),r.join(", ")},t.prototype.bookUrl=function(t){return this.urlGenerator.getReaderURL(t,"ItemType")},t.prototype.profileUrl=function(t){return this.urlGenerator.getProfileURL(t,"ItemType")},t.prototype.sectionTitle=function(){if(!this.title)return"";switch(this.title.toUpperCase()){case"POPULARFREE":return"";case"POPULAR":return"Popular books";case"NEWLYADDED":return"Newly added books";case"FEATURED":return"Featured";default:return""}},t.prototype.isItemType=function(t,e){return(t.ItemType||"").toLowerCase()==e},t.prototype.getDisplayTitle=function(t){return this.isItemType(t,this.itemTypeEnum.BOOK)&&t.Volume?t.Title+" - Vol. "+t.Volume:t.Title},t.prototype.getActivityText=function(t){var e="",r=[];return"book"==t.ItemType.toLowerCase()?(e+="Title: "+t.Title,t.Subtitle&&(e+=": "+t.Subtitle),e+=t.Volume?" - Vol. "+t.Volume+"\n":"\n",angular.forEach(t.Contributor,function(t,e){r.push(t.Value)}),r.length&&r.length>0&&(e+="Contributor(s): "+r.join(" | ")+"\n"),e+="Publisher: "+t.Publisher+"\n",e+="Year: "+this.getPubYear(t)+"\n",e+="Page: "):(e+="Title: "+t.Title,t.Subtitle&&(e+=": "+t.Subtitle),e+="\n",angular.forEach(t.ContributorsDeDupped,function(t,e){r.push(t.NameFull)}),r.length&&r.length>0&&(e+="Contributor(s): "+r.join(" | ")+"\n"),e+="Publication: "+t.PublicationName+" "+(t.Volume||"")+" "+(t.Issue||"")+" ("+this.getPubYear(t)+"): ")},t.prototype.getPubYear=function(t){var e="";if(t.PublicationDate){var r=t.PublicationDate.split(",");e=2==r.length?$.trim(r[1]):t.PublicationDate}return e},t.$inject=["UrlGenerator","AuthManager"],t}();e.$inject=["$timeout"],t.container.directive("qtLibraryIndex",e)}(Library||(Library={}));
var Common;!function(t){"use strict";function e(t){return{restrict:"A",controller:i,controllerAs:"sp",scope:!0,replace:!0,templateUrl:"/app/common/directives/save-publication/save-publication.html",link:function(e,i,n,o){t(function(){o.pageId=n.pageId,o.docId=n.docId},0)}}}var i=function(){function t(t,e,i){var n=this;this.projectService=t,this.httpManager=e,this.urlGenerator=i,this.error=!1,this.busy=!0,this.init(),this.projectService.registerPublicationChangedCallback(function(t,e,i,o){n.activeProject.ID===t&&n.pageId===e&&n.docId===i&&(n.savedItem=o)})}return t.prototype.init=function(){var t=this;this.projectService.getActiveProject().then(function(e){t.activeProject=e,t.checkItemExist()},function(){t.busy=!1,t.error=!0})},t.prototype.checkItemExist=function(){var t=this;this.projectService.getWorkspaceItems(this.activeProject,["BookshelfItem"],"",0,0,"",!1,this.docId).then(function(e){e&&e.length>0&&(t.savedItem=e[0])},function(){t.error=!0}).then(function(){t.busy=!1})},t.prototype.savePublication=function(){var t=this;this.error=!1,this.busy=!0;var e={ParentID:this.activeProject.ID,ContentID:this.docId,PageID:this.pageId};this.projectService.savePublication(e).then(function(i){t.projectService.getWorkspaceItems(t.activeProject,["BookshelfItem"],"",0,0,"",!1,t.docId).then(function(i){i&&i.length>0&&(t.savedItem=i[0],t.projectService.invokePublicationStatusChanged(e.ParentID,e.PageID,e.ContentID,t.savedItem))},function(){t.busy=!1}).then(function(){t.busy=!1})},function(e){t.error=!0})},t.prototype.removePublication=function(){var t=this;this.error=!1,this.busy=!0;var e=_.find(this.savedItem.Links,function(t){return t&&"self"===t.Relation&&"DELETE"===t.Method});e&&this.projectService.removePublication(this.savedItem).then(function(e){t.savedItem=null,t.projectService.invokePublicationStatusChanged(t.activeProject.ID,t.pageId,t.docId,t.savedItem)},function(e){t.error=!0}).then(function(){t.busy=!1})},t.$inject=["ProjectService","HttpManager","UrlGenerator"],t}();e.$inject=["$timeout"],t.container.directive("savePublication",e)}(Common||(Common={}));
var Common;!function(e){"use strict";function t(e){return{restrict:"A",replace:!0,scope:{term:"@",itemsTotal:"@"},templateUrl:"/app/library/directives/qt-cliff-search/qt-cliff-search.html",link:function(t){var r="/library/cliffs-notes/1";t.original="undefined"==typeof t.term?"":t.term,t.search=function(){e.location.href=""!=t.term?r+"?filter="+t.term:r},t.clear=function(){e.location.href=r}}}}e.container.directive("qtCliffSearch",t),t.$inject=["$window"]}(Common||(Common={}));
var Common;!function(t){"use strict";function n(t,n){return{controller:o,controllerAs:"lmc",restrict:"A",scope:!0,replace:!0,templateUrl:"/app/common/directives/load-malt/load-malt.html",link:function(o,r,e,i){t(function(){i.docId=e.docId,i.load().then(function(t){204==t.status?i.noContent=!0:t.data&&r.append(n(t.data)(o))},function(){i.error=!0}).then(function(){i.busy=!1})},0)}}}var o=function(){function t(t){this.libraryService=t,this.busy=!0,this.error=!1,this.noContent=!1}return t.prototype.load=function(){return this.libraryService.LoadMALT(this.docId)},t.$inject=["LibraryService"],t}();n.$inject=["$timeout","$compile"],t.container.directive("loadMalt",n)}(Common||(Common={}));
var Common;!function(o){"use strict";function e(o){return{restrict:"A",scope:!0,link:function(e,s,n){function l(){i||"quick"==e.shortHide&&r.toggleClass("hidden"),"fade"==e.longShow?c.fadeIn("slow"):c.toggleClass("hidden")}function t(){i||"quick"==e.shortShow&&r.toggleClass("hidden"),"slide"==e.longHide?c.slideUp():c.toggleClass("hidden")}e.shortShow=n.shortShow||"quick",e.shortHide=n.shortHide||"quick",e.longShow=n.longShow||"quick",e.longHide=n.longHide||"quick",e.lessIcon=n.lessIcon||"n",e.moreIcon=n.moreIcon||"o",e.lessText=n.lessText||"Show more",e.moreText=n.moreText||"Show less",e.scrollToTop=n.scrollToTop||"false";var i=!1,c=s.find(".long");0==c.length&&(i=!0,c=s.find(".remain"));var r=s.find(".short");e.showless=!0,e.icon=e.lessIcon,e.text=e.lessText,e.toggle=function(){tracer.log("toggle! showRemaining = "+i),e.showless=!e.showless,e.showless?(t(),"true"==e.scrollToTop&&o.scrollTo(0,0),e.icon=e.lessIcon,e.text=e.lessText):(l(),e.icon=e.moreIcon,e.text=e.moreText)}}}}e.$inject=["$window"],o.container.directive("showMore",e)}(Common||(Common={}));
var Common;!function(s){"use strict";function e(s){return{restrict:"A",scope:!0,replace:!0,templateUrl:"/app/common/directives/show-more/simple-show-more.html",transclude:!0,link:function(e,o,l){function t(){e.showless||("slide"==e.showtype?n.slideDown():n.toggleClass("hidden"))}e.showtype=l.showtype||"slide",e.hidetype=l.hidetype||"slide",e.lessIcon=l.lessIcon||"n",e.moreIcon=l.moreIcon||"o",e.lessText=l.lessText||"Show more",e.moreText=l.moreText||"Show less",e.lessClass=l.lessClass||"collapsed",e.moreClass=l.moreClass||"expanded",e.scrollToTop=l.scrollToTop||"false";var n=o.find(".long");e.showless=!0,e.uxclass=e.lessClass,e.uxicon=e.lessIcon,e.uxtext=e.lessText,e.toggle=function(){t(),e.showless?("true"==e.scrollToTop&&s.scrollTo(0,0),e.uxicon=e.lessIcon,e.uxtext=e.lessText,e.uxclass=e.lessClass):(e.uxicon=e.moreIcon,e.uxtext=e.moreText,e.uxclass=e.moreClass),e.showless=!e.showless},e.toggle()}}}e.$inject=["$window"],s.container.directive("simpleShowMore",e)}(Common||(Common={}));
var Common;!function(e){"use strict";function t(){return{restrict:"A",link:function(e){function t(e){var t=$("#"+e+"List");$("#itemList .library-list").hide(),t.show(),$("#relatedTabbedNav .selected").removeClass("selected"),$("#"+e+"Tab").addClass("selected")}e.select=function(e){var a=angular.element(e.target);if(!a.hasClass("disabled")){var i=a.attr("id").replace("Tab","");t(i)}}}}}e.container.directive("tabs",t)}(Common||(Common={}));
var Common;!function(e){"use strict";function t(){return{restrict:"A",link:function(e){function t(e){var t=$("#"+e+"List");$("#itemList .library-list").hide(),t.show(),$("#relatedTabbedNav .selected").removeClass("selected"),$("#"+e+"Tab").addClass("selected")}e.change=function(e){t(e)}}}}e.container.directive("pubTypeDropdown",t)}(Common||(Common={}));
angular.module("common").directive("noImage",function(){var n=function(n,r,t){var a="<span class='undefined-cover'><span> No cover image</span><span class='tiny-qta-logo'></span></span>";n.parent().html(a),""!=t&&$("[src='"+t+"']").parent().html(a)};return{restrict:"A",link:function(r,t,a){r.$watch(function(){return a.ngSrc},function(){var r=a.ngSrc;r||n(t,a.title,"")}),t.bind("error",function(){n(t,a.title,a.src)})}}});
!function(t){t.fn.hoverIntent=function(e,n){var o={sensitivity:7,interval:100,timeout:0};o=t.extend(o,n?{over:e,out:n}:e);var r,i,u,v,s=function(t){r=t.pageX,i=t.pageY},a=function(e,n){return n.hoverIntent_t=clearTimeout(n.hoverIntent_t),Math.abs(u-r)+Math.abs(v-i)<o.sensitivity?(t(n).unbind("mousemove",s),n.hoverIntent_s=1,o.over.apply(n,[e])):(u=r,v=i,n.hoverIntent_t=setTimeout(function(){a(e,n)},o.interval),void 0)},h=function(t,e){return e.hoverIntent_t=clearTimeout(e.hoverIntent_t),e.hoverIntent_s=0,o.out.apply(e,[t])},m=function(e){var n=jQuery.extend({},e),r=this;r.hoverIntent_t&&(r.hoverIntent_t=clearTimeout(r.hoverIntent_t)),"mouseenter"==e.type?(u=n.pageX,v=n.pageY,t(r).bind("mousemove",s),1!=r.hoverIntent_s&&(r.hoverIntent_t=setTimeout(function(){a(n,r)},o.interval))):(t(r).unbind("mousemove",s),1==r.hoverIntent_s&&(r.hoverIntent_t=setTimeout(function(){h(n,r)},o.timeout)))};return this.bind("mouseenter",m).bind("mouseleave",m)}}(jQuery);
function openAutoComplete(){$("#typeAheadLoadingImg").toggle(),$(".ui-autocomplete").children("li:odd").addClass("odd")}function PublicationFormat(t,e){return unescape(t)}function PublicationParser(t){var e=new Array;0==t.length&&(e[0]={data:noMatchingText,value:noMatchingText,result:noMatchingText,label:'<span class="errMsg">'+noMatchingText+"</span>"});for(var n=0;n<t.length;n++)e[n]={data:t[n],value:t[n].URL,result:unescape(t[n].Name),label:"<a>"+PublicationFormat(t[n].Name)+"</a>"};return e}function SelectPublication(t){return t==noMatchingText?!1:($("#txtSiFindPubs").val(""),$(document).trigger("OMNITURE_CLICK",{actionName:"SiteIndex|PubFinder"}),location=t,void $("#txtSiFindPubs").val(""))}function InitializeSearch(){$("#txtSiFindPubs").autocomplete({source:function(t,e){$.ajax({url:"/PublicationTypeAhead",dataType:"json",data:{term:t.term},success:function(t){e(PublicationParser(t))}})},search:function(t,e){return""==$.trim(t.target.value)?!1:($("#typeAheadLoadingImg").toggle(),!0)},minLength:3,html:!0,delay:500,select:function(t,e){return SelectPublication(e.item.value),!1},focus:function(t,e){return!1},open:function(t,e){openAutoComplete()}}).data("autocomplete")._renderItem=function(t,e){return $("<li></li>").data("item.autocomplete",e).append(e.label).appendTo(t)}}$().ready(function(){0!=$("#txtSiFindPubs").length&&(InitializeSearch(),$("#txtSiFindPubs").focus(function(){$("#txtSiFindPubs").autocomplete("search")}))});var noMatchingText="No matching periodicals found.";